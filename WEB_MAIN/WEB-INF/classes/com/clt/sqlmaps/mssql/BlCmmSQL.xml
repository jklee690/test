<?xml version="1.0" encoding="UTF-8" ?> 
<!DOCTYPE sqlMap PUBLIC "-//ibatis.apache.org//DTD SQL Map 2.0//EN" "http://ibatis.apache.org/dtd/sql-map-2.dtd">
<sqlMap namespace="bl.cmm"> 
    <typeAlias alias="BlCmmVO"         type="com.clt.apps.fis.see.bmd.housebl.dto.BlCommonVO"/><!-- BL공통정보   -->
    <typeAlias alias="HBLInfoVO"       type="com.clt.apps.fis.see.bmd.housebl.dto.SeeHouseBLVO"/><!-- Ocean House BL 등록 및 조회 정보   -->
    <typeAlias alias="AirHBLInfoVO"    type="com.clt.apps.fis.aie.bmd.housebl.dto.AieHouseBLVO"/><!-- Air House BL 등록 및 조회 정보   -->
    <typeAlias alias="BkgCntrInfoVO"   type="com.clt.apps.fis.see.bmd.housebl.dto.BkgCntrVO"/><!-- House BL 등록 및 조회 정보   -->
    <typeAlias alias="CntrLstVO"       type="com.clt.apps.fis.see.bmd.housebl.dto.CntrListVO"/><!-- Container목록   -->
    <typeAlias alias="ItmLstVO"        type="com.clt.apps.fis.see.bmd.housebl.dto.HblItemVO"/><!-- Container목록   -->
    <typeAlias alias="JobListVO"       type="com.clt.apps.fis.see.bmd.housebl.dto.HblItemVO"/><!-- Container목록   -->
    <typeAlias alias="DimInfoVO"       type="com.clt.apps.fis.aie.bmd.housebl.dto.DimVO"/><!-- Dimension정보를 등록 및 조회 정보   -->
    <typeAlias alias="PLCIBLInfoVO"    type="com.clt.apps.fis.see.bmd.housebl.dto.PLCIBLInfoVO"/><!-- COMMERCIAL INVOICE   -->
    <typeAlias alias="BkgPoInfoVO"     type="com.clt.apps.fis.see.bmd.housebl.dto.BkgPurOrdVO"/><!-- Booking PO 정보를 등록 및 조회 정보   -->
    <typeAlias alias="BkgPoItemInfoVO" type="com.clt.apps.fis.see.bmd.housebl.dto.BkgPurOrdItemVO"/><!-- Booking PO Item 정보를 등록 및 조회 정보   -->
    <typeAlias alias="BkgCntrListVO"   type="com.clt.apps.fis.see.bmd.housebl.dto.BkgCntrListVO"/><!-- Booking PO Item 정보를 등록 및 조회 정보   -->

    <typeAlias alias="SeeMasterBLVO"    	type="com.clt.apps.fis.see.bmd.masterbl.dto.SeeMasterBLVO"/>
    <typeAlias alias="LPBLVO"     			type="com.clt.apps.fis.see.bmd.masterbl.dto.LPBLVO"/>
    <typeAlias alias="QttnInfoVO"    		type="com.clt.apps.fis.see.bmd.masterbl.dto.QttnInfoVO"/>
    <typeAlias alias="QttnChgInfoVO"    	type="com.clt.apps.fis.see.bmd.masterbl.dto.QttnChgInfoVO"/>
    <typeAlias alias="QttnOthChgInfoVO"  type="com.clt.apps.fis.see.bmd.masterbl.dto.QttnOthChgInfoVO"/>
    
	<select id="selectCHECK_BL_STS" parameterClass="HashMap" resultClass="BlCmmVO">
		SELECT  ISNULL(BLCK.BL_STS_CD1, BL.BL_STS_CD) AS BL_STS_CD,  modi_usrid AS proc_usrid,  delt_flg
		  FROM  tb_intg_bl bl
		  LEFT OUTER JOIN(SELECT INTG_BL_SEQ AS INTG_BL_SEQ1, BL_STS_CD AS BL_STS_CD1 FROM TB_INTG_BL_BLCK) BLCK ON BL.INTG_BL_SEQ = BLCK.INTG_BL_SEQ1
		 WHERE  bl.intg_bl_seq = #intg_bl_seq#
	</select>

    <select id="selectBlBkgSeq" parameterClass="HashMap" resultClass="String">
        SELECT  TOP 1 bl.intg_bl_seq
          FROM  tb_intg_bl bl 
          JOIN  tb_add_info_bnd bnd 
            ON  bl.intg_bl_seq = bnd.intg_bl_seq AND bnd.delt_flg = 'N'
         WHERE  bl.bl_no = #f_bl_no# 
           AND  bl.biz_clss_cd = #f_biz_clss_cd# 
           AND  bl.air_sea_clss_cd = #f_air_sea#
           AND  bnd.bnd_clss_cd = #f_bnd_clss_cd#
           AND  bl.delt_flg = 'N'
    </select>
    <!-- 중복 체크   -->
    <select id="selectBlNoDuplCheck" parameterClass="HashMap" resultClass="Integer">
        SELECT  count(bl.bl_no)
          FROM  tb_intg_bl bl 
          JOIN  tb_add_info_bnd bnd 
            ON  bl.INTG_BL_SEQ = bnd.INTG_BL_SEQ AND bnd.delt_flg = 'N'
         WHERE  bl.bl_no = #f_bl_no# 
           AND  bl.biz_clss_cd = #f_biz_clss_cd# 
           AND  bl.air_sea_clss_cd = #f_air_sea#
           AND  bnd.bnd_clss_cd = #f_bnd_clss_cd#
           AND  bl.delt_flg = 'N'
    </select>
    
    <!-- 중복 체크   -->
    <select id="selectRefNoDuplCheck" parameterClass="HashMap" resultClass="Integer">
        SELECT  count(bl.ref_no)
          FROM  tb_intg_bl bl 
          JOIN  tb_add_info_bnd bnd 
            ON  bl.INTG_BL_SEQ = bnd.INTG_BL_SEQ AND bnd.delt_flg = 'N'
         WHERE  bl.ref_no = #f_ref_no# 
           AND  bl.delt_flg = 'N'
       <isNotNull property="mbl_seq">
           AND  bl.intg_bl_seq NOT IN (select intg_bl_seq from tb_intg_bl_rlt where rlt_intg_bl_seq = #mbl_seq#)
       </isNotNull>
 	   <isNotNull property="mbl_seq">
           AND bl.intg_bl_seq != #mbl_seq#
       </isNotNull>
       <isNotNull property="hbl_seq">
           AND bl.intg_bl_seq != #hbl_seq#
       </isNotNull>
       <isNotNull property="f_air_sea">
           AND bl.air_sea_clss_cd = #f_air_sea#
       </isNotNull>
       <isNotNull property="f_bnd_clss_cd">
           AND bnd.bnd_clss_cd = #f_bnd_clss_cd#
       </isNotNull>
       <isNotNull property="f_biz_clss_cd">
           AND bl.biz_clss_cd = #f_biz_clss_cd#
       </isNotNull>
    </select>
    
    <!-- 통합 BL테이블 PK 생성   -->
    <select id="selectINTG_BL_PK" parameterClass="HashMap" resultClass="String">
        SELECT ISNULL(MAX(intg_bl_seq),0)+1
          FROM tb_intg_bl
         WHERE rgst_ofc_cd = #proc_ofccd#
    </select>
    
    <!-- Booking PK 생성   -->
    <select id="selectBKG_PK" parameterClass="HashMap" resultClass="HashMap">
        SELECT  ISNULL(MAX(hbl.bkg_seq),0)+1        AS bkgSeq,  
                convert(varchar(4), getdate(), 12)  AS bkgDt
          FROM  tb_intg_bl hbl 
          JOIN  tb_add_info_bnd bnd
            ON  hbl.intg_bl_seq = bnd.intg_bl_seq
         WHERE  hbl.air_sea_clss_cd = #air_sea_clss_cd#   AND  bnd.bnd_clss_cd = #bnd_clss_cd# 
           AND  hbl.biz_clss_cd     = #biz_clss_cd#       AND  hbl.bkg_no IS NOT NULL 
           AND  convert(varchar(6), hbl.rgst_tms, 112) = CONVERT(VARCHAR(6), getdate(), 112)
    </select>
    
    <!-- HBL PK생성   -->
    <select id="selectBL_PK" parameterClass="HashMap" resultClass="HashMap">
        SELECT  ISNULL(MAX(hbl.hbl_seq),0)+1        AS hblSeq,  
                convert(varchar(4), getdate(), 12)  AS hblDt
          FROM  tb_intg_bl hbl 
         WHERE  convert(varchar(6), hbl.hbl_cre_dt, 112) = convert(varchar(6), getdate(), 112)
           AND  biz_clss_cd = #biz_clss_cd#   
           AND  air_sea_clss_cd = #air_sea_clss_cd# 
    </select>
    
    <select id="selectHBL_DUP_CHK" parameterClass="java.lang.String" resultClass="java.lang.Integer">
        SELECT  count(*) as cnt
          FROM  tb_intg_bl
         WHERE  bl_no = #bl_no#
    </select>
    
    
    <select id="selectREFNO_DUP_CHK" parameterClass="java.lang.String" resultClass="java.lang.Integer">
        SELECT count(*) as cnt
          FROM tb_intg_bl
         WHERE ref_no = #ref_no#
           AND biz_clss_cd = 'M'
    </select>

    <!--자동채번 버튼한 BL저장  -->
    <update id="updateBL_NO" parameterClass="HashMap">
        UPDATE  tb_intg_bl
           SET  bl_no      = #bl_no#,          hbl_cre_dt  = CONVERT(VARCHAR(8), GETDATE(), 112),    
        <isNotEmpty property="hbl_seq">
                hbl_seq    = #hbl_seq#,
        </isNotEmpty>       
                modi_tms    = GETUTCDATE()
         WHERE  intg_bl_seq= #intg_bl_seq#
    </update>
    
    <!--HBL에서 Ref No. 변경시 실적처리를 위해 기존 MBL의 MODI_TMS 업데이트  -->
    <update id="updateMBL_MODI_TMS" parameterClass="HashMap">
        UPDATE  tb_intg_bl
           SET  modi_tms    = getutcdate()
         WHERE  intg_bl_seq= #org_rlt_intg_bl_seq#
    </update>
    
    <!--통합 BL테이블 등록   -->
    <insert id="insertINTG_BL" parameterClass="HBLInfoVO">
	    /** BlCmmSQL.xml > insertINTG_BL **/
        INSERT  tb_intg_bl(
                intg_bl_seq,        bkg_no,             bl_no,   
                hbl_tp_cd,          po_no,
                bl_sts_cd,          bkg_seq,            bl_ser_no,
                biz_clss_cd,        air_sea_clss_cd,    shp_tp_cd,
                lnr_bkg_no,         shp_mod_cd,         inco_cd,            bkg_dt_tm,              bl_iss_dt,
                frt_term_cd,        rep_cmdt_cd,        rep_cmdt_nm,        pck_qty,                pck_ut_cd,
                grs_wgt,            grs_wgt_ut_cd,      act_wgt,            act_wgt_ut_cd,          meas,          meas_ut_cd,         
                fm_svc_term_cd,     to_svc_term_cd,     srd_flg, 
             
                por_cd,             					por_nm,             pol_cd,                 pol_nod_cd,    pol_nm,                 
                pod_cd,             pod_nod_cd,         pod_nm,             del_cd,                 del_nm,
                iss_loc_cd,         iss_loc_nm,         pay_loc_cd,         pay_loc_nm,
        
                fnl_dest_loc_cd,    fnl_dest_loc_nm,    cgo_rcv_dt_tm,          
		        cfs_loc_cd,         cfs_nod_cd,         cfs_loc_nm,         csts_clr_tp,
                de_due_dt,          
                pre_vsl_cd,         pre_vsl_nm,         pre_voy,            trnk_vsl_cd,            trnk_vsl_nm,    trnk_voy,            lane_cd,
                cgo_clz_dt_tm,      obrd_dt_tm,         etd_dt_tm,          eta_dt_tm,
                lnr_rmk,            mk_txt,             desc_txt,           rmk,                    say_txt,        sad_txt,              mm_txt,
                act_shp_info,       nomi_flg,
        
                rgst_usrid,         rgst_ofc_cd,        rgst_tms,
                modi_usrid,         modi_ofc_cd,        dept_cd,            modi_usr_nm,            modi_tms,               DELT_FLG,

cargo_tp_cd,
curr_cd,                 
ref_no,
sub_bl_no,
mbl_ref_no,
post_dt,
sub_mbl_flg,
state_cd,
grs_wgt1,
act_wgt1,
meas1,
size_ut_cd,
agent_rt,
agent_amt,
agent_curr_cd,
cust_rt,
cust_amt,
cust_curr_cd,
profit_share,
express_tp_cd,
iss_loc_cd1,
iss_loc_nm1,
trans_shipment,
itn_no,
onward_rout,
clean_on_board,
frt_term_c_cd,
frt_term_a_cd,
obrd_dt_tm1,
ref_ofc_cd,
exp_ref_no,
obl_tp_cd,
broker_rt,
cut_off_dt,
rcv_wh_cd,
cnt_cd,
mk_grs_wgt,
mk_grs_wgt1,
mk_meas,
mk_meas1,
f_eta_dt_tm,
d_eta_dt_tm,
avail_dt_tm,
lfd_dt_tm,
go_dt_tm,
rcvd_dt_tm,
rlsd_dt_tm,
te,
it_no,
it_loc,
bond_carr_cd,
bond_no,
goods_at,
goods_value,
door_loc_cd,
fnl_wh_cd,
org_bl_rcvd_flg,
ror_flg,
rlsd_flg,
rlsd_usrid,
te_dt_tm,
ams_no,
isf_no,
carr_trdp_cd1,
cy_trdp_cd,
cfs_trdp_cd,
rt_trdp_cd,
imp_ref_no,
cust_ref_no,
svc_scope,
att_mk_txt,
att_desc_txt,
desc_txt1,
an_inv_no,
an_due_dt,
an_curr_cd, 
wgt_disp_cd,
doc_recpt_no,
reserve_field01,
reserve_field02,
reserve_field03,
reserve_field04,
reserve_field05,
reserve_field06,
reserve_field11,
lc_no,
inv_no,
wh_cut_off_dt,
doc_cut_off_dt, 
org_bl_qty,
ams_id,        
cntr_info,
etd_por_tm
,ccn_no
,ccn_dt
,pre_ccn_no
,mnf_fr_loc
,mnf_to_loc
        )VALUES(
                #intg_bl_seq#,        #bkg_no#,             #bl_no#,
                #hbl_tp_cd#,          #po_no#,
                #bl_sts_cd#,          #bkg_seq#,            #bl_ser_no#,
                #biz_clss_cd#,        #air_sea_clss_cd#,    #shp_tp_cd#,
                #lnr_bkg_no#,         #shp_mod_cd#,         #inco_cd#,            #bkg_dt_tm#,              #bl_iss_dt#,
                #frt_term_cd#,        #rep_cmdt_cd#,        #rep_cmdt_nm#,        #pck_qty#,                #pck_ut_cd#,
                #grs_wgt#,            #grs_wgt_ut_cd#,      #act_wgt#,            #act_wgt_ut_cd#,          #meas#,         #meas_ut_cd#,
                #fm_svc_term_cd#,     #to_svc_term_cd#,     #srd_flg#,
        
                #por_cd#,               					#por_nm#,             #pol_cd#,                 #pol_nod_cd#,   #pol_nm#,                 
                #pod_cd#,             #pod_nod_cd#,         #pod_nm#,             #del_cd#,                 #del_nm#,
                #iss_loc_cd#,         #iss_loc_nm#,         #pay_loc_cd#,         #pay_loc_nm#,
        
                #fnl_dest_loc_cd#,    #fnl_dest_loc_nm#,    #cgo_rcv_dt_tm#,          
		        #cfs_loc_cd#,         #cfs_nod_cd#,         #cfs_loc_nm#,         #csts_clr_tp#,
		        #de_due_dt#,          
                #pre_vsl_cd#,         #pre_vsl_nm#,         #pre_voy#,            #trnk_vsl_cd#,            #trnk_vsl_nm#,   #trnk_voy#,    #lane_cd#,       
                #cgo_clz_dt_tm#,      #obrd_dt_tm#,         #etd_dt_tm#,          #eta_dt_tm#,
                #lnr_rmk#,            #mk_txt#,             #desc_txt#,           #rmk#,                    #say_txt#,      #sad_txt#,  #mm_txt#,
                #act_shp_info#,       #nomi_flg#,
        
                #proc_usrid#,         #proc_ofccd#,         getdate(),
                #proc_usrid#,         #proc_ofccd#,         #proc_dept_cd#,       #proc_usrnm#,              GETUTCDATE(),                 'N',

#cargo_tp_cd#,
#curr_cd#,                
#ref_no#,
#sub_bl_no#,
#mbl_ref_no#,
#post_dt#,
#sub_mbl_flg#,
#state_cd#,
#grs_wgt1#,
#act_wgt1#,
#meas1#,
#size_ut_cd#,
#agent_rt#,
#agent_amt#,
#agent_curr_cd#,
#cust_rt#,
#cust_amt#,
#cust_curr_cd#,
#profit_share#,
#express_tp_cd#,
#iss_loc_cd1#,
#iss_loc_nm1#,
#trans_shipment#,
#itn_no#,
#onward_rout#,
#clean_on_board#,
#frt_term_c_cd#,
#frt_term_a_cd#,
#obrd_dt_tm1#,
#ref_ofc_cd#,
#exp_ref_no#,
#obl_tp_cd#,
#broker_rt#,
#cut_off_dt#,
#rcv_wh_cd#,
#cnt_cd#,
#mk_grs_wgt#,
#mk_grs_wgt1#,
#mk_meas#,
#mk_meas1#,
#f_eta_dt_tm#,
#d_eta_dt_tm#,
#avail_dt_tm#,
#lfd_dt_tm#,
#go_dt_tm#,
#rcvd_dt_tm#,
#rlsd_dt_tm#,
#te#,
#it_no#,
#it_loc#,
#bond_carr_cd#,
#bond_no#,
#goods_at#,
#goods_value#,
#door_loc_cd#,
#fnl_wh_cd#,
#org_bl_rcvd_flg#,
#ror_flg#,
#rlsd_flg#,
#rlsd_usrid#,
#te_dt_tm#,
#ams_no#,
#isf_no#,
#carr_trdp_cd1#,
#cy_trdp_cd#,
#cfs_trdp_cd#,
#rt_trdp_cd#,
#imp_ref_no#,
#cust_ref_no#,
#svc_scope#,
#att_mk_txt#,
#att_desc_txt#,
#desc_txt1#,
#an_inv_no#,
#an_due_dt#,
#an_curr_cd#,
#wgt_disp_cd#,
#doc_recpt_no#,
#reserve_field01#,
#reserve_field02#,
#reserve_field03#,
#reserve_field04#,
#reserve_field05#,
#reserve_field06#,
#reserve_field11#,
#lc_no#,
#inv_no#,
#wh_cut_off_dt#,
#doc_cut_off_dt#, 
#org_bl_qty#,
#ams_id#, 
#cntr_info#,
#etd_por_tm#
,#ccn_no#
,#ccn_dt#
,#pre_ccn_no#
,#mnf_fr_loc#
,#mnf_to_loc#
        )
    </insert>
    
   <!-- BL내용 수정   -->
   <update id="updateINTG_BL" parameterClass="HBLInfoVO">
   		/** BlCmmSQL.xml > updateINTG_BL **/
        UPDATE  tb_intg_bl
           SET  hbl_tp_cd      = #hbl_tp_cd#,          po_no          = #po_no#,
                shp_tp_cd      = #shp_tp_cd#,          bl_ser_no      = #bl_ser_no#,
                lnr_bkg_no     = #lnr_bkg_no#,         shp_mod_cd     = #shp_mod_cd#,          inco_cd    = #inco_cd#,

                frt_term_cd    = #frt_term_cd#,        rep_cmdt_cd    = #rep_cmdt_cd#,         rep_cmdt_nm= #rep_cmdt_nm#,
                pck_qty        = #pck_qty#,            pck_ut_cd      = #pck_ut_cd#,
                grs_wgt        = #grs_wgt#,            grs_wgt_ut_cd  = #grs_wgt_ut_cd#,
                act_wgt        = #act_wgt#,            act_wgt_ut_cd  = #act_wgt_ut_cd#,
                meas           = #meas#,               meas_ut_cd     = #meas_ut_cd#,
       
                fm_svc_term_cd = #fm_svc_term_cd#,     to_svc_term_cd = #to_svc_term_cd#,      srd_flg    = #srd_flg#,

                por_cd         = #por_cd#,             por_nm     = #por_nm#,
                pol_cd         = #pol_cd#,             pol_nod_cd     = #pol_nod_cd#,          pol_nm     = #pol_nm#,
                pod_cd         = #pod_cd#,             pod_nod_cd     = #pod_nod_cd#,          pod_nm     = #pod_nm#,
                del_cd         = #del_cd#,             										   del_nm     = #del_nm#,
                iss_loc_cd     = #iss_loc_cd#,         iss_loc_nm     = #iss_loc_nm#,
			    pay_loc_cd     = #pay_loc_cd#,         pay_loc_nm     = #pay_loc_nm#,

                fnl_dest_loc_cd= #fnl_dest_loc_cd#,    fnl_dest_loc_nm= #fnl_dest_loc_nm#,
                cfs_nod_cd     = #cfs_nod_cd#,         cfs_loc_cd     = #cfs_loc_cd#,          cfs_loc_nm = #cfs_loc_nm#,
				csts_clr_tp    = #csts_clr_tp#, 
	   
                pre_vsl_cd     = #pre_vsl_cd#,         pre_vsl_nm     = #pre_vsl_nm#,          pre_voy    = #pre_voy#,
                trnk_vsl_cd    = #trnk_vsl_cd#,        trnk_vsl_nm    = #trnk_vsl_nm#,         trnk_voy   = #trnk_voy#,          lane_cd = #lane_cd#, 

                bkg_dt_tm      = #bkg_dt_tm#,          bl_iss_dt      = #bl_iss_dt#,
                cgo_clz_dt_tm  = #cgo_clz_dt_tm#,      obrd_dt_tm     = #obrd_dt_tm#,
                de_due_dt      = #de_due_dt#,          cgo_rcv_dt_tm  = #cgo_rcv_dt_tm#,

                lnr_rmk        = #lnr_rmk#,            mk_txt         = #mk_txt#,              desc_txt   = #desc_txt#,
                rmk            = #rmk#,                say_txt        = #say_txt#,             sad_txt    = #sad_txt#,            mm_txt = #mm_txt#,
                act_shp_info   = #act_shp_info#,       nomi_flg       = #nomi_flg#,   

                modi_usrid     = #opr_usrid#,          modi_ofc_cd    = #opr_ofc_cd#,          dept_cd = #opr_dept_cd#,
                modi_usr_nm    = #opr_usrnm#,          modi_tms       = GETUTCDATE(),

bl_no = #bl_no#,
cargo_tp_cd = #cargo_tp_cd#,
etd_dt_tm = #etd_dt_tm#,
eta_dt_tm = #eta_dt_tm#,
                
curr_cd = #curr_cd#,
ref_no = #ref_no#,
sub_bl_no = #sub_bl_no#,
mbl_ref_no = #mbl_ref_no#,
sub_mbl_flg = #sub_mbl_flg#,
state_cd = #state_cd#,
grs_wgt1 = #grs_wgt1#,
act_wgt1 = #act_wgt1#,
meas1 = #meas1#,
size_ut_cd = #size_ut_cd#,
agent_rt = #agent_rt#,
agent_amt = #agent_amt#,
agent_curr_cd = #agent_curr_cd#,
cust_rt = #cust_rt#,
cust_amt = #cust_amt#,
cust_curr_cd = #cust_curr_cd#,
profit_share = #profit_share#,
express_tp_cd = #express_tp_cd#,
iss_loc_cd1 = #iss_loc_cd1#,
iss_loc_nm1 = #iss_loc_nm1#,
trans_shipment = #trans_shipment#,
itn_no = #itn_no#,
onward_rout = #onward_rout#,
clean_on_board = #clean_on_board#,
frt_term_c_cd = #frt_term_c_cd#,
frt_term_a_cd = #frt_term_a_cd#,
obrd_dt_tm1 = #obrd_dt_tm1#,
ref_ofc_cd = #ref_ofc_cd#,
exp_ref_no = #exp_ref_no#,
obl_tp_cd = #obl_tp_cd#,
broker_rt = #broker_rt#,
cut_off_dt = #cut_off_dt#,
rcv_wh_cd = #rcv_wh_cd#,
cnt_cd = #cnt_cd#,
mk_grs_wgt = #mk_grs_wgt#,
mk_grs_wgt1 = #mk_grs_wgt1#,
mk_meas = #mk_meas#,
mk_meas1 = #mk_meas1#,
f_eta_dt_tm = #f_eta_dt_tm#,
d_eta_dt_tm = #d_eta_dt_tm#,
avail_dt_tm = #avail_dt_tm#,
lfd_dt_tm = #lfd_dt_tm#,
go_dt_tm = #go_dt_tm#,
rcvd_dt_tm = #rcvd_dt_tm#,
rlsd_dt_tm = #rlsd_dt_tm#,
te = #te#,
it_no = #it_no#,
it_loc = #it_loc#,
bond_carr_cd = #bond_carr_cd#,
bond_no = #bond_no#,
goods_at = #goods_at#,
goods_value = #goods_value#,
door_loc_cd = #door_loc_cd#,
fnl_wh_cd = #fnl_wh_cd#,
org_bl_rcvd_flg = #org_bl_rcvd_flg#,
ror_flg = #ror_flg#,
rlsd_flg = #rlsd_flg#,
rlsd_usrid = #rlsd_usrid#,
te_dt_tm = #te_dt_tm#,
isf_no = #isf_no#,
carr_trdp_cd1 = #carr_trdp_cd1#,
cy_trdp_cd = #cy_trdp_cd#,
cfs_trdp_cd = #cfs_trdp_cd#,
rt_trdp_cd = #rt_trdp_cd#,
imp_ref_no = #imp_ref_no#,
cust_ref_no = #cust_ref_no#,
svc_scope = #svc_scope#,
att_mk_txt = #att_mk_txt#,
att_desc_txt = #att_desc_txt#,
desc_txt1 = #desc_txt1#,
an_inv_no = #an_inv_no#,
an_due_dt = #an_due_dt#,
an_curr_cd = #an_curr_cd#,
wgt_disp_cd = #wgt_disp_cd#,
doc_recpt_no = #doc_recpt_no#,
reserve_field01 = #reserve_field01#,
reserve_field02 = #reserve_field02#,
reserve_field03 = #reserve_field03#,
reserve_field04 = #reserve_field04#,
reserve_field05 = #reserve_field05#,
reserve_field06 = #reserve_field06#,
reserve_field11 = #reserve_field11#,
lc_no = #lc_no#,
inv_no = #inv_no#,
ams_no = #ams_no#,
wh_cut_off_dt = #wh_cut_off_dt#,
doc_cut_off_dt = #doc_cut_off_dt#,
org_bl_qty = #org_bl_qty#
,cntr_info = #cntr_info#
,etd_por_tm = #etd_por_tm#
,ccn_no = #ccn_no#
,ccn_dt = #ccn_dt#
,pre_ccn_no = #pre_ccn_no#
,mnf_fr_loc = #mnf_fr_loc#
,mnf_to_loc = #mnf_to_loc#
         WHERE  intg_bl_seq    = #intg_bl_seq#
    </update>

    <!-- 단계(상태) 변경. Status를 변경함  -->
    <update id="updateINTG_BL_STS" parameterClass="HashMap">
        UPDATE  tb_intg_bl
           SET  bl_sts_cd  = #bl_sts_cd#,    modi_tms    = GETUTCDATE()
         WHERE  intg_bl_seq= #intg_bl_seq#
    </update>

	<!-- Manager가 Closing 또는 Confirm Cancel할 경우   -->
    <update id="updateINTG_BL_STS_BY_MNG" parameterClass="HashMap">
        UPDATE  tb_intg_bl
           SET  bl_sts_cd  = #bl_sts_cd#     
         WHERE  intg_bl_seq= #intg_bl_seq#
    </update>
	
	<!-- BL Confirm이라는 상태를 이전으로 수정함   -->
    <update id="updateWRK_FLOW_BY_MNG" parameterClass="HashMap">
		UPDATE tb_wrk_flow
		   SET jb_act_dt_tm = null,  modi_usrid = '', modi_ofc_cd = ''
		 WHERE intg_bl_seq = #intg_bl_seq# AND jb_sts_cd = #pre_sts_cd#
	</update>
	    
    <!--HBL정보 조회  -->
    <select id="selectINTG_BL" parameterClass="HashMap" resultClass="HBLInfoVO">
    	/* BlCmmSQL.xml > selectINTG_BL */
        SELECT  bl.intg_bl_seq,        bkg.bkg_no,            bl.bl_no,              bl.hbl_tp_cd,              bl.po_no,
                ISNULL(BLCK.BL_STS_CD1, BL.BL_STS_CD) AS BL_STS_CD,          
                bkg.bkg_seq,           bl.sr_no,              mbl.bl_no AS mbl_no,
                bl.biz_clss_cd,        bl.air_sea_clss_cd,    bl.shp_tp_cd,          bl.bl_ser_no,
                bl.lnr_bkg_no,         bl.shp_mod_cd,         bl.inco_cd,            bl.bkg_dt_tm,              bl.bl_iss_dt,
                bl.frt_term_cd,        bl.rep_cmdt_cd,        bl.rep_cmdt_nm,        bl.pck_qty,                bl.pck_ut_cd,     pcd.pck_nm AS pck_ut_nm, 
                bl.grs_wgt,            bl.grs_wgt_ut_cd,      bl.act_wgt,            bl.act_wgt_ut_cd,          bl.meas,          bl.meas_ut_cd,         
                bl.fm_svc_term_cd,     bl.to_svc_term_cd,     bl.srd_flg,
             
                bl.por_cd,             '' AS por_nod_cd,         bl.por_nm,             bl.pol_cd,                 bl.pol_nod_cd,    bl.pol_nm,                 
                bl.pod_cd,             bl.pod_nod_cd,         bl.pod_nm,             bl.del_cd,                 '' AS del_nod_cd,    bl.del_nm,
                bl.iss_loc_cd,         bl.iss_loc_nm,         bl.pay_loc_cd,         bl.pay_loc_nm,
        
                bl.fnl_dest_loc_cd,    '' AS fnl_dest_nod_cd,    bl.fnl_dest_loc_nm,    bl.cgo_rcv_dt_tm,          
		        bl.cfs_loc_cd,         bl.cfs_nod_cd,         bl.cfs_loc_nm,         bl.csts_clr_tp,            bl.de_due_dt,          
                bl.pre_vsl_cd,         bl.pre_vsl_nm,         bl.pre_voy,            bl.trnk_vsl_cd,            bl.trnk_vsl_nm,   bl.trnk_voy,            bl.lane_cd,        
                bl.cgo_clz_dt_tm,      bl.obrd_dt_tm,         bl.etd_dt_tm,          bl.eta_dt_tm,
                bl.lnr_rmk,            bl.mk_txt,             bl.desc_txt,           bl.rmk,                    bl.say_txt,       bl.sad_txt,              bl.mm_txt,
                bl.act_shp_info,       bl.nomi_flg,           ISNULL(bl.org_bl_qty, 0)  AS org_bl_qty,
        
                bl.dept_cd,            bl.modi_tms           
                ,bnd.issued_by AS issued_by
                ,(select max(locl_usr_nm) from tb_usr where usrid = bnd.issued_by )  AS proc_usrnm,
		        bl.modi_ofc_cd AS proc_ofccd,                 bl.dept_cd AS proc_dept_cd,
		
                bnd.sls_ofc_cd,        bnd.sls_dept_cd,       bnd.sls_usrid,                        bnd.sls_usr_nm,
                jbt.tmplt_nm AS jb_tmplt_nm,                  bnd.jb_tmplt_seq,						bnd.exp_frt_desc,
        	    bnd.ts1_port_nm, 	bnd.ts1_port_cd, 	bnd.ts1_etd_dt_tm, 					bnd.ts1_eta_dt_tm, 
                shp.trdp_cd AS shpr_trdp_cd,      shp.trdp_nm AS shpr_trdp_nm,      shp.trdp_addr AS shpr_trdp_addr,
                cne.trdp_cd AS cnee_trdp_cd,      cne.trdp_nm AS cnee_trdp_nm,      cne.trdp_addr AS cnee_trdp_addr,
                ntf.trdp_cd AS ntfy_trdp_cd,      ntf.trdp_nm AS ntfy_trdp_nm,      ntf.trdp_addr AS ntfy_trdp_addr,
                act.trdp_cd AS act_shpr_trdp_cd,  act.trdp_nm AS act_shpr_trdp_nm,  act.trdp_addr AS act_trdp_addr,
                lnr.trdp_cd AS lnr_trdp_cd,       lnr.trdp_nm AS lnr_trdp_nm,
                ptn.trdp_cd AS prnr_trdp_cd,      ptn.trdp_nm AS prnr_trdp_nm,      ptn.trdp_addr AS prnr_trdp_addr,
                agent.trdp_cd AS agent_trdp_cd,   agent.trdp_nm AS agent_trdp_nm,   agent.trdp_addr AS agent_trdp_addr,
                third.trdp_cd AS third_trdp_cd,   third.trdp_nm AS third_trdp_nm,   third.trdp_addr AS third_trdp_addr,
                ptn2.trdp_cd AS prnr_trdp_cd2,    ptn2.trdp_nm AS prnr_trdp_nm2,    ptn2.trdp_addr AS prnr_trdp_addr2,
                cust.trdp_cd AS cust_trdp_cd,     cust.trdp_nm AS cust_trdp_nm,     cust.trdp_addr AS cust_trdp_addr,
                trk.trdp_cd AS trk_trdp_cd,     trk.trdp_nm AS trk_trdp_nm,     trk.trdp_addr AS trk_trdp_addr,
                carr.trdp_cd AS carr_trdp_cd,     carr.trdp_nm AS carr_trdp_nm,     carr.trdp_addr AS carr_trdp_addr,
                vndr.trdp_cd AS vndr_trdp_cd,     vndr.trdp_nm AS vndr_trdp_nm,     vndr.trdp_addr AS vndr_trdp_addr,
                cgo_pu.trdp_cd AS cgo_pu_trdp_cd,     cgo_pu.trdp_nm AS cgo_pu_trdp_nm,     cgo_pu.trdp_addr AS cgo_pu_trdp_addr,
bl.lc_no,
bl.inv_no,
                
'' AS mrn,
rlt.rlt_intg_bl_seq,                
bl.cargo_tp_cd,
bl.curr_cd,
bl.ref_no,
bl.sub_bl_no,
bl.mbl_ref_no,
bl.post_dt,
bl.sub_mbl_flg,
bl.state_cd,
CASE WHEN isnull(bnd.state_cnt_cd,'') != ''
THEN
(SELECT top 1 state_eng_nm FROM tb_state X WHERE X.state_cd = bl.state_cd and X.cnt_cd = bnd.state_cnt_cd) 
ELSE  
(SELECT top 1 state_eng_nm FROM tb_state X WHERE X.state_cd = bl.state_cd)
END AS state_nm,
bl.grs_wgt1,
bl.act_wgt1,
bl.meas1,
bl.size_ut_cd,
bl.agent_rt,
bl.agent_amt,
bl.agent_curr_cd,
bl.cust_rt,
bl.cust_amt,
bl.cust_curr_cd,
bl.profit_share,
bl.express_tp_cd,
bl.iss_loc_cd1,
bl.iss_loc_nm1,
bl.trans_shipment,
bl.itn_no,
bl.onward_rout,
bl.clean_on_board,
bl.frt_term_c_cd,
bl.frt_term_a_cd,
bl.obrd_dt_tm1,
bl.ref_ofc_cd,
bl.exp_ref_no,
bl.obl_tp_cd,
bl.broker_rt,
bl.cut_off_dt,
bl.rcv_wh_cd,
bl.cnt_cd,
(SELECT cnt_eng_nm FROM tb_cnt x where x.cnt_cd = bl.cnt_cd) AS cnt_nm,
bl.mk_grs_wgt,
bl.mk_grs_wgt1,
bl.mk_meas,
bl.mk_meas1,
bl.f_eta_dt_tm,
bl.d_eta_dt_tm,
bl.avail_dt_tm,
bl.lfd_dt_tm,
bl.go_dt_tm,
bl.rcvd_dt_tm,
bl.rlsd_dt_tm,
bl.te,
bl.it_no,
bl.it_loc,
bl.bond_carr_cd,
(SELECT eng_nm FROM tb_trdp x where x.trdp_cd = bl.bond_carr_cd) AS bond_carr_nm,
bl.bond_no,
bl.goods_at,
bl.goods_value,
bl.door_loc_cd,
(SELECT eng_nm FROM tb_trdp x where x.trdp_cd = bl.door_loc_cd) AS door_loc_nm,
bl.fnl_wh_cd,
(SELECT eng_nm FROM tb_trdp x where x.trdp_cd = bl.fnl_wh_cd) AS fnl_wh_nm,
bl.org_bl_rcvd_flg,
bl.ror_flg,
bl.rlsd_flg,
bl.rlsd_usrid,
bl.te_dt_tm,
bl.ams_no,
bl.isf_no,
bl.carr_trdp_cd1,
(SELECT eng_nm FROM tb_trdp x where x.trdp_cd = bl.carr_trdp_cd1) AS carr_trdp_nm1,
bl.cy_trdp_cd,
(SELECT eng_nm FROM tb_trdp x where x.trdp_cd = bl.cy_trdp_cd) AS cy_trdp_nm,
bl.cfs_trdp_cd,
(SELECT eng_nm FROM tb_trdp x where x.trdp_cd = bl.cfs_trdp_cd) AS cfs_trdp_nm,
bl.rt_trdp_cd,
(SELECT eng_nm FROM tb_trdp x where x.trdp_cd = bl.rt_trdp_cd) AS rt_trdp_nm,
bl.imp_ref_no,
bl.cust_ref_no,
bl.svc_scope,
bl.att_mk_txt,
bl.att_desc_txt,
bl.desc_txt1,
bl.an_inv_no,
bl.an_due_dt,
bl.an_curr_cd,
bl.wgt_disp_cd,
bl.doc_recpt_no,
bl.reserve_field01,
bl.reserve_field02,
bl.reserve_field03,
bl.reserve_field04,
bl.reserve_field05,
bl.reserve_field06,
'' AS reserve_field07,
'' AS reserve_field08,
'' AS reserve_field09,
'' AS reserve_field10,
bl.reserve_field11,
'' AS reserve_field12,
(CASE WHEN bl.biz_clss_cd =  'H' THEN mbl.curr_cd ELSE bl.curr_cd END) as mbl_curr_cd,
bl.wh_cut_off_dt,
bl.doc_cut_off_dt
,bl.cntr_info 
,bl.etd_por_tm
,bl.ccn_no
,bl.ccn_dt
,bl.pre_ccn_no
,bl.mnf_fr_loc
,bl.mnf_to_loc
,bnd.item_no
,bnd.hbl_ser_pfx
,bnd.hbl_ser_no
,bnd.ctrb_ofc_cd
,bnd.ctrb_dept_cd
,bnd.ctrb_ratio_yn
,bnd.ctrb_mgn
,bnd.state_cnt_cd
,bnd.cfs_rmk
,bnd.csms_rlse_dt
,bnd.pkup_dt
,bnd.entr_no
         FROM   tb_intg_bl bl
        
         JOIN   tb_add_info_bnd bnd
           ON   bl.intg_bl_seq = bnd.intg_bl_seq AND bnd.bnd_clss_cd = #bnd_clss_cd#   AND bnd.delt_flg = 'N'

         LEFT OUTER JOIN   tb_jb_tmplt jbt
           ON   jbt.jb_tmplt_seq = bnd.jb_tmplt_seq AND LG_CLSS_BIZ_CD = #air_biz_clss_cd#
                
LEFT OUTER JOIN tb_bl_prnr act
           ON   bl.intg_bl_seq = act.intg_bl_seq  AND act.bl_trdp_tp_cd = 'S02' AND act.delt_flg = 'N'

LEFT OUTER JOIN tb_pck_ut_cd pcd        
           ON   bl.pck_ut_cd   = pcd.pck_ut_cd    AND pcd.delt_flg = 'N'
         
LEFT OUTER JOIN tb_bl_prnr shp
           ON   bl.intg_bl_seq = shp.intg_bl_seq  AND shp.bl_trdp_tp_cd = 'S01' AND shp.delt_flg = 'N'
         
LEFT OUTER JOIN tb_bl_prnr cne
           ON   bl.intg_bl_seq = cne.intg_bl_seq  AND cne.bl_trdp_tp_cd = 'C01' AND cne.delt_flg = 'N'

LEFT OUTER JOIN tb_bl_prnr ntf
           ON   bl.intg_bl_seq = ntf.intg_bl_seq  AND ntf.bl_trdp_tp_cd = 'N01' AND ntf.delt_flg = 'N'

LEFT OUTER JOIN tb_bl_prnr lnr
           ON   bl.intg_bl_seq = lnr.intg_bl_seq  AND lnr.bl_trdp_tp_cd = 'L01' AND lnr.delt_flg = 'N'

LEFT OUTER JOIN tb_bl_prnr ptn
           ON   bl.intg_bl_seq = ptn.intg_bl_seq  AND ptn.bl_trdp_tp_cd = 'P01' AND ptn.delt_flg = 'N'

LEFT OUTER JOIN tb_bl_prnr agent
           ON   bl.intg_bl_seq = agent.intg_bl_seq  AND agent.bl_trdp_tp_cd = 'A01' AND agent.delt_flg = 'N'
           
LEFT OUTER JOIN tb_bl_prnr third
           ON   bl.intg_bl_seq = third.intg_bl_seq  AND third.bl_trdp_tp_cd = 'T01' AND third.delt_flg = 'N'
           
LEFT OUTER JOIN tb_bl_prnr ptn2
           ON   bl.intg_bl_seq = ptn2.intg_bl_seq  AND ptn2.bl_trdp_tp_cd = 'P03' AND ptn2.delt_flg = 'N'

LEFT OUTER JOIN tb_bl_prnr cust
           ON   bl.intg_bl_seq = cust.intg_bl_seq  AND cust.bl_trdp_tp_cd = 'C03' AND cust.delt_flg = 'N'

LEFT OUTER JOIN tb_bl_prnr trk
           ON   bl.intg_bl_seq = trk.intg_bl_seq  AND trk.bl_trdp_tp_cd = 'T02' AND trk.delt_flg = 'N'

LEFT OUTER JOIN tb_bl_prnr carr
           ON   bl.intg_bl_seq = carr.intg_bl_seq  AND carr.bl_trdp_tp_cd = 'B01' AND carr.delt_flg = 'N'

LEFT OUTER JOIN tb_bl_prnr vndr
           ON   bl.intg_bl_seq = vndr.intg_bl_seq  AND vndr.bl_trdp_tp_cd = 'V01' AND vndr.delt_flg = 'N'

LEFT OUTER JOIN tb_bl_prnr cgo_pu
           ON   bl.intg_bl_seq = cgo_pu.intg_bl_seq  AND cgo_pu.bl_trdp_tp_cd = 'S03' AND cgo_pu.delt_flg = 'N'           

LEFT OUTER JOIN tb_intg_bl_rlt rlt
            ON  bl.intg_bl_seq = rlt.intg_bl_seq AND rlt.delt_flg = 'N'
        
LEFT OUTER JOIN tb_intg_bl mbl
            ON  rlt.rlt_intg_bl_seq = mbl.intg_bl_seq AND mbl.biz_clss_cd = 'M' AND mbl.delt_flg = 'N'
            
LEFT OUTER JOIN tb_bkg bkg
            ON  bkg.intg_bl_seq = bl.intg_bl_seq AND bkg.delt_flg = 'N'

LEFT OUTER JOIN(SELECT INTG_BL_SEQ AS INTG_BL_SEQ1, BL_STS_CD AS BL_STS_CD1 FROM TB_INTG_BL_BLCK) BLCK 
			ON BL.INTG_BL_SEQ = BLCK.INTG_BL_SEQ1
        
        WHERE bl.delt_flg = 'N' AND bl.biz_clss_cd = #biz_clss_cd# AND bl.air_sea_clss_cd = #air_sea_clss_cd#
        <dynamic>
            <isNotEmpty property="f_intg_bl_seq">
                AND bl.intg_bl_seq = #f_intg_bl_seq#
            </isNotEmpty>           
            <isNotEmpty property="f_bl_no">
                AND bl.bl_no  = #f_bl_no#
            </isNotEmpty>
        </dynamic>
    </select>
    
    <!-- BL 요약 정보를 리턴함   -->
    <select id="selectBL_SMRY" parameterClass="HashMap" resultClass="HBLInfoVO">
     /* BlCmmSQL.xml > selectBL_SMRY */
        SELECT  bl.intg_bl_seq,        bl.bkg_no,             bl.bl_no,
                bl.rep_cmdt_cd,        bl.rep_cmdt_nm,        bl.pck_qty,            bl.pck_ut_cd,              pcd.pck_nm AS pck_ut_nm,
                
                bl.grs_wgt,            bl.grs_wgt1,			  bl.grs_wgt_ut_cd,      bl.chg_wgt,            	bl.chg_wgt_ut_cd,          
                bl.act_wgt,            bl.act_wgt_ut_cd,      bl.meas,               bl.meas1,					bl.meas_ut_cd,         
             
                bl.por_cd,             '' AS por_nod_cd,         bl.por_nm,             bl.pol_cd,                 bl.pol_nod_cd,    bl.pol_nm,                 
                bl.pod_cd,             bl.pod_nod_cd,         bl.pod_nm,             bl.del_cd,                 '' AS del_nod_cd,    bl.del_nm,
                bl.iss_loc_cd,         bl.iss_loc_nm,         bl.pay_loc_cd,         bl.pay_loc_nm,
        
                bl.fnl_dest_loc_cd,    '' AS fnl_dest_nod_cd,    bl.fnl_dest_loc_nm,    bl.cgo_rcv_dt_tm,          bl.cfs_loc_cd,
                bl.cfs_nod_cd,         bl.de_due_dt,          
                bl.pre_vsl_cd,         bl.pre_vsl_nm,         bl.pre_voy,            bl.trnk_vsl_cd,            bl.trnk_vsl_nm,   bl.trnk_voy,           
                bl.cgo_clz_dt_tm,      bl.obrd_dt_tm,         bl.etd_dt_tm,          bl.eta_dt_tm,
        
                bl.lnr_bkg_no,         lnr.trdp_cd AS lnr_trdp_cd,                   lnr.trdp_nm AS lnr_trdp_nm,
                bl.rmk
         FROM   tb_intg_bl bl
			LEFT OUTER JOIN tb_pck_ut_cd pcd        
			           ON   bl.pck_ut_cd   = pcd.pck_ut_cd    AND pcd.delt_flg = 'N'
			LEFT OUTER JOIN tb_bl_prnr lnr
			           ON   bl.intg_bl_seq = lnr.intg_bl_seq  AND lnr.bl_trdp_tp_cd = 'L01' AND lnr.delt_flg = 'N'
        WHERE   bl.intg_bl_seq = #intg_bl_seq#
    </select>
    
    <!-- Work Order BL 요약 정보를 리턴함   -->
    <select id="selectWO_BL_SMRY" parameterClass="HashMap" resultClass="com.clt.apps.fis.see.bmd.workorder.dto.WoOrdVO">
     /* BlCmmSQL.xml > selectWO_BL_SMRY */
         SELECT TOP 1
        		BL.INTG_BL_SEQ,        
                BL.BKG_NO,             
                BL.BL_NO,
                BL.REP_CMDT_CD,        
                BL.REP_CMDT_NM,        
                BL.PCK_QTY CGO_PCK_QTY,            
                BL.PCK_UT_CD CGO_PCK_UT_CD,              
                PCD.PCK_NM AS PCK_UT_NM,
                BL.GRS_WGT ACT_WGT_K,            
                BL.GRS_WGT1 ACT_WGT_L,			 
                BL.GRS_WGT_UT_CD,      
                BL.CHG_WGT,            	
                BL.CHG_WGT_UT_CD,          
                BL.ACT_WGT,            
                BL.ACT_WGT_UT_CD,      
                BL.MEAS CGO_MEAS_M,               
                BL.MEAS1 CGO_MEAS_F,					
                BL.MEAS_UT_CD,
                BL.POR_CD,             
                '' AS POR_NOD_CD,         
                BL.POR_NM,            
                BL.POL_CD,                 
                BL.POL_NOD_CD,    
                BL.POL_NM,                 
                BL.POD_CD,             
                BL.POD_NOD_CD,         
                BL.POD_NM,             
                BL.DEL_CD,                 
                '' AS DEL_NOD_CD,    
                BL.DEL_NM,
                BL.ISS_LOC_CD,         
                BL.ISS_LOC_NM,         
                BL.PAY_LOC_CD,         
                BL.PAY_LOC_NM,
                BL.FNL_DEST_LOC_CD,    
                '' AS FNL_DEST_NOD_CD,    
                BL.FNL_DEST_LOC_NM,    
                BL.CGO_RCV_DT_TM,          
                BL.CFS_LOC_CD,
                BL.CFS_NOD_CD,         
                BL.DE_DUE_DT,          
                BL.PRE_VSL_CD,         
                BL.PRE_VSL_NM,         
                BL.PRE_VOY,            
                BL.TRNK_VSL_CD,            
                BL.TRNK_VSL_NM,   
                BL.TRNK_VOY,           
                BL.CGO_CLZ_DT_TM,      
                BL.OBRD_DT_TM,         
                BL.ETD_DT_TM,          
                BL.ETA_DT_TM,
                BL.LNR_BKG_NO,         
                LNR.TRDP_CD AS LNR_TRDP_CD,                   
                LNR.TRDP_NM AS LNR_TRDP_NM,
                BL.RMK,
                BL.REP_CMDT_CD AS CGO_ITM_CMDT_CD, 
                BL.REP_CMDT_NM AS CGO_ITM_CMDT_NM,				   
                ACT.TRDP_CD AS BILL_TO_TRDP_CD,               
                ACT.TRDP_NM AS BILL_TO_TRDP_NM,   
                (SELECT ISNULL(BILL_TO.LGL_ADDR,'') + 
	                	(CASE WHEN ISNULL(BILL_TO.CITY_NM,'') != '' AND ISNULL(BILL_TO.STATE_CD,'') != '' AND ISNULL(BILL_TO.REP_ZIP,'') != '' THEN CHAR(13) + BILL_TO.CITY_NM + ', ' + BILL_TO.STATE_CD + ' ' + BILL_TO.REP_ZIP
					  	      WHEN ISNULL(BILL_TO.CITY_NM,'') != '' AND ISNULL(BILL_TO.STATE_CD,'') != '' AND ISNULL(BILL_TO.REP_ZIP,'') = '' THEN CHAR(13) + BILL_TO.CITY_NM + ' ' + BILL_TO.STATE_CD
						      WHEN ISNULL(BILL_TO.CITY_NM,'') != '' AND ISNULL(BILL_TO.STATE_CD,'') = '' AND ISNULL(BILL_TO.REP_ZIP,'') = '' THEN CHAR(13) + BILL_TO.CITY_NM
						      WHEN ISNULL(BILL_TO.CITY_NM,'') != '' AND ISNULL(BILL_TO.STATE_CD,'') = '' AND ISNULL(BILL_TO.REP_ZIP,'') != '' THEN CHAR(13) + BILL_TO.CITY_NM + ', ' + BILL_TO.REP_ZIP
						      ELSE '' END)
	           	 FROM TB_TRDP BILL_TO
	             WHERE ACT.TRDP_CD = BILL_TO.TRDP_CD) AS BILL_TO_TRDP_ADDR, 
                BL.REF_NO AS BILL_TO_REF_NO,
                TRK.TRDP_CD TRUCKER_TRDP_CD,
                TRK.TRDP_NM TRUCKER_TRDP_NM,
                (SELECT B.PIC_NM  FROM TB_TRDP_CNTC_PSON B WHERE B.TRDP_CD = TRK.TRDP_CD AND B.REP_FLG = 'Y' AND B.DELT_FLG = 'N') AS TRUCKER_PIC,
  				(SELECT B.PIC_PHN  FROM TB_TRDP_CNTC_PSON B WHERE B.TRDP_CD = TRK.TRDP_CD AND B.REP_FLG = 'Y' AND B.DELT_FLG = 'N') AS TRUCKER_PHN,
  				(SELECT B.PIC_FAX  FROM TB_TRDP_CNTC_PSON B WHERE B.TRDP_CD = TRK.TRDP_CD AND B.REP_FLG = 'Y' AND B.DELT_FLG = 'N') AS TRUCKER_FAX,
				(SELECT ISNULL(TRK_TRDP.LGL_ADDR,'') + 
		                (CASE WHEN ISNULL(TRK_TRDP.CITY_NM,'') != '' AND ISNULL(TRK_TRDP.STATE_CD,'') != '' AND ISNULL(TRK_TRDP.REP_ZIP,'') != '' THEN CHAR(13) + TRK_TRDP.CITY_NM + ', ' + TRK_TRDP.STATE_CD + ' ' + TRK_TRDP.REP_ZIP
					  	      WHEN ISNULL(TRK_TRDP.CITY_NM,'') != '' AND ISNULL(TRK_TRDP.STATE_CD,'') != '' AND ISNULL(TRK_TRDP.REP_ZIP,'') = '' THEN CHAR(13) + TRK_TRDP.CITY_NM + ' ' + TRK_TRDP.STATE_CD
						      WHEN ISNULL(TRK_TRDP.CITY_NM,'') != '' AND ISNULL(TRK_TRDP.STATE_CD,'') = '' AND ISNULL(TRK_TRDP.REP_ZIP,'') = '' THEN CHAR(13) + TRK_TRDP.CITY_NM
						      WHEN ISNULL(TRK_TRDP.CITY_NM,'') != '' AND ISNULL(TRK_TRDP.STATE_CD,'') = '' AND ISNULL(TRK_TRDP.REP_ZIP,'') != '' THEN CHAR(13) + TRK_TRDP.CITY_NM + ', ' + TRK_TRDP.REP_ZIP
						      ELSE '' END)
			     FROM TB_TRDP TRK_TRDP
			     WHERE TRK.TRDP_CD = TRK_TRDP.TRDP_CD) AS TRUCKER_TRDP_ADDR,
				CASE WHEN BL.AIR_SEA_CLSS_CD = 'S' AND BND.BND_CLSS_CD = 'O' AND BL.BIZ_CLSS_CD = 'H' THEN MBL.PU_TRDP_CD ELSE '' END AS PICKUP_TRDP_CD,
				CASE WHEN BL.AIR_SEA_CLSS_CD = 'S' AND BND.BND_CLSS_CD = 'O' AND BL.BIZ_CLSS_CD = 'H' THEN (SELECT LOCL_NM FROM TB_TRDP WHERE TRDP_CD = MBL.PU_TRDP_CD AND DELT_FLG ='N') ELSE '' END AS PICKUP_TRDP_NM,
				CASE WHEN BL.AIR_SEA_CLSS_CD = 'S' AND BND.BND_CLSS_CD = 'O' AND BL.BIZ_CLSS_CD = 'H' THEN 				
				(SELECT ISNULL(PU_TRDP.LGL_ADDR,'') + 
	                	(CASE WHEN ISNULL(PU_TRDP.CITY_NM,'') != '' AND ISNULL(PU_TRDP.STATE_CD,'') != '' AND ISNULL(PU_TRDP.REP_ZIP,'') != '' THEN CHAR(13) + PU_TRDP.CITY_NM + ', ' + PU_TRDP.STATE_CD + ' ' + PU_TRDP.REP_ZIP
					  	      WHEN ISNULL(PU_TRDP.CITY_NM,'') != '' AND ISNULL(PU_TRDP.STATE_CD,'') != '' AND ISNULL(PU_TRDP.REP_ZIP,'') = '' THEN CHAR(13) + PU_TRDP.CITY_NM + ' ' + PU_TRDP.STATE_CD
						      WHEN ISNULL(PU_TRDP.CITY_NM,'') != '' AND ISNULL(PU_TRDP.STATE_CD,'') = '' AND ISNULL(PU_TRDP.REP_ZIP,'') = '' THEN CHAR(13) + PU_TRDP.CITY_NM
						      WHEN ISNULL(PU_TRDP.CITY_NM,'') != '' AND ISNULL(PU_TRDP.STATE_CD,'') = '' AND ISNULL(PU_TRDP.REP_ZIP,'') != '' THEN CHAR(13) + PU_TRDP.CITY_NM + ', ' + PU_TRDP.REP_ZIP
						      ELSE '' END)
			     FROM TB_TRDP PU_TRDP
			     WHERE MBL.PU_TRDP_CD = PU_TRDP.TRDP_CD) ELSE '' END AS PICKUP_TRDP_ADDR,
				CASE WHEN BL.AIR_SEA_CLSS_CD = 'S' AND BND.BND_CLSS_CD = 'O' AND BL.BIZ_CLSS_CD = 'H' THEN (SELECT B.PIC_NM  FROM TB_TRDP_CNTC_PSON B WHERE B.TRDP_CD = MBL.PU_TRDP_CD AND B.REP_FLG = 'Y' AND B.DELT_FLG = 'N') ELSE '' END AS PICKUP_PIC,
				CASE WHEN BL.AIR_SEA_CLSS_CD = 'S' AND BND.BND_CLSS_CD = 'O' AND BL.BIZ_CLSS_CD = 'H' THEN (SELECT B.PIC_PHN FROM TB_TRDP_CNTC_PSON B WHERE B.TRDP_CD = MBL.PU_TRDP_CD AND B.REP_FLG = 'Y' AND B.DELT_FLG = 'N') ELSE '' END AS PICKUP_PHN,
				CASE WHEN BL.AIR_SEA_CLSS_CD = 'S' AND BND.BND_CLSS_CD = 'O' AND BL.BIZ_CLSS_CD = 'H' THEN (SELECT B.PIC_FAX FROM TB_TRDP_CNTC_PSON B WHERE B.TRDP_CD = MBL.PU_TRDP_CD AND B.REP_FLG = 'Y' AND B.DELT_FLG = 'N') ELSE '' END AS PICKUP_FAX,
				<!-- #34862 - [BINEX]Work Order - Trucker 정보 Link -->
				#pickup_ref_no# AS pickup_ref_no,
		  	  	#delivery_ref_no# AS delivery_ref_no,
		  	  	CASE WHEN BL.AIR_SEA_CLSS_CD = 'S' AND BND.BND_CLSS_CD = 'O' AND BL.BIZ_CLSS_CD = 'H' THEN DEL.TRDP_CD ELSE '' END AS DELIVERY_TRDP_CD,
                CASE WHEN BL.AIR_SEA_CLSS_CD = 'S' AND BND.BND_CLSS_CD = 'O' AND BL.BIZ_CLSS_CD = 'H' THEN DEL.TRDP_NM ELSE '' END AS DELIVERY_TRDP_NM,
                CASE WHEN BL.AIR_SEA_CLSS_CD = 'S' AND BND.BND_CLSS_CD = 'O' AND BL.BIZ_CLSS_CD = 'H' THEN (SELECT B.PIC_NM  FROM TB_TRDP_CNTC_PSON B WHERE B.TRDP_CD = DEL.TRDP_CD AND B.REP_FLG = 'Y' AND B.DELT_FLG = 'N') ELSE '' END AS DELIVERY_PIC,
  				CASE WHEN BL.AIR_SEA_CLSS_CD = 'S' AND BND.BND_CLSS_CD = 'O' AND BL.BIZ_CLSS_CD = 'H' THEN (SELECT B.PIC_PHN  FROM TB_TRDP_CNTC_PSON B WHERE B.TRDP_CD = DEL.TRDP_CD AND B.REP_FLG = 'Y' AND B.DELT_FLG = 'N') ELSE '' END AS DELIVERY_PHN,
  				CASE WHEN BL.AIR_SEA_CLSS_CD = 'S' AND BND.BND_CLSS_CD = 'O' AND BL.BIZ_CLSS_CD = 'H' THEN (SELECT B.PIC_FAX  FROM TB_TRDP_CNTC_PSON B WHERE B.TRDP_CD = DEL.TRDP_CD AND B.REP_FLG = 'Y' AND B.DELT_FLG = 'N') ELSE '' END AS DELIVERY_FAX,
  				CASE WHEN BL.AIR_SEA_CLSS_CD = 'S' AND BND.BND_CLSS_CD = 'O' AND BL.BIZ_CLSS_CD = 'H' THEN 
				(SELECT ISNULL(DEL_TRDP.LGL_ADDR,'') + 
	                	(CASE WHEN ISNULL(DEL_TRDP.CITY_NM,'') != '' AND ISNULL(DEL_TRDP.STATE_CD,'') != '' AND ISNULL(DEL_TRDP.REP_ZIP,'') != '' THEN CHAR(13) + DEL_TRDP.CITY_NM + ', ' + DEL_TRDP.STATE_CD + ' ' + DEL_TRDP.REP_ZIP
					  	      WHEN ISNULL(DEL_TRDP.CITY_NM,'') != '' AND ISNULL(DEL_TRDP.STATE_CD,'') != '' AND ISNULL(DEL_TRDP.REP_ZIP,'') = '' THEN CHAR(13) + DEL_TRDP.CITY_NM + ' ' + DEL_TRDP.STATE_CD
						      WHEN ISNULL(DEL_TRDP.CITY_NM,'') != '' AND ISNULL(DEL_TRDP.STATE_CD,'') = '' AND ISNULL(DEL_TRDP.REP_ZIP,'') = '' THEN CHAR(13) + DEL_TRDP.CITY_NM
						      WHEN ISNULL(DEL_TRDP.CITY_NM,'') != '' AND ISNULL(DEL_TRDP.STATE_CD,'') = '' AND ISNULL(DEL_TRDP.REP_ZIP,'') != '' THEN CHAR(13) + DEL_TRDP.CITY_NM + ', ' + DEL_TRDP.REP_ZIP
						      ELSE '' END)
		         FROM TB_TRDP DEL_TRDP
		         WHERE DEL.TRDP_CD = DEL_TRDP.TRDP_CD) ELSE '' END AS DELIVERY_TRDP_ADDR,
				CASE WHEN BL.AIR_SEA_CLSS_CD = 'S' AND BND.BND_CLSS_CD = 'O' AND BL.BIZ_CLSS_CD = 'H' THEN MBL.RCV_WH_CD ELSE '' END AS RETURN_TRDP_CD,
				CASE WHEN BL.AIR_SEA_CLSS_CD = 'S' AND BND.BND_CLSS_CD = 'O' AND BL.BIZ_CLSS_CD = 'H' THEN (SELECT LOCL_NM FROM TB_TRDP WHERE TRDP_CD = MBL.RCV_WH_CD AND DELT_FLG ='N') ELSE '' END AS RETURN_TRDP_NM,
				CASE WHEN BL.AIR_SEA_CLSS_CD = 'S' AND BND.BND_CLSS_CD = 'O' AND BL.BIZ_CLSS_CD = 'H' THEN 				
				(SELECT ISNULL(RTN_TRDP.LGL_ADDR,'') + 
	                	(CASE WHEN ISNULL(RTN_TRDP.CITY_NM,'') != '' AND ISNULL(RTN_TRDP.STATE_CD,'') != '' AND ISNULL(RTN_TRDP.REP_ZIP,'') != '' THEN CHAR(13) + RTN_TRDP.CITY_NM + ', ' + RTN_TRDP.STATE_CD + ' ' + RTN_TRDP.REP_ZIP
			  	      		  WHEN ISNULL(RTN_TRDP.CITY_NM,'') != '' AND ISNULL(RTN_TRDP.STATE_CD,'') != '' AND ISNULL(RTN_TRDP.REP_ZIP,'') = '' THEN CHAR(13) + RTN_TRDP.CITY_NM + ' ' + RTN_TRDP.STATE_CD
				      		  WHEN ISNULL(RTN_TRDP.CITY_NM,'') != '' AND ISNULL(RTN_TRDP.STATE_CD,'') = '' AND ISNULL(RTN_TRDP.REP_ZIP,'') = '' THEN CHAR(13) + RTN_TRDP.CITY_NM
				      		  WHEN ISNULL(RTN_TRDP.CITY_NM,'') != '' AND ISNULL(RTN_TRDP.STATE_CD,'') = '' AND ISNULL(RTN_TRDP.REP_ZIP,'') != '' THEN CHAR(13) + RTN_TRDP.CITY_NM + ', ' + RTN_TRDP.REP_ZIP
				      		  ELSE '' END)
		         FROM TB_TRDP RTN_TRDP
		         WHERE MBL.RCV_WH_CD = RTN_TRDP.TRDP_CD) ELSE '' END AS RETURN_TRDP_ADDR,
				CASE WHEN BL.AIR_SEA_CLSS_CD = 'S' AND BND.BND_CLSS_CD = 'O' AND BL.BIZ_CLSS_CD = 'H' THEN (SELECT B.PIC_NM  FROM TB_TRDP_CNTC_PSON B WHERE B.TRDP_CD = MBL.RCV_WH_CD AND B.REP_FLG = 'Y' AND B.DELT_FLG = 'N') ELSE '' END AS RETURN_PIC,
				CASE WHEN BL.AIR_SEA_CLSS_CD = 'S' AND BND.BND_CLSS_CD = 'O' AND BL.BIZ_CLSS_CD = 'H' THEN (SELECT B.PIC_PHN FROM TB_TRDP_CNTC_PSON B WHERE B.TRDP_CD = MBL.RCV_WH_CD AND B.REP_FLG = 'Y' AND B.DELT_FLG = 'N') ELSE '' END AS RETURN_PHN,
				CASE WHEN BL.AIR_SEA_CLSS_CD = 'S' AND BND.BND_CLSS_CD = 'O' AND BL.BIZ_CLSS_CD = 'H' THEN (SELECT B.PIC_FAX FROM TB_TRDP_CNTC_PSON B WHERE B.TRDP_CD = MBL.RCV_WH_CD AND B.REP_FLG = 'Y' AND B.DELT_FLG = 'N') ELSE '' END AS RETURN_FAX   
           FROM TB_INTG_BL BL
           LEFT OUTER JOIN TB_ADD_INFO_BND BND 
			 ON BL.INTG_BL_SEQ = BND.INTG_BL_SEQ
		   LEFT OUTER JOIN TB_PCK_UT_CD PCD        
			 ON BL.PCK_UT_CD = PCD.PCK_UT_CD
		    AND PCD.DELT_FLG = 'N'
		   LEFT OUTER JOIN TB_BL_PRNR LNR
			 ON BL.INTG_BL_SEQ = LNR.INTG_BL_SEQ  
			AND LNR.BL_TRDP_TP_CD = 'L01' 
			AND LNR.DELT_FLG = 'N'
		   LEFT OUTER JOIN TB_BL_PRNR ACT            
			 ON BL.INTG_BL_SEQ = ACT.INTG_BL_SEQ  
			AND ACT.BL_TRDP_TP_CD = 'S02' 
			AND ACT.DELT_FLG = 'N'
		   LEFT OUTER JOIN TB_BL_PRNR TRK            
			 ON BL.INTG_BL_SEQ = TRK.INTG_BL_SEQ  
			AND TRK.BL_TRDP_TP_CD = 'T02' 
			AND TRK.DELT_FLG = 'N'  
		   LEFT OUTER JOIN TB_BL_PRNR DEL            
			 ON BL.INTG_BL_SEQ = DEL.INTG_BL_SEQ  
			AND DEL.BL_TRDP_TP_CD = 'S03' 
			AND DEL.DELT_FLG = 'N'     
		   LEFT OUTER JOIN TB_INTG_BL_RLT RLT
            ON  BL.INTG_BL_SEQ = RLT.INTG_BL_SEQ AND RLT.DELT_FLG = 'N'        
		   LEFT OUTER JOIN TB_INTG_BL MBL
            ON  RLT.RLT_INTG_BL_SEQ = MBL.INTG_BL_SEQ AND MBL.BIZ_CLSS_CD = 'M' AND MBL.DELT_FLG = 'N'
           WHERE BL.INTG_BL_SEQ = #intg_bl_seq#
             AND BL.DELT_FLG = 'N'
    </select>
    
        <!-- Work Order BL 요약 정보를 리턴함   -->
    <select id="selectWO_BL_SMRY_OIH" parameterClass="HashMap" resultClass="com.clt.apps.fis.see.bmd.workorder.dto.WoOrdVO">
     /* BlCmmSQL.xml > selectWO_BL_SMRY_OIH */
         SELECT TOP 1
        		BL.INTG_BL_SEQ,        
                BL.BKG_NO,             
                BL.BL_NO,
                BL.REP_CMDT_CD,        
                BL.REP_CMDT_NM,        
                BL.PCK_QTY CGO_PCK_QTY,            
                BL.PCK_UT_CD CGO_PCK_UT_CD,              
                PCD.PCK_NM AS PCK_UT_NM,
                BL.GRS_WGT ACT_WGT_K,            
                BL.GRS_WGT1 ACT_WGT_L,			 
                BL.GRS_WGT_UT_CD,      
                BL.CHG_WGT,            	
                BL.CHG_WGT_UT_CD,          
                BL.ACT_WGT,            
                BL.ACT_WGT_UT_CD,      
                BL.MEAS CGO_MEAS_M,               
                BL.MEAS1 CGO_MEAS_F,					
                BL.MEAS_UT_CD,
                BL.POR_CD,             
                '' AS POR_NOD_CD,         
                BL.POR_NM,            
                BL.POL_CD,                 
                BL.POL_NOD_CD,    
                BL.POL_NM,                 
                BL.POD_CD,             
                BL.POD_NOD_CD,         
                BL.POD_NM,             
                BL.DEL_CD,                 
                '' AS DEL_NOD_CD,    
                BL.DEL_NM,
                BL.ISS_LOC_CD,         
                BL.ISS_LOC_NM,         
                BL.PAY_LOC_CD,         
                BL.PAY_LOC_NM,
                BL.FNL_DEST_LOC_CD,    
                '' AS FNL_DEST_NOD_CD,    
                BL.FNL_DEST_LOC_NM,    
                BL.CGO_RCV_DT_TM,          
                BL.CFS_LOC_CD,
                BL.CFS_NOD_CD,         
                BL.DE_DUE_DT,          
                BL.PRE_VSL_CD,         
                BL.PRE_VSL_NM,         
                BL.PRE_VOY,            
                BL.TRNK_VSL_CD,            
                BL.TRNK_VSL_NM,   
                BL.TRNK_VOY,           
                BL.CGO_CLZ_DT_TM,      
                BL.OBRD_DT_TM,         
                BL.ETD_DT_TM,          
                BL.ETA_DT_TM,
                BL.LNR_BKG_NO,         
                LNR.TRDP_CD AS LNR_TRDP_CD,                   
                LNR.TRDP_NM AS LNR_TRDP_NM,
                BL.RMK,
                BL.REP_CMDT_CD AS CGO_ITM_CMDT_CD, 
                BL.REP_CMDT_NM AS CGO_ITM_CMDT_NM,				   
                ACT.TRDP_CD AS BILL_TO_TRDP_CD,               
                ACT.TRDP_NM AS BILL_TO_TRDP_NM,   
                (SELECT ISNULL(BILL_TO.LGL_ADDR,'') + 
                		(CASE WHEN ISNULL(BILL_TO.CITY_NM,'') != '' AND ISNULL(BILL_TO.STATE_CD,'') != '' AND ISNULL(BILL_TO.REP_ZIP,'') != '' THEN CHAR(13) + BILL_TO.CITY_NM + ', ' + BILL_TO.STATE_CD + ' ' + BILL_TO.REP_ZIP
					  	      WHEN ISNULL(BILL_TO.CITY_NM,'') != '' AND ISNULL(BILL_TO.STATE_CD,'') != '' AND ISNULL(BILL_TO.REP_ZIP,'') = '' THEN CHAR(13) + BILL_TO.CITY_NM + ' ' + BILL_TO.STATE_CD
						      WHEN ISNULL(BILL_TO.CITY_NM,'') != '' AND ISNULL(BILL_TO.STATE_CD,'') = '' AND ISNULL(BILL_TO.REP_ZIP,'') = '' THEN CHAR(13) + BILL_TO.CITY_NM
						      WHEN ISNULL(BILL_TO.CITY_NM,'') != '' AND ISNULL(BILL_TO.STATE_CD,'') = '' AND ISNULL(BILL_TO.REP_ZIP,'') != '' THEN CHAR(13) + BILL_TO.CITY_NM + ', ' + BILL_TO.REP_ZIP
						      ELSE '' END)
		         FROM TB_TRDP BILL_TO
		         WHERE ACT.TRDP_CD = BILL_TO.TRDP_CD) AS BILL_TO_TRDP_ADDR,
                BL.REF_NO AS BILL_TO_REF_NO,
                TRK.TRDP_CD TRUCKER_TRDP_CD,
                TRK.TRDP_NM TRUCKER_TRDP_NM,
                (SELECT B.PIC_NM  FROM TB_TRDP_CNTC_PSON B WHERE B.TRDP_CD = TRK.TRDP_CD AND B.REP_FLG = 'Y' AND B.DELT_FLG = 'N') AS TRUCKER_PIC,
  				(SELECT B.PIC_PHN  FROM TB_TRDP_CNTC_PSON B WHERE B.TRDP_CD = TRK.TRDP_CD AND B.REP_FLG = 'Y' AND B.DELT_FLG = 'N') AS TRUCKER_PHN,
  				(SELECT B.PIC_FAX  FROM TB_TRDP_CNTC_PSON B WHERE B.TRDP_CD = TRK.TRDP_CD AND B.REP_FLG = 'Y' AND B.DELT_FLG = 'N') AS TRUCKER_FAX,
				(SELECT ISNULL(TRK_TRDP.LGL_ADDR,'') + 
	                	(CASE WHEN ISNULL(TRK_TRDP.CITY_NM,'') != '' AND ISNULL(TRK_TRDP.STATE_CD,'') != '' AND ISNULL(TRK_TRDP.REP_ZIP,'') != '' THEN CHAR(13) + TRK_TRDP.CITY_NM + ', ' + TRK_TRDP.STATE_CD + ' ' + TRK_TRDP.REP_ZIP
					  	      WHEN ISNULL(TRK_TRDP.CITY_NM,'') != '' AND ISNULL(TRK_TRDP.STATE_CD,'') != '' AND ISNULL(TRK_TRDP.REP_ZIP,'') = '' THEN CHAR(13) + TRK_TRDP.CITY_NM + ' ' + TRK_TRDP.STATE_CD
						      WHEN ISNULL(TRK_TRDP.CITY_NM,'') != '' AND ISNULL(TRK_TRDP.STATE_CD,'') = '' AND ISNULL(TRK_TRDP.REP_ZIP,'') = '' THEN CHAR(13) + TRK_TRDP.CITY_NM
						      WHEN ISNULL(TRK_TRDP.CITY_NM,'') != '' AND ISNULL(TRK_TRDP.STATE_CD,'') = '' AND ISNULL(TRK_TRDP.REP_ZIP,'') != '' THEN CHAR(13) + TRK_TRDP.CITY_NM + ', ' + TRK_TRDP.REP_ZIP
						      ELSE '' END)
		         FROM TB_TRDP TRK_TRDP
		         WHERE TRK.TRDP_CD = TRK_TRDP.TRDP_CD) AS TRUCKER_TRDP_ADDR,
				<!-- #34862 - [BINEX]Work Order - Trucker 정보 Link -->
				#pickup_ref_no# AS pickup_ref_no,
		  	  	#delivery_ref_no# AS delivery_ref_no,
			    CASE WHEN LEN(BL.CY_TRDP_CD) > 0 THEN BL.CY_TRDP_CD ELSE BL.CFS_TRDP_CD END AS PICKUP_TRDP_CD,
				(SELECT LOCL_NM FROM TB_TRDP WHERE TRDP_CD =  ISNULL(REPLACE(BL.CY_TRDP_CD,'',NULL),BL.CFS_TRDP_CD) AND DELT_FLG ='N')PICKUP_TRDP_NM,
				(SELECT ISNULL(PU_TRDP.LGL_ADDR,'') + 
	                	(CASE WHEN ISNULL(PU_TRDP.CITY_NM,'') != '' AND ISNULL(PU_TRDP.STATE_CD,'') != '' AND ISNULL(PU_TRDP.REP_ZIP,'') != '' THEN CHAR(13) + PU_TRDP.CITY_NM + ', ' + PU_TRDP.STATE_CD + ' ' + PU_TRDP.REP_ZIP
			  	      		  WHEN ISNULL(PU_TRDP.CITY_NM,'') != '' AND ISNULL(PU_TRDP.STATE_CD,'') != '' AND ISNULL(PU_TRDP.REP_ZIP,'') = '' THEN CHAR(13) + PU_TRDP.CITY_NM + ' ' + PU_TRDP.STATE_CD
				      		  WHEN ISNULL(PU_TRDP.CITY_NM,'') != '' AND ISNULL(PU_TRDP.STATE_CD,'') = '' AND ISNULL(PU_TRDP.REP_ZIP,'') = '' THEN CHAR(13) + PU_TRDP.CITY_NM
				      		  WHEN ISNULL(PU_TRDP.CITY_NM,'') != '' AND ISNULL(PU_TRDP.STATE_CD,'') = '' AND ISNULL(PU_TRDP.REP_ZIP,'') != '' THEN CHAR(13) + PU_TRDP.CITY_NM + ', ' + PU_TRDP.REP_ZIP
				      		  ELSE '' END)
		         FROM TB_TRDP PU_TRDP
		         WHERE PU_TRDP.TRDP_CD = (CASE WHEN LEN(BL.CY_TRDP_CD) > 0 THEN BL.CY_TRDP_CD ELSE BL.CFS_TRDP_CD END)) AS PICKUP_TRDP_ADDR,
				(SELECT B.PIC_NM  FROM TB_TRDP_CNTC_PSON B WHERE B.TRDP_CD = CASE WHEN LEN(BL.CY_TRDP_CD) > 0 THEN BL.CY_TRDP_CD ELSE BL.CFS_TRDP_CD END AND B.REP_FLG = 'Y' AND B.DELT_FLG = 'N') PICKUP_PIC,
				(SELECT B.PIC_PHN FROM TB_TRDP_CNTC_PSON B WHERE B.TRDP_CD = CASE WHEN LEN(BL.CY_TRDP_CD) > 0 THEN BL.CY_TRDP_CD ELSE BL.CFS_TRDP_CD END AND B.REP_FLG = 'Y' AND B.DELT_FLG = 'N') PICKUP_PHN,
				(SELECT B.PIC_FAX FROM TB_TRDP_CNTC_PSON B WHERE B.TRDP_CD = CASE WHEN LEN(BL.CY_TRDP_CD) > 0 THEN BL.CY_TRDP_CD ELSE BL.CFS_TRDP_CD END AND B.REP_FLG = 'Y' AND B.DELT_FLG = 'N') PICKUP_FAX,
				 BL.DOOR_LOC_CD DELIVERY_TRDP_CD,
				(SELECT LOCL_NM FROM TB_TRDP WHERE TRDP_CD = BL.DOOR_LOC_CD AND DELT_FLG ='N') DELIVERY_TRDP_NM,
				(SELECT ISNULL(DEL_TRDP.LGL_ADDR,'') + 
	                	(CASE WHEN ISNULL(DEL_TRDP.CITY_NM,'') != '' AND ISNULL(DEL_TRDP.STATE_CD,'') != '' AND ISNULL(DEL_TRDP.REP_ZIP,'') != '' THEN CHAR(13) + DEL_TRDP.CITY_NM + ', ' + DEL_TRDP.STATE_CD + ' ' + DEL_TRDP.REP_ZIP
					  	      WHEN ISNULL(DEL_TRDP.CITY_NM,'') != '' AND ISNULL(DEL_TRDP.STATE_CD,'') != '' AND ISNULL(DEL_TRDP.REP_ZIP,'') = '' THEN CHAR(13) + DEL_TRDP.CITY_NM + ' ' + DEL_TRDP.STATE_CD
						      WHEN ISNULL(DEL_TRDP.CITY_NM,'') != '' AND ISNULL(DEL_TRDP.STATE_CD,'') = '' AND ISNULL(DEL_TRDP.REP_ZIP,'') = '' THEN CHAR(13) + DEL_TRDP.CITY_NM
						      WHEN ISNULL(DEL_TRDP.CITY_NM,'') != '' AND ISNULL(DEL_TRDP.STATE_CD,'') = '' AND ISNULL(DEL_TRDP.REP_ZIP,'') != '' THEN CHAR(13) + DEL_TRDP.CITY_NM + ', ' + DEL_TRDP.REP_ZIP
						      ELSE '' END)
		         FROM TB_TRDP DEL_TRDP
		         WHERE DEL_TRDP.TRDP_CD = BL.DOOR_LOC_CD) AS DELIVERY_TRDP_ADDR,
				(SELECT B.PIC_NM  FROM TB_TRDP_CNTC_PSON B WHERE B.TRDP_CD = BL.DOOR_LOC_CD AND B.REP_FLG = 'Y' AND B.DELT_FLG = 'N') DELIVERY_PIC,
				(SELECT B.PIC_PHN FROM TB_TRDP_CNTC_PSON B WHERE B.TRDP_CD = BL.DOOR_LOC_CD AND B.REP_FLG = 'Y' AND B.DELT_FLG = 'N') DELIVERY_PHN,
				(SELECT B.PIC_FAX FROM TB_TRDP_CNTC_PSON B WHERE B.TRDP_CD = BL.DOOR_LOC_CD AND B.REP_FLG = 'Y' AND B.DELT_FLG = 'N') DELIVERY_FAX,
				'' RETURN_TRDP_CD,
				'' RETURN_TRDP_NM,
                '' RETURN_TRDP_ADDR,
 			    '' RETURN_PIC,
				'' RETURN_PHN,
				'' RETURN_FAX     
           FROM TB_INTG_BL BL
		   LEFT OUTER JOIN TB_PCK_UT_CD PCD        
			 ON BL.PCK_UT_CD = PCD.PCK_UT_CD
		    AND PCD.DELT_FLG = 'N'
		   LEFT OUTER JOIN TB_BL_PRNR LNR
			 ON BL.INTG_BL_SEQ = LNR.INTG_BL_SEQ  
			AND LNR.BL_TRDP_TP_CD = 'L01' 
			AND LNR.DELT_FLG = 'N'
		   LEFT OUTER JOIN TB_BL_PRNR ACT            
			 ON BL.INTG_BL_SEQ = ACT.INTG_BL_SEQ  
			AND ACT.BL_TRDP_TP_CD = 'S02' 
			AND ACT.DELT_FLG = 'N'
		   LEFT OUTER JOIN TB_BL_PRNR TRK            
			 ON BL.INTG_BL_SEQ = TRK.INTG_BL_SEQ  
			AND TRK.BL_TRDP_TP_CD = 'T02' 
			AND TRK.DELT_FLG = 'N'             
           WHERE BL.INTG_BL_SEQ = #intg_bl_seq#
             AND BL.DELT_FLG = 'N'
    </select>
    
    
        <!-- Work Order BL 요약 정보를 리턴함   -->
    <select id="selectWO_BL_SMRY_AIH" parameterClass="HashMap" resultClass="com.clt.apps.fis.see.bmd.workorder.dto.WoOrdVO">
     /* BlCmmSQL.xml > selectWO_BL_SMRY_AIH */
         SELECT TOP 1
        		BL.INTG_BL_SEQ,        
                BL.BKG_NO,             
                BL.BL_NO,
                BL.REP_CMDT_CD,        
                BL.REP_CMDT_NM,        
                BL.PCK_QTY CGO_PCK_QTY,            
                BL.PCK_UT_CD CGO_PCK_UT_CD,              
                PCD.PCK_NM AS PCK_UT_NM,
                BL.GRS_WGT ACT_WGT_K,            
                BL.GRS_WGT1 ACT_WGT_L,			 
                BL.GRS_WGT_UT_CD,      
                BL.CHG_WGT,            	
                BL.CHG_WGT_UT_CD,          
                BL.ACT_WGT,            
                BL.ACT_WGT_UT_CD,      
                BL.MEAS CGO_MEAS_M,               
                BL.MEAS1 CGO_MEAS_F,					
                BL.MEAS_UT_CD,
                BL.POR_CD,             
                '' AS POR_NOD_CD,         
                BL.POR_NM,            
                BL.POL_CD,                 
                BL.POL_NOD_CD,    
                BL.POL_NM,                 
                BL.POD_CD,             
                BL.POD_NOD_CD,         
                BL.POD_NM,             
                BL.DEL_CD,                 
                '' AS DEL_NOD_CD,    
                BL.DEL_NM,
                BL.ISS_LOC_CD,         
                BL.ISS_LOC_NM,         
                BL.PAY_LOC_CD,         
                BL.PAY_LOC_NM,
                BL.FNL_DEST_LOC_CD,    
                '' AS FNL_DEST_NOD_CD,    
                BL.FNL_DEST_LOC_NM,    
                BL.CGO_RCV_DT_TM,          
                BL.CFS_LOC_CD,
                BL.CFS_NOD_CD,         
                BL.DE_DUE_DT,          
                BL.PRE_VSL_CD,         
                BL.PRE_VSL_NM,         
                BL.PRE_VOY,            
                BL.TRNK_VSL_CD,            
                BL.TRNK_VSL_NM,   
                BL.TRNK_VOY,           
                BL.CGO_CLZ_DT_TM,      
                BL.OBRD_DT_TM,         
                BL.ETD_DT_TM,          
                BL.ETA_DT_TM,
                BL.LNR_BKG_NO,         
                LNR.TRDP_CD AS LNR_TRDP_CD,                   
                LNR.TRDP_NM AS LNR_TRDP_NM,
                BL.RMK,
                BL.REP_CMDT_CD AS CGO_ITM_CMDT_CD, 
                BL.REP_CMDT_NM AS CGO_ITM_CMDT_NM,				   
                ACT.TRDP_CD AS BILL_TO_TRDP_CD,               
                ACT.TRDP_NM AS BILL_TO_TRDP_NM,   
                (SELECT ISNULL(BILL_TO.LGL_ADDR,'') + 
	                	(CASE WHEN ISNULL(BILL_TO.CITY_NM,'') != '' AND ISNULL(BILL_TO.STATE_CD,'') != '' AND ISNULL(BILL_TO.REP_ZIP,'') != '' THEN CHAR(13) + BILL_TO.CITY_NM + ', ' + BILL_TO.STATE_CD + ' ' + BILL_TO.REP_ZIP
					  	      WHEN ISNULL(BILL_TO.CITY_NM,'') != '' AND ISNULL(BILL_TO.STATE_CD,'') != '' AND ISNULL(BILL_TO.REP_ZIP,'') = '' THEN CHAR(13) + BILL_TO.CITY_NM + ' ' + BILL_TO.STATE_CD
						      WHEN ISNULL(BILL_TO.CITY_NM,'') != '' AND ISNULL(BILL_TO.STATE_CD,'') = '' AND ISNULL(BILL_TO.REP_ZIP,'') = '' THEN CHAR(13) + BILL_TO.CITY_NM
						      WHEN ISNULL(BILL_TO.CITY_NM,'') != '' AND ISNULL(BILL_TO.STATE_CD,'') = '' AND ISNULL(BILL_TO.REP_ZIP,'') != '' THEN CHAR(13) + BILL_TO.CITY_NM + ', ' + BILL_TO.REP_ZIP
						      ELSE '' END)
	           	 FROM TB_TRDP BILL_TO
	          	 WHERE ACT.TRDP_CD = BILL_TO.TRDP_CD) AS BILL_TO_TRDP_ADDR,
                BL.REF_NO AS BILL_TO_REF_NO,
                TRK.TRDP_CD TRUCKER_TRDP_CD,
                TRK.TRDP_NM TRUCKER_TRDP_NM,
                (SELECT B.PIC_NM  FROM TB_TRDP_CNTC_PSON B WHERE B.TRDP_CD = TRK.TRDP_CD AND B.REP_FLG = 'Y' AND B.DELT_FLG = 'N') AS TRUCKER_PIC,
  				(SELECT B.PIC_PHN  FROM TB_TRDP_CNTC_PSON B WHERE B.TRDP_CD = TRK.TRDP_CD AND B.REP_FLG = 'Y' AND B.DELT_FLG = 'N') AS TRUCKER_PHN,
  				(SELECT B.PIC_FAX  FROM TB_TRDP_CNTC_PSON B WHERE B.TRDP_CD = TRK.TRDP_CD AND B.REP_FLG = 'Y' AND B.DELT_FLG = 'N') AS TRUCKER_FAX,
				(SELECT ISNULL(TRK_TRDP.LGL_ADDR,'') + 
	                	(CASE WHEN ISNULL(TRK_TRDP.CITY_NM,'') != '' AND ISNULL(TRK_TRDP.STATE_CD,'') != '' AND ISNULL(TRK_TRDP.REP_ZIP,'') != '' THEN CHAR(13) + TRK_TRDP.CITY_NM + ', ' + TRK_TRDP.STATE_CD + ' ' + TRK_TRDP.REP_ZIP
					  	      WHEN ISNULL(TRK_TRDP.CITY_NM,'') != '' AND ISNULL(TRK_TRDP.STATE_CD,'') != '' AND ISNULL(TRK_TRDP.REP_ZIP,'') = '' THEN CHAR(13) + TRK_TRDP.CITY_NM + ' ' + TRK_TRDP.STATE_CD
						      WHEN ISNULL(TRK_TRDP.CITY_NM,'') != '' AND ISNULL(TRK_TRDP.STATE_CD,'') = '' AND ISNULL(TRK_TRDP.REP_ZIP,'') = '' THEN CHAR(13) + TRK_TRDP.CITY_NM
						      WHEN ISNULL(TRK_TRDP.CITY_NM,'') != '' AND ISNULL(TRK_TRDP.STATE_CD,'') = '' AND ISNULL(TRK_TRDP.REP_ZIP,'') != '' THEN CHAR(13) + TRK_TRDP.CITY_NM + ', ' + TRK_TRDP.REP_ZIP
						      ELSE '' END)
		         FROM TB_TRDP TRK_TRDP
		         WHERE TRK.TRDP_CD = TRK_TRDP.TRDP_CD) AS TRUCKER_TRDP_ADDR,
				<!-- #34862 - [BINEX]Work Order - Trucker 정보 Link -->
				#pickup_ref_no# AS pickup_ref_no,
		  	  	#delivery_ref_no# AS delivery_ref_no,
			    CASE WHEN LEN(BL.CY_TRDP_CD) > 0 THEN BL.CY_TRDP_CD ELSE BL.CFS_TRDP_CD END AS  PICKUP_TRDP_CD,
				(SELECT LOCL_NM FROM TB_TRDP WHERE TRDP_CD =  ISNULL(REPLACE(BL.CY_TRDP_CD,'',NULL),BL.CFS_TRDP_CD) AND DELT_FLG ='N')PICKUP_TRDP_NM,
				(SELECT ISNULL(PU_TRDP.LGL_ADDR,'') + 
	                	(CASE WHEN ISNULL(PU_TRDP.CITY_NM,'') != '' AND ISNULL(PU_TRDP.STATE_CD,'') != '' AND ISNULL(PU_TRDP.REP_ZIP,'') != '' THEN CHAR(13) + PU_TRDP.CITY_NM + ', ' + PU_TRDP.STATE_CD + ' ' + PU_TRDP.REP_ZIP
					  	      WHEN ISNULL(PU_TRDP.CITY_NM,'') != '' AND ISNULL(PU_TRDP.STATE_CD,'') != '' AND ISNULL(PU_TRDP.REP_ZIP,'') = '' THEN CHAR(13) + PU_TRDP.CITY_NM + ' ' + PU_TRDP.STATE_CD
						      WHEN ISNULL(PU_TRDP.CITY_NM,'') != '' AND ISNULL(PU_TRDP.STATE_CD,'') = '' AND ISNULL(PU_TRDP.REP_ZIP,'') = '' THEN CHAR(13) + PU_TRDP.CITY_NM
						      WHEN ISNULL(PU_TRDP.CITY_NM,'') != '' AND ISNULL(PU_TRDP.STATE_CD,'') = '' AND ISNULL(PU_TRDP.REP_ZIP,'') != '' THEN CHAR(13) + PU_TRDP.CITY_NM + ', ' + PU_TRDP.REP_ZIP
						      ELSE '' END)
		         FROM TB_TRDP PU_TRDP
		         WHERE PU_TRDP.TRDP_CD = (CASE WHEN LEN(BL.CY_TRDP_CD) > 0 THEN BL.CY_TRDP_CD ELSE BL.CFS_TRDP_CD END)) AS PICKUP_TRDP_ADDR,
				(SELECT B.PIC_NM  FROM TB_TRDP_CNTC_PSON B WHERE B.TRDP_CD = CASE WHEN LEN(BL.CY_TRDP_CD) > 0 THEN BL.CY_TRDP_CD ELSE BL.CFS_TRDP_CD END AND B.REP_FLG = 'Y' AND B.DELT_FLG = 'N') PICKUP_PIC,
				(SELECT B.PIC_PHN FROM TB_TRDP_CNTC_PSON B WHERE B.TRDP_CD = CASE WHEN LEN(BL.CY_TRDP_CD) > 0 THEN BL.CY_TRDP_CD ELSE BL.CFS_TRDP_CD END AND B.REP_FLG = 'Y' AND B.DELT_FLG = 'N') PICKUP_PHN,
				(SELECT B.PIC_FAX FROM TB_TRDP_CNTC_PSON B WHERE B.TRDP_CD = CASE WHEN LEN(BL.CY_TRDP_CD) > 0 THEN BL.CY_TRDP_CD ELSE BL.CFS_TRDP_CD END AND B.REP_FLG = 'Y' AND B.DELT_FLG = 'N') PICKUP_FAX,
				 BL.DOOR_LOC_CD DELIVERY_TRDP_CD,
				(SELECT LOCL_NM FROM TB_TRDP WHERE TRDP_CD = BL.DOOR_LOC_CD AND DELT_FLG ='N') DELIVERY_TRDP_NM,
				(SELECT ISNULL(DEL_TRDP.LGL_ADDR,'') + 
	                	(CASE WHEN ISNULL(DEL_TRDP.CITY_NM,'') != '' AND ISNULL(DEL_TRDP.STATE_CD,'') != '' AND ISNULL(DEL_TRDP.REP_ZIP,'') != '' THEN CHAR(13) + DEL_TRDP.CITY_NM + ', ' + DEL_TRDP.STATE_CD + ' ' + DEL_TRDP.REP_ZIP
					  	      WHEN ISNULL(DEL_TRDP.CITY_NM,'') != '' AND ISNULL(DEL_TRDP.STATE_CD,'') != '' AND ISNULL(DEL_TRDP.REP_ZIP,'') = '' THEN CHAR(13) + DEL_TRDP.CITY_NM + ' ' + DEL_TRDP.STATE_CD
						      WHEN ISNULL(DEL_TRDP.CITY_NM,'') != '' AND ISNULL(DEL_TRDP.STATE_CD,'') = '' AND ISNULL(DEL_TRDP.REP_ZIP,'') = '' THEN CHAR(13) + DEL_TRDP.CITY_NM
						      WHEN ISNULL(DEL_TRDP.CITY_NM,'') != '' AND ISNULL(DEL_TRDP.STATE_CD,'') = '' AND ISNULL(DEL_TRDP.REP_ZIP,'') != '' THEN CHAR(13) + DEL_TRDP.CITY_NM + ', ' + DEL_TRDP.REP_ZIP
						      ELSE '' END)
		         FROM TB_TRDP DEL_TRDP
		         WHERE DEL_TRDP.TRDP_CD = BL.DOOR_LOC_CD) AS DELIVERY_TRDP_ADDR,
				(SELECT B.PIC_NM  FROM TB_TRDP_CNTC_PSON B WHERE B.TRDP_CD = BL.DOOR_LOC_CD AND B.REP_FLG = 'Y' AND B.DELT_FLG = 'N') DELIVERY_PIC,
				(SELECT B.PIC_PHN FROM TB_TRDP_CNTC_PSON B WHERE B.TRDP_CD = BL.DOOR_LOC_CD AND B.REP_FLG = 'Y' AND B.DELT_FLG = 'N') DELIVERY_PHN,
				(SELECT B.PIC_FAX FROM TB_TRDP_CNTC_PSON B WHERE B.TRDP_CD = BL.DOOR_LOC_CD AND B.REP_FLG = 'Y' AND B.DELT_FLG = 'N') DELIVERY_FAX,
				'' RETURN_TRDP_CD,
				'' RETURN_TRDP_NM,
                '' RETURN_TRDP_ADDR,
 			    '' RETURN_PIC,
				'' RETURN_PHN,
				'' RETURN_FAX      
           FROM TB_INTG_BL BL
		   LEFT OUTER JOIN TB_PCK_UT_CD PCD        
			 ON BL.PCK_UT_CD = PCD.PCK_UT_CD
		    AND PCD.DELT_FLG = 'N'
		   LEFT OUTER JOIN TB_BL_PRNR LNR
			 ON BL.INTG_BL_SEQ = LNR.INTG_BL_SEQ  
			AND LNR.BL_TRDP_TP_CD = 'L01' 
			AND LNR.DELT_FLG = 'N'
		   LEFT OUTER JOIN TB_BL_PRNR ACT            
			 ON BL.INTG_BL_SEQ = ACT.INTG_BL_SEQ  
			AND ACT.BL_TRDP_TP_CD = 'S02' 
			AND ACT.DELT_FLG = 'N'
		   LEFT OUTER JOIN TB_BL_PRNR TRK            
			 ON BL.INTG_BL_SEQ = TRK.INTG_BL_SEQ  
			AND TRK.BL_TRDP_TP_CD = 'T02' 
			AND TRK.DELT_FLG = 'N'             
           WHERE BL.INTG_BL_SEQ = #intg_bl_seq#
             AND BL.DELT_FLG = 'N'
    </select>
    
    <!-- Other BL 요약 정보를 리턴함   -->
    <select id="selectOth_BL_SMRY" parameterClass="HashMap" resultClass="HBLInfoVO">
    /* BlCmmSQL.xml > selectOth_BL_SMRY */
        SELECT
        bl.oth_seq as intg_bl_seq,
        '' bkg_no,
        bl.hbl_no bl_no,
        '' rep_cmdt_cd,
        '' rep_cmdt_nm,
        bl.pck_qty,
        bl.pck_ut_cd,
        '' pck_ut_nm,
        bl.grs_wgt_l as grs_wgt,
        bl.GRS_WGT_K as grs_wgt1,
        '' grs_wgt_ut_cd,
        '' chg_wgt,
        '' chg_wgt_ut_cd,
        '' act_wgt,
        '' act_wgt_ut_cd,
        bl.meas_m as meas,
        bl.meas_f meas1,
        '' meas_ut_cd,
        '' por_cd,
        '' AS por_nod_cd,
        '' por_nm,
        bl.pol_cd,
        '' pol_nod_cd,
        bl.pol_nm,
        bl.pod_cd,
        '' pod_nod_cd,
        bl.pod_nm,
        '' del_cd,
        '' del_nod_cd,
        '' del_nm,
        '' iss_loc_cd,
        '' iss_loc_nm,
        '' pay_loc_cd,
        '' pay_loc_nm,
        '' fnl_dest_loc_cd,
        '' fnl_dest_nod_cd,
        '' fnl_dest_loc_nm,
        '' cgo_rcv_dt_tm,
        '' cfs_loc_cd,
        '' cfs_nod_cd,
        '' de_due_dt,
        '' pre_vsl_cd,
        '' pre_vsl_nm,
        '' pre_voy,
        '' trnk_vsl_cd,
        '' trnk_vsl_nm,
        '' trnk_voy,
        '' cgo_clz_dt_tm,
        '' obrd_dt_tm,
        bl.etd_dt_tm,
        bl.eta_dt_tm,
        '' lnr_bkg_no,
        lnr.trdp_cd AS lnr_trdp_cd,
        lnr.trdp_nm AS lnr_trdp_nm,
        '' rmk                           
    FROM
        TB_OTH_SALES bl 
    LEFT OUTER JOIN
        tb_bl_prnr lnr            
            ON   bl.oth_seq = lnr.intg_bl_seq  
            AND lnr.bl_trdp_tp_cd = 'L01' 
            AND lnr.delt_flg = 'N'                  
    WHERE
        bl.ref_no =  #oth_ref_no#
    </select>
    
    <!--BL과 관련된 거래처 정보를 조회  -->
    <select id="selectTRDP_CD_LIST" parameterClass="HashMap" resultClass="BlCmmVO">
        SELECT  shp.trdp_cd AS shpr_trdp_cd,
                cne.trdp_cd AS cnee_trdp_cd,
                ntf.trdp_cd AS ntfy_trdp_cd,
                act.trdp_cd AS act_shpr_trdp_cd,  
                lnr.trdp_cd AS lnr_trdp_cd,
                ptn.trdp_cd AS prnr_trdp_cd,
                
                agent.trdp_cd AS agent_trdp_cd,
                third.trdp_cd AS third_trdp_cd,
                ptn2.trdp_cd AS prnr_trdp_cd2,
                
                cust.trdp_cd AS cust_trdp_cd,
                carr.trdp_cd AS carr_trdp_cd,
                
                iss.trdp_cd AS iss_trdp_cd,

                trk.trdp_cd AS trk_trdp_cd,

                vndr.trdp_cd AS vndr_trdp_cd,
                
                cgo_pu.trdp_cd AS cgo_pu_trdp_cd

         FROM   tb_intg_bl bl
        
         JOIN   tb_add_info_bnd bnd
           ON   bl.intg_bl_seq = bnd.intg_bl_seq AND bnd.bnd_clss_cd = #bnd_clss_cd#   AND bnd.delt_flg = 'N'
        
LEFT OUTER JOIN tb_bl_prnr act
           ON   bl.intg_bl_seq = act.intg_bl_seq  AND act.bl_trdp_tp_cd = 'S02' AND act.delt_flg = 'N'
        
LEFT OUTER JOIN tb_bl_prnr shp
           ON   bl.intg_bl_seq = shp.intg_bl_seq  AND shp.bl_trdp_tp_cd = 'S01' AND shp.delt_flg = 'N'
         
LEFT OUTER JOIN tb_bl_prnr cne
           ON   bl.intg_bl_seq = cne.intg_bl_seq  AND cne.bl_trdp_tp_cd = 'C01' AND cne.delt_flg = 'N'

LEFT OUTER JOIN tb_bl_prnr ntf
           ON   bl.intg_bl_seq = ntf.intg_bl_seq  AND ntf.bl_trdp_tp_cd = 'N01' AND ntf.delt_flg = 'N'

LEFT OUTER JOIN tb_bl_prnr lnr
           ON   bl.intg_bl_seq = lnr.intg_bl_seq  AND lnr.bl_trdp_tp_cd = 'L01' AND lnr.delt_flg = 'N'

LEFT OUTER JOIN tb_bl_prnr ptn
           ON   bl.intg_bl_seq = ptn.intg_bl_seq  AND ptn.bl_trdp_tp_cd = 'P01' AND ptn.delt_flg = 'N'

LEFT OUTER JOIN tb_bl_prnr agent
           ON   bl.intg_bl_seq = agent.intg_bl_seq  AND agent.bl_trdp_tp_cd = 'A01' AND agent.delt_flg = 'N'
           
LEFT OUTER JOIN tb_bl_prnr third
           ON   bl.intg_bl_seq = third.intg_bl_seq  AND third.bl_trdp_tp_cd = 'T01' AND third.delt_flg = 'N'           
           
LEFT OUTER JOIN tb_bl_prnr ptn2
           ON   bl.intg_bl_seq = ptn2.intg_bl_seq  AND ptn2.bl_trdp_tp_cd = 'P03' AND ptn2.delt_flg = 'N'

LEFT OUTER JOIN tb_bl_prnr carr
           ON   bl.intg_bl_seq = carr.intg_bl_seq  AND carr.bl_trdp_tp_cd = 'B01' AND carr.delt_flg = 'N'
           
LEFT OUTER JOIN tb_bl_prnr cust
           ON   bl.intg_bl_seq = cust.intg_bl_seq  AND cust.bl_trdp_tp_cd = 'C03' AND cust.delt_flg = 'N'     

LEFT OUTER JOIN tb_bl_prnr iss
           ON   bl.intg_bl_seq = iss.intg_bl_seq  AND iss.bl_trdp_tp_cd = 'I01' AND iss.delt_flg = 'N'     

LEFT OUTER JOIN tb_bl_prnr trk
           ON   bl.intg_bl_seq = trk.intg_bl_seq  AND trk.bl_trdp_tp_cd = 'T02' AND trk.delt_flg = 'N'     

LEFT OUTER JOIN tb_bl_prnr vndr
           ON   bl.intg_bl_seq = vndr.intg_bl_seq  AND vndr.bl_trdp_tp_cd = 'V01' AND vndr.delt_flg = 'N'
           
LEFT OUTER JOIN tb_bl_prnr cgo_pu
           ON   bl.intg_bl_seq = cgo_pu.intg_bl_seq  AND cgo_pu.bl_trdp_tp_cd = 'S03' AND cgo_pu.delt_flg = 'N'           

        WHERE bl.delt_flg = 'N' AND bl.intg_bl_seq = #intg_bl_seq#
    </select>
    
<!-- BL PARTNER 등록  -->
    <insert id="insertBL_PRNR" parameterClass="HashMap">
        INSERT INTO tb_bl_prnr(                                                      
              intg_bl_seq,          bl_trdp_tp_cd,    
              trdp_cd,              trdp_addr,          trdp_nm,
              
              trdp_pic_usr_id,      trdp_pic,           trdp_phn,      trdp_fax,     trdp_eml,
              
              rgst_usrid,           rgst_ofc_cd,        rgst_tms,        
              modi_usrid,           modi_ofc_cd,        modi_tms,      delt_flg                                                       
        ) SELECT  #intg_bl_seq#,    #bl_trdp_tp_cd#, 
                  #trdp_cd#,        UPPER(#trdp_addr#),  #trdp_nm#,
                  b.cntc_pson_seq,  b.pic_nm,            b.pic_phn,    b.pic_fax,    b.pic_eml,
                  #proc_usrid#,     #proc_ofccd#,        getdate(),
                  #proc_usrid#,     #proc_ofccd#,        GETUTCDATE(),    'N'
            FROM  tb_trdp a 
 LEFT OUTER JOIN  tb_trdp_cntc_pson b
              ON  a.trdp_cd=b.trdp_cd 
             AND  b.cntc_pson_seq = ( SELECT MIN(cntc_pson_seq)  
                                        FROM tb_trdp_cntc_pson 
                                       WHERE delt_flg = 'N' AND trdp_cd = a.trdp_cd )
             AND  a.delt_flg = 'N'
           WHERE  a.trdp_cd = #trdp_cd# 
           /* AND a.delt_flg = 'N' */
    </insert>

    <!--거래처 수정  -->
    <update id="updateBL_PRNR" parameterClass="HashMap">
        UPDATE  tb_bl_prnr                                                      
           SET  trdp_addr   = UPPER(#trdp_addr#),    trdp_nm  = #trdp_nm#
         WHERE  intg_bl_seq = #intg_bl_seq#   AND  bl_trdp_tp_cd = #bl_trdp_tp_cd#
    </update>
    
    <update id="updatePIC_NAME" parameterClass="HashMap">
        UPDATE  tb_bl_prnr                                                      
           SET  trdp_pic   =#trdp_pic#
         WHERE  intg_bl_seq = #intg_bl_seq#   AND  bl_trdp_tp_cd = #bl_trdp_tp_cd#
    </update>
    
    <!--거래처 삭제  -->
    <delete id="deleteBL_PRNR" parameterClass="HashMap">
        DELETE  tb_bl_prnr                                                      
         WHERE  intg_bl_seq = #intg_bl_seq#   AND  bl_trdp_tp_cd = #bl_trdp_tp_cd#
    </delete>
    
    <update id="updateHBLPol" parameterClass="HashMap">
        /* BlCmmSQL.xml -- updateHBLPol  */
        UPDATE  tb_intg_bl                                                      
           SET  pol_cd   = #pol_cd#
               ,pol_nm   = #pol_nm#
         WHERE  intg_bl_seq = #intg_bl_seq#
    </update>
    
    <update id="updateHBLPod" parameterClass="HashMap">
    	/* BlCmmSQL.xml -- updateHBLPod  */
        UPDATE  tb_intg_bl                                                      
           SET  pod_cd   = #pod_cd#
               ,pod_nm   = #pod_nm#
         WHERE  intg_bl_seq = #intg_bl_seq#
    </update>
    
    <!-- BL추가정보 테이블   -->
    <insert id="insertADD_INFO_BND" parameterClass="HashMap">
        INSERT INTO tb_add_info_bnd( 
            intg_bl_seq,     bnd_clss_cd,      jb_tmplt_seq,
            clz_flg,         cfm_flg,
            sls_ofc_cd,      sls_dept_cd,      sls_usrid,     sls_usr_nm,     pic_usrid,   
            rgst_usrid,      rgst_ofc_cd,      rgst_tms,        
            modi_usrid,      modi_ofc_cd,      modi_tms,      delt_flg,		  item_no,
            fst_to_cd,		 fst_to_nm,  
            exp_frt_desc,	 hbl_ser_no,
            ts1_port_cd,     ts1_port_nm,      ts1_etd_dt_tm, 	ts1_eta_dt_tm,
            issued_by,		 ctrb_ofc_cd, 	   ctrb_dept_cd, 	ctrb_ratio_yn,    ctrb_mgn ,state_cnt_cd, certi_sts_cd, certi_hndl_info                                                    

        )VALUES(
            #intg_bl_seq#,   #bnd_clss_cd#,    #jb_tmplt_seq#,
            'N',             'N',         
            #sls_ofc_cd#,    #sls_dept_cd#,    #sls_usrid#,   #sls_usr_nm#,     #pic_usrid#,
            #proc_usrid#,    #proc_ofccd#,     getdate(),            
            #proc_usrid#,    #proc_ofccd#,     GETUTCDATE(),     'N',			#item_no#,
            #fst_to_cd#,	 #fst_to_nm#,
            #exp_frt_desc#,  #hbl_ser_no#,
            #ts1_port_cd#,   #ts1_port_nm#,    #ts1_etd_dt_tm#,	 #ts1_eta_dt_tm#,
            #issued_by#,	 #ctrb_ofc_cd#,    #ctrb_dept_cd#,   #ctrb_ratio_yn#,  #ctrb_mgn#,#state_cnt_cd#, #certi_sts_cd#, #certi_hndl_info#
        )
    </insert>
    
    <!-- 추가정보 테이블을 업데이트함   -->
    <update id="updateADD_INFO_BND" parameterClass="HBLInfoVO">
        UPDATE  tb_add_info_bnd
           SET  sls_ofc_cd  = #sls_ofc_cd#,		sls_dept_cd = #sls_dept_cd#, 
                sls_usrid   = #sls_usrid#,      sls_usr_nm  = #sls_usr_nm#,
                modi_usrid  = #proc_usrid#,     modi_ofc_cd = #proc_ofccd#,    
                modi_tms    = GETUTCDATE(),		item_no = #item_no#,
                fst_to_cd   = #fst_to_cd#,      fst_to_nm = #fst_to_nm#,
                exp_frt_desc = #exp_frt_desc#,
                ts1_port_cd = #ts1_port_cd#,  ts1_port_nm = #ts1_port_nm#,
                ts1_etd_dt_tm = #ts1_etd_dt_tm#,  ts1_eta_dt_tm = #ts1_eta_dt_tm#
                ,issued_by = #issued_by#
                ,hbl_ser_pfx = #hbl_ser_pfx#
                ,hbl_ser_no = #hbl_ser_no#
                ,ctrb_ofc_cd = #ctrb_ofc_cd#
				,ctrb_dept_cd = #ctrb_dept_cd#
				,ctrb_ratio_yn = #ctrb_ratio_yn#
				,ctrb_mgn = #ctrb_mgn#
				,state_cnt_cd = #state_cnt_cd#
				,cfs_rmk = #cfs_rmk#
				,entr_no = #entr_no#
				,csms_rlse_dt = #csms_rlse_dt#
				,pkup_dt = #pkup_dt#
         WHERE  intg_bl_seq = #intg_bl_seq#
    </update>
    
    <!-- #27545 [BINEX] OIM Issued by를 수정하면 OIM, OIH Entry의 Issued by를 자동 반영(변경)   -->
    <update id="updateADD_INFO_BND_ISSBY" parameterClass="HBLInfoVO">
    	/* BlCmmSQL.xml -- updateADD_INFO_BND_ISSBY  */
        UPDATE  tb_add_info_bnd
           SET  modi_usrid  = #proc_usrid#, modi_ofc_cd = #proc_ofccd#,    
                modi_tms    = GETUTCDATE(), issued_by = #issued_by#
         WHERE  intg_bl_seq = #intg_bl_seq#
    </update>
    
    <!-- MST 추가정보 테이블을 업데이트함   -->
    <update id="updateMST_ADD_INFO_BND" parameterClass="HashMap">
        /* BlCmmSQL.xml -- updateMST_ADD_INFO_BND  */
        UPDATE  tb_add_info_bnd
           SET  sls_ofc_cd  = #sls_ofc_cd#,		sls_dept_cd = #sls_dept_cd#, 
                sls_usrid   = #sls_usrid#,      sls_usr_nm  = #sls_usr_nm#, modi_usrid  = #proc_usrid#,     
                modi_ofc_cd = #proc_ofccd#, 	modi_tms    = GETUTCDATE()		,issued_by = #issued_by#,
                ctrb_ofc_cd = #ctrb_ofc_cd#,
				ctrb_dept_cd = #ctrb_dept_cd#,
				ctrb_ratio_yn = #ctrb_ratio_yn#,
				ctrb_mgn = #ctrb_mgn#,
				cfs_rmk = #cfs_rmk#
         WHERE  intg_bl_seq = #intg_bl_seq#
    </update>
    
    <!-- Work Flow 템플릿을 등록한다   -->
    <procedure id="insertWRK_FLOW" parameterClass="HashMap">
         { CALL SP_BL_JBTMPL(#intg_bl_seq#, #jb_tmplt_seq#, #proc_usrid#, #proc_ofccd#) } 
    </procedure>
    
    <!-- BL처리에 따라 처리 상태를 업데이트 한다   -->
    <update id="updateWRK_FLOW" parameterClass="HashMap">
        UPDATE  tb_wrk_flow
           SET  jb_act_dt_tm= getdate(),
                modi_usrid  = #proc_usrid#,     modi_ofc_cd = #proc_ofccd#,    
                modi_tms    = GETUTCDATE()
         WHERE  intg_bl_seq = #intg_bl_seq# AND jb_sts_cd = #bl_sts_cd#
    </update>
        
    <!-- SR에서 업데이트 처리에 따라 처리 상태를 업데이트 한다   -->
    <update id="updateSR_WRK_FLOW" parameterClass="com.clt.apps.fis.see.bmd.shippingreq.dto.ShippingReqVO">
        UPDATE  tb_wrk_flow
           SET  jb_act_dt_tm= getdate(),
                modi_usrid  = #proc_usrid#,     modi_ofc_cd = #proc_ofccd#,    
                modi_tms    = GETUTCDATE()
         WHERE  intg_bl_seq = #intg_bl_seq# AND jb_sts_cd = #bl_sts_cd#
    </update>

    <!-- MBL 생성시 Work Flow 처리 상태를 업데이트 한다   -->
    <update id="updateMBL_WRK_FLOW" parameterClass="HashMap">
        UPDATE  tb_wrk_flow
           SET  jb_act_dt_tm= getdate(),
                modi_usrid  = #proc_usrid#,     modi_ofc_cd = #proc_ofccd#,    
                modi_tms    = GETUTCDATE()
         WHERE  intg_bl_seq IN (SELECT intg_bl_seq FROM tb_intg_bl_rlt WHERE rlt_intg_bl_seq = #intg_bl_seq#) 
           AND  jb_sts_cd = #bl_sts_cd#
    </update>
    
    <!-- Work Flow List를 조회함   -->
    <select id="selectWRK_FLOW_LIST" resultClass="com.clt.apps.fis.see.bmd.housebl.dto.WrkFlowVO" parameterClass="HashMap">
        SELECT   wrk.jb_sts_cd,
<!--        		,tpls.bl_sts_lbl AS jb_sts_nm,  -->
        		 (SELECT cd_nm 
                    FROM tb_com_cd_dtl b    
                   WHERE b.com_cd =   ( CASE tpls.jb_tmplt_seq WHEN 3 THEN 'C063' ELSE 'C062' END )  
                     and b.cd_val = wrk.jb_sts_cd) AS jb_sts_nm,
                SUBSTRING(convert(VARCHAR(16), wrk.jb_pln_dt_tm, 121), 1,10) AS jb_pln_dt,
		        SUBSTRING(convert(VARCHAR(16), wrk.jb_pln_dt_tm, 121), 11,6) AS jb_pln_tm,
		        SUBSTRING(convert(VARCHAR(16), wrk.jb_act_dt_tm, 121), 1,10) AS jb_act_dt,
		        SUBSTRING(convert(VARCHAR(16), wrk.jb_act_dt_tm, 121), 11,6) AS jb_act_tm,
    <![CDATA[   CASE   WHEN (wrk.jb_act_dt_tm IS NULL) AND (  wrk.jb_pln_dt_tm < getdate())
                       THEN '1'
                       WHEN (wrk.jb_act_dt_tm IS NULL) AND (  wrk.jb_pln_dt_tm >= getdate())    
                       THEN '0'
                       WHEN wrk.jb_pln_dt_tm >= wrk.jb_act_dt_tm 
                       THEN '0'
                       WHEN wrk.jb_pln_dt_tm < wrk.jb_act_dt_tm    ]]> 
                       THEN '1'
                  END AS sts_img,
                   
                 wrk.srt_seq
                ,wrk.modi_usrid
                ,tpls.jb_tmplt_seq
                ,tpls.dur_tm_qty
          FROM  tb_add_info_bnd bnd
          
           JOIN  tb_wrk_flow wrk
           ON   bnd.intg_bl_seq = wrk.intg_bl_seq
           
          LEFT OUTER JOIN  tb_jb_tmplt_list tpls
            ON  tpls.jb_tmplt_seq = bnd.jb_tmplt_seq AND wrk.jb_sts_cd = tpls.bl_sts_cd
            
         WHERE  bnd.intg_bl_seq = #intg_bl_seq#
      ORDER BY  wrk.srt_seq ASC 
    </select>
    
    <!--Container Master에서 정보 조회   -->
    <select id="selectCNTR_CMDT_LIST" parameterClass="HashMap" resultClass="CntrLstVO">
        SELECT cms.cntr_no,         cms.cntr_tpsz_cd,         cms.lr_trdp_cd AS cntr_sprl_trdp_cd,     
               cms.cntr_sts_cd,     cms.lstm_cd AS soc_flg,  cmp.eng_nm AS cntr_sprl_trdp_nm,  
               agm.agmt_dt,         agm.eff_dt
        
         FROM  tb_cntr_mst cms, tb_cntr_agmt agm, tb_trdp cmp
        WHERE  cms.agmt_no = agm.agmt_no 
          AND  cmp.trdp_cd = cms.lr_trdp_cd
        <isEmpty property="rgst_cntr_yn">
          AND  agm.eff_dt >= CONVERT(varchar(8), getdate(), 112)
          AND  cms.cntr_sts_cd = #f_cntr_sts_cd#
        </isEmpty>
        <isNotEmpty property="f_cntr_sprl_trdp_cd">
            AND cms.lr_trdp_cd = #f_cntr_sprl_trdp_cd#
        </isNotEmpty>
        <isNotEmpty property="f_cntr_tpsz_cd">
            AND cms.cntr_tpsz_cd = #f_cntr_tpsz_cd#
        </isNotEmpty>
    </select>
    
    <select id="selectCNTR_CMDT_LIST_CNT" parameterClass="HashMap" resultClass="Integer">
        SELECT count(cms.cntr_no)
         FROM  tb_cntr_mst cms, tb_cntr_agmt agm, tb_trdp cmp
        WHERE  cms.agmt_no = agm.agmt_no 
          AND  cmp.trdp_cd = cms.lr_trdp_cd
        <isEmpty property="rgst_cntr_yn">
          AND  agm.eff_dt >= CONVERT(varchar(8), getdate(), 112)
          AND  cms.cntr_sts_cd = #f_cntr_sts_cd#
        </isEmpty>
        <isNotEmpty property="f_cntr_sprl_trdp_cd">
            AND cms.lr_trdp_cd = #f_cntr_sprl_trdp_cd#
        </isNotEmpty>
        <isNotEmpty property="f_cntr_tpsz_cd">
            AND cms.cntr_tpsz_cd = #f_cntr_tpsz_cd#
        </isNotEmpty>
    </select>
    
<!-- Booking Contaienr 정보   -->
    <!--CONTAINER SUMMARY SEQ생성  -->
    <select id="selectCONSUMPK" resultClass="Integer">
        SELECT  ISNULL(MAX(cntr_smry_seq),0)+1
          FROM  tb_cntr_smry
    </select>

    <!-- CONTAINER SUMMARY 등록  -->
    <insert id="insertCNTR_SMRY" parameterClass="BkgCntrInfoVO">
        INSERT INTO tb_cntr_smry(
                    intg_bl_seq,        cntr_smry_seq,      cntr_tpsz_cd,          cntr_qty,
                    rgst_usrid,         rgst_ofc_cd,        rgst_tms,          
                    modi_usrid,         modi_ofc_cd,        modi_tms,              delt_flg
                    
            )VALUES(
                    #intg_bl_seq#,      #cntr_smry_seq#,    #smry_cntr_tpsz_cd#,   #smry_cntr_qty#,
                    #proc_usrid#,       #proc_ofccd#,       getdate(),
                    #proc_usrid#,       #proc_ofccd#,       GETUTCDATE(),         'N'
            )    
    </insert>
    
    <!-- CONTAINER SUMMARY 수정  -->
    <update id="updateCNTR_SMRY" parameterClass="BkgCntrInfoVO">
        UPDATE tb_cntr_smry
               cntr_tpsz_cd = #smry_cntr_tpsz_cd#,     cntr_qty    = #smry_cntr_qty#,        
               modi_usrid   = #proc_usrid#,            modi_ofc_cd = #proc_ofccd#,        modi_tms = GETUTCDATE()
        WHERE  intg_bl_seq  = #intg_bl_seq# 
          AND  cntr_smry_seq= #cntr_smry_seq#           
    </update>

    <!-- CONTAINER SUMMARY 삭제  -->
    <delete id="deleteCNTR_SMRY" parameterClass="BkgCntrInfoVO">
        DELETE tb_cntr_smry
        WHERE  intg_bl_seq  = #intg_bl_seq# 
          AND  cntr_smry_seq= #cntr_smry_seq#           
    </delete>   
    
    
    <!-- Conainer Summary리를 조호회함   -->
    <select id="selectCNTR_SMRY" parameterClass="HashMap" resultClass="BkgCntrInfoVO">
        SELECT  intg_bl_seq,        cntr_smry_seq,      cntr_tpsz_cd AS smry_cntr_tpsz_cd,          
                cntr_qty AS smry_cntr_qty
          FROM  tb_cntr_smry
         WHERE  intg_bl_seq = #intg_bl_seq# AND delt_flg = 'N' 
      ORDER BY  cntr_smry_seq ASC
    </select>
    
<!-- Container List 정보   -->
    <!--CONTAINER LIST SEQ생성  -->
    <select id="selectCNTR_LIST_PK" resultClass="Integer">
        SELECT ISNULL(MAX(cntr_list_seq),0)+1
          FROM tb_cntr_list
    </select>
    
    <!--Container목록에 저장  -->
    <!-- #20417 : [BINEX] MLB/IPI 건들 Pickup and LFD 추가 - jsjang 2013.9.6 -->
    <insert id="insertCNTR_LIST" parameterClass="CntrLstVO">
        INSERT INTO tb_cntr_list(
            intg_bl_seq,        cntr_list_seq,       rgst_cntr_yn,
            cntr_no,            cntr_tpsz_cd,
            cgo_pck_qty,        cgo_pck_ut,          cgo_wgt,           cgo_meas,         vol_meas,
            soc_flg,            dg_gds_flg,          cntr_rmk,
            seal_no1,           seal_no2,            seal_no3, 
            cntr_sprl_trdp_cd,
            rgst_usrid,         rgst_ofc_cd,         rgst_tms,
            modi_usrid,         modi_ofc_cd,         modi_tms,          delt_flg,
            cgo_wgt1, cgo_meas1
            ,pickup_number, lfd, cntr_go_date, temp_cd, vent_cd, cfs_in_dt, devan_dt
            ,org_pkup_dt 			,fnl_dest_eta_dt 	,apnt_dt 			,de_dt 			,free_det_dt , emty_rt_dt
            <isNotEmpty property="temp_val">
            ,temp_val
            </isNotEmpty>
        )VALUES(
            #intg_bl_seq#,       #cntr_list_seq#,    #rgst_cntr_yn#, 
            #cntr_no#,           #cntr_tpsz_cd#, 
            #cgo_pck_qty#,       #cgo_pck_ut#,       #cgo_wgt#,          #cgo_meas#,        #vol_meas#, 
            #soc_flg#,           #dg_gds_flg#,       #cntr_rmk#, 
            #seal_no1#,          #seal_no2#,         #seal_no3#, 
            #cntr_sprl_trdp_cd#, 
            #proc_usrid#,        #proc_ofccd#,       getdate(),
            #proc_usrid#,        #proc_ofccd#,       GETUTCDATE(),         'N',
            #cgo_wgt1#, #cgo_meas1#
            ,#pickup_number#, #lfd#, #cntr_go_date#, #temp_cd#, #vent_cd#, #cfs_in_dt#, #devan_dt#
            ,#org_pkup_dt# 		,#fnl_dest_eta_dt# 	,#apnt_dt# 		,#de_dt# 		,#free_det_dt# , #emty_rt_dt#
            <isNotEmpty property="temp_val">
            , #temp_val#
            </isNotEmpty>
        )
    </insert>
    
    <!-- 컨테이너 등록 삭제시 Equipment의 상태 정보를 수정한다.  -->
    <update id="updateCNTR_MST_STS" parameterClass="CntrLstVO">
       UPDATE  tb_cntr_mst
          SET  cntr_sts_cd  = #rgst_cntr_yn#
        WHERE  cntr_no = #cntr_no#
    </update>
    
    <!-- Container목록 수정  -->
    <!-- #20417 : [BINEX] MLB/IPI 건들 Pickup and LFD 추가 - jsjang 2013.9.6  -->
    <update id="updateCNTR_LIST" parameterClass="CntrLstVO">
        UPDATE  tb_cntr_list
           SET  cntr_no    = #cntr_no#,       cntr_tpsz_cd= #cntr_tpsz_cd#,
                cgo_pck_qty= #cgo_pck_qty#,   cgo_pck_ut  = #cgo_pck_ut#,          
                cgo_wgt    = #cgo_wgt#,       cgo_meas    = #cgo_meas#,       vol_meas = #vol_meas#,
                soc_flg    = #soc_flg#,       dg_gds_flg  = #dg_gds_flg#,     cntr_rmk = #cntr_rmk#,
                seal_no1   = #seal_no1#,      seal_no2    = #seal_no2#,       seal_no3 = #seal_no3#,
                cntr_sprl_trdp_cd = #cntr_sprl_trdp_cd#,
                modi_usrid = #proc_usrid#,    modi_ofc_cd = #proc_ofccd#,     modi_tms = GETUTCDATE(),
                cgo_wgt1 = #cgo_wgt1#, cgo_meas1 = #cgo_meas1#
                ,pickup_number = #pickup_number#, lfd = #lfd#, cntr_go_date = #cntr_go_date#, emty_rt_dt = #emty_rt_dt#
                ,cfs_in_dt = #cfs_in_dt#, devan_dt = #devan_dt#
                ,org_pkup_dt = #org_pkup_dt#
                ,fnl_dest_eta_dt = #fnl_dest_eta_dt#
                ,apnt_dt = #apnt_dt#
                ,de_dt = #de_dt#
                ,free_det_dt = #free_det_dt#
                <isNotEmpty property="temp_cd">
				, temp_cd = #temp_cd#
        		</isNotEmpty>
				, vent_cd = #vent_cd#
        		<isNotEmpty property="temp_val">
        		, temp_val = #temp_val#
        		</isNotEmpty>
         WHERE  intg_bl_seq = #intg_bl_seq# AND   cntr_list_seq = #cntr_list_seq#
    </update>
    
    <!-- #26042 : [BINEX] HBL수정전 cont_no취득 - SYLEE 2014.4.15  -->
    <select id="selectCNTR_NO" parameterClass="HashMap" resultClass="String">
        SELECT  cntr_no
		  FROM  tb_cntr_list
		 WHERE  intg_bl_seq = #intg_bl_seq#
		   AND  cntr_list_seq = #cntr_list_seq#
    </select>
    <!-- #26042 : [BINEX] MBL에서 등록한 컨테이너NO가 HBL에 존재하면 컨테이너NO 취득 cont_no취득 - SYLEE 2014.4.15  -->
    <select id="selectCNTR_NO_HBL" parameterClass="HashMap" resultClass="String">
        SELECT  DISTINCT(cntr_no)
		  FROM  tb_cntr_list
		 WHERE  cntr_no = #cntr_no#
    </select>
	<!-- #26042 : [BINEX] MLB수정에 따른 HBL 수정 - SYLEE 2014.4.15  -->
    <update id="updateCNTR_LIST_HBL" parameterClass="HashMap">
        UPDATE  tb_cntr_list
           SET  cntr_no    = #cntr_no#,       
           		cntr_tpsz_cd= #cntr_tpsz_cd#,
                seal_no1   = #seal_no1#,      
                seal_no2    = #seal_no2#,  
                pickup_number = #pickup_number#
         WHERE  cntr_no = #pre_cntr_no#
         		and intg_bl_seq IN
						(SELECT intg_bl_seq 
						   FROM tb_intg_bl_rlt 
						  WHERE rlt_intg_bl_seq = #intg_bl_seq#)
<!--          WHERE  cntr_list_seq IN (
		  			SELECT cntr_list_seq 
					FROM tb_cntr_list
					WHERE intg_bl_seq IN
						(SELECT intg_bl_seq 
						   FROM tb_intg_bl_rlt 
						  WHERE rlt_intg_bl_seq = #intg_bl_seq#)
					AND cntr_no = #pre_cntr_no#
			     ) -->
    </update>
    <!-- Hbl 의 Container No 수정  -->
    <update id="updateHblCntrNo" parameterClass="CntrLstVO">
        UPDATE  tb_cntr_list
           SET  cntr_no    = #cntr_no#,
                modi_usrid = #proc_usrid#,    modi_ofc_cd = #proc_ofccd#,     modi_tms = GETUTCDATE()
         WHERE  cntr_no = (SELECT cntr_no 
         					 FROM tb_cntr_list 
         				    WHERE intg_bl_seq = #intg_bl_seq# 
         				      AND cntr_list_seq = #cntr_list_seq#)
	       AND  intg_bl_seq in (SELECT intg_bl_seq 
	                              FROM tb_intg_bl_rlt 
	                             WHERE rlt_intg_bl_seq = #intg_bl_seq#)
    </update>
    
    <!-- Container목록 삭제  -->
    <update id="deleteCNTR_LIST" parameterClass="CntrLstVO">
        DELETE  tb_cntr_list
         WHERE  intg_bl_seq = #intg_bl_seq#   AND  cntr_list_seq = #cntr_list_seq#
    </update>   
    
    <!-- Container 목록 조회  -->
    <select id="selectCNTR_LIST" parameterClass="HashMap" resultClass="CntrLstVO">
        SELECT  lst.intg_bl_seq,        lst.cntr_list_seq,       lst.rgst_cntr_yn,
                lst.cntr_no,            lst.cntr_tpsz_cd,
                lst.cgo_pck_qty,        lst.cgo_pck_ut,          lst.cgo_wgt,           lst.cgo_meas,         lst.vol_meas,
                lst.soc_flg,            lst.dg_gds_flg,          lst.cntr_rmk,
                lst.seal_no1,           lst.seal_no2,            lst.seal_no3, 
                lst.cntr_sprl_trdp_cd,  prn.eng_nm AS cntr_sprl_trdp_nm,
                lst.cgo_wgt1, lst.cgo_meas1
                , lst.pickup_number, CONVERT(VARCHAR, ISNULL(lst.lfd, ''), 120) AS lfd ,CONVERT(VARCHAR, ISNULL(lst.cntr_go_date, ''), 120) AS cntr_go_date
                , lst.temp_cd, lst.vent_cd ,lst.temp_val 
                , lst.emty_rt_dt
          FROM  tb_cntr_list lst
LEFT OUTER JOIN tb_trdp prn
            ON  lst.cntr_sprl_trdp_cd = prn.trdp_cd  AND prn.delt_flg = 'N'
        
         WHERE  lst.intg_bl_seq = #intg_bl_seq#      AND lst.delt_flg = 'N' 
      ORDER BY  lst.cntr_list_seq ASC
    </select>

    <!-- BKG Container 목록 조회  -->
    <select id="selectBKGCNTR_LIST" parameterClass="HashMap" resultClass="CntrLstVO">
        select cntr_tpsz_cd , qty as cgo_pck_qty from TB_BKG_CNTR 
		where BKG_SEQ = #bkg_seq# 
		and DELT_FLG = 'N'  
		order by CNTR_SEQ 
    </select>

    <!-- MBL에 연결된 Container List를 조회함   -->
    <!-- #20417 : [BINEX] MLB/IPI 건들 Pickup and LFD 추가 - jsjang 2013.9.6 -->
    <select id="selectMBL_CNTR_LIST" parameterClass="HashMap" resultClass="CntrLstVO">
        <!-- 
        SELECT  lst.intg_bl_seq,        lst.cntr_list_seq,       lst.rgst_cntr_yn,
                lst.cntr_no,            lst.cntr_tpsz_cd,
                lst.cgo_pck_qty,        lst.cgo_pck_ut,          lst.cgo_wgt,           lst.cgo_meas,         lst.vol_meas,
                cdt.cd_nm AS soc_flg,
                lst.dg_gds_flg,         lst.cntr_rmk,
                lst.seal_no1,           lst.seal_no2,            lst.seal_no3, 
                lst.cntr_sprl_trdp_cd,  prn.eng_nm AS cntr_sprl_trdp_nm,
                hbl.bl_no
          
          FROM  tb_intg_bl_rlt rlt
          JOIN  tb_intg_bl   hbl
            ON  rlt.intg_bl_seq = hbl.intg_bl_seq
            
          JOIN  tb_cntr_list lst
           ON   hbl.intg_bl_seq = lst.intg_bl_seq
        
          JOIN  tb_com_cd_dtl cdt
           ON   lst.soc_flg = cdt.cd_val AND cdt.com_cd = 'C058' AND cdt.delt_flg = 'N'
        
LEFT OUTER JOIN tb_trdp prn
            ON  lst.cntr_sprl_trdp_cd= prn.trdp_cd        AND prn.delt_flg = 'N'
        
         WHERE   rlt.rlt_intg_bl_seq = #intg_bl_seq#      AND lst.delt_flg = 'N' 
      ORDER BY  lst.intg_bl_seq ASC, lst.cntr_list_seq ASC
		  -->
		SELECT  lst.intg_bl_seq,        lst.cntr_list_seq,       lst.rgst_cntr_yn,
                lst.cntr_no,            lst.cntr_tpsz_cd,		 lst.temp_cd,           lst.vent_cd,
                lst.cgo_pck_qty,        lst.cgo_pck_ut,          lst.cgo_wgt,           lst.cgo_meas,         lst.vol_meas,
                cdt.cd_nm AS soc_flg,
                lst.dg_gds_flg,         lst.cntr_rmk,
                lst.seal_no1,           lst.seal_no2,            lst.seal_no3, 
                lst.cntr_sprl_trdp_cd,  prn.eng_nm AS cntr_sprl_trdp_nm,
          		lst.cgo_wgt1, 			lst.cgo_meas1
          		
          		, lst.pickup_number
          		,CONVERT(VARCHAR, ISNULL(lst.lfd, ''), 120) AS lfd
          		,CONVERT(VARCHAR, ISNULL(lst.cntr_go_date, ''), 120) AS cntr_go_date
                ,CONVERT(VARCHAR, ISNULL(lst.cfs_in_dt, ''), 120) AS cfs_in_dt
                ,CONVERT(VARCHAR, ISNULL(lst.devan_dt, ''), 120) AS devan_dt
          		,CONVERT(VARCHAR, ISNULL(lst.org_pkup_dt, ''), 120) AS org_pkup_dt
                ,CONVERT(VARCHAR, ISNULL(lst.fnl_dest_eta_dt, ''), 120) AS fnl_dest_eta_dt
                ,CONVERT(VARCHAR, ISNULL(lst.apnt_dt, ''), 120) AS apnt_dt
                ,CONVERT(VARCHAR, ISNULL(lst.de_dt, ''), 120) AS de_dt
                ,CONVERT(VARCHAR, ISNULL(lst.free_det_dt, ''), 120) AS free_det_dt
          		, lst.temp_cd, lst.vent_cd ,lst.temp_val
          		, lst.emty_rt_dt
          FROM  tb_intg_bl bl

          JOIN  tb_cntr_list lst
           ON   bl.intg_bl_seq = lst.intg_bl_seq
        
LEFT OUTER JOIN  tb_com_cd_dtl cdt
           ON   lst.soc_flg = cdt.cd_val AND cdt.com_cd = 'C058' AND cdt.delt_flg = 'N'
        
LEFT OUTER JOIN tb_trdp prn
            ON  lst.cntr_sprl_trdp_cd= prn.trdp_cd AND prn.delt_flg = 'N'
        
         WHERE  bl.intg_bl_seq = #intg_bl_seq#
		   AND  lst.delt_flg = 'N' 
      ORDER BY  lst.intg_bl_seq ASC, lst.cntr_list_seq ASC
      
    </select>
    
<!--등록된 파일목록을 조회함   -->
    <select id="selectPALT_SHP_DOC_LIST" parameterClass="java.util.HashMap" resultClass="com.clt.apps.fis.see.bmd.shippingdoc.dto.PaltShpDocVO">
        SELECT  palt_doc_seq,         intg_bl_seq,          palt_trdp_cd,     
                palt_trdp_pic_nm,     palt_trdp_pic_fax,    palt_trdp_pic_phn,    
                palt_doc_tp_cd,       
                (SELECT CD_NM FROM TB_COM_CD_DTL WHERE COM_CD = 'C027' AND CD_VAL = palt_doc_tp_cd) AS palt_doc_tp_nm,
                palt_doc_nm,          palt_doc_no,      
                palt_doc_img_url,     palt_doc_img_nm,
                palt_doc_pdf_url,     palt_doc_pdf_nm,  
                palt_doc_msg,         palt_doc_rmk,			isnull(palt_ext_flg, 'N') AS palt_ext_flg,
                rgst_usrid,           rgst_ofc_cd,          CONVERT(VARCHAR(8), rgst_tms, 112) AS rgst_tms
          FROM  tb_palt_shp_doc
         WHERE  intg_bl_seq  = #intg_bl_seq#  <!-- AND palt_doc_tp_cd = 'CL'   -->
    </select>
    
    
    <delete id="deletePALT_SHP_DOC" parameterClass="com.clt.apps.fis.see.bmd.shippingdoc.dto.PaltShpDocVO">
        DELETE  tb_palt_shp_doc
         WHERE  intg_bl_seq  = #intg_bl_seq# AND palt_doc_seq =#palt_doc_seq#
    </delete>
    
<!-- ITEM 등록  -->
    <!--CONTAINER SEAL NUMBER SEQ생성  -->
    <select id="selectSHP_CMDT_PK" resultClass="Integer">
        SELECT ISNULL(MAX(shp_cmdt_seq),0)+1
        FROM   tb_shp_cmdt
    </select>

    <!-- Item등록  -->
    <insert id="insertSHP_CMDT" parameterClass="ItmLstVO">
        INSERT INTO tb_shp_cmdt(
            shp_cmdt_seq,       intg_bl_seq,     cntr_list_seq,
            shp_cmdt_cd,        shp_cmdt_nm,
		
		    pck_qty,            pck_ut_cd,        
            wgt,                meas,            rmk,
		    dg_cd_tp,           dg_cd,  
		        
            rgst_usrid,         rgst_ofc_cd,     rgst_tms,
            modi_usrid,         modi_ofc_cd,     modi_tms,    delt_flg,
            
            hs_grp_cd,		 	cmdt_cd,		 po_cmdt_seq,		        
            po_sys_no,		 	pck_inr_qty,	 ea_cnt,		        
            ttl_qty,		 	lbs_wgt,		 cft_meas            
        )VALUES(
           #item_shp_cmdt_seq#, #intg_bl_seq#,      #item_cntr_list_seq#,
           #item_shp_cmdt_cd#,  #item_shp_cmdt_nm#,
		 
		   #item_pck_qty#,      #item_pck_ut_cd#,
           #item_wgt#,          #item_meas#,        #item_rmk#,
		   #item_dg_cd_tp#,     #item_dg_cd#,
		
           #proc_usrid#,        #proc_ofccd#,       getdate(),
           #proc_usrid#,        #proc_ofccd#,       GETUTCDATE(),    'N',
           
           #item_hs_grp_cd#,	#item_cmdt_cd#,		#item_po_cmdt_seq#,		        
           #item_po_sys_no#,	#item_pck_inr_qty#,	#item_ea_cnt#,		        
           #item_ttl_qty#,		#item_lbs_wgt#,		#item_cft_meas#      
        )    
    </insert>
    
    <!-- Item수정  -->
    <update id="updateSHP_CMDT" parameterClass="ItmLstVO">
        UPDATE  tb_shp_cmdt
           SET  shp_cmdt_cd = #item_shp_cmdt_cd#,   shp_cmdt_nm= #item_shp_cmdt_nm#,
                pck_qty     = #item_pck_qty#,       pck_ut_cd  = #item_pck_ut_cd#,        
                wgt         = #item_wgt#,           meas       = #item_meas#,       rmk     = #item_rmk#,
		        dg_cd_tp    = #item_dg_cd_tp#,      dg_cd      = #item_dg_cd#,
		
                modi_usrid  = #proc_usrid#,         modi_ofc_cd= #proc_ofccd#,      modi_tms= GETUTCDATE(),
                
                hs_grp_cd 		= #item_hs_grp_cd#,
                cmdt_cd 		= #item_cmdt_cd#,
                po_cmdt_seq 	= #item_po_cmdt_seq#,
                po_sys_no 		= #item_po_sys_no#,
                pck_inr_qty 	= #item_pck_inr_qty#,
                ea_cnt 			= #item_ea_cnt#,
                ttl_qty 		= #item_ttl_qty#,
                lbs_wgt 		= #item_lbs_wgt#,
                cft_meas 		= #item_cft_meas#
                       
         WHERE  intg_bl_seq  = #intg_bl_seq#  
           AND  shp_cmdt_seq = #item_shp_cmdt_seq#   
        <isNotEmpty property="item_cntr_list_seq">
		   AND  cntr_list_seq = #item_cntr_list_seq# 
        </isNotEmpty>
    </update>
    
    <!-- Item 삭제   -->
    <delete id="deleteSHP_CMDT" parameterClass="ItmLstVO">
        DELETE  tb_shp_cmdt
         WHERE  intg_bl_seq  = #intg_bl_seq# 
           AND  shp_cmdt_seq = #item_shp_cmdt_seq# 
    	<isNotEmpty property="item_cntr_list_seq">
		   AND  cntr_list_seq = #item_cntr_list_seq# 
        </isNotEmpty>  
    </delete>
    
    <!--Container Number 코드 생성위해   -->
    <select id="selectCNTR_NO_LIST" parameterClass="HashMap" resultClass="com.clt.apps.opusbase.system.systemcode.dto.ComCdDtlVO">
        SELECT  cntr_no AS  cd_val , cntr_no AS cd_nm
          FROM  tb_cntr_list
         WHERE  intg_bl_seq  = #f_intg_bl_seq#
      ORDER BY  cntr_list_seq ASC
    </select>
    
    <!-- Item목록 조회   -->
    <select id="selectSHP_CMDT_LIST" parameterClass="HashMap" resultClass="ItmLstVO">
	        SELECT  cdt.intg_bl_seq,       cdt.cntr_list_seq AS item_cntr_list_seq,   cdt.shp_cmdt_seq AS item_shp_cmdt_seq,       
	                cdt.wgt AS item_wgt,   cdt.meas AS item_meas,    cdt.rmk          AS item_rmk,       
	                cdt.pck_qty     AS item_pck_qty,                 cdt.pck_ut_cd    AS item_pck_ut_cd,
			        cdt.dg_cd_tp    AS item_dg_cd_tp,                cdt.dg_cd  AS item_dg_cd,
			
	                cdt.shp_cmdt_cd AS item_shp_cmdt_cd,
	                cdt.shp_cmdt_nm AS item_shp_cmdt_nm,             pcd.pck_nm  AS item_pck_nm,
			           
	                ctl.cntr_no     AS item_cntr_no,
	                
	                cdt.hs_grp_cd		AS item_hs_grp_cd,
	                cdt.cmdt_cd     	AS item_cmdt_cd,
	                itm.item_nm 		as item_cmdt_nm,
	                cdt.po_cmdt_seq     AS item_po_cmdt_seq,
					cdt.po_sys_no     	AS item_po_sys_no,
					po.cust_po_no		AS item_cust_po_no,
					cdt.pck_inr_qty     AS item_pck_inr_qty,
					cdt.ea_cnt     		AS item_ea_cnt,					
					cdt.ttl_qty     	AS item_ttl_qty,					
					cdt.lbs_wgt     	AS item_lbs_wgt,					
					cdt.cft_meas     	AS item_cft_meas
	          FROM  tb_shp_cmdt cdt
	          LEFT OUTER JOIN  tb_cntr_list ctl ON cdt.cntr_list_seq = ctl.cntr_list_seq AND cdt.INTG_BL_SEQ = ctl.INTG_BL_SEQ
	          LEFT OUTER JOIN tb_pck_ut_cd pcd ON cdt.pck_ut_cd = pcd.pck_ut_cd
	          LEFT OUTER JOIN tb_po po ON cdt.po_sys_no = po.po_sys_no AND po.delt_flg = 'N'
	          LEFT OUTER JOIN tb_po_cmdt po_cmdt ON po.po_sys_no = po_cmdt.po_sys_no AND po_cmdt.delt_flg = 'N'
	          LEFT OUTER JOIN tl_ctrt_cust_item itm ON po_cmdt.ctrt_no = itm.ctrt_no AND po_cmdt.item_sys_no = itm.item_sys_no AND po_cmdt.cust_itm_id = itm.item_cd AND itm.item_use_flg = 'Y'
	         WHERE  cdt.intg_bl_seq = #intg_bl_seq# AND cdt.delt_flg = 'N'                  
	      ORDER BY  cdt.shp_cmdt_seq  ASC
    </select>
    
    
    <!-- PICKUP/WORKORDER 조회   -->
    <select id="selectWO_LIST" resultClass="com.clt.apps.fis.see.bmd.workorder.dto.WoOrdVO" parameterClass="HashMap">
    <!--BlCmmSQL> selectWO_LIST   -->
        SELECT wo.wo_no,
               wo.wo_sts_cd,
               wo.pickup_trdp_nm,
               wo.delivery_trdp_nm,
               wo.return_trdp_nm,
               wo.trucker_trdp_nm,
               wo.act_wgt_k
         FROM  tb_pd_ord wo
        WHERE  wo.intg_bl_seq = #intg_bl_seq#
          AND wo.delt_flg = 'N'
    </select>
    
<!--수출신고 번호   -->
    
    <!--CONTAINER SEAL NUMBER SEQ생성  -->
    <select id="selectEDI_INFO_PK" parameterClass="String" resultClass="Integer">
        SELECT  ISNULL(MAX(edi_xpt_seq),0)+1
          FROM  tb_edi_info
		 WHERE  intg_bl_seq = #value#
    </select>

    <!-- 수출신고 번호 등록   -->
    <insert id="insertEDI_INFO" parameterClass="com.clt.apps.fis.see.bmd.housebl.dto.EdiXptInfoVO">
        INSERT INTO tb_edi_info(
            intg_bl_seq,   edi_xpt_seq,    mbl_no,           xpt_no,     edi_snd_sts_cd,
            pck_qty,       pck_ut_cd,      edi_grs_wt,       sprt_flg,   
        <isNotEmpty property="sprt_seq">
            sprt_seq,
        </isNotEmpty>
            sam_pck_tp,    sam_pck_qty,    sam_pck_ut_cd,
        
            rgst_usrid,    rgst_ofc_cd,    rgst_tms,
            modi_usrid,    modi_ofc_cd,    modi_tms,         delt_flg
        )VALUES(
           #intg_bl_seq#,  #edi_xpt_seq#,  #mbl_no#,         #xpt_no#,     'CT',
           #edi_pck_qty#,  #edi_pck_ut_cd#,#edi_grs_wt#,     #sprt_flg#,   
        
        <isNotEmpty property="sprt_seq">
            #sprt_seq#,
        </isNotEmpty>
           #sam_pck_tp#,   #sam_pck_qty#,  #sam_pck_ut_cd#,
        
           #proc_usrid#,   #proc_ofccd#,   getdate(),
           #proc_usrid#,   #proc_ofccd#,   GETUTCDATE(),        'N'        
        )
    </insert>
    
    <!-- 수출신고 번호 수정   -->
    <update id="updateEDI_INFO" parameterClass="com.clt.apps.fis.see.bmd.housebl.dto.EdiXptInfoVO">
        UPDATE  tb_edi_info
           SET  mbl_no     = #mbl_no#,        xpt_no     = #xpt_no#,          edi_snd_sts_cd= #edi_snd_sts_cd#,
                pck_qty    = #edi_pck_qty#,   pck_ut_cd  = #edi_pck_ut_cd#,   edi_grs_wt    = #edi_grs_wt#,
                sprt_flg   = #sprt_flg#,      
        <isNotEmpty property="sprt_seq">
                sprt_seq   = #sprt_seq#,
        </isNotEmpty>
        <isEmpty property="sprt_seq">
                sprt_seq   = NULL,
        </isEmpty>
                sam_pck_tp = #sam_pck_tp#,    sam_pck_qty= #sam_pck_qty#,     sam_pck_ut_cd = #sam_pck_ut_cd#,
                modi_usrid = #proc_usrid#,    modi_ofc_cd= #proc_ofccd#,      modi_tms      = GETUTCDATE()
         WHERE  intg_bl_seq= #intg_bl_seq#  AND  edi_xpt_seq = #edi_xpt_seq#        
    </update>
    
    <!-- 수출신고 번호 삭제   -->
    <delete id="deleteEDI_INFO" parameterClass="com.clt.apps.fis.see.bmd.housebl.dto.EdiXptInfoVO">
        DELETE  tb_edi_info
         WHERE  intg_bl_seq= #intg_bl_seq#  AND  edi_xpt_seq = #edi_xpt_seq#        
    </delete>
    
    <!-- 수출신고 번호 조회   -->
    <select id="selectEDI_INFO" parameterClass="HashMap" resultClass="com.clt.apps.fis.see.bmd.housebl.dto.EdiXptInfoVO">
        SELECT xpt.intg_bl_seq,   xpt.edi_xpt_seq,    xpt.mbl_no,           xpt.xpt_no,     xpt.edi_snd_sts_cd,
               xpt.edi_grs_wt,    xpt.sprt_flg,       xpt.sprt_seq,         cdt.cd_nm AS edi_snd_sts_nm,
               xpt.sam_pck_tp,    xpt.sam_pck_qty,    xpt.sam_pck_ut_cd,
               xpt.pck_qty AS edi_pck_qty,            
               xpt.pck_ut_cd AS edi_pck_ut_cd,        utc.pck_nm AS edi_pck_ut_nm
         FROM  tb_edi_info xpt
        
LEFT OUTER JOIN tb_pck_ut_cd  utc
           ON  xpt.pck_ut_cd = utc.pck_ut_cd AND utc.delt_flg = 'N'
        
LEFT OUTER JOIN tb_com_cd_dtl cdt
           ON  xpt.edi_snd_sts_cd = cdt.cd_val AND cdt.com_cd = 'C061'
        
        WHERE  xpt.intg_bl_seq = #intg_bl_seq#  
          AND  xpt.delt_flg    = 'N'
     ORDER BY  xpt.edi_xpt_seq ASC
    </select>
    
    
<!-- 거래처 사업자 정보 조회  -->
    <select id="selectCmpInfo" parameterClass="HashMap" resultClass="com.clt.apps.fis.mdm.mcm.partner.dto.TrdpVO">  
        SELECT  trdp_cd, eng_nm, biz_no 
          FROM  tb_trdp
         WHERE  trdp_cd = #trdp_cd# AND delt_flg = 'N'
    </select>
    
    <!-- 담당자정보를 조회한다.   -->
    <select id="selectBlUserList" parameterClass="HashMap" resultClass="com.clt.apps.fis.sal.tpm.tradepartner.dto.TrdpCntcPsonVO">
        SELECT  ps.cntc_pson_seq,    ps.pic_nm,         ps.trd_div_nm,    
                ps.pic_phn,          ps.pic_fax,        ps.pic_eml,        ps.pic_desc, 
                CASE WHEN pnr.trdp_pic_usr_id = ps.cntc_pson_seq THEN 'Y'
                     ELSE 'N'
                END  AS rep_flg
          FROM  tb_trdp_cntc_pson ps
          JOIN  tb_bl_prnr pnr
            ON  ps.trdp_cd  = pnr.trdp_cd
         WHERE  ps.delt_flg = 'N'
           AND  pnr.trdp_cd = #trdp_cd#
           AND  pnr.intg_bl_seq= #intg_bl_seq#
		   AND  bl_trdp_tp_cd  = #trdp_tp#
           AND  pnr.DELT_FLG   = 'N'
      ORDER BY  ps.cntc_pson_seq ASC
    </select>
    
    <!-- 거래처 담당자 정보를 수정함   -->
    <update id="updateBlPicInfo" parameterClass="HashMap">
        UPDATE tb_bl_prnr
           SET trdp_pic_usr_id = #trdp_pic_usr_id#
         WHERE intg_bl_seq     = #intg_bl_seq# 
           AND trdp_cd = #trdp_cd# 
    </update>
    
    <!--통합 BL테이블 복사   -->
    <insert id="insertMBL_INTG_BL_COPY" parameterClass="HashMap">
        INSERT  tb_intg_bl(
                intg_bl_seq,        bkg_no,             hbl_tp_cd,          po_no,
                bl_sts_cd,          bkg_seq,            sr_no,              sr_seq,                 sr_cre_dt,
                biz_clss_cd,        air_sea_clss_cd,    shp_tp_cd,
                lnr_bkg_no,         shp_mod_cd,         inco_cd,            bkg_dt_tm,              bl_iss_dt,
                frt_term_cd,        rep_cmdt_cd,        rep_cmdt_nm,        pck_qty,                pck_ut_cd,
                grs_wgt,            grs_wgt_ut_cd,      act_wgt,            act_wgt_ut_cd,          meas,          meas_ut_cd,         
                fm_svc_term_cd,     to_svc_term_cd,     srd_flg, 
             
                por_cd,             			        por_nm,             pol_cd,                 pol_nod_cd,    pol_nm,                 
                pod_cd,             pod_nod_cd,         pod_nm,             del_cd,                 del_nm,
                iss_loc_cd,         iss_loc_nm,         pay_loc_cd,         pay_loc_nm,
        
                fnl_dest_loc_cd,    fnl_dest_loc_nm,    cgo_rcv_dt_tm,          cfs_loc_cd,
                cfs_nod_cd,         de_due_dt,          
                pre_vsl_cd,         pre_vsl_nm,         pre_voy,            trnk_vsl_cd,            trnk_vsl_nm,    trnk_voy,           
                cgo_clz_dt_tm,      obrd_dt_tm,         etd_dt_tm,          eta_dt_tm,
                lnr_rmk,            mk_txt,             desc_txt,           rmk,                    say_txt,        sad_txt,              mm_txt,
                act_shp_info,
        
                rgst_usrid,         rgst_ofc_cd,        rgst_tms,
                modi_usrid,         modi_ofc_cd,        dept_cd,              modi_usr_nm,          modi_tms,       delt_flg
                
        )  SELECT   #intg_bl_seq#,      #bkg_no#,           hbl_tp_cd,        po_no,
                    #bl_sts_cd#,        #bkg_seq#,          #sr_no#,          #sr_seq#,             getdate(),
                    biz_clss_cd,        air_sea_clss_cd,    shp_tp_cd,
                    lnr_bkg_no,         shp_mod_cd,         inco_cd,          bkg_dt_tm,            bl_iss_dt,
                    frt_term_cd,        rep_cmdt_cd,        rep_cmdt_nm,      pck_qty,              pck_ut_cd,
                    grs_wgt,            grs_wgt_ut_cd,      act_wgt,          act_wgt_ut_cd,        meas,          meas_ut_cd,         
                    fm_svc_term_cd,     to_svc_term_cd,     srd_flg, 
                 
                    por_cd,             					por_nm,           pol_cd,               pol_nod_cd,    pol_nm,                 
                    pod_cd,             pod_nod_cd,         pod_nm,           del_cd,               del_nm,
                    iss_loc_cd,         iss_loc_nm,         pay_loc_cd,       pay_loc_nm,
            
                    fnl_dest_loc_cd,    fnl_dest_loc_nm,  cgo_rcv_dt_tm,        cfs_loc_cd,
                    cfs_nod_cd,         de_due_dt,          
                    pre_vsl_cd,         pre_vsl_nm,         pre_voy,          trnk_vsl_cd,          trnk_vsl_nm,    trnk_voy,           
                    cgo_clz_dt_tm,      obrd_dt_tm,         etd_dt_tm,        eta_dt_tm,
                    lnr_rmk,            mk_txt,             desc_txt,         rmk,                  say_txt,        sad_txt,              mm_txt,
                    act_shp_info,
            
                    #proc_usrid#,      #proc_ofccd#,        getdate(),
                    #proc_usrid#,      #proc_ofccd#,        #proc_dept_cd#,   #proc_usrnm#,         GETUTCDATE(),      delt_flg
             FROM   tb_intg_bl
            WHERE   intg_bl_seq = #org_intg_bl_seq# AND delt_flg = 'N'
    </insert>
    
    <!--통합 BL테이블 복사   -->
    <insert id="insertINTG_BL_COPY" parameterClass="HashMap">
        INSERT  tb_intg_bl(
                intg_bl_seq,        bl_sts_cd,          sr_no,        
                bkg_no,             bkg_seq,            bl_no,              hbl_seq,                hbl_cre_dt,
                hbl_tp_cd,          po_no,
                biz_clss_cd,        air_sea_clss_cd,    shp_tp_cd,
                lnr_bkg_no,         shp_mod_cd,         inco_cd,            bkg_dt_tm,              bl_iss_dt,
                frt_term_cd,        rep_cmdt_cd,        rep_cmdt_nm,        pck_qty,                pck_ut_cd,
                grs_wgt,            grs_wgt_ut_cd,      act_wgt,            act_wgt_ut_cd,          meas,          meas_ut_cd,         
                fm_svc_term_cd,     to_svc_term_cd,     srd_flg, 
             
                por_cd,             					por_nm,             pol_cd,                 pol_nod_cd,    pol_nm,                 
                pod_cd,             pod_nod_cd,         pod_nm,             del_cd,                 del_nm,
                iss_loc_cd,         iss_loc_nm,         pay_loc_cd,         pay_loc_nm,
        
                fnl_dest_loc_cd,    fnl_dest_loc_nm,    cgo_rcv_dt_tm,          cfs_loc_cd,
                cfs_nod_cd,         de_due_dt,          
                pre_vsl_cd,         pre_vsl_nm,         pre_voy,            trnk_vsl_cd,            trnk_vsl_nm,    trnk_voy,           
                cgo_clz_dt_tm,      obrd_dt_tm,         etd_dt_tm,          eta_dt_tm,
                lnr_rmk,            mk_txt,             desc_txt,           rmk,                    say_txt,        sad_txt,              mm_txt,
                act_shp_info,
        
                rgst_usrid,         rgst_ofc_cd,        rgst_tms,
                modi_usrid,         modi_ofc_cd,        dept_cd,            modi_usr_nm,            modi_tms,       delt_flg
                
        )  SELECT   #intg_bl_seq#,      #bl_sts_cd#,       #sr_no#,      
                    #bkg_no#,           #bkg_seq#,         #bl_no#,            #hbl_seq#,              getdate(),  
                    
                    #hbl_tp_cd#,        po_no,
                    
                    biz_clss_cd,        air_sea_clss_cd,    shp_tp_cd,
                    lnr_bkg_no,         shp_mod_cd,         inco_cd,            bkg_dt_tm,              bl_iss_dt,
                    frt_term_cd,        rep_cmdt_cd,        rep_cmdt_nm,        pck_qty,                pck_ut_cd,
                    grs_wgt,            grs_wgt_ut_cd,      act_wgt,            act_wgt_ut_cd,          meas,          meas_ut_cd,         
                    fm_svc_term_cd,     to_svc_term_cd,     srd_flg, 
                 
                    por_cd,             					por_nm,             pol_cd,                 pol_nod_cd,    pol_nm,                 
                    pod_cd,             pod_nod_cd,         pod_nm,             del_cd,                 del_nm,
                    iss_loc_cd,         iss_loc_nm,         pay_loc_cd,         pay_loc_nm,
            
                    fnl_dest_loc_cd,    fnl_dest_loc_nm,    cgo_rcv_dt_tm,          cfs_loc_cd,
                    cfs_nod_cd,         de_due_dt,          
                    pre_vsl_cd,         pre_vsl_nm,         pre_voy,            trnk_vsl_cd,            trnk_vsl_nm,    trnk_voy,           
                    cgo_clz_dt_tm,      obrd_dt_tm,         etd_dt_tm,          eta_dt_tm,
                    lnr_rmk,            mk_txt,             desc_txt,           rmk,                    say_txt,        sad_txt,              mm_txt,
                    act_shp_info,
            
                    #proc_usrid#,         #proc_ofccd#,         getdate(),
                    #proc_usrid#,         #proc_ofccd#,         #proc_dept_cd#,       #proc_usrnm#,              GETUTCDATE(),                 delt_flg
             FROM   tb_intg_bl
            WHERE   intg_bl_seq = #org_intg_bl_seq# AND delt_flg = 'N'
    </insert>
        
    <!-- BL추가정보 테이블 복사   -->
    <insert id="insertADD_INFO_BND_COPY" parameterClass="HashMap">
        INSERT INTO tb_add_info_bnd( 
            intg_bl_seq,     bnd_clss_cd,
            clz_flg,         cfm_flg,          jb_tmplt_seq,  
            sls_ofc_cd,      sls_dept_cd,      sls_usrid,     sls_usr_nm,     pic_usrid,   
            rgst_usrid,      rgst_ofc_cd,      rgst_tms,      
            modi_usrid,      modi_ofc_cd,      modi_tms,      delt_flg 
        )SELECT  #intg_bl_seq#,   #bnd_clss_cd#,
                 'N',             'N',              #jb_tmplt_seq#, 
                 sls_ofc_cd,      sls_dept_cd,      sls_usrid,       sls_usr_nm,     pic_usrid,
                 #proc_usrid#,    #proc_ofccd#,     getdate(),
                 #proc_usrid#,    #proc_ofccd#,     GETUTCDATE(),       'N'
           FROM  tb_add_info_bnd
          WHERE  intg_bl_seq = #org_intg_bl_seq# AND delt_flg = 'N'
    </insert>

    <!-- BL PARTNER 등록  -->
    <insert id="insertBL_PRNR_COPY" parameterClass="HashMap">
        INSERT INTO tb_bl_prnr(                                                      
              intg_bl_seq,          bl_trdp_tp_cd,    
              trdp_cd,              trdp_addr,          trdp_nm,
              
              trdp_pic_usr_id,      trdp_pic,           trdp_phn,      trdp_fax,     trdp_eml,
              
              rgst_usrid,           rgst_ofc_cd,        rgst_tms,        
              modi_usrid,           modi_ofc_cd,        modi_tms,      delt_flg
                                                               
        )SELECT   #intg_bl_seq#,    bl_trdp_tp_cd,
                  trdp_cd,          trdp_addr,          trdp_nm,
                  trdp_pic_usr_id,  trdp_pic,           trdp_phn,      trdp_fax,     trdp_eml,
                  #proc_usrid#,     #proc_ofccd#,       getdate(),
                  #proc_usrid#,     #proc_ofccd#,       GETUTCDATE(),     delt_flg

           FROM  tb_bl_prnr
          WHERE  intg_bl_seq = #org_intg_bl_seq# AND delt_flg = 'N'
    </insert>
    
    
    <!--Container목록에 저장  -->
    <insert id="insertCNTR_LIST_COPY" parameterClass="HashMap">
        INSERT INTO tb_cntr_list(
            intg_bl_seq,        cntr_list_seq,       rgst_cntr_yn,
            cntr_no,            cntr_tpsz_cd,        
            temp_cd,           
            vent_cd,		  
            temp_val,
            cgo_pck_qty,        cgo_pck_ut,          cgo_wgt,           cgo_meas,         vol_meas,
            soc_flg,            dg_gds_flg,          cntr_rmk,
            seal_no1,           seal_no2,            seal_no3, 
            cntr_sprl_trdp_cd,
            rgst_usrid,         rgst_ofc_cd,         rgst_tms,
            modi_usrid,         modi_ofc_cd,         modi_tms,          delt_flg
        )
        SELECT #intg_bl_seq#,       cntr_list_seq,       rgst_cntr_yn, 
                cntr_no,            cntr_tpsz_cd,        
                temp_cd,           
                vent_cd,       
                temp_val,
                cgo_pck_qty,        cgo_pck_ut,          cgo_wgt,           cgo_meas,         vol_meas, 
                soc_flg,            dg_gds_flg,          cntr_rmk, 
                seal_no1,           seal_no2,            seal_no3, 
                cntr_sprl_trdp_cd,
                #proc_usrid#,        #proc_ofccd#,       getdate(),
                #proc_usrid#,        #proc_ofccd#,       GETUTCDATE(),         delt_flg
          FROM  tb_cntr_list
         WHERE  intg_bl_seq = #org_intg_bl_seq# AND delt_flg = 'N'
    </insert>

    <!-- Item등록  -->
    <insert id="insertSHP_CMDT_COPY" parameterClass="HashMap">
        INSERT INTO tb_shp_cmdt(
            intg_bl_seq,     shp_cmdt_seq,    cntr_list_seq,
            shp_cmdt_cd,     pck_qty,         pck_ut_cd,        
            wgt,             meas,            rmk,
		    dg_cd_tp,        dg_cd,
		          
            rgst_usrid,      rgst_ofc_cd,     rgst_tms,
            modi_usrid,      modi_ofc_cd,     modi_tms,      delt_flg,
            
            hs_grp_cd,		 cmdt_cd,		  po_cmdt_seq,		        
            po_sys_no,		 pck_inr_qty,	  ea_cnt,		        
            ttl_qty,		 lbs_wgt,		  cft_meas
        )SELECT #intg_bl_seq#,   shp_cmdt_seq,    cntr_list_seq,
                shp_cmdt_cd,     pck_qty,         pck_ut_cd,
                wgt,             meas,            rmk,
		        dg_cd_tp,        dg_cd,
		
                #proc_usrid#,    #proc_ofccd#,    getdate(),
                #proc_usrid#,    #proc_ofccd#,    GETUTCDATE(),     delt_flg,
                hs_grp_cd,		 cmdt_cd,		  po_cmdt_seq,		        
	            po_sys_no,		 pck_inr_qty,	  ea_cnt,		        
	            ttl_qty,		 lbs_wgt,		  cft_meas
          FROM  tb_shp_cmdt
         WHERE  intg_bl_seq = #org_intg_bl_seq# AND delt_flg = 'N'
    </insert>

    
    <!-- MBL과 HBL 관계 테이블 생성   -->
    <insert id="insertINTG_BL_RLT_COPY" parameterClass="HashMap">
        INSERT INTO  tb_intg_bl_rlt(
                 intg_bl_seq,     rlt_intg_bl_seq,   intg_bl_rlt_cd,
                 rgst_usrid,      rgst_ofc_cd,       rgst_tms,         
                 modi_usrid,      modi_ofc_cd,       modi_tms,     delt_flg
        )VALUES(
                #intg_bl_seq#,    #rlt_intg_bl_seq#, #intg_bl_rlt_cd#,
                #proc_usrid#,     #proc_ofccd#,      getdate(),
                #proc_usrid#,     #proc_ofccd#,      GETUTCDATE(),        'N'
        )
    </insert>
    
	
    <!-- 수출신고 번호 등록   -->
    <insert id="insertEDI_INFO_COPY" parameterClass="HashMap">
        INSERT INTO tb_edi_info(
            intg_bl_seq,   edi_xpt_seq,    xpt_no,           edi_snd_sts_cd,
        
            rgst_usrid,    rgst_ofc_cd,    rgst_tms,
            modi_usrid,    modi_ofc_cd,    modi_tms,         delt_flg
        )VALUES(
           #intg_bl_seq#,  #edi_xpt_seq#,  #xpt_no#,         'CT',
        
           #proc_usrid#,   #proc_ofccd#,   getdate(),
           #proc_usrid#,   #proc_ofccd#,   GETUTCDATE(),        'N'        
        )
    </insert>

	
	<!-- 수출 정보를 조회함   -->
	<select id="selectEXP_INFO" parameterClass="String" resultClass="com.clt.apps.common.dto.CmmAjaxVO">
		  SELECT  mbl.bl_ser_no AS select_code,      '' AS code_shrt_name,
		          hbl.bl_ser_no AS select_sub_code    
			FROM  tb_intg_bl hbl
			JOIN  tb_intg_bl_rlt rlt
			  ON  hbl.intg_bl_seq = rlt.intg_bl_seq
		 
			JOIN  tb_intg_bl mbl
			  ON  mbl.intg_bl_seq = rlt.rlt_intg_bl_seq   
		     AND  mbl.biz_clss_cd = 'M'            AND  mbl.delt_flg = 'N'
		
		   WHERE  hbl.intg_bl_seq = #intg_bl_seq#  AND  hbl.delt_flg = 'N'
		     AND  hbl.biz_clss_cd = 'H'
	</select>
	
    <!--BL삭제시 Disable  -->
    <update id="removeEDI_INFO" parameterClass="HashMap">
        UPDATE  tb_edi_info
           SET  delt_flg   = #delt_flg#,
                modi_usrid = #proc_usrid#,     modi_ofc_cd = #proc_ofccd#, 
                modi_tms   = GETUTCDATE()
         WHERE  intg_bl_seq= #intg_bl_seq#
    </update>
    
    <update id="removeFRT" parameterClass="HashMap">
        UPDATE  tb_frt
           SET  delt_flg   = #delt_flg#,
                modi_usrid = #proc_usrid#,     modi_ofc_cd = #proc_ofccd#, 
                modi_tms   = GETUTCDATE()
         WHERE  intg_bl_seq= #intg_bl_seq#
    </update>
    
    <update id="removeBL_PRNR" parameterClass="HashMap">
        UPDATE  tb_bl_prnr
           SET  delt_flg   = #delt_flg#,
                modi_usrid = #proc_usrid#,     modi_ofc_cd = #proc_ofccd#, 
                modi_tms   = GETUTCDATE()
         WHERE  intg_bl_seq= #intg_bl_seq#
    </update>
    
    <update id="removeCNTR_SMRY" parameterClass="HashMap">
        UPDATE  tb_cntr_smry
           SET  delt_flg   = #delt_flg#,
                modi_usrid = #proc_usrid#,     modi_ofc_cd = #proc_ofccd#,  
                modi_tms   = GETUTCDATE()
         WHERE  intg_bl_seq= #intg_bl_seq#
    </update>
    
    <update id="removeADD_INFO_BND" parameterClass="HashMap">
        UPDATE  tb_add_info_bnd
           SET  delt_flg   = #delt_flg#,
                modi_usrid = #proc_usrid#,     modi_ofc_cd = #proc_ofccd#,   
                modi_tms   = GETUTCDATE()
         WHERE  intg_bl_seq= #intg_bl_seq#
    </update>
    
    <update id="removePALT_SHP_DOC" parameterClass="HashMap">
        UPDATE  tb_palt_shp_doc
           SET  delt_flg   = #delt_flg#,
                modi_usrid = #proc_usrid#,     modi_ofc_cd = #proc_ofccd#, 
                modi_tms   = GETUTCDATE()
         WHERE  intg_bl_seq= #intg_bl_seq#
    </update>
    
    <update id="removeSHP_CMDT" parameterClass="HashMap">
        UPDATE  tb_shp_cmdt
           SET  delt_flg   = #delt_flg#,
                modi_usrid = #proc_usrid#,     modi_ofc_cd = #proc_ofccd#, 
                modi_tms   = GETUTCDATE()
         WHERE  intg_bl_seq= #intg_bl_seq#
    </update>
    
    <update id="removeCNTR_LIST" parameterClass="HashMap">
        UPDATE  tb_cntr_list
                 SET  delt_flg   = #delt_flg#,
                modi_usrid = #proc_usrid#,     modi_ofc_cd = #proc_ofccd#, 
                modi_tms   = GETUTCDATE()
         WHERE  intg_bl_seq= #intg_bl_seq#
    </update>
    
    <update id="removeINTG_BL" parameterClass="HashMap">
        UPDATE  tb_intg_bl
           SET  delt_flg   = #delt_flg#,
                modi_usrid = #proc_usrid#,     modi_ofc_cd = #proc_ofccd#,    modi_usr_nm = #proc_usrnm#, 
                modi_tms   = GETUTCDATE()
         WHERE  intg_bl_seq= #intg_bl_seq#
    </update>
    
    <update id="removeBL_RLT" parameterClass="HashMap">
        <!--
        UPDATE  tb_intg_bl_rlt
           SET  delt_flg   = #delt_flg#,
                modi_usrid = #proc_usrid#,     modi_ofc_cd = #proc_ofccd#, 
                modi_tms   = getdate()
         WHERE  rlt_intg_bl_seq= #intg_bl_seq#
          -->
		/* BlCmmSQL.xml > removeBL_RLT */
        DELETE  tb_intg_bl_rlt
         WHERE  rlt_intg_bl_seq= #intg_bl_seq#
    </update>
    

    <update id="removeBL_RLT_BY_HBL" parameterClass="HashMap">
		/* BlCmmSQL.xml > removeBL_RLT_BY_HBL */
        DELETE  tb_intg_bl_rlt
         WHERE  intg_bl_seq= #intg_bl_seq#
    </update>

    <!-- ZOOT=NoPaging 처리  -->
    <select id="selectBL_LIST_NOPAGING_MAX" parameterClass="java.util.HashMap" resultClass="HashMap">
           /* selectBL_LIST_NOPAGING_MAX */
	        SELECT MIN(post_dt) post_dt_start, MAX(post_dt) post_dt_end 
	        	FROM (
			        SELECT  TOP $topCnt$
				         			post_dt
							  FROM  tb_intg_bl bl with(nolock) 
							  JOIN  tb_add_info_bnd bnd  with(nolock) 
								ON  bl.intg_bl_seq = bnd.intg_bl_seq AND bnd.bnd_clss_cd = #bnd_clss_cd#       
							 WHERE  bl.delt_flg = 'N' 
							<isNotEmpty property="f_ofc_cd">
							   AND  bl.ref_ofc_cd = #f_ofc_cd#
							</isNotEmpty>
							   AND  bl.air_sea_clss_cd = #air_sea_clss_cd#
							   AND  bl.biz_clss_cd  = #biz_clss_cd#
			 			    ORDER BY BL.post_dt DESC, BL.modi_tms DESC
			 	) A
		 	
    </select>
    <!-- ZOOT=NoPaging 처리  -->
     <!-- ZOOT=LIST PAGE AR_AP_DC STAUS PROCESS -->
    <!-- ZOOT=2015-01-08 NoPaging 처리  --> 
    <select id="selectHBL_LIST_NOPAGING" parameterClass="java.util.HashMap" resultClass="HBLInfoVO">
           /* selectHBL_LIST_NOPAGING NEW2 */
            	with blinfo as (
					select a1.* from (
						select 
								ROW_NUMBER() OVER (
							ORDER BY
								BL.POST_DT DESC,
								BL.MODI_TMS DESC) as ROWNUM,
								BL.*
								,ISNULL(bnd.AR_CHK,'X') AS AR_CHK
								,ISNULL(bnd.AP_CHK,'X') AS AP_CHK
								,ISNULL(bnd.DC_CHK,'X') AS DC_CHK
								,ISNULL(bnd.FRT_CHK,'X') AS FRT_CHK
								,bnd.issued_by
								,bnd.hbl_ser_no
								,bnd.entr_no
								,bnd.pkup_dt
								,bnd.an_fax_snd_dt
								,bnd.an_eml_snd_dt
						 from 
							TB_INTG_BL BL with(nolock) 
							JOIN  tb_add_info_bnd bnd with(nolock) 
							ON  bl.intg_bl_seq = bnd.intg_bl_seq AND bnd.bnd_clss_cd = #bnd_clss_cd# 						
							<isNotEmpty property="f_ofc_cd">
							   AND  bl.ref_ofc_cd = #f_ofc_cd#
							</isNotEmpty>
							<isNotEmpty property="f_bl_ser_no_frm">
							   	<isNotEmpty property="f_bl_ser_no_to">
							  	 	AND  bnd.hbl_ser_no between #f_bl_ser_no_frm# and #f_bl_ser_no_to#
								</isNotEmpty>
							</isNotEmpty>
												
						WHERE  bl.delt_flg = 'N'
						  AND  bl.air_sea_clss_cd = #air_sea_clss_cd#
						  AND  bl.biz_clss_cd  = #biz_clss_cd#					
					) a1   
				<![CDATA[ where a1.ROWNUM > #beginIdx# AND a1.ROWNUM <= #topCnt#	]]>
				)
            	SELECT  
		         			BL.INTG_BL_SEQ, X.RLT_INTG_BL_SEQ, 
							BL.BL_NO AS HBL_NO, BL.REF_NO, BL.REF_OFC_CD, X.BL_NO AS MBL_NO,
							(SELECT UPPER(X.CNT_CD) FROM TB_OFC X WHERE X.OFC_CD = BL.REF_OFC_CD AND X.DELT_FLG = 'N') AS REF_OFC_CNT,
							BL.ETD_DT_TM, BL.ETA_DT_TM,
							BL.POR_CD, BL.POR_NM, 
							BL.POL_CD, BL.POL_NM, 
							BL.POD_CD, BL.POD_NM, 
							BL.DEL_CD, BL.DEL_NM,		
							PRNR.TRDP_CD AS PRNR_TRDP_CD, PRNR.TRDP_NM AS PRNR_TRDP_NM,
							SHPR.TRDP_CD AS SHPR_TRDP_CD, SHPR.TRDP_NM AS SHPR_TRDP_NM,
							CNEE.TRDP_CD AS CNEE_TRDP_CD, CNEE.TRDP_NM AS CNEE_TRDP_NM,
							ACT.TRDP_CD AS ACT_SHPR_TRDP_CD, ACT.TRDP_NM AS ACT_SHPR_TRDP_NM,
							LNR.TRDP_CD AS LNR_TRDP_CD, LNR.TRDP_NM AS LNR_TRDP_NM,
							NTFY.TRDP_CD AS NTFY_TRDP_CD, NTFY.TRDP_NM AS NTFY_TRDP_NM,
							TRK.TRDP_CD TRK_TRDP_CD, TRK.TRDP_NM TRK_TRDP_NM,
							CUST.TRDP_CD AS CUST_TRDP_CD, CUST.TRDP_NM AS CUST_TRDP_NM,
							VNDR.TRDP_CD VNDR_TRDP_CD, VNDR.TRDP_NM VNDR_TRDP_NM,
							BL.CFS_TRDP_CD, CFS.ENG_NM AS CFS_TRDP_NM,							
							BL.HBL_TP_CD, BL.SHP_MOD_CD, BL.INCO_CD, BL.RGST_USRID, BL.REP_CMDT_NM,
							BL.CUST_REF_NO, BL.LNR_BKG_NO, BL.EXP_REF_NO,
							(SELECT x.cnt_cd FROM TB_OFC x WHERE x.OFC_CD = bl.rgst_ofc_cd) AS BL_CNT, 
							(SELECT max(X.LOCL_USR_NM) FROM TB_USR X WHERE X.USR_TP = 'I' AND X.USRID = BL.issued_by ) AS PROC_USRNM,
							BL.POST_DT, BL.TRNK_VSL_NM, BL.TRNK_VOY, BL.DOC_RECPT_NO, BL.IT_NO,							
							BL.PCK_QTY, BL.GRS_WGT, BL.GRS_WGT1, BL.MEAS,							
							BL.RLSD_FLG, BL.RLSD_DT_TM,
							CASE WHEN bl.EXPRESS_TP_CD ='Y' THEN 'YES' ELSE 'NO' END EXPRESS_TP_CD,
							BL.ORG_BL_RCVD_FLG, BL.RCVD_DT_TM,							
							(SELECT MAX(X.CNTR_NO) FROM TB_CNTR_LIST X WHERE X.INTG_BL_SEQ = BL.INTG_BL_SEQ AND X.DELT_FLG = 'N') AS CNTR_NO,
							(SELECT COUNT(X.CNTR_NO)-1 FROM TB_CNTR_LIST X WHERE X.INTG_BL_SEQ = BL.INTG_BL_SEQ AND X.DELT_FLG = 'N') AS CNTR_CNT,
							ISNULL(DBO.FC_MK_MEMO_SCRIPT(BL.INTG_BL_SEQ), '') AS MEMO,
		  					CASE WHEN CHARINDEX(CHAR(13)+CHAR(10), BL.PO_NO) = 0 THEN BL.PO_NO
							ELSE SUBSTRING(BL.PO_NO, 1, CHARINDEX(CHAR(13)+CHAR(10), BL.PO_NO)-1) END AS PO_NO , 					
							BL.LC_NO, 
							ISNULL(BLCK.BL_STS_CD1, BL.BL_STS_CD) AS BL_STS_CD,
							ISNULL(BL.ISF_NO,'') AS ISF_NO,
							ISNULL(BL.AMS_NO,'') AS AMS_NO,
		    				BL.CCN_NO,
							BL.CCN_DT,
							BL.PRE_CCN_NO,
							BL.MNF_FR_LOC,
							BL.MNF_TO_LOC,
							BL.MODI_TMS,
							ISNULL(BL.AR_CHK,'X') AS AR_CHK,
							ISNULL(BL.AP_CHK,'X') AS AP_CHK,
							ISNULL(BL.DC_CHK,'X') AS DC_CHK,     				
							ISNULL(BL.FRT_CHK,'X') AS FRT_CHK,     				
							BL.hbl_ser_no,
							BL.FNL_DEST_LOC_CD,
							BL.FNL_DEST_LOC_NM,
							BL.F_ETA_DT_TM,
							BL.ENTR_NO,
							BL.PKUP_DT,
							BL.SUB_BL_NO,
							CASE WHEN bl.EXPRESS_TP_CD ='Y' 
							     THEN 'YES' 
							     ELSE 'NO' 
							 END EXPRESS_TP_CD,
							CASE WHEN ISNULL(BL.AN_EML_SND_DT,'') = ''
							     THEN ''
							     ELSE (SUBSTRING(BL.AN_EML_SND_DT,5,2)+'-'+SUBSTRING(BL.AN_EML_SND_DT,7,2)+'-'+SUBSTRING(BL.AN_EML_SND_DT,1,4)+' '+
							           SUBSTRING(BL.AN_EML_SND_DT,9,2)+':'+SUBSTRING(BL.AN_EML_SND_DT,11,2)) 
                             END AS AN_EML_SND_DT,
							CASE WHEN ISNULL(BL.AN_FAX_SND_DT,'') = ''
							     THEN ''
							     ELSE (SUBSTRING(BL.AN_FAX_SND_DT,5,2)+'-'+SUBSTRING(BL.AN_FAX_SND_DT,7,2)+'-'+SUBSTRING(BL.AN_FAX_SND_DT,1,4)+' '+
							           SUBSTRING(BL.AN_FAX_SND_DT,9,2)+':'+SUBSTRING(BL.AN_FAX_SND_DT,11,2)) 
                             END AS AN_FAX_SND_DT
					  FROM  blinfo BL with(nolock)					  
		   LEFT OUTER JOIN  tb_bl_prnr PRNR with(nolock) 
						ON  bl.intg_bl_seq = prnr.intg_bl_seq  AND prnr.bl_trdp_tp_cd = 'P01' AND prnr.delt_flg = 'N'
		   LEFT OUTER JOIN  tb_bl_prnr SHPR with(nolock) 
						ON  bl.intg_bl_seq = SHPR.intg_bl_seq  AND SHPR.bl_trdp_tp_cd = 'S01' AND SHPR.delt_flg = 'N'
		   LEFT OUTER JOIN  tb_bl_prnr CNEE with(nolock) 
						ON  bl.intg_bl_seq = CNEE.intg_bl_seq  AND CNEE.bl_trdp_tp_cd = 'C01' AND CNEE.delt_flg = 'N'
		   LEFT OUTER JOIN  tb_bl_prnr ACT with(nolock) 
						ON  bl.intg_bl_seq = act.intg_bl_seq  AND act.bl_trdp_tp_cd = 'S02' AND act.delt_flg = 'N'
		   LEFT OUTER JOIN  tb_bl_prnr LNR with(nolock) 
						ON  bl.intg_bl_seq = lnr.intg_bl_seq  AND lnr.bl_trdp_tp_cd = 'L01' AND lnr.delt_flg = 'N'
		   LEFT OUTER JOIN  tb_bl_prnr NTFY with(nolock) 
						ON  bl.intg_bl_seq = ntfy.intg_bl_seq  AND ntfy.bl_trdp_tp_cd = 'N01' AND ntfy.delt_flg = 'N'
		   LEFT OUTER JOIN tb_bl_prnr TRK with(nolock) 
		   				ON bl.intg_bl_seq = TRK.intg_bl_seq  AND TRK.bl_trdp_tp_cd = 'T02' AND TRK.delt_flg = 'N'
		   LEFT OUTER JOIN	tb_bl_prnr CUST with(nolock) 
		           		ON	bl.intg_bl_seq = cust.intg_bl_seq  AND cust.bl_trdp_tp_cd = 'C03' AND cust.delt_flg = 'N'
		   LEFT OUTER JOIN tb_bl_prnr VNDR with(nolock) 
						ON bl.intg_bl_seq = VNDR.intg_bl_seq  AND VNDR.bl_trdp_tp_cd = 'V01' AND VNDR.delt_flg = 'N'
		   LEFT OUTER JOIN  tb_trdp CFS with(nolock) 
						ON  bl.cfs_trdp_cd = cfs.trdp_cd  AND cfs.delt_flg = 'N'
		   LEFT OUTER JOIN (
						SELECT  rlt.intg_bl_seq, mbl.bl_no, rlt.rlt_intg_bl_seq
						  FROM  tb_intg_bl mbl with(nolock) 
			   LEFT OUTER JOIN  tb_intg_bl_rlt rlt with(nolock) 
							ON  rlt.rlt_intg_bl_seq = mbl.intg_Bl_seq AND mbl.delt_flg = 'N'  
							) X ON X.intg_bl_seq = bl.intg_Bl_seq	
		   LEFT OUTER JOIN(SELECT INTG_BL_SEQ AS INTG_BL_SEQ1, BL_STS_CD AS BL_STS_CD1 FROM TB_INTG_BL_BLCK) BLCK 
		   					ON BL.INTG_BL_SEQ = BLCK.INTG_BL_SEQ1												   			
					 WHERE  bl.delt_flg = 'N'
					   AND  bl.air_sea_clss_cd= #air_sea_clss_cd#
					   AND  bl.biz_clss_cd  = #biz_clss_cd#
	 			    ORDER BY  BL.POST_DT DESC, BL.MODI_TMS DESC
    </select>
     
    <!-- #50591 [BNX TORONTO] FREIGHT LOCATION인 RAIL 회사인 CN과 CP의 CONTAINER LIST 및 EXCEL 다운로드 화면 추가  -->
    <select id="selectHBL_LIST_NOPAGING_CN_CP_EXCEL" parameterClass="java.util.HashMap" resultClass="HBLInfoVO">
           /* selectHBL_LIST_NOPAGING_CN_CP_EXCEL */
            	SELECT a1.*
				  FROM (
		         	SELECT   
		         	
		         	    BL.BL_NO AS HBL_NO,
			            BL.REF_NO,     
			            BL.POST_DT,  
			            CFS.ENG_NM AS CFS_TRDP_NM,                
			            (CASE WHEN 'CN' = #f_cn_cp# THEN SUBSTRING(LIST.CNTR_NO,1,LEN(LIST.CNTR_NO)-1) 
            			ELSE LIST.CNTR_NO END) as CNTR_NO,
                        BL.MODI_TMS
					  FROM  TB_INTG_BL BL
					  <isEqual property="bnd_clss_cd" compareValue="O">
							with(index(IDX_ETD_DT_TM), nolock)
					  </isEqual>     
					  <isEqual property="bnd_clss_cd" compareValue="I">
							with(index(IDX_ETA_DT_TM), nolock)
					  </isEqual>  
					  JOIN  tb_add_info_bnd bnd with(nolock)
						ON  bl.intg_bl_seq = bnd.intg_bl_seq AND bnd.bnd_clss_cd = #bnd_clss_cd# AND bnd.delt_flg = 'N'
						<isNotEmpty property="f_bl_ser_no_frm">
						   	<isNotEmpty property="f_bl_ser_no_to">
						  	 	AND  bnd.hbl_ser_no between #f_bl_ser_no_frm# and #f_bl_ser_no_to#
							</isNotEmpty>
						</isNotEmpty>
		   LEFT OUTER JOIN TB_CNTR_LIST list with(nolock)
		   				ON  bl.intg_bl_seq = list.intg_bl_seq AND list.delt_flg = 'N'    
		   LEFT OUTER JOIN  tb_bl_prnr PRNR with(nolock)
						ON  bl.intg_bl_seq = prnr.intg_bl_seq  AND prnr.bl_trdp_tp_cd = 'P01' AND prnr.delt_flg = 'N'
		   LEFT OUTER JOIN  tb_bl_prnr SHPR with(nolock)
						ON  bl.intg_bl_seq = SHPR.intg_bl_seq  AND SHPR.bl_trdp_tp_cd = 'S01' AND SHPR.delt_flg = 'N'
		   LEFT OUTER JOIN  tb_bl_prnr CNEE with(nolock)
						ON  bl.intg_bl_seq = CNEE.intg_bl_seq  AND CNEE.bl_trdp_tp_cd = 'C01' AND CNEE.delt_flg = 'N'
		   LEFT OUTER JOIN  tb_bl_prnr ACT with(nolock)
						ON  bl.intg_bl_seq = act.intg_bl_seq  AND act.bl_trdp_tp_cd = 'S02' AND act.delt_flg = 'N'
		   LEFT OUTER JOIN  tb_bl_prnr LNR with(nolock)
						ON  bl.intg_bl_seq = lnr.intg_bl_seq  AND lnr.bl_trdp_tp_cd = 'L01' AND lnr.delt_flg = 'N'
		   LEFT OUTER JOIN  tb_bl_prnr NTFY with(nolock)
						ON  bl.intg_bl_seq = ntfy.intg_bl_seq  AND ntfy.bl_trdp_tp_cd = 'N01' AND ntfy.delt_flg = 'N'
		   LEFT OUTER JOIN tb_bl_prnr TRK with(nolock)
		   				ON bl.intg_bl_seq = TRK.intg_bl_seq  AND TRK.bl_trdp_tp_cd = 'T02' AND TRK.delt_flg = 'N'
		   LEFT OUTER JOIN	tb_bl_prnr CUST with(nolock)
		           		ON	bl.intg_bl_seq = cust.intg_bl_seq  AND cust.bl_trdp_tp_cd = 'C03' AND cust.delt_flg = 'N'
		   LEFT OUTER JOIN tb_bl_prnr VNDR with(nolock)
						ON bl.intg_bl_seq = VNDR.intg_bl_seq  AND VNDR.bl_trdp_tp_cd = 'V01' AND VNDR.delt_flg = 'N'
		   LEFT OUTER JOIN  tb_trdp CFS with(nolock)
						ON  bl.cfs_trdp_cd = cfs.trdp_cd  AND cfs.delt_flg = 'N'
		   LEFT OUTER JOIN (
						SELECT  rlt.intg_bl_seq, mbl.bl_no, rlt.rlt_intg_bl_seq
						  FROM  tb_intg_bl mbl with(nolock) 
			   LEFT OUTER JOIN  tb_intg_bl_rlt rlt with(nolock) 
							ON  rlt.rlt_intg_bl_seq = mbl.intg_Bl_seq AND mbl.delt_flg = 'N'  
							) X ON X.intg_bl_seq = bl.intg_Bl_seq
		   LEFT OUTER JOIN(SELECT INTG_BL_SEQ AS INTG_BL_SEQ1, BL_STS_CD AS BL_STS_CD1 FROM TB_INTG_BL_BLCK with(nolock)) BLCK 
		   				ON BL.INTG_BL_SEQ = BLCK.INTG_BL_SEQ1																   			
					 WHERE  bl.delt_flg = 'N'
					   AND  bl.air_sea_clss_cd= #air_sea_clss_cd#
					   AND  bl.biz_clss_cd  = #biz_clss_cd#
					<isNotEmpty property="f_hbl_no">
					   AND  BL.BL_NO LIKE '%' + #f_hbl_no# + '%'
					</isNotEmpty>
					<isNotEmpty property="f_ref_no">
					   AND  BL.REF_NO LIKE '%' + #f_ref_no# + '%'
					</isNotEmpty>
					<isNotEmpty property="f_mbl_no">
					   AND  X.BL_NO LIKE '%' + #f_mbl_no# + '%'
					</isNotEmpty>
					<isNotEmpty property="f_cntr_no">
					   AND  BL.INTG_BL_SEQ IN (SELECT  CNTR.INTG_BL_SEQ
												 FROM  TB_CNTR_LIST CNTR with(nolock)
												WHERE  CNTR.CNTR_NO LIKE '%' + #f_cntr_no# + '%' )
					</isNotEmpty>
					<isNotEmpty property="etd_strdt">
					   AND  BL.ETD_DT_TM BETWEEN #etd_strdt# AND #etd_enddt#
					</isNotEmpty>
					<isNotEmpty property="eta_strdt">
					   AND  BL.ETA_DT_TM BETWEEN #eta_strdt# AND #eta_enddt#
					</isNotEmpty>
					<isNotEmpty property="f_pol_cd">
					   AND  BL.POL_CD = #f_pol_cd#
					</isNotEmpty>
					<isNotEmpty property="f_pol_nm">
					   AND  BL.POL_NM LIKE '%' + #f_pol_nm# + '%'
					</isNotEmpty>
					<isNotEmpty property="f_por_cd">
					   AND  BL.POR_CD = #f_por_cd#
					</isNotEmpty>
					<isNotEmpty property="f_por_nm">
					   AND  BL.POR_NM LIKE '%' + #f_por_nm# + '%'
					</isNotEmpty>
					<isNotEmpty property="f_pod_cd">
					   AND  BL.POD_CD = #f_pod_cd#
					</isNotEmpty>
					<isNotEmpty property="f_pod_nm">
					   AND  BL.POD_NM LIKE '%' + #f_pod_nm# + '%'
					</isNotEmpty>
					<isNotEmpty property="f_del_cd">
					   AND  BL.DEL_CD = #f_del_cd#
					</isNotEmpty>
					<isNotEmpty property="f_del_nm">
					   AND  BL.DEL_NM LIKE '%' + #f_del_nm# + '%'
					</isNotEmpty>
					<isNotEmpty property="f_prnr_trdp_nm">
					   AND  PRNR.TRDP_NM LIKE '%' + #f_prnr_trdp_nm# + '%'
					</isNotEmpty>
					<isNotEmpty property="f_shpr_trdp_nm">
					   AND  SHPR.TRDP_NM LIKE '%' + #f_shpr_trdp_nm# + '%'
					</isNotEmpty>
					<isNotEmpty property="f_cnee_trdp_nm">
					   AND  CNEE.TRDP_NM LIKE '%' + #f_cnee_trdp_nm# + '%'
					</isNotEmpty>
					<isNotEmpty property="f_ahpr_trdp_nm">
					   AND  ACT.TRDP_NM LIKE '%' + #f_ahpr_trdp_nm# + '%'
					</isNotEmpty>
					<isNotEmpty property="f_ntfy_trdp_nm">
					   AND  NTFY.TRDP_NM LIKE '%' + #f_ntfy_trdp_nm# + '%'
					</isNotEmpty>
					<isNotEmpty property="f_cfs_trdp_nm">
					   AND  CFS.ENG_NM LIKE '%' + #f_cfs_trdp_nm# + '%'
					</isNotEmpty>
					<isNotEmpty property="f_hbl_tp_cd">
					   AND  BL.HBL_TP_CD = #f_hbl_tp_cd#
					</isNotEmpty>
					<isNotEmpty property="f_ofc_cd">
					   AND  BL.REF_OFC_CD = #f_ofc_cd#
					</isNotEmpty>
					<isNotEmpty property="f_shp_mod_cd">
					   AND  BL.SHP_MOD_CD = #f_shp_mod_cd#
					</isNotEmpty>
					<isNotEmpty property="f_inco_cd">
					   AND  BL.INCO_CD = #f_inco_cd#
					</isNotEmpty>
					<isNotEmpty property="f_pic_id">
					   AND  BL.RGST_USRID LIKE '%' + #f_pic_id# + '%'
					</isNotEmpty>
					<isNotEmpty property="f_cmdt_nm">
					   AND  BL.REP_CMDT_NM LIKE '%' + #f_cmdt_nm# + '%'
					</isNotEmpty>
					<isNotEmpty property="f_trnk_vsl_nm">
					   AND  BL.TRNK_VSL_NM LIKE '%' + #f_trnk_vsl_nm# + '%'
					</isNotEmpty>
					<isNotEmpty property="f_grs_wgt">
					   AND  BL.GRS_WGT LIKE '%' + #f_grs_wgt# + '%'
					</isNotEmpty>
					<isNotEmpty property="f_grs_wgt1">
					   AND  BL.GRS_WGT1 LIKE '%' + #f_grs_wgt1# + '%'
					</isNotEmpty>
					<isNotEmpty property="f_meas">
					   AND  BL.MEAS LIKE '%' + #f_meas# + '%'
					</isNotEmpty>
					<isNotEmpty property="f_it_no">
					   AND  BL.IT_NO LIKE '%' + #f_it_no# + '%'
					</isNotEmpty>
					<isNotEmpty property="fm_pck_qty">
					   AND  BL.PCK_QTY BETWEEN #fm_pck_qty# AND #to_pck_qty#
					</isNotEmpty>
					<isNotEmpty property="fm_grs_wgt">
					   AND  BL.GRS_WGT BETWEEN #fm_grs_wgt# AND #to_grs_wgt#
					</isNotEmpty>
					<isNotEmpty property="fm_meas">
					   AND  BL.MEAS BETWEEN #fm_meas# AND #to_meas#
					</isNotEmpty>
					<isNotEmpty property="f_po_no">
					   AND  BL.PO_NO LIKE '%' + #f_po_no# + '%'
					</isNotEmpty>
					<isNotEmpty property="f_lc_no">
					   AND  BL.LC_NO = #f_lc_no#
					</isNotEmpty>
					<isNotEmpty property="f_inv_no">
					   AND  BL.INV_NO = #f_inv_no#
					</isNotEmpty>
					<isNotEmpty property="f_lnr_bkg_no">
					   AND  BL.LNR_BKG_NO = #f_lnr_bkg_no#
					</isNotEmpty>
					<isNotEmpty property="f_cust_ref_no">
					   AND  BL.CUST_REF_NO LIKE '%' + #f_cust_ref_no# + '%'
					</isNotEmpty>			
					<isNotEmpty property="f_ams_no">
					   AND  BL.AMS_NO LIKE '%' + #f_ams_no# + '%'
					</isNotEmpty>
					<isNotEmpty property="f_isf_no">
					   AND  BL.ISF_NO LIKE '%' + #f_isf_no# + '%'
					</isNotEmpty>	
					<isNotEmpty property="f_ccn_no">
					   AND  BL.CCN_NO LIKE '%' + #f_ccn_no# + '%'
					</isNotEmpty>		
					<isNotEmpty property="f_fnl_dest_loc_cd">
					   AND  BL.FNL_DEST_LOC_CD = #f_fnl_dest_loc_cd#
					</isNotEmpty>
					<isNotEmpty property="f_fnl_dest_loc_nm">
					   AND  BL.FNL_DEST_LOC_NM LIKE '%' + #f_fnl_dest_loc_nm# + '%'
					</isNotEmpty>
					<isNotEmpty property="f_entr_no">
					   AND  BND.ENTR_NO LIKE '%' + #f_entr_no# + '%'
					</isNotEmpty>	
					<isNotEmpty property="post_strdt">
					   AND  BL.POST_DT BETWEEN #post_strdt# AND #post_enddt#
					</isNotEmpty>			
					<isNotEmpty property="f_sub_bl_no">
					   AND  BL.SUB_BL_NO LIKE '%' + #f_sub_bl_no# + '%'
					</isNotEmpty>
					<isNotEmpty property="opr_usrid">
					   AND  BND.ISSUED_BY = #opr_usrid#
					</isNotEmpty>	
					<isNotEmpty property="f_cn_cp">
					   AND  (CFS.ENG_NM = #f_cn_cp# OR CFS.ENG_NM LIKE #f_cn_cp# + ' %')
					</isNotEmpty>					
					 ) a1
			ORDER BY  a1.POST_DT DESC, a1.MODI_TMS DESC
    </select>
    <!-- House B/L List select    -->
    <!-- #18782 : [BINEX, GPL] OBL RCV and Release update function (From BL List) - add BL.ORG_BL_RCVD_FLG, BL.RCVD_DT_TM jsjang 2013.9.14    -->
     <!-- ZOOT=LIST PAGE AR_AP_DC STAUS PROCESS -->
    <select id="selectHBL_LIST" parameterClass="java.util.HashMap" resultClass="HBLInfoVO">
		/* BlCmmSQL.xml > selectHBL_LIST NEW IN/OUT */		
     	  		SELECT a1.*
				  FROM (
		         	SELECT  ROW_NUMBER() OVER (ORDER BY  BL.POST_DT DESC, BL.MODI_TMS DESC) as ROWNUM,
							BL.INTG_BL_SEQ, X.RLT_INTG_BL_SEQ, 
							BL.BL_NO AS HBL_NO, BL.REF_NO, BL.REF_OFC_CD, X.BL_NO AS MBL_NO,
							(SELECT UPPER(X.CNT_CD) FROM TB_OFC X WHERE X.OFC_CD = BL.REF_OFC_CD AND X.DELT_FLG = 'N') AS REF_OFC_CNT,
							BL.ETD_DT_TM, BL.ETA_DT_TM,
							BL.POR_CD, BL.POR_NM, 
							BL.POL_CD, BL.POL_NM, 
							BL.POD_CD, BL.POD_NM, 
							BL.DEL_CD, BL.DEL_NM,		
							PRNR.TRDP_CD AS PRNR_TRDP_CD, PRNR.TRDP_NM AS PRNR_TRDP_NM,
							SHPR.TRDP_CD AS SHPR_TRDP_CD, SHPR.TRDP_NM AS SHPR_TRDP_NM,
							CNEE.TRDP_CD AS CNEE_TRDP_CD, CNEE.TRDP_NM AS CNEE_TRDP_NM,
							ACT.TRDP_CD AS ACT_SHPR_TRDP_CD, ACT.TRDP_NM AS ACT_SHPR_TRDP_NM,
							LNR.TRDP_CD AS LNR_TRDP_CD, LNR.TRDP_NM AS LNR_TRDP_NM,
							NTFY.TRDP_CD AS NTFY_TRDP_CD, NTFY.TRDP_NM AS NTFY_TRDP_NM,
							TRK.TRDP_CD TRK_TRDP_CD, TRK.TRDP_NM TRK_TRDP_NM,
							CUST.TRDP_CD AS CUST_TRDP_CD, CUST.TRDP_NM AS CUST_TRDP_NM,
							VNDR.TRDP_CD VNDR_TRDP_CD, VNDR.TRDP_NM VNDR_TRDP_NM,
							BL.CFS_TRDP_CD, CFS.ENG_NM AS CFS_TRDP_NM,							
							BL.HBL_TP_CD, BL.SHP_MOD_CD, BL.INCO_CD, BL.RGST_USRID, BL.REP_CMDT_NM,
							BL.CUST_REF_NO, BL.LNR_BKG_NO, BL.EXP_REF_NO,
							(SELECT x.cnt_cd FROM TB_OFC x WHERE x.OFC_CD = bl.rgst_ofc_cd) AS BL_CNT, 
							(SELECT max(X.LOCL_USR_NM) FROM TB_USR X WHERE X.USR_TP = 'I' AND X.USRID = bnd.issued_by ) AS PROC_USRNM,
							BL.POST_DT, BL.TRNK_VSL_NM, BL.TRNK_VOY, BL.DOC_RECPT_NO, BL.IT_NO,							
							BL.PCK_QTY, BL.GRS_WGT, BL.GRS_WGT1, BL.MEAS,							
							BL.RLSD_FLG, BL.RLSD_DT_TM,
							CASE WHEN bl.EXPRESS_TP_CD ='Y' THEN 'YES' ELSE 'NO' END EXPRESS_TP_CD,
							BL.ORG_BL_RCVD_FLG, BL.RCVD_DT_TM,							
							(SELECT MAX(X.CNTR_NO) FROM TB_CNTR_LIST X WHERE X.INTG_BL_SEQ = BL.INTG_BL_SEQ AND X.DELT_FLG = 'N') AS CNTR_NO,
							(SELECT COUNT(X.CNTR_NO)-1 FROM TB_CNTR_LIST X WHERE X.INTG_BL_SEQ = BL.INTG_BL_SEQ AND X.DELT_FLG = 'N') AS CNTR_CNT,
							ISNULL(DBO.FC_MK_MEMO_SCRIPT(BL.INTG_BL_SEQ), '') AS MEMO,
		  					CASE WHEN CHARINDEX(CHAR(13)+CHAR(10), BL.PO_NO) = 0 THEN BL.PO_NO
							ELSE SUBSTRING(BL.PO_NO, 1, CHARINDEX(CHAR(13)+CHAR(10), BL.PO_NO)-1) END AS PO_NO , 					
							BL.LC_NO, 
							BL.INV_NO,
							BL.AMS_ID,
							ISNULL(BLCK.BL_STS_CD1, BL.BL_STS_CD) AS BL_STS_CD,
							BL.ISF_NO,
							BL.AMS_NO,
		    				BL.CCN_NO,
							BL.CCN_DT,
							BL.PRE_CCN_NO,
							BL.MNF_FR_LOC,
							BL.MNF_TO_LOC,
							BL.MODI_TMS,
							ISNULL(bnd.AR_CHK,'X') AS AR_CHK,
							ISNULL(bnd.AP_CHK,'X') AS AP_CHK,
							ISNULL(bnd.DC_CHK,'X') AS DC_CHK,
							ISNULL(bnd.FRT_CHK,'X') AS FRT_CHK,
							BND.HBL_SER_NO,
							BL.FNL_DEST_LOC_CD,
							BL.FNL_DEST_LOC_NM,
							BL.F_ETA_DT_TM,
							BND.ENTR_NO,
							BND.PKUP_DT,
							BL.SUB_BL_NO,
							CASE WHEN ISNULL(BND.AN_EML_SND_DT,'') = ''
							     THEN ''
							     ELSE (SUBSTRING(BND.AN_EML_SND_DT,5,2)+'-'+SUBSTRING(BND.AN_EML_SND_DT,7,2)+'-'+SUBSTRING(BND.AN_EML_SND_DT,1,4)+' '+
							           SUBSTRING(BND.AN_EML_SND_DT,9,2)+':'+SUBSTRING(BND.AN_EML_SND_DT,11,2)) 
                             END AS AN_EML_SND_DT,
							CASE WHEN ISNULL(BND.AN_FAX_SND_DT,'') = ''
							     THEN ''
							     ELSE (SUBSTRING(BND.AN_FAX_SND_DT,5,2)+'-'+SUBSTRING(BND.AN_FAX_SND_DT,7,2)+'-'+SUBSTRING(BND.AN_FAX_SND_DT,1,4)+' '+
							           SUBSTRING(BND.AN_FAX_SND_DT,9,2)+':'+SUBSTRING(BND.AN_FAX_SND_DT,11,2)) 
                             END AS AN_FAX_SND_DT
					  FROM  TB_INTG_BL BL
					  <isEqual property="bnd_clss_cd" compareValue="O">
							with(index(IDX_ETD_DT_TM), nolock)
					  </isEqual>     
					  <isEqual property="bnd_clss_cd" compareValue="I">
							with(index(IDX_ETA_DT_TM), nolock)
					  </isEqual>  
					  JOIN  tb_add_info_bnd bnd with(nolock)
						ON  bl.intg_bl_seq = bnd.intg_bl_seq AND bnd.bnd_clss_cd = #bnd_clss_cd# AND bnd.delt_flg = 'N'
						<isNotEmpty property="f_bl_ser_no_frm">
						   	<isNotEmpty property="f_bl_ser_no_to">
						  	 	AND  bnd.hbl_ser_no between #f_bl_ser_no_frm# and #f_bl_ser_no_to#
							</isNotEmpty>
						</isNotEmpty>
		   LEFT OUTER JOIN  tb_bl_prnr PRNR with(nolock)
						ON  bl.intg_bl_seq = prnr.intg_bl_seq  AND prnr.bl_trdp_tp_cd = 'P01' AND prnr.delt_flg = 'N'
		   LEFT OUTER JOIN  tb_bl_prnr SHPR with(nolock)
						ON  bl.intg_bl_seq = SHPR.intg_bl_seq  AND SHPR.bl_trdp_tp_cd = 'S01' AND SHPR.delt_flg = 'N'
		   LEFT OUTER JOIN  tb_bl_prnr CNEE with(nolock)
						ON  bl.intg_bl_seq = CNEE.intg_bl_seq  AND CNEE.bl_trdp_tp_cd = 'C01' AND CNEE.delt_flg = 'N'
		   LEFT OUTER JOIN  tb_bl_prnr ACT with(nolock)
						ON  bl.intg_bl_seq = act.intg_bl_seq  AND act.bl_trdp_tp_cd = 'S02' AND act.delt_flg = 'N'
		   LEFT OUTER JOIN  tb_bl_prnr LNR with(nolock)
						ON  bl.intg_bl_seq = lnr.intg_bl_seq  AND lnr.bl_trdp_tp_cd = 'L01' AND lnr.delt_flg = 'N'
		   LEFT OUTER JOIN  tb_bl_prnr NTFY with(nolock)
						ON  bl.intg_bl_seq = ntfy.intg_bl_seq  AND ntfy.bl_trdp_tp_cd = 'N01' AND ntfy.delt_flg = 'N'
		   LEFT OUTER JOIN tb_bl_prnr TRK with(nolock)
		   				ON bl.intg_bl_seq = TRK.intg_bl_seq  AND TRK.bl_trdp_tp_cd = 'T02' AND TRK.delt_flg = 'N'
		   LEFT OUTER JOIN	tb_bl_prnr CUST with(nolock)
		           		ON	bl.intg_bl_seq = cust.intg_bl_seq  AND cust.bl_trdp_tp_cd = 'C03' AND cust.delt_flg = 'N'
		   LEFT OUTER JOIN tb_bl_prnr VNDR with(nolock)
						ON bl.intg_bl_seq = VNDR.intg_bl_seq  AND VNDR.bl_trdp_tp_cd = 'V01' AND VNDR.delt_flg = 'N'
		   LEFT OUTER JOIN  tb_trdp CFS with(nolock)
						ON  bl.cfs_trdp_cd = cfs.trdp_cd  AND cfs.delt_flg = 'N'
		   LEFT OUTER JOIN (
						SELECT  rlt.intg_bl_seq, mbl.bl_no, rlt.rlt_intg_bl_seq
						  FROM  tb_intg_bl mbl with(nolock) 
			   LEFT OUTER JOIN  tb_intg_bl_rlt rlt with(nolock) 
							ON  rlt.rlt_intg_bl_seq = mbl.intg_Bl_seq AND mbl.delt_flg = 'N'  
							) X ON X.intg_bl_seq = bl.intg_Bl_seq
		   LEFT OUTER JOIN(SELECT INTG_BL_SEQ AS INTG_BL_SEQ1, BL_STS_CD AS BL_STS_CD1 FROM TB_INTG_BL_BLCK with(nolock)) BLCK 
		   				ON BL.INTG_BL_SEQ = BLCK.INTG_BL_SEQ1																   			
					 WHERE  bl.delt_flg = 'N'
					   AND  bl.air_sea_clss_cd= #air_sea_clss_cd#
					   AND  bl.biz_clss_cd  = #biz_clss_cd#
					<isNotEmpty property="f_hbl_no">
					   AND  BL.BL_NO LIKE '%' + #f_hbl_no# + '%'
					</isNotEmpty>
					<isNotEmpty property="f_ref_no">
					   AND  BL.REF_NO LIKE '%' + #f_ref_no# + '%'
					</isNotEmpty>
					<isNotEmpty property="f_mbl_no">
					   AND  X.BL_NO LIKE '%' + #f_mbl_no# + '%'
					</isNotEmpty>
					<isNotEmpty property="f_cntr_no">
					   AND  BL.INTG_BL_SEQ IN (SELECT  CNTR.INTG_BL_SEQ
												 FROM  TB_CNTR_LIST CNTR with(nolock)
												WHERE  CNTR.CNTR_NO LIKE '%' + #f_cntr_no# + '%' )
					</isNotEmpty>
					<isNotEmpty property="etd_strdt">
					   AND  BL.ETD_DT_TM BETWEEN #etd_strdt# AND #etd_enddt#
					</isNotEmpty>
					<isNotEmpty property="eta_strdt">
					   AND  BL.ETA_DT_TM BETWEEN #eta_strdt# AND #eta_enddt#
					</isNotEmpty>
					<isNotEmpty property="f_pol_cd">
					   AND  BL.POL_CD = #f_pol_cd#
					</isNotEmpty>
					<isNotEmpty property="f_pol_nm">
					   AND  BL.POL_NM LIKE '%' + #f_pol_nm# + '%'
					</isNotEmpty>
					<isNotEmpty property="f_por_cd">
					   AND  BL.POR_CD = #f_por_cd#
					</isNotEmpty>
					<isNotEmpty property="f_por_nm">
					   AND  BL.POR_NM LIKE '%' + #f_por_nm# + '%'
					</isNotEmpty>
					<isNotEmpty property="f_pod_cd">
					   AND  BL.POD_CD = #f_pod_cd#
					</isNotEmpty>
					<isNotEmpty property="f_pod_nm">
					   AND  BL.POD_NM LIKE '%' + #f_pod_nm# + '%'
					</isNotEmpty>
					<isNotEmpty property="f_del_cd">
					   AND  BL.DEL_CD = #f_del_cd#
					</isNotEmpty>
					<isNotEmpty property="f_del_nm">
					   AND  BL.DEL_NM LIKE '%' + #f_del_nm# + '%'
					</isNotEmpty>
					<isNotEmpty property="f_prnr_trdp_nm">
					   AND  PRNR.TRDP_NM LIKE '%' + #f_prnr_trdp_nm# + '%'
					</isNotEmpty>
					<isNotEmpty property="f_shpr_trdp_nm">
					   AND  SHPR.TRDP_NM LIKE '%' + #f_shpr_trdp_nm# + '%'
					</isNotEmpty>
					<isNotEmpty property="f_cnee_trdp_nm">
					   AND  CNEE.TRDP_NM LIKE '%' + #f_cnee_trdp_nm# + '%'
					</isNotEmpty>
					<isNotEmpty property="f_ahpr_trdp_nm">
					   AND  ACT.TRDP_NM LIKE '%' + #f_ahpr_trdp_nm# + '%'
					</isNotEmpty>
					<isNotEmpty property="f_ntfy_trdp_nm">
					   AND  NTFY.TRDP_NM LIKE '%' + #f_ntfy_trdp_nm# + '%'
					</isNotEmpty>
					<isNotEmpty property="f_cfs_trdp_nm">
					   AND  CFS.ENG_NM LIKE '%' + #f_cfs_trdp_nm# + '%'
					</isNotEmpty>
					<isNotEmpty property="f_hbl_tp_cd">
					   AND  BL.HBL_TP_CD = #f_hbl_tp_cd#
					</isNotEmpty>
					<isNotEmpty property="f_ofc_cd">
					   AND  BL.REF_OFC_CD = #f_ofc_cd#
					</isNotEmpty>
					<isNotEmpty property="f_shp_mod_cd">
					   AND  BL.SHP_MOD_CD = #f_shp_mod_cd#
					</isNotEmpty>
					<isNotEmpty property="f_inco_cd">
					   AND  BL.INCO_CD = #f_inco_cd#
					</isNotEmpty>
					<isNotEmpty property="f_pic_id">
					   AND  BL.RGST_USRID LIKE '%' + #f_pic_id# + '%'
					</isNotEmpty>
					<isNotEmpty property="f_cmdt_nm">
					   AND  BL.REP_CMDT_NM LIKE '%' + #f_cmdt_nm# + '%'
					</isNotEmpty>
					<isNotEmpty property="f_trnk_vsl_nm">
					   AND  BL.TRNK_VSL_NM LIKE '%' + #f_trnk_vsl_nm# + '%'
					</isNotEmpty>
					<isNotEmpty property="f_grs_wgt">
					   AND  BL.GRS_WGT LIKE '%' + #f_grs_wgt# + '%'
					</isNotEmpty>
					<isNotEmpty property="f_grs_wgt1">
					   AND  BL.GRS_WGT1 LIKE '%' + #f_grs_wgt1# + '%'
					</isNotEmpty>
					<isNotEmpty property="f_meas">
					   AND  BL.MEAS LIKE '%' + #f_meas# + '%'
					</isNotEmpty>
					<isNotEmpty property="f_it_no">
					   AND  BL.IT_NO LIKE '%' + #f_it_no# + '%'
					</isNotEmpty>
					<isNotEmpty property="fm_pck_qty">
					   AND  BL.PCK_QTY BETWEEN #fm_pck_qty# AND #to_pck_qty#
					</isNotEmpty>
					<isNotEmpty property="fm_grs_wgt">
					   AND  BL.GRS_WGT BETWEEN #fm_grs_wgt# AND #to_grs_wgt#
					</isNotEmpty>
					<isNotEmpty property="fm_meas">
					   AND  BL.MEAS BETWEEN #fm_meas# AND #to_meas#
					</isNotEmpty>
					<isNotEmpty property="f_po_no">
					   AND  BL.PO_NO LIKE '%' + #f_po_no# + '%'
					</isNotEmpty>
					<isNotEmpty property="f_lc_no">
					   AND  BL.LC_NO = #f_lc_no#
					</isNotEmpty>
					<isNotEmpty property="f_inv_no">
					   AND  BL.INV_NO = #f_inv_no#
					</isNotEmpty>
					<isNotEmpty property="f_lnr_bkg_no">
					   AND  BL.LNR_BKG_NO = #f_lnr_bkg_no#
					</isNotEmpty>
					<isNotEmpty property="f_cust_ref_no">
					   AND  BL.CUST_REF_NO LIKE '%' + #f_cust_ref_no# + '%'
					</isNotEmpty>			
					<isNotEmpty property="f_ams_no">
					   AND  BL.AMS_NO LIKE '%' + #f_ams_no# + '%'
					</isNotEmpty>
					<isNotEmpty property="f_isf_no">
					   AND  BL.ISF_NO LIKE '%' + #f_isf_no# + '%'
					</isNotEmpty>	
					<isNotEmpty property="f_ccn_no">
					   AND  BL.CCN_NO LIKE '%' + #f_ccn_no# + '%'
					</isNotEmpty>		
					<isNotEmpty property="f_fnl_dest_loc_cd">
					   AND  BL.FNL_DEST_LOC_CD = #f_fnl_dest_loc_cd#
					</isNotEmpty>
					<isNotEmpty property="f_fnl_dest_loc_nm">
					   AND  BL.FNL_DEST_LOC_NM LIKE '%' + #f_fnl_dest_loc_nm# + '%'
					</isNotEmpty>
					<isNotEmpty property="f_entr_no">
					   AND  BND.ENTR_NO LIKE '%' + #f_entr_no# + '%'
					</isNotEmpty>	
					<isNotEmpty property="post_strdt">
					   AND  BL.POST_DT BETWEEN #post_strdt# AND #post_enddt#
					</isNotEmpty>			
					<isNotEmpty property="f_sub_bl_no">
					   AND  BL.SUB_BL_NO LIKE '%' + #f_sub_bl_no# + '%'
					</isNotEmpty>
					<isNotEmpty property="opr_usrid">
					   AND  BND.ISSUED_BY = #opr_usrid#
					</isNotEmpty>	
					 ) a1
		 <![CDATA[ where a1.ROWNUM > #beginIdx# AND a1.ROWNUM <= #topCnt#	]]> 				
    </select>
    
    <!--  House B/L List select count    -->
    <!-- ZOOT -->
    <select id="selectHBL_LIST_CNT" parameterClass="java.util.HashMap" resultClass="Integer">
        SELECT  COUNT(bl.intg_bl_seq)    
          FROM  TB_INTG_BL BL          
			  JOIN  tb_add_info_bnd bnd with(nolock)
				ON  bl.intg_bl_seq = bnd.intg_bl_seq AND bnd.bnd_clss_cd = #bnd_clss_cd# AND bnd.delt_flg = 'N'
				<isNotEmpty property="f_bl_ser_no_frm">
				   	<isNotEmpty property="f_bl_ser_no_to">
				  	 	AND  bnd.hbl_ser_no between #f_bl_ser_no_frm# and #f_bl_ser_no_to#
					</isNotEmpty>
				</isNotEmpty>
   LEFT OUTER JOIN  tb_bl_prnr PRNR with(nolock)
				ON  bl.intg_bl_seq = prnr.intg_bl_seq  AND prnr.bl_trdp_tp_cd = 'P01' AND prnr.delt_flg = 'N'
   LEFT OUTER JOIN  tb_bl_prnr SHPR with(nolock)
				ON  bl.intg_bl_seq = SHPR.intg_bl_seq  AND SHPR.bl_trdp_tp_cd = 'S01' AND SHPR.delt_flg = 'N'
   LEFT OUTER JOIN  tb_bl_prnr CNEE with(nolock)
				ON  bl.intg_bl_seq = CNEE.intg_bl_seq  AND CNEE.bl_trdp_tp_cd = 'C01' AND CNEE.delt_flg = 'N'
   LEFT OUTER JOIN  tb_bl_prnr ACT with(nolock)
				ON  bl.intg_bl_seq = act.intg_bl_seq  AND act.bl_trdp_tp_cd = 'S02' AND act.delt_flg = 'N'
   LEFT OUTER JOIN  tb_bl_prnr LNR with(nolock)
				ON  bl.intg_bl_seq = lnr.intg_bl_seq  AND lnr.bl_trdp_tp_cd = 'L01' AND lnr.delt_flg = 'N'
   LEFT OUTER JOIN  tb_bl_prnr NTFY with(nolock)
				ON  bl.intg_bl_seq = ntfy.intg_bl_seq  AND ntfy.bl_trdp_tp_cd = 'N01' AND ntfy.delt_flg = 'N'
   LEFT OUTER JOIN	tb_bl_prnr CUST with(nolock)
           		ON	bl.intg_bl_seq = cust.intg_bl_seq  AND cust.bl_trdp_tp_cd = 'C03' AND cust.delt_flg = 'N'
   LEFT OUTER JOIN	tb_bl_prnr trk with(nolock)
           		ON	bl.intg_bl_seq = cust.intg_bl_seq  AND cust.bl_trdp_tp_cd = 'T02' AND cust.delt_flg = 'N'
   LEFT OUTER JOIN	tb_bl_prnr vndr with(nolock)
           		ON	bl.intg_bl_seq = vndr.intg_bl_seq  AND vndr.bl_trdp_tp_cd = 'V01' AND vndr.delt_flg = 'N'
   LEFT OUTER JOIN  tb_trdp CFS with(nolock)
				ON  bl.cfs_trdp_cd = cfs.trdp_cd  AND cfs.delt_flg = 'N'
   LEFT OUTER JOIN (
				SELECT  rlt.intg_bl_seq, mbl.bl_no
				  FROM  tb_intg_bl mbl with(nolock)
	   LEFT OUTER JOIN  tb_intg_bl_rlt rlt with(nolock)
					ON  rlt.rlt_intg_bl_seq = mbl.intg_Bl_seq AND mbl.delt_flg = 'N'  
					) X ON X.intg_bl_seq = bl.intg_Bl_seq   
        WHERE   bl.delt_flg = 'N'  AND bl.air_sea_clss_cd= #air_sea_clss_cd#
          AND bl.biz_clss_cd  = #biz_clss_cd#
    		<isNotEmpty property="f_hbl_no">
			   AND  BL.BL_NO LIKE '%' + #f_hbl_no# + '%'
			</isNotEmpty>
			<isNotEmpty property="f_ref_no">
			   AND  BL.REF_NO LIKE '%' + #f_ref_no# + '%'
			</isNotEmpty>
			<isNotEmpty property="f_mbl_no">
			   AND  X.BL_NO LIKE '%' + #f_mbl_no# + '%'
			</isNotEmpty>
			<isNotEmpty property="f_cntr_no">
			   AND  BL.INTG_BL_SEQ IN (SELECT  CNTR.INTG_BL_SEQ
										 FROM  TB_CNTR_LIST CNTR with(nolock)
										WHERE  CNTR.CNTR_NO LIKE '%' + #f_cntr_no# + '%')
			</isNotEmpty>
			<isNotEmpty property="etd_strdt">
			   AND  BL.ETD_DT_TM BETWEEN #etd_strdt# AND #etd_enddt#
			</isNotEmpty>
			<isNotEmpty property="eta_strdt">
			   AND  BL.ETA_DT_TM BETWEEN #eta_strdt# AND #eta_enddt#
			</isNotEmpty>
			<isNotEmpty property="f_pol_cd">
			   AND  BL.POL_CD = #f_pol_cd#
			</isNotEmpty>
			<isNotEmpty property="f_pol_nm">
			   AND  BL.POL_NM LIKE '%' + #f_pol_nm# + '%'
			</isNotEmpty>
			<isNotEmpty property="f_por_cd">
			   AND  BL.POR_CD = #f_por_cd#
			</isNotEmpty>
			<isNotEmpty property="f_por_nm">
			   AND  BL.POR_NM LIKE '%' + #f_por_nm# + '%'
			</isNotEmpty>
			<isNotEmpty property="f_pod_cd">
			   AND  BL.POD_CD = #f_pod_cd#
			</isNotEmpty>
			<isNotEmpty property="f_pod_nm">
			   AND  BL.POD_NM LIKE '%' + #f_pod_nm# + '%'
			</isNotEmpty>
			<isNotEmpty property="f_del_cd">
			   AND  BL.DEL_CD = #f_del_cd#
			</isNotEmpty>
			<isNotEmpty property="f_del_nm">
			   AND  BL.DEL_NM LIKE '%' + #f_del_nm# + '%'
			</isNotEmpty>
			<isNotEmpty property="f_prnr_trdp_nm">
			   AND  PRNR.TRDP_NM LIKE '%' + #f_prnr_trdp_nm# + '%'
			</isNotEmpty>
			<isNotEmpty property="f_shpr_trdp_nm">
			   AND  SHPR.TRDP_NM LIKE '%' + #f_shpr_trdp_nm# + '%'
			</isNotEmpty>
			<isNotEmpty property="f_cnee_trdp_nm">
			   AND  CNEE.TRDP_NM LIKE '%' + #f_cnee_trdp_nm# + '%'
			</isNotEmpty>
			<isNotEmpty property="f_ahpr_trdp_nm">
			   AND  ACT.TRDP_NM LIKE '%' + #f_ahpr_trdp_nm# + '%'
			</isNotEmpty>
			<isNotEmpty property="f_ntfy_trdp_nm">
			   AND  NTFY.TRDP_NM LIKE '%' + #f_ntfy_trdp_nm# + '%'
			</isNotEmpty>
			<isNotEmpty property="f_cfs_trdp_nm">
			   AND  CFS.ENG_NM LIKE '%' + #f_cfs_trdp_nm# + '%'
			</isNotEmpty>
			<isNotEmpty property="f_hbl_tp_cd">
			   AND  BL.HBL_TP_CD = #f_hbl_tp_cd#
			</isNotEmpty>
			<isNotEmpty property="f_ofc_cd">
			   AND  BL.REF_OFC_CD = #f_ofc_cd#
			</isNotEmpty>
			<isNotEmpty property="f_shp_mod_cd">
			   AND  BL.SHP_MOD_CD = #f_shp_mod_cd#
			</isNotEmpty>
			<isNotEmpty property="f_inco_cd">
			   AND  BL.INCO_CD = #f_inco_cd#
			</isNotEmpty>
			<isNotEmpty property="f_pic_id">
			   AND  BL.RGST_USRID LIKE '%' + #f_pic_id# + '%'
			</isNotEmpty>
			<isNotEmpty property="f_cmdt_nm">
			   AND  BL.REP_CMDT_NM LIKE '%' + #f_cmdt_nm# + '%'
			</isNotEmpty>
			<isNotEmpty property="f_trnk_vsl_nm">
			   AND  BL.TRNK_VSL_NM LIKE '%' + #f_trnk_vsl_nm# + '%'
			</isNotEmpty>
			<isNotEmpty property="f_grs_wgt">
			   AND  BL.GRS_WGT LIKE '%' + #f_grs_wgt# + '%'
			</isNotEmpty>
			<isNotEmpty property="f_grs_wgt1">
			   AND  BL.GRS_WGT1 LIKE '%' + #f_grs_wgt1# + '%'
			</isNotEmpty>
			<isNotEmpty property="f_meas">
			   AND  BL.MEAS LIKE '%' + #f_meas# + '%'
			</isNotEmpty>
			<isNotEmpty property="f_it_no">
			   AND  BL.IT_NO LIKE '%' + #f_it_no# + '%'
			</isNotEmpty>
			<isNotEmpty property="fm_pck_qty">
			   AND  BL.PCK_QTY BETWEEN #fm_pck_qty# AND #to_pck_qty#
			</isNotEmpty>
			<isNotEmpty property="fm_grs_wgt">
			   AND  BL.GRS_WGT BETWEEN #fm_grs_wgt# AND #to_grs_wgt#
			</isNotEmpty>
			<isNotEmpty property="fm_meas">
			   AND  BL.MEAS BETWEEN #fm_meas# AND #to_meas#
			</isNotEmpty>
			<isNotEmpty property="f_po_no">
			   AND  BL.PO_NO LIKE '%' + #f_po_no# + '%'
			</isNotEmpty>
			<isNotEmpty property="f_lc_no">
			   AND  BL.LC_NO = #f_lc_no#
			</isNotEmpty>
			<isNotEmpty property="f_inv_no">
			   AND  BL.INV_NO = #f_inv_no#
			</isNotEmpty>
			<isNotEmpty property="f_lnr_bkg_no">
			   AND  BL.LNR_BKG_NO = #f_lnr_bkg_no#
			</isNotEmpty>
			<isNotEmpty property="f_cust_ref_no">
			   AND  BL.CUST_REF_NO LIKE '%' + #f_cust_ref_no# + '%'
			</isNotEmpty>	
			<isNotEmpty property="f_ams_no">
			   AND  BL.AMS_NO LIKE '%' + #f_ams_no# + '%'
			</isNotEmpty>
			<isNotEmpty property="f_isf_no">
			   AND  BL.ISF_NO LIKE '%' + #f_isf_no# + '%'
			</isNotEmpty>		
			<isNotEmpty property="f_ccn_no">
			   AND  BL.CCN_NO LIKE '%' + #f_ccn_no# + '%'
			</isNotEmpty>			
			<isNotEmpty property="f_fnl_dest_loc_cd">
			   AND  BL.FNL_DEST_LOC_CD = #f_fnl_dest_loc_cd#
			</isNotEmpty>
			<isNotEmpty property="f_fnl_dest_loc_nm">
			   AND  BL.FNL_DEST_LOC_NM LIKE '%' + #f_fnl_dest_loc_nm# + '%'
			</isNotEmpty>
			<isNotEmpty property="f_entr_no">
			   AND  BND.ENTR_NO LIKE '%' + #f_entr_no# + '%'
			</isNotEmpty>	
			<isNotEmpty property="post_strdt">
			   AND  BL.POST_DT BETWEEN #post_strdt# AND #post_enddt#
			</isNotEmpty>					
			<isNotEmpty property="f_sub_bl_no">
			   AND  BL.SUB_BL_NO LIKE '%' + #f_sub_bl_no# + '%'
			</isNotEmpty>
			<isNotEmpty property="opr_usrid">
			    AND  BND.ISSUED_BY = #opr_usrid#
			</isNotEmpty>
	</select>

    <!-- House B/L List select    -->
    <select id="selectIMP_HBL_LIST" parameterClass="java.util.HashMap" resultClass="HBLInfoVO">
        SELECT  TOP $topCnt$
                bl.intg_bl_seq,     bl.biz_clss_cd,     bl.bl_no,         bl.bkg_no,    
                bl.obrd_dt_tm,      bl.etd_dt_tm,       bl.eta_dt_tm, 
                bl.por_cd,          bl.por_nm,          '' AS por_nod_cd,      
                bl.pol_cd,          bl.pol_nm,          bl.pol_nod_cd,
                bl.pod_cd,          bl.pod_nm,          bl.pod_nod_cd,      
                bl.del_cd,          bl.del_nm,          '' AS del_nod_cd,
                bl.fnl_dest_loc_cd, bl.fnl_dest_loc_nm, '' AS fnl_dest_nod_cd,
				(select max(locl_usr_nm) from tb_usr where usrid = bnd.issued_by )  AS proc_usrnm,
				dpt.cd_nm AS proc_dept_nm,
				act.trdp_cd AS act_shpr_trdp_cd,  act.trdp_nm AS act_shpr_trdp_nm,
                shp.trdp_cd AS shpr_trdp_cd,      shp.trdp_nm AS shpr_trdp_nm,
                cne.trdp_cd AS cnee_trdp_cd,      cne.trdp_nm AS cnee_trdp_nm,
                lnr.trdp_cd AS lnr_trdp_cd,       lnr.trdp_nm AS lnr_trdp_nm,
                
                prnr.trdp_cd AS prnr_trdp_cd,     prnr.trdp_nm AS prnr_trdp_nm,
                
				ISNULL(BLCK.BL_STS_CD1, BL.BL_STS_CD) AS BL_STS_CD,                     stp.cd_nm AS bl_sts_label,
				bl.cust_ref_no,
				
				bl.ref_ofc_cd, bl.ref_no, bl.sub_bl_no, bl.post_dt, X.bl_no AS mbl_no,
                bl.trnk_vsl_nm, bl.trnk_voy
        
          FROM  tb_intg_bl bl 
          JOIN  tb_add_info_bnd bnd
            ON   bl.intg_bl_seq = bnd.intg_bl_seq AND bnd.bnd_clss_cd   = #bnd_clss_cd#   AND bnd.delt_flg = 'N'

LEFT OUTER JOIN(SELECT INTG_BL_SEQ AS INTG_BL_SEQ1, BL_STS_CD AS BL_STS_CD1 FROM TB_INTG_BL_BLCK) BLCK 
			ON BL.INTG_BL_SEQ = BLCK.INTG_BL_SEQ1
			
LEFT OUTER JOIN  tb_com_cd_dtl dpt
            ON  dpt.cd_val = bl.dept_cd  AND  dpt.com_cd = 'C056'  AND  dpt.delt_flg = 'N'
		
LEFT OUTER JOIN  tb_com_cd_dtl stp
            ON  stp.cd_val = ISNULL(BLCK.BL_STS_CD1, BL.BL_STS_CD)  AND stp.com_cd = #f_sts_cd_tp# AND stp.delt_flg = 'N'
		
LEFT OUTER JOIN tb_bl_prnr shp
           ON   bl.intg_bl_seq = shp.intg_bl_seq  AND shp.bl_trdp_tp_cd = 'S01' AND shp.delt_flg = 'N'

LEFT OUTER JOIN tb_bl_prnr act
           ON   bl.intg_bl_seq = act.intg_bl_seq  AND act.bl_trdp_tp_cd = 'S02' AND shp.delt_flg = 'N'
                  
LEFT OUTER JOIN tb_bl_prnr cne
           ON   bl.intg_bl_seq = cne.intg_bl_seq  AND cne.bl_trdp_tp_cd = 'C01' AND cne.delt_flg = 'N'

LEFT OUTER JOIN tb_bl_prnr lnr
           ON   bl.intg_bl_seq = lnr.intg_bl_seq  AND lnr.bl_trdp_tp_cd = 'L01' AND lnr.delt_flg = 'N'

LEFT OUTER JOIN tb_bl_prnr prnr
           ON   bl.intg_bl_seq = prnr.intg_bl_seq  AND prnr.bl_trdp_tp_cd = 'P01' AND prnr.delt_flg = 'N'
           
LEFT OUTER JOIN (
				SELECT rlt.intg_bl_seq, mbl.bl_no
				  FROM tb_intg_bl mbl
	   LEFT OUTER JOIN tb_intg_bl_rlt rlt ON rlt.rlt_intg_bl_seq = mbl.intg_Bl_seq AND mbl.delt_flg = 'N'  
) X ON X.intg_bl_seq = bl.intg_Bl_seq        
        
        WHERE   bl.delt_flg = 'N'                 AND bl.air_sea_clss_cd= #air_sea_clss_cd#
          AND bl.biz_clss_cd  = #biz_clss_cd#
    <isNotNull property="f_dpt_cd">
          AND   bl.dept_cd = #f_dpt_cd#
    </isNotNull>
    <isNotNull property="f_ofc_cd">
          AND   bl.ref_ofc_cd = #f_ofc_cd#
    </isNotNull>
    <isNotNull property="f_pic_id">
          AND   bl.modi_usr_nm  = #f_pic_id#
    </isNotNull>
    <isNotNull property="f_hbl_no">
          AND   bl.bl_no  LIKE  '%' + #f_hbl_no# + '%'
    </isNotNull>
    <isNotNull property="f_hbl_tp_cd">
          AND   bl.hbl_tp_cd = #f_hbl_tp_cd#
    </isNotNull>
    <isNotEmpty property="eta_strdt">
          AND   bl.eta_dt_tm BETWEEN #eta_strdt# AND #eta_enddt#
    </isNotEmpty>
    <isNotNull property="f_act_shp_nm">
          AND   act.trdp_nm  LIKE  '%' + #f_act_shp_nm# + '%'
    </isNotNull>
    <isNotNull property="f_pol_cd">
          AND   bl.pol_cd = #f_pol_cd#
    </isNotNull>
    <isNotNull property="f_pod_cd">
          AND   bl.pod_cd = #f_pod_cd#
    </isNotNull>
    <isNotNull property="f_mbl_no">
          AND    bl.intg_bl_seq IN 
               (
                 SELECT  rlt.intg_bl_seq 
                   FROM  tb_intg_bl_rlt rlt
                   JOIN  tb_intg_bl mbl
                     ON  rlt.rlt_intg_bl_seq = mbl.intg_bl_seq
                   JOIN  tb_add_info_bnd bnd
                     ON  mbl.intg_bl_seq = bnd.intg_bl_seq AND bnd.bnd_clss_cd =  #bnd_clss_cd#   
                    AND  bnd.delt_flg = 'N'           
                  WHERE  mbl.bl_no LIKE '%' + #f_mbl_no# + '%'
                  	AND mbl.biz_clss_cd = 'M' 
                    AND  mbl.air_sea_clss_cd = #air_sea_clss_cd#
               )
    </isNotNull>
	<isNotNull property="f_cntr_no">
          AND    bl.intg_bl_seq IN 
                 (
                    SELECT intg_bl_seq 
                      FROM tb_cntr_list
                     WHERE cntr_no LIKE '%'+#f_cntr_no#+'%'
                 )
	</isNotNull>
	<isNotNull property="f_ref_no">
          AND   bl.ref_no LIKE '%' + #f_ref_no# + '%'
    </isNotNull>
        ORDER BY bl.post_dt DESC, bl.obrd_dt_tm DESC, bl.intg_bl_seq DESC
    </select>
    
    <!--  House B/L List select count    -->
    <select id="selectIMP_HBL_LIST_CNT" parameterClass="java.util.HashMap" resultClass="Integer">
        SELECT  COUNT(bl.intg_bl_seq)    
          FROM  tb_intg_bl bl 
          JOIN  tb_add_info_bnd bnd
            ON   bl.intg_bl_seq = bnd.intg_bl_seq AND bnd.bnd_clss_cd   = #bnd_clss_cd#   AND bnd.delt_flg = 'N'

LEFT OUTER JOIN tb_bl_prnr shp
           ON   bl.intg_bl_seq = shp.intg_bl_seq  AND shp.bl_trdp_tp_cd = 'S01' AND shp.delt_flg = 'N'

LEFT OUTER JOIN tb_bl_prnr act
           ON   bl.intg_bl_seq = act.intg_bl_seq  AND act.bl_trdp_tp_cd = 'S02' AND shp.delt_flg = 'N'
                  
LEFT OUTER JOIN tb_bl_prnr cne
           ON   bl.intg_bl_seq = cne.intg_bl_seq  AND cne.bl_trdp_tp_cd = 'C01' AND cne.delt_flg = 'N'

LEFT OUTER JOIN tb_bl_prnr lnr
           ON   bl.intg_bl_seq = lnr.intg_bl_seq  AND lnr.bl_trdp_tp_cd = 'L01' AND lnr.delt_flg = 'N'
        
        WHERE   bl.delt_flg = 'N'                 AND bl.air_sea_clss_cd= #air_sea_clss_cd#
          AND bl.biz_clss_cd  = #biz_clss_cd#
    <isNotNull property="f_dpt_cd">
          AND   bl.dept_cd = #f_dpt_cd#
    </isNotNull>
    <isNotNull property="f_ofc_cd">
          AND   bl.ref_ofc_cd = #f_ofc_cd#
    </isNotNull>
    <isNotNull property="f_pic_id">
          AND   bl.modi_usr_nm  = #f_pic_id#
    </isNotNull>
    <isNotNull property="f_hbl_no">
          AND   bl.bl_no  LIKE  '%' + #f_hbl_no# + '%'
    </isNotNull>
    <isNotNull property="f_hbl_tp_cd">
          AND   bl.hbl_tp_cd = #f_hbl_tp_cd#
    </isNotNull>
    <isNotEmpty property="eta_strdt">
          AND   bl.eta_dt_tm BETWEEN #eta_strdt# AND #eta_enddt#
    </isNotEmpty>
    <isNotNull property="f_act_shp_nm">
          AND   act.trdp_nm  LIKE  '%' + #f_act_shp_nm# + '%'
    </isNotNull>
    <isNotNull property="f_pol_cd">
          AND   bl.pol_cd = #f_pol_cd#
    </isNotNull>
    <isNotNull property="f_pod_cd">
          AND   bl.pod_cd = #f_pod_cd#
    </isNotNull>
    <isNotNull property="f_mbl_no">
          AND    bl.intg_bl_seq IN 
               (
                 SELECT  rlt.intg_bl_seq 
                   FROM  tb_intg_bl_rlt rlt
                   JOIN  tb_intg_bl mbl
                     ON  rlt.rlt_intg_bl_seq = mbl.intg_bl_seq
                   JOIN  tb_add_info_bnd bnd
                     ON  mbl.intg_bl_seq = bnd.intg_bl_seq AND bnd.bnd_clss_cd =  #bnd_clss_cd#   
                    AND  bnd.delt_flg = 'N'
                  WHERE  mbl.bl_no LIKE '%' + #f_mbl_no# + '%'           AND mbl.biz_clss_cd = 'M' 
                    AND  mbl.air_sea_clss_cd = #air_sea_clss_cd#
               )
    </isNotNull>
    <isNotNull property="f_cntr_no">
          AND    bl.intg_bl_seq IN 
                 (
                    SELECT intg_bl_seq 
                      FROM tb_cntr_list
                     WHERE cntr_no LIKE '%'+#f_cntr_no#+'%'
                 )
    </isNotNull>
    <isNotNull property="f_ref_no">
          AND   bl.ref_no LIKE '%' + #f_ref_no# + '%'
    </isNotNull>
    </select>

	
    <!-- Master B/L List select    -->
    <select id="selectMBL_SUB_LIST" parameterClass="java.util.HashMap" resultClass="HBLInfoVO">
        SELECT  bl.intg_bl_seq,     bl.biz_clss_cd,     bl.bl_no,        bl.etd_dt_tm,    bl.eta_dt_tm,    bl.bkg_no,
        		bl.ref_no,    
                bl.por_cd,          bl.por_nm,          '' AS por_nod_cd,   bl.pol_cd,       bl.pol_nm,       bl.pol_nod_cd,
                bl.pod_cd,          bl.pod_nm,          bl.pod_nod_cd,   bl.del_cd,       bl.del_nm,       '' AS del_nod_cd,
                shp.trdp_cd AS shpr_trdp_cd,            shp.trdp_nm AS shpr_trdp_nm,
                lnr.trdp_cd AS lnr_trdp_cd,             lnr.trdp_nm AS lnr_trdp_nm, ISNULL(BLCK.BL_STS_CD1, BL.BL_STS_CD) AS BL_STS_CD
          FROM  tb_intg_bl bl
          JOIN  tb_intg_bl_rlt rlt
            ON  bl.intg_bl_seq = rlt.rlt_intg_bl_seq AND rlt.delt_flg = 'N'
LEFT OUTER JOIN tb_bl_prnr shp
            ON  bl.intg_bl_seq = shp.intg_bl_seq  AND shp.bl_trdp_tp_cd = 'S01' AND shp.delt_flg = 'N'

LEFT OUTER JOIN tb_bl_prnr lnr
            ON  bl.intg_bl_seq = lnr.intg_bl_seq  AND lnr.bl_trdp_tp_cd = 'L01' AND lnr.delt_flg = 'N'
            
LEFT OUTER JOIN(SELECT INTG_BL_SEQ AS INTG_BL_SEQ1, BL_STS_CD AS BL_STS_CD1 FROM TB_INTG_BL_BLCK) BLCK 
			ON BL.INTG_BL_SEQ = BLCK.INTG_BL_SEQ1
			            
         WHERE  rlt.intg_bl_seq = #f_intg_bl_seq#
           AND  bl.DELT_FLG = 'N'
    </select>    
    
    <!-- ZOOT=NoPaging 처리  -->    
    <!-- ZOOT=LIST PAGE AR_AP_DC STAUS PROCESS -->    
    <!-- ZOOT=2015-01-08 NoPaging 처리  -->
    <select id="selectMBL_LIST_NOPAGING" parameterClass="java.util.HashMap" resultClass="com.clt.apps.fis.see.bmd.masterbl.dto.SeeMasterBLVO">
           /* selectMBL_LIST_NOPAGING NEW2 */
            	with blinfo as (
					select a1.* from (
						select 
								ROW_NUMBER() OVER (
							ORDER BY
								BL.POST_DT DESC,
								BL.MODI_TMS DESC) as ROWNUM,
								BL.*
								,ISNULL(bnd.AR_CHK,'X') AS AR_CHK
								,ISNULL(bnd.AP_CHK,'X') AS AP_CHK
								,ISNULL(bnd.DC_CHK,'X') AS DC_CHK
								,ISNULL(bnd.FRT_CHK,'X') AS FRT_CHK
								,bnd.issued_by
						 from 
							TB_INTG_BL BL with(nolock) 
							JOIN  tb_add_info_bnd bnd with(nolock) 
							ON  bl.intg_bl_seq = bnd.intg_bl_seq 
							   AND bnd.bnd_clss_cd = #bnd_clss_cd# 
							<isNotEmpty property="opr_usrid">
					           AND BND.ISSUED_BY = #opr_usrid#
					        </isNotEmpty>		
							<isNotEmpty property="f_ofc_cd">
							   AND  bl.ref_ofc_cd = #f_ofc_cd#
							</isNotEmpty>	
						WHERE  bl.delt_flg = 'N'
						  AND  bl.air_sea_clss_cd = #air_sea_clss_cd#
						  AND  bl.biz_clss_cd  = #biz_clss_cd#					
					) a1   
				<![CDATA[ where a1.ROWNUM > #beginIdx# AND a1.ROWNUM <= #topCnt#	]]>
				)
            	SELECT  
		         			BL.INTG_BL_SEQ,
							BL.BL_NO, BL.REF_NO, BL.REF_OFC_CD, BL.LNR_BKG_NO,
							BL.ETD_DT_TM, BL.ETA_DT_TM, BL.F_ETA_DT_TM,
							BL.POR_CD, BL.POR_NM, 
							BL.POL_CD, BL.POL_NM, 
							BL.POD_CD, BL.POD_NM, 
							BL.DEL_CD, BL.DEL_NM,
							(SELECT MAX(X.CNTR_NO) FROM TB_CNTR_LIST X WHERE X.INTG_BL_SEQ = BL.INTG_BL_SEQ AND X.DELT_FLG = 'N') AS CNTR_NO,
							(SELECT COUNT(X.CNTR_NO)-1 FROM TB_CNTR_LIST X WHERE X.INTG_BL_SEQ = BL.INTG_BL_SEQ AND X.DELT_FLG = 'N') AS CNTR_CNT,
							PRNR2.TRDP_CD AS PRNR_TRDP_CD2, PRNR2.TRDP_NM AS PRNR_TRDP_NM2,
							SHPR.TRDP_CD AS SHPR_TRDP_CD, SHPR.TRDP_NM AS SHPR_TRDP_NM,
							CNEE.TRDP_CD AS CNEE_TRDP_CD, CNEE.TRDP_NM AS CNEE_TRDP_NM,
							LNR.TRDP_CD AS LNR_TRDP_CD, LNR.TRDP_NM AS LNR_TRDP_NM,
							CARR.TRDP_CD AS CARR_TRDP_CD, CARR.TRDP_NM AS CARR_TRDP_NM,
							BL.CY_TRDP_CD, CY.ENG_NM AS CY_TRDP_NM,
							BL.CFS_TRDP_CD, CFS.ENG_NM AS CFS_TRDP_NM,
							BL.HBL_TP_CD, BL.SHP_MOD_CD, BL.INCO_CD, BL.RGST_USRID, BL.REP_CMDT_NM,
							BL.CUST_REF_NO,
							(SELECT x.cnt_cd FROM TB_OFC x WHERE x.OFC_CD = bl.rgst_ofc_cd) AS BL_CNT, 
							(SELECT MAX(X.LOCL_USR_NM) FROM TB_USR X WHERE X.USR_TP = 'I' AND X.USRID = bl.issued_by) AS PROC_USRNM,
							BL.POST_DT, BL.TRNK_VSL_NM, BL.TRNK_VOY,
							(  SELECT COUNT(*) FROM TB_INTG_BL_RLT RLT WHERE  RLT.RLT_INTG_BL_SEQ = BL.INTG_BL_SEQ AND RLT.DELT_FLG = 'N') AS HBL_CNT,    	
							ISNULL(DBO.FC_MK_MEMO_SCRIPT(BL.INTG_BL_SEQ), '') AS MEMO,
							AMS_ID
							, BL.RLSD_FLG, BL.RLSD_DT_TM , ISNULL(BLCK.BL_STS_CD1, BL.BL_STS_CD) AS BL_STS_CD
	    					,BL.CCN_NO
							,BL.CCN_DT
							,BL.PRE_CCN_NO
							,BL.MNF_FR_LOC
							,BL.MNF_TO_LOC
							,BL.IMP_REF_NO
							,BL.MODI_TMS	
							,ISNULL(BL.AR_CHK,'X') AS AR_CHK
							,ISNULL(BL.AP_CHK,'X') AS AP_CHK
							,ISNULL(BL.DC_CHK,'X') AS DC_CHK       						
							,ISNULL(BL.FRT_CHK,'X') AS FRT_CHK       						
					  FROM  blinfo BL with(nolock)					
		   LEFT OUTER JOIN  tb_bl_prnr PRNR2 with(nolock) 
						ON  bl.intg_bl_seq = prnr2.intg_bl_seq  AND prnr2.bl_trdp_tp_cd = 'P03' AND prnr2.delt_flg = 'N'
		   LEFT OUTER JOIN  tb_bl_prnr SHPR with(nolock) 
						ON  bl.intg_bl_seq = SHPR.intg_bl_seq  AND SHPR.bl_trdp_tp_cd = 'S01' AND SHPR.delt_flg = 'N'
		   LEFT OUTER JOIN  tb_bl_prnr CNEE with(nolock) 
						ON  bl.intg_bl_seq = CNEE.intg_bl_seq  AND CNEE.bl_trdp_tp_cd = 'C01' AND CNEE.delt_flg = 'N'
		   LEFT OUTER JOIN  tb_bl_prnr CARR with(nolock) 
						ON  bl.intg_bl_seq = carr.intg_bl_seq  AND carr.bl_trdp_tp_cd = 'B01' AND carr.delt_flg = 'N'
		   LEFT OUTER JOIN  tb_bl_prnr LNR with(nolock) 
						ON  bl.intg_bl_seq = lnr.intg_bl_seq  AND lnr.bl_trdp_tp_cd = 'L01' AND lnr.delt_flg = 'N'
		   LEFT OUTER JOIN  tb_trdp CY with(nolock) 
						ON  bl.cy_trdp_cd = cy.trdp_cd  AND cy.delt_flg = 'N'
		   LEFT OUTER JOIN  tb_trdp CFS with(nolock) 
						ON  bl.cfs_trdp_cd = cfs.trdp_cd  AND cfs.delt_flg = 'N' 
		   LEFT OUTER JOIN(SELECT INTG_BL_SEQ AS INTG_BL_SEQ1, BL_STS_CD AS BL_STS_CD1 FROM TB_INTG_BL_BLCK) BLCK 
		   				ON BL.INTG_BL_SEQ = BLCK.INTG_BL_SEQ1		             
					 WHERE  bl.delt_flg = 'N'
					   AND  bl.air_sea_clss_cd = #air_sea_clss_cd#
					   AND  bl.biz_clss_cd  = #biz_clss_cd#					
	 			    ORDER BY  BL.POST_DT DESC, BL.MODI_TMS DESC        
    </select>
    
    <!-- Master B/L List select    -->
    <!-- ZOOT -->
    <select id="selectMBL_LIST_BACKUP" parameterClass="java.util.HashMap" resultClass="com.clt.apps.fis.see.bmd.masterbl.dto.SeeMasterBLVO">        
           /* selectMBL_LIST NEW IN/OUT */
            SELECT T1.*,
			<![CDATA[ 
			    CASE WHEN ISNULL(inv_sum.ar_cnt, 0)  = 0 THEN 'X'
                     WHEN inv_sum.ar_bal_amt = 0 THEN 'Y'
                     WHEN inv_sum.ar_inv_sum_amt = inv_sum.ar_bal_amt THEN 'N'
                     WHEN inv_sum.ar_bal_amt < 0 THEN 'O'   
                     ELSE 'P'
                END AS AR_CHK,
                CASE WHEN ISNULL(inv_sum.ap_cnt, 0)  = 0 THEN 'X'
                     WHEN inv_sum.ap_bal_amt = 0 THEN 'Y'
                     WHEN inv_sum.ap_inv_sum_amt = inv_sum.ap_bal_amt THEN 'N'
                     WHEN inv_sum.ap_bal_amt < 0 THEN 'O'   
                     ELSE 'P'
                END AS AP_CHK,
                CASE WHEN ISNULL(inv_sum.dc_cnt, 0)  = 0 THEN 'X'
                     WHEN inv_sum.dc_bal_amt = 0 THEN 'Y'
                     WHEN inv_sum.dc_inv_sum_amt = inv_sum.dc_bal_amt THEN 'N'
                     WHEN inv_sum.dc_bal_amt < 0 THEN 'O'   
                     ELSE 'P'
                END AS DC_CHK
    		]]> 
			FROM 
			(
	            SELECT a1.*
				  FROM (
		         	SELECT  ROW_NUMBER() OVER (ORDER BY  BL.POST_DT DESC, BL.MODI_TMS DESC) as ROWNUM,
		         			BL.INTG_BL_SEQ,
							BL.BL_NO, BL.REF_NO, BL.REF_OFC_CD, BL.LNR_BKG_NO,
							BL.ETD_DT_TM, BL.ETA_DT_TM, BL.F_ETA_DT_TM,
							BL.POR_CD, BL.POR_NM, 
							BL.POL_CD, BL.POL_NM, 
							BL.POD_CD, BL.POD_NM, 
							BL.DEL_CD, BL.DEL_NM,
		
							(SELECT MAX(X.CNTR_NO) FROM TB_CNTR_LIST X WHERE X.INTG_BL_SEQ = BL.INTG_BL_SEQ AND X.DELT_FLG = 'N') AS CNTR_NO,
		
							PRNR2.TRDP_CD AS PRNR_TRDP_CD2, PRNR2.TRDP_NM AS PRNR_TRDP_NM2,
							SHPR.TRDP_CD AS SHPR_TRDP_CD, SHPR.TRDP_NM AS SHPR_TRDP_NM,
							CNEE.TRDP_CD AS CNEE_TRDP_CD, CNEE.TRDP_NM AS CNEE_TRDP_NM,
							LNR.TRDP_CD AS LNR_TRDP_CD, LNR.TRDP_NM AS LNR_TRDP_NM,
							CARR.TRDP_CD AS CARR_TRDP_CD, CARR.TRDP_NM AS CARR_TRDP_NM,
							BL.CY_TRDP_CD, CY.ENG_NM AS CY_TRDP_NM,
							BL.CFS_TRDP_CD, CFS.ENG_NM AS CFS_TRDP_NM,
							BL.HBL_TP_CD, BL.SHP_MOD_CD, BL.INCO_CD, BL.RGST_USRID, BL.REP_CMDT_NM,
							BL.CUST_REF_NO,
							(SELECT x.cnt_cd FROM TB_OFC x WHERE x.OFC_CD = bl.rgst_ofc_cd) AS BL_CNT, 
							(SELECT MAX(X.LOCL_USR_NM) FROM TB_USR X WHERE X.USR_TP = 'I' AND X.USRID = bnd.issued_by) AS PROC_USRNM,
							BL.POST_DT, BL.TRNK_VSL_NM, BL.TRNK_VOY,
							(  SELECT COUNT(*) FROM TB_INTG_BL_RLT RLT WHERE  RLT.RLT_INTG_BL_SEQ = BL.INTG_BL_SEQ AND RLT.DELT_FLG = 'N') AS HBL_CNT,    
							ISNULL(DBO.FC_MK_MEMO_SCRIPT(BL.INTG_BL_SEQ), '') AS MEMO,
							AMS_ID
							, BL.RLSD_FLG, BL.RLSD_DT_TM , ISNULL(BLCK.BL_STS_CD1, BL.BL_STS_CD) AS BL_STS_CD
	    					,BL.CCN_NO
							,BL.CCN_DT
							,BL.PRE_CCN_NO
							,BL.MNF_FR_LOC
							,BL.MNF_TO_LOC
							,BL.IMP_REF_NO
					  FROM  TB_INTG_BL BL
					  <isEqual property="bnd_clss_cd" compareValue="O">
							with(index(IDX_ETD_DT_TM), nolock)
					  </isEqual>     
					  <isEqual property="bnd_clss_cd" compareValue="I">
							with(index(IDX_ETA_DT_TM), nolock)
					  </isEqual>  
					  JOIN  tb_add_info_bnd bnd
						ON  bl.intg_bl_seq = bnd.intg_bl_seq AND bnd.bnd_clss_cd = #bnd_clss_cd# AND bnd.delt_flg = 'N'
		   LEFT OUTER JOIN  tb_bl_prnr PRNR2
						ON  bl.intg_bl_seq = prnr2.intg_bl_seq  AND prnr2.bl_trdp_tp_cd = 'P03' AND prnr2.delt_flg = 'N'
		   LEFT OUTER JOIN  tb_bl_prnr SHPR
						ON  bl.intg_bl_seq = SHPR.intg_bl_seq  AND SHPR.bl_trdp_tp_cd = 'S01' AND SHPR.delt_flg = 'N'
		   LEFT OUTER JOIN  tb_bl_prnr CNEE
						ON  bl.intg_bl_seq = CNEE.intg_bl_seq  AND CNEE.bl_trdp_tp_cd = 'C01' AND CNEE.delt_flg = 'N'
		   LEFT OUTER JOIN  tb_bl_prnr CARR
						ON  bl.intg_bl_seq = carr.intg_bl_seq  AND carr.bl_trdp_tp_cd = 'B01' AND carr.delt_flg = 'N'
		   LEFT OUTER JOIN  tb_bl_prnr LNR
						ON  bl.intg_bl_seq = lnr.intg_bl_seq  AND lnr.bl_trdp_tp_cd = 'L01' AND lnr.delt_flg = 'N'
		   LEFT OUTER JOIN  tb_trdp CY
						ON  bl.cy_trdp_cd = cy.trdp_cd  AND cy.delt_flg = 'N'
		   LEFT OUTER JOIN  tb_trdp CFS
						ON  bl.cfs_trdp_cd = cfs.trdp_cd  AND cfs.delt_flg = 'N'   
		   LEFT OUTER JOIN(SELECT INTG_BL_SEQ AS INTG_BL_SEQ1, BL_STS_CD AS BL_STS_CD1 FROM TB_INTG_BL_BLCK) BLCK 
		   				ON BL.INTG_BL_SEQ = BLCK.INTG_BL_SEQ1
					 WHERE  bl.delt_flg = 'N'
					   AND  bl.air_sea_clss_cd = #air_sea_clss_cd#
					   AND  bl.biz_clss_cd  = #biz_clss_cd#
					<isNotEmpty property="f_ref_no">
					   AND  BL.REF_NO LIKE '%' + #f_ref_no# + '%'
					</isNotEmpty>
					<isNotEmpty property="f_mbl_no">
					   AND  BL.BL_NO LIKE '%' + #f_mbl_no# + '%'
					</isNotEmpty>
					<isNotEmpty property="f_lnr_bkg_no">
					   AND  BL.LNR_BKG_NO LIKE '%' + #f_lnr_bkg_no# + '%'
					</isNotEmpty>
					<isNotEmpty property="f_cntr_no">
					   AND  BL.INTG_BL_SEQ IN (SELECT  CNTR.INTG_BL_SEQ
												 FROM  TB_CNTR_LIST CNTR
												WHERE  CNTR.CNTR_NO LIKE '%' + #f_cntr_no# + '%')
					</isNotEmpty>
					<isNotEmpty property="etd_strdt">
					   AND  BL.ETD_DT_TM BETWEEN #etd_strdt# AND #etd_enddt#
					</isNotEmpty>
					<isNotEmpty property="eta_strdt">
					   AND  BL.ETA_DT_TM BETWEEN #eta_strdt# AND #eta_enddt#
					</isNotEmpty>
					<isNotEmpty property="f_eta_strdt">
					   AND  BL.F_ETA_DT_TM BETWEEN #f_eta_strdt# AND #f_eta_enddt#
					</isNotEmpty>
					<isNotEmpty property="f_pol_cd">
					   AND  BL.POL_CD = #f_pol_cd#
					</isNotEmpty>
					<isNotEmpty property="f_pol_nm">
					   AND  BL.POL_NM LIKE '%' + #f_pol_nm# + '%'
					</isNotEmpty>
					<isNotEmpty property="f_pod_cd">
					   AND  BL.POD_CD = #f_pod_cd#
					</isNotEmpty>
					<isNotEmpty property="f_pod_nm">
					   AND  BL.POD_NM LIKE '%' + #f_pod_nm# + '%'
					</isNotEmpty>
					<isNotEmpty property="f_del_cd">
					   AND  BL.DEL_CD = #f_del_cd#
					</isNotEmpty>
					<isNotEmpty property="f_del_nm">
					   AND  BL.DEL_NM LIKE '%' + #f_del_nm# + '%'
					</isNotEmpty>
					<isNotEmpty property="f_prnr_trdp_nm2">
					   AND  PRNR2.TRDP_NM LIKE '%' + #f_prnr_trdp_nm2# + '%'
					</isNotEmpty>
					<isNotEmpty property="f_shpr_trdp_nm">
					   AND  SHPR.TRDP_NM LIKE '%' + #f_shpr_trdp_nm# + '%'
					</isNotEmpty>
					<isNotEmpty property="f_cnee_trdp_nm">
					   AND  CNEE.TRDP_NM LIKE '%' + #f_cnee_trdp_nm# + '%'
					</isNotEmpty>
					<isNotEmpty property="f_carr_trdp_nm">
					   AND  LNR.TRDP_NM LIKE '%' + #f_carr_trdp_nm# + '%'
					</isNotEmpty>
					<isNotEmpty property="f_cy_trdp_nm">
					   AND  CY.ENG_NM LIKE '%' + #f_cy_trdp_nm# + '%'
					</isNotEmpty>
					<isNotEmpty property="f_cfs_trdp_nm">
					   AND  CFS.ENG_NM LIKE '%' + #f_cfs_trdp_nm# + '%'
					</isNotEmpty>
					<isNotEmpty property="f_hbl_tp_cd">
					   AND  BL.HBL_TP_CD = #f_hbl_tp_cd#
					</isNotEmpty>
					<isNotEmpty property="f_ofc_cd">
					   AND  BL.REF_OFC_CD = #f_ofc_cd#
					</isNotEmpty>
					<isNotEmpty property="f_shp_mod_cd">
					   AND  BL.SHP_MOD_CD = #f_shp_mod_cd#
					</isNotEmpty>
					<isNotEmpty property="f_pic_id">
					   AND  BL.RGST_USRID LIKE '%' + #f_pic_id# + '%'
					</isNotEmpty>
					<isNotEmpty property="f_trnk_vsl_nm">
					   AND  BL.TRNK_VSL_NM LIKE '%' + #f_trnk_vsl_nm# + '%'
					</isNotEmpty>
					<isNotEmpty property="f_imp_ref_no">
					   AND  BL.IMP_REF_NO LIKE '%' + #f_imp_ref_no# + '%'
					</isNotEmpty>				
					<isNotEmpty property="f_ccn_no">
					   AND  BL.CCN_NO LIKE '%' + #f_ccn_no# + '%'
					</isNotEmpty>				
	<!--			  ORDER BY  BL.RGST_TMS DESC  -->
			  ) a1
	<![CDATA[ where a1.ROWNUM > #beginIdx# AND a1.ROWNUM <= #topCnt#	]]>
			) T1 
			LEFT OUTER JOIN (SELECT frt.intg_bl_seq ,
		             SUM(CASE WHEN frt.sell_buy_tp_cd = 'S'
							  THEN 1
							  ELSE 0
						 END) AS ar_cnt,
					 SUM(CASE WHEN frt.sell_buy_tp_cd = 'S'
							  THEN dtl.inv_sum_amt
							  ELSE 0
						 END) AS ar_inv_sum_amt,
					 SUM(CASE WHEN frt.sell_buy_tp_cd = 'S'
							  THEN dtl.bal_amt
							  ELSE 0
						 END) AS ar_bal_amt,
					 SUM(CASE WHEN frt.sell_buy_tp_cd = 'B'
							  THEN 1
							  ELSE 0
						 END) AS ap_cnt,	 
					 SUM(CASE WHEN frt.sell_buy_tp_cd = 'B'
							  THEN dtl.inv_sum_amt
							  ELSE 0
						 END) AS ap_inv_sum_amt,
					 SUM(CASE WHEN frt.sell_buy_tp_cd = 'B'
							  THEN dtl.bal_amt
							  ELSE 0
						 END) AS ap_bal_amt,
					 SUM(CASE WHEN frt.sell_buy_tp_cd = 'D' OR frt.sell_buy_tp_cd = 'C'
							  THEN 1
							  ELSE 0
						 END) AS dc_cnt,	 
					 SUM(CASE WHEN frt.sell_buy_tp_cd = 'D' OR frt.sell_buy_tp_cd = 'C'
							  THEN dtl.inv_sum_amt
							  ELSE 0
						 END) AS dc_inv_sum_amt,
					 SUM(CASE WHEN frt.sell_buy_tp_cd = 'D' OR frt.sell_buy_tp_cd = 'C'
							  THEN dtl.bal_amt
							  ELSE 0
						 END) AS dc_bal_amt
					FROM TB_INTG_BL A 
					<isEqual property="bnd_clss_cd" compareValue="O">
						with(index(IDX_ETD_DT_TM), nolock)
				   </isEqual>     
				   <isEqual property="bnd_clss_cd" compareValue="I">
						with(index(IDX_ETA_DT_TM), nolock)
				   </isEqual>  
					  	
						  JOIN tb_add_info_bnd bnd ON A.intg_bl_seq = bnd.intg_bl_seq AND bnd.bnd_clss_cd = #bnd_clss_cd# AND bnd.delt_flg = 'N'
			   			  JOIN TB_FRT frt ON A.intg_bl_seq = frt.intg_bl_seq 
			   			  JOIN TB_INV_DTL dtl with(index(XIF1TB_INV_DTL), nolock)
			   			    ON dtl.delt_flg = 'N' AND frt.inv_seq = dtl.inv_seq 
						 WHERE  frt.delt_flg = 'N'
						<isNotEmpty property="etd_strdt">  
						   AND A.ETD_DT_TM BETWEEN #etd_strdt# AND #etd_enddt#
						</isNotEmpty>
						<isNotEmpty property="eta_strdt">
						   AND A.ETA_DT_TM BETWEEN #eta_strdt# AND #eta_enddt#
						</isNotEmpty>	
						<isNotEmpty property="f_ofc_cd">
						   AND  A.REF_OFC_CD = #f_ofc_cd#
					    </isNotEmpty>					   
						   AND A.delt_flg = 'N'
						   AND A.air_sea_clss_cd = #air_sea_clss_cd#
						   AND A.biz_clss_cd = #biz_clss_cd#                						 
						 GROUP BY frt.intg_bl_seq
						) inv_sum 
			ON T1.intg_bl_seq = inv_sum.intg_bl_seq 
    </select>
    <!-- ZOOT=LIST PAGE AR_AP_DC STAUS PROCESS -->
    <select id="selectMBL_LIST" parameterClass="java.util.HashMap" resultClass="com.clt.apps.fis.see.bmd.masterbl.dto.SeeMasterBLVO">        
           /* selectMBL_LIST NEW IN/OUT */
	            SELECT a1.*
				  FROM (
		         	SELECT  ROW_NUMBER() OVER (ORDER BY  BL.POST_DT DESC, BL.MODI_TMS DESC) as ROWNUM,
		         			BL.INTG_BL_SEQ,
							BL.BL_NO, BL.REF_NO, BL.REF_OFC_CD, BL.LNR_BKG_NO,
							BL.ETD_DT_TM, BL.ETA_DT_TM, BL.F_ETA_DT_TM,
							BL.POR_CD, BL.POR_NM, 
							BL.POL_CD, BL.POL_NM, 
							BL.POD_CD, BL.POD_NM, 
							BL.DEL_CD, BL.DEL_NM,
		
							(SELECT MAX(X.CNTR_NO) FROM TB_CNTR_LIST X WHERE X.INTG_BL_SEQ = BL.INTG_BL_SEQ AND X.DELT_FLG = 'N') AS CNTR_NO,
							(SELECT COUNT(X.CNTR_NO)-1 FROM TB_CNTR_LIST X WHERE X.INTG_BL_SEQ = BL.INTG_BL_SEQ AND X.DELT_FLG = 'N') AS CNTR_CNT,
							PRNR2.TRDP_CD AS PRNR_TRDP_CD2, PRNR2.TRDP_NM AS PRNR_TRDP_NM2,
							SHPR.TRDP_CD AS SHPR_TRDP_CD, SHPR.TRDP_NM AS SHPR_TRDP_NM,
							CNEE.TRDP_CD AS CNEE_TRDP_CD, CNEE.TRDP_NM AS CNEE_TRDP_NM,
							LNR.TRDP_CD AS LNR_TRDP_CD, LNR.TRDP_NM AS LNR_TRDP_NM,
							CARR.TRDP_CD AS CARR_TRDP_CD, CARR.TRDP_NM AS CARR_TRDP_NM,
							BL.CY_TRDP_CD, CY.ENG_NM AS CY_TRDP_NM,
							BL.CFS_TRDP_CD, CFS.ENG_NM AS CFS_TRDP_NM,
							BL.HBL_TP_CD, BL.SHP_MOD_CD, BL.INCO_CD, BL.RGST_USRID, BL.REP_CMDT_NM,
							BL.CUST_REF_NO,
							(SELECT x.cnt_cd FROM TB_OFC x WHERE x.OFC_CD = bl.rgst_ofc_cd) AS BL_CNT, 
							(SELECT MAX(X.LOCL_USR_NM) FROM TB_USR X WHERE X.USR_TP = 'I' AND X.USRID = bnd.issued_by) AS PROC_USRNM,
							BL.POST_DT, BL.TRNK_VSL_NM, BL.TRNK_VOY,
							(  SELECT COUNT(*) FROM TB_INTG_BL_RLT RLT WHERE  RLT.RLT_INTG_BL_SEQ = BL.INTG_BL_SEQ AND RLT.DELT_FLG = 'N') AS HBL_CNT,    
							ISNULL(DBO.FC_MK_MEMO_SCRIPT(BL.INTG_BL_SEQ), '') AS MEMO,
							AMS_ID
							, BL.RLSD_FLG, BL.RLSD_DT_TM , ISNULL(BLCK.BL_STS_CD1, BL.BL_STS_CD) AS BL_STS_CD
	    					,BL.CCN_NO
							,BL.CCN_DT
							,BL.PRE_CCN_NO
							,BL.MNF_FR_LOC
							,BL.MNF_TO_LOC
							,BL.IMP_REF_NO
							,ISNULL(bnd.AR_CHK,'X') AS AR_CHK
							,ISNULL(bnd.AP_CHK,'X') AS AP_CHK
							,ISNULL(bnd.DC_CHK,'X') AS DC_CHK
							,ISNULL(bnd.FRT_CHK,'X') AS FRT_CHK
					  FROM  TB_INTG_BL BL
					  <isEqual property="bnd_clss_cd" compareValue="O">
							with(index(IDX_ETD_DT_TM), nolock)
					  </isEqual>     
					  <isEqual property="bnd_clss_cd" compareValue="I">
							with(index(IDX_ETA_DT_TM), nolock)
					  </isEqual>  
					  JOIN  tb_add_info_bnd bnd
						ON  bl.intg_bl_seq = bnd.intg_bl_seq AND bnd.bnd_clss_cd = #bnd_clss_cd# AND bnd.delt_flg = 'N'
		   LEFT OUTER JOIN  tb_bl_prnr PRNR2
						ON  bl.intg_bl_seq = prnr2.intg_bl_seq  AND prnr2.bl_trdp_tp_cd = 'P03' AND prnr2.delt_flg = 'N'
		   LEFT OUTER JOIN  tb_bl_prnr SHPR
						ON  bl.intg_bl_seq = SHPR.intg_bl_seq  AND SHPR.bl_trdp_tp_cd = 'S01' AND SHPR.delt_flg = 'N'
		   LEFT OUTER JOIN  tb_bl_prnr CNEE
						ON  bl.intg_bl_seq = CNEE.intg_bl_seq  AND CNEE.bl_trdp_tp_cd = 'C01' AND CNEE.delt_flg = 'N'
		   LEFT OUTER JOIN  tb_bl_prnr CARR
						ON  bl.intg_bl_seq = carr.intg_bl_seq  AND carr.bl_trdp_tp_cd = 'B01' AND carr.delt_flg = 'N'
		   LEFT OUTER JOIN  tb_bl_prnr LNR
						ON  bl.intg_bl_seq = lnr.intg_bl_seq  AND lnr.bl_trdp_tp_cd = 'L01' AND lnr.delt_flg = 'N'
		   LEFT OUTER JOIN  tb_trdp CY
						ON  bl.cy_trdp_cd = cy.trdp_cd  AND cy.delt_flg = 'N'
		   LEFT OUTER JOIN  tb_trdp CFS
						ON  bl.cfs_trdp_cd = cfs.trdp_cd  AND cfs.delt_flg = 'N'  
		   LEFT OUTER JOIN(SELECT INTG_BL_SEQ AS INTG_BL_SEQ1, BL_STS_CD AS BL_STS_CD1 FROM TB_INTG_BL_BLCK) BLCK 
		   				ON BL.INTG_BL_SEQ = BLCK.INTG_BL_SEQ1		            
					 WHERE  bl.delt_flg = 'N'
					   AND  bl.air_sea_clss_cd = #air_sea_clss_cd#
					   AND  bl.biz_clss_cd  = #biz_clss_cd#
					<isNotEmpty property="f_ref_no">
					   AND  BL.REF_NO LIKE '%' + #f_ref_no# + '%'
					</isNotEmpty>
					<isNotEmpty property="f_mbl_no">
					   AND  BL.BL_NO LIKE '%' + #f_mbl_no# + '%'
					</isNotEmpty>
					<isNotEmpty property="f_lnr_bkg_no">
					   AND  BL.LNR_BKG_NO LIKE '%' + #f_lnr_bkg_no# + '%'
					</isNotEmpty>
					<isNotEmpty property="f_cntr_no">
					   AND  BL.INTG_BL_SEQ IN (SELECT  CNTR.INTG_BL_SEQ
												 FROM  TB_CNTR_LIST CNTR
												WHERE  CNTR.CNTR_NO LIKE '%' + #f_cntr_no# + '%')
					</isNotEmpty>
					<isNotEmpty property="etd_strdt">
					   AND  BL.ETD_DT_TM BETWEEN #etd_strdt# AND #etd_enddt#
					</isNotEmpty>
					<isNotEmpty property="eta_strdt">
					   AND  BL.ETA_DT_TM BETWEEN #eta_strdt# AND #eta_enddt#
					</isNotEmpty>
					<isNotEmpty property="f_eta_strdt">
					   AND  BL.F_ETA_DT_TM BETWEEN #f_eta_strdt# AND #f_eta_enddt#
					</isNotEmpty>
					<isNotEmpty property="f_pol_cd">
					   AND  BL.POL_CD = #f_pol_cd#
					</isNotEmpty>
					<isNotEmpty property="f_pol_nm">
					   AND  BL.POL_NM LIKE '%' + #f_pol_nm# + '%'
					</isNotEmpty>
					<isNotEmpty property="f_por_cd">
					   AND  BL.POR_CD = #f_por_cd#
					</isNotEmpty>
					<isNotEmpty property="f_por_nm">
					   AND  BL.POR_NM LIKE '%' + #f_por_nm# + '%'
					</isNotEmpty>
					<isNotEmpty property="f_pod_cd">
					   AND  BL.POD_CD = #f_pod_cd#
					</isNotEmpty>
					<isNotEmpty property="f_pod_nm">
					   AND  BL.POD_NM LIKE '%' + #f_pod_nm# + '%'
					</isNotEmpty>
					<isNotEmpty property="f_del_cd">
					   AND  BL.DEL_CD = #f_del_cd#
					</isNotEmpty>
					<isNotEmpty property="f_del_nm">
					   AND  BL.DEL_NM LIKE '%' + #f_del_nm# + '%'
					</isNotEmpty>
					<isNotEmpty property="f_prnr_trdp_nm2">
					   AND  PRNR2.TRDP_NM LIKE '%' + #f_prnr_trdp_nm2# + '%'
					</isNotEmpty>
					<isNotEmpty property="f_shpr_trdp_nm">
					   AND  SHPR.TRDP_NM LIKE '%' + #f_shpr_trdp_nm# + '%'
					</isNotEmpty>
					<isNotEmpty property="f_cnee_trdp_nm">
					   AND  CNEE.TRDP_NM LIKE '%' + #f_cnee_trdp_nm# + '%'
					</isNotEmpty>
					<isNotEmpty property="f_carr_trdp_nm">
					   AND  LNR.TRDP_NM LIKE '%' + #f_carr_trdp_nm# + '%'
					</isNotEmpty>
					<isNotEmpty property="f_cy_trdp_nm">
					   AND  CY.ENG_NM LIKE '%' + #f_cy_trdp_nm# + '%'
					</isNotEmpty>
					<isNotEmpty property="f_cfs_trdp_nm">
					   AND  CFS.ENG_NM LIKE '%' + #f_cfs_trdp_nm# + '%'
					</isNotEmpty>
					<isNotEmpty property="f_hbl_tp_cd">
					   AND  BL.HBL_TP_CD = #f_hbl_tp_cd#
					</isNotEmpty>
					<isNotEmpty property="f_ofc_cd">
					   AND  BL.REF_OFC_CD = #f_ofc_cd#
					</isNotEmpty>
					<isNotEmpty property="f_shp_mod_cd">
					   AND  BL.SHP_MOD_CD = #f_shp_mod_cd#
					</isNotEmpty>
					<isNotEmpty property="f_pic_id">
					   AND  BL.RGST_USRID LIKE '%' + #f_pic_id# + '%'
					</isNotEmpty>
					<isNotEmpty property="f_trnk_vsl_nm">
					   AND  BL.TRNK_VSL_NM LIKE '%' + #f_trnk_vsl_nm# + '%'
					</isNotEmpty>
					<isNotEmpty property="f_imp_ref_no">
					   AND  BL.IMP_REF_NO LIKE '%' + #f_imp_ref_no# + '%'
					</isNotEmpty>				
					<isNotEmpty property="f_ccn_no">
					   AND  BL.CCN_NO LIKE '%' + #f_ccn_no# + '%'
					</isNotEmpty>				
					<isNotEmpty property="post_strdt">
					   AND  BL.POST_DT BETWEEN #post_strdt# AND #post_enddt#
					</isNotEmpty>
					<isNotEmpty property="opr_usrid">
					   AND  BND.ISSUED_BY = #opr_usrid#
					</isNotEmpty>
					
					
	<!--			  ORDER BY  BL.RGST_TMS DESC  -->
			  ) a1
	<![CDATA[ where a1.ROWNUM > #beginIdx# AND a1.ROWNUM <= #topCnt#	]]>			
    </select>

	<!-- Master B/L List select  (H/BL로 검색했을 경우)  -->
	<!-- #29408 [BINEX]B/L List 검색조건 추가 -->
     <!-- ZOOT=LIST PAGE AR_AP_DC STAUS PROCESS -->
    <select id="selectMHBL_LIST" parameterClass="java.util.HashMap" resultClass="com.clt.apps.fis.see.bmd.masterbl.dto.SeeMasterBLVO">
           /* selectMHBL_LIST */
            SELECT a1.*
			  FROM (
	         	SELECT  ROW_NUMBER() OVER (ORDER BY  BL.POST_DT DESC, BL.MODI_TMS DESC) as ROWNUM,
	         			BL.INTG_BL_SEQ,
						BL.BL_NO, 
						(SELECT TOP 1
                    		XBL.BL_NO      
               			 FROM
                    		TB_INTG_BL XBL 
		                WHERE
		                    XBL.INTG_BL_SEQ IN (SELECT
		                        INTG_BL_SEQ 
		                    FROM
		                        TB_INTG_BL_RLT RLT 
		                    WHERE
		                        RLT.RLT_INTG_BL_SEQ = BL.INTG_BL_SEQ
								AND XBL.delt_flg = 'N'          
								AND XBL.air_sea_clss_cd =  #air_sea_clss_cd#         
								AND XBL.biz_clss_cd  =  #biz_clss_cd#         
								AND XBL.BL_NO LIKE '%' +  #f_mbl_no# + '%'  
		                        AND RLT.DELT_FLG = 'N')) AS HBL_NO,
						BL.REF_NO, BL.REF_OFC_CD, BL.LNR_BKG_NO,
						BL.ETD_DT_TM, BL.ETA_DT_TM, BL.F_ETA_DT_TM,
						BL.POR_CD, BL.POR_NM, 
						BL.POL_CD, BL.POL_NM, 
						BL.POD_CD, BL.POD_NM, 
						BL.DEL_CD, BL.DEL_NM,
	
						(SELECT MAX(X.CNTR_NO) FROM TB_CNTR_LIST X WHERE X.INTG_BL_SEQ = BL.INTG_BL_SEQ AND X.DELT_FLG = 'N') AS CNTR_NO,
						(SELECT COUNT(X.CNTR_NO)-1 FROM TB_CNTR_LIST X WHERE X.INTG_BL_SEQ = BL.INTG_BL_SEQ AND X.DELT_FLG = 'N') AS CNTR_CNT,
	
						PRNR2.TRDP_CD AS PRNR_TRDP_CD2, PRNR2.TRDP_NM AS PRNR_TRDP_NM2,
						SHPR.TRDP_CD AS SHPR_TRDP_CD, SHPR.TRDP_NM AS SHPR_TRDP_NM,
						CNEE.TRDP_CD AS CNEE_TRDP_CD, CNEE.TRDP_NM AS CNEE_TRDP_NM,
						LNR.TRDP_CD AS LNR_TRDP_CD, LNR.TRDP_NM AS LNR_TRDP_NM,
						CARR.TRDP_CD AS CARR_TRDP_CD, CARR.TRDP_NM AS CARR_TRDP_NM,
						BL.CY_TRDP_CD, CY.ENG_NM AS CY_TRDP_NM,
						BL.CFS_TRDP_CD, CFS.ENG_NM AS CFS_TRDP_NM,
						
						BL.HBL_TP_CD, BL.SHP_MOD_CD, BL.INCO_CD, BL.RGST_USRID, BL.REP_CMDT_NM,
						BL.CUST_REF_NO,
						(SELECT x.cnt_cd FROM TB_OFC x WHERE x.OFC_CD = bl.rgst_ofc_cd) AS BL_CNT, 
						(SELECT MAX(X.LOCL_USR_NM) FROM TB_USR X WHERE X.USR_TP = 'I' AND X.USRID = bnd.issued_by) AS PROC_USRNM,
						BL.POST_DT, BL.TRNK_VSL_NM, BL.TRNK_VOY,
						
						(SELECT COUNT(*) 
						   FROM TB_INTG_BL X 
						  WHERE X.INTG_BL_SEQ IN (SELECT INTG_BL_SEQ FROM TB_INTG_BL_RLT RLT WHERE RLT.RLT_INTG_BL_SEQ = BL.INTG_BL_SEQ AND RLT.DELT_FLG = 'N' AND X.DELT_FLG = 'N')) AS HBL_CNT, 						  				          				
						ISNULL(DBO.FC_MK_MEMO_SCRIPT(BL.INTG_BL_SEQ), '') AS MEMO,
						AMS_ID
						, BL.RLSD_FLG, BL.RLSD_DT_TM , ISNULL(BLCK.BL_STS_CD1, BL.BL_STS_CD) AS BL_STS_CD
    					,BL.CCN_NO
						,BL.CCN_DT
						,BL.PRE_CCN_NO
						,BL.MNF_FR_LOC
						,BL.MNF_TO_LOC
						,BL.IMP_REF_NO
						,ISNULL(bnd.AR_CHK,'X') AS AR_CHK
						,ISNULL(bnd.AP_CHK,'X') AS AP_CHK
						,ISNULL(bnd.DC_CHK,'X') AS DC_CHK
						,ISNULL(bnd.FRT_CHK,'X') AS FRT_CHK
				  FROM  TB_INTG_BL BL
				  JOIN  tb_add_info_bnd bnd
					ON  bl.intg_bl_seq = bnd.intg_bl_seq AND bnd.bnd_clss_cd = #bnd_clss_cd# AND bnd.delt_flg = 'N'
	   LEFT OUTER JOIN  tb_bl_prnr PRNR2
					ON  bl.intg_bl_seq = prnr2.intg_bl_seq  AND prnr2.bl_trdp_tp_cd = 'P03' AND prnr2.delt_flg = 'N'
	   LEFT OUTER JOIN  tb_bl_prnr SHPR
					ON  bl.intg_bl_seq = SHPR.intg_bl_seq  AND SHPR.bl_trdp_tp_cd = 'S01' AND SHPR.delt_flg = 'N'
	   LEFT OUTER JOIN  tb_bl_prnr CNEE
					ON  bl.intg_bl_seq = CNEE.intg_bl_seq  AND CNEE.bl_trdp_tp_cd = 'C01' AND CNEE.delt_flg = 'N'
	   LEFT OUTER JOIN  tb_bl_prnr CARR
					ON  bl.intg_bl_seq = carr.intg_bl_seq  AND carr.bl_trdp_tp_cd = 'B01' AND carr.delt_flg = 'N'
	   LEFT OUTER JOIN  tb_bl_prnr LNR
					ON  bl.intg_bl_seq = lnr.intg_bl_seq  AND lnr.bl_trdp_tp_cd = 'L01' AND lnr.delt_flg = 'N'
	   LEFT OUTER JOIN  tb_trdp CY
					ON  bl.cy_trdp_cd = cy.trdp_cd  AND cy.delt_flg = 'N'
	   LEFT OUTER JOIN  tb_trdp CFS
					ON  bl.cfs_trdp_cd = cfs.trdp_cd  AND cfs.delt_flg = 'N'
	   LEFT OUTER JOIN(SELECT INTG_BL_SEQ AS INTG_BL_SEQ1, BL_STS_CD AS BL_STS_CD1 FROM TB_INTG_BL_BLCK) BLCK 
	   				ON BL.INTG_BL_SEQ = BLCK.INTG_BL_SEQ1
				  
				 WHERE  bl.delt_flg = 'N'
				   AND  bl.air_sea_clss_cd = #air_sea_clss_cd#
				   AND  bl.biz_clss_cd  = 'M'
				<isNotEmpty property="f_ref_no">
				   AND  BL.REF_NO LIKE '%' + #f_ref_no# + '%'
				</isNotEmpty>
				<isNotEmpty property="f_mbl_no">
				   AND  
				   		BL.INTG_BL_SEQ 
				        IN (SELECT DISTINCT 
							(SELECT RLT_INTG_BL_SEQ FROM TB_INTG_BL_RLT RLT WHERE RLT.INTG_BL_SEQ = BL.INTG_BL_SEQ AND RLT.DELT_FLG = 'N') 
							 AS INTG_BL_SEQ
						  FROM  TB_INTG_BL BL
						 WHERE  bl.delt_flg = 'N'
						   AND  bl.air_sea_clss_cd = #air_sea_clss_cd#
						   AND  bl.biz_clss_cd  = #biz_clss_cd#
						   AND  BL.BL_NO LIKE '%' + #f_mbl_no# + '%'
						) 
				</isNotEmpty>
				<isNotEmpty property="f_lnr_bkg_no">
				   AND  BL.LNR_BKG_NO LIKE '%' + #f_lnr_bkg_no# + '%'
				</isNotEmpty>
				<isNotEmpty property="f_cntr_no">
				   AND  BL.INTG_BL_SEQ IN (SELECT  CNTR.INTG_BL_SEQ
											 FROM  TB_CNTR_LIST CNTR
											WHERE  CNTR.CNTR_NO LIKE '%' + #f_cntr_no# + '%')
				</isNotEmpty>
				<isNotEmpty property="etd_strdt">
				   AND  BL.ETD_DT_TM BETWEEN #etd_strdt# AND #etd_enddt#
				</isNotEmpty>
				<isNotEmpty property="eta_strdt">
				   AND  BL.ETA_DT_TM BETWEEN #eta_strdt# AND #eta_enddt#
				</isNotEmpty>
				<isNotEmpty property="f_eta_strdt">
				   AND  BL.F_ETA_DT_TM BETWEEN #f_eta_strdt# AND #f_eta_enddt#
				</isNotEmpty>
				<isNotEmpty property="f_pol_cd">
				   AND  BL.POL_CD = #f_pol_cd#
				</isNotEmpty>
				<isNotEmpty property="f_pol_nm">
				   AND  BL.POL_NM LIKE '%' + #f_pol_nm# + '%'
				</isNotEmpty>
				<isNotEmpty property="f_pod_cd">
				   AND  BL.POD_CD = #f_pod_cd#
				</isNotEmpty>
				<isNotEmpty property="f_pod_nm">
				   AND  BL.POD_NM LIKE '%' + #f_pod_nm# + '%'
				</isNotEmpty>
				<isNotEmpty property="f_del_cd">
				   AND  BL.DEL_CD = #f_del_cd#
				</isNotEmpty>
				<isNotEmpty property="f_del_nm">
				   AND  BL.DEL_NM LIKE '%' + #f_del_nm# + '%'
				</isNotEmpty>
				<isNotEmpty property="f_prnr_trdp_nm2">
				   AND  PRNR2.TRDP_NM LIKE '%' + #f_prnr_trdp_nm2# + '%'
				</isNotEmpty>
				<isNotEmpty property="f_shpr_trdp_nm">
				   AND  SHPR.TRDP_NM LIKE '%' + #f_shpr_trdp_nm# + '%'
				</isNotEmpty>
				<isNotEmpty property="f_cnee_trdp_nm">
				   AND  CNEE.TRDP_NM LIKE '%' + #f_cnee_trdp_nm# + '%'
				</isNotEmpty>
				<isNotEmpty property="f_carr_trdp_nm">
				   AND  LNR.TRDP_NM LIKE '%' + #f_carr_trdp_nm# + '%'
				</isNotEmpty>
				<isNotEmpty property="f_cy_trdp_nm">
				   AND  CY.ENG_NM LIKE '%' + #f_cy_trdp_nm# + '%'
				</isNotEmpty>
				<isNotEmpty property="f_cfs_trdp_nm">
				   AND  CFS.ENG_NM LIKE '%' + #f_cfs_trdp_nm# + '%'
				</isNotEmpty>
				<isNotEmpty property="f_hbl_tp_cd">
				   AND  BL.HBL_TP_CD = #f_hbl_tp_cd#
				</isNotEmpty>
				<isNotEmpty property="f_ofc_cd">
				   AND  BL.REF_OFC_CD = #f_ofc_cd#
				</isNotEmpty>
				<isNotEmpty property="f_shp_mod_cd">
				   AND  BL.SHP_MOD_CD = #f_shp_mod_cd#
				</isNotEmpty>
				<isNotEmpty property="f_pic_id">
				   AND  BL.RGST_USRID LIKE '%' + #f_pic_id# + '%'
				</isNotEmpty>
				<isNotEmpty property="f_trnk_vsl_nm">
				   AND  BL.TRNK_VSL_NM LIKE '%' + #f_trnk_vsl_nm# + '%'
				</isNotEmpty>
				<isNotEmpty property="f_imp_ref_no">
				   AND  BL.IMP_REF_NO LIKE '%' + #f_imp_ref_no# + '%'
				</isNotEmpty>				
				<isNotEmpty property="f_ccn_no">
				   AND  BL.CCN_NO LIKE '%' + #f_ccn_no# + '%'
				</isNotEmpty>		
				<isNotEmpty property="post_strdt">
				   AND  BL.POST_DT BETWEEN #post_strdt# AND #post_enddt#
				</isNotEmpty>
				<isNotEmpty property="opr_usrid">
				    AND BND.ISSUED_BY = #opr_usrid#
				</isNotEmpty>		
<!--			  ORDER BY  BL.RGST_TMS DESC  -->
			  ) a1
<![CDATA[ where a1.ROWNUM > #beginIdx# AND a1.ROWNUM <= #topCnt#	]]>
    </select>
	<!--  Master B/L List select count    -->
	<!-- ZOOT -->
    <select id="selectMBL_LIST_CNT" parameterClass="java.util.HashMap" resultClass="Integer">
        /* selectMBL_LIST_CNT IN/OUT */
        SELECT  
        		COUNT(bl.intg_bl_seq)
          FROM  TB_INTG_BL BL          
			  JOIN  tb_add_info_bnd bnd
				ON  bl.intg_bl_seq = bnd.intg_bl_seq AND bnd.bnd_clss_cd = #bnd_clss_cd# AND bnd.delt_flg = 'N'
   LEFT OUTER JOIN  tb_bl_prnr PRNR2
				ON  bl.intg_bl_seq = prnr2.intg_bl_seq  AND prnr2.bl_trdp_tp_cd = 'P03' AND prnr2.delt_flg = 'N'
   LEFT OUTER JOIN  tb_bl_prnr SHPR
				ON  bl.intg_bl_seq = SHPR.intg_bl_seq  AND SHPR.bl_trdp_tp_cd = 'S01' AND SHPR.delt_flg = 'N'
   LEFT OUTER JOIN  tb_bl_prnr CNEE
				ON  bl.intg_bl_seq = CNEE.intg_bl_seq  AND CNEE.bl_trdp_tp_cd = 'C01' AND CNEE.delt_flg = 'N'
   LEFT OUTER JOIN  tb_bl_prnr CARR
				ON  bl.intg_bl_seq = carr.intg_bl_seq  AND carr.bl_trdp_tp_cd = 'B01' AND carr.delt_flg = 'N'
   LEFT OUTER JOIN  tb_bl_prnr LNR
				ON  bl.intg_bl_seq = lnr.intg_bl_seq  AND lnr.bl_trdp_tp_cd = 'L01' AND lnr.delt_flg = 'N'
   LEFT OUTER JOIN  tb_trdp CY
				ON  bl.cy_trdp_cd = cy.trdp_cd  AND cy.delt_flg = 'N'
   LEFT OUTER JOIN  tb_trdp CFS
				ON  bl.cfs_trdp_cd = cfs.trdp_cd  AND cfs.delt_flg = 'N'   
         WHERE  bl.bl_no IS NOT NULL
           AND  bl.delt_flg = 'N' AND   bl.biz_clss_cd = #biz_clss_cd#            
           AND  bl.air_sea_clss_cd = #air_sea_clss_cd#
           AND  bnd.bnd_clss_cd = #bnd_clss_cd#           
        <isNotEmpty property="f_ref_no">
			   AND  BL.REF_NO LIKE '%' + #f_ref_no# + '%'
			</isNotEmpty>
			<isNotEmpty property="f_mbl_no">
			   AND  BL.BL_NO LIKE '%' + #f_mbl_no# + '%'
			</isNotEmpty>
			<isNotEmpty property="f_lnr_bkg_no">
			   AND  BL.LNR_BKG_NO LIKE '%' + #f_lnr_bkg_no# + '%'
			</isNotEmpty>
			<isNotEmpty property="f_cntr_no">
			   AND  BL.INTG_BL_SEQ IN (SELECT  CNTR.INTG_BL_SEQ
										 FROM  TB_CNTR_LIST CNTR
										WHERE  CNTR.CNTR_NO LIKE '%' + #f_cntr_no# + '%')
			</isNotEmpty>
			<isNotEmpty property="etd_strdt">
			   AND  BL.ETD_DT_TM BETWEEN #etd_strdt# AND #etd_enddt#
			</isNotEmpty>
			<isNotEmpty property="eta_strdt">
			   AND  BL.ETA_DT_TM BETWEEN #eta_strdt# AND #eta_enddt#
			</isNotEmpty>
			<isNotEmpty property="f_eta_strdt">
			   AND  BL.F_ETA_DT_TM BETWEEN #f_eta_strdt# AND #f_eta_enddt#
			</isNotEmpty>
			<isNotEmpty property="f_pol_cd">
			   AND  BL.POL_CD = #f_pol_cd#
			</isNotEmpty>
			<isNotEmpty property="f_pol_nm">
			   AND  BL.POL_NM LIKE '%' + #f_pol_nm# + '%'
			</isNotEmpty>
			<isNotEmpty property="f_por_cd">
			   AND  BL.POR_CD = #f_por_cd#
			</isNotEmpty>
			<isNotEmpty property="f_por_nm">
			   AND  BL.POR_NM LIKE '%' + #f_por_nm# + '%'
			</isNotEmpty>
			<isNotEmpty property="f_pod_cd">
			   AND  BL.POD_CD = #f_pod_cd#
			</isNotEmpty>
			<isNotEmpty property="f_pod_nm">
			   AND  BL.POD_NM LIKE '%' + #f_pod_nm# + '%'
			</isNotEmpty>
			<isNotEmpty property="f_del_cd">
			   AND  BL.DEL_CD = #f_del_cd#
			</isNotEmpty>
			<isNotEmpty property="f_del_nm">
			   AND  BL.DEL_NM LIKE '%' + #f_del_nm# + '%'
			</isNotEmpty>
			<isNotEmpty property="f_prnr_trdp_nm2">
			   AND  PRNR2.TRDP_NM LIKE '%' + #f_prnr_trdp_nm2# + '%'
			</isNotEmpty>
			<isNotEmpty property="f_shpr_trdp_nm">
			   AND  SHPR.TRDP_NM LIKE '%' + #f_shpr_trdp_nm# + '%'
			</isNotEmpty>
			<isNotEmpty property="f_cnee_trdp_nm">
			   AND  CNEE.TRDP_NM LIKE '%' + #f_cnee_trdp_nm# + '%'
			</isNotEmpty>
			<isNotEmpty property="f_carr_trdp_nm">
			   AND  CARR.TRDP_NM LIKE '%' + #f_carr_trdp_nm# + '%'
			</isNotEmpty>
			<isNotEmpty property="f_cy_trdp_nm">
			   AND  CY.ENG_NM LIKE '%' + #f_cy_trdp_nm# + '%'
			</isNotEmpty>
			<isNotEmpty property="f_cfs_trdp_nm">
			   AND  CFS.ENG_NM LIKE '%' + #f_cfs_trdp_nm# + '%'
			</isNotEmpty>
			<isNotEmpty property="f_hbl_tp_cd">
			   AND  BL.HBL_TP_CD = #f_hbl_tp_cd#
			</isNotEmpty>
			<isNotEmpty property="f_ofc_cd">
			   AND  BL.REF_OFC_CD = #f_ofc_cd#
			</isNotEmpty>
			<isNotEmpty property="f_shp_mod_cd">
			   AND  BL.SHP_MOD_CD = #f_shp_mod_cd#
			</isNotEmpty>
			<isNotEmpty property="f_pic_id">
			   AND  BL.RGST_USRID LIKE '%' + #f_pic_id# + '%'
			</isNotEmpty>
			<isNotEmpty property="f_trnk_vsl_nm">
			   AND  BL.TRNK_VSL_NM LIKE '%' + #f_trnk_vsl_nm# + '%'
			</isNotEmpty>
			<isNotEmpty property="f_imp_ref_no">
			   AND  BL.IMP_REF_NO LIKE '%' + #f_imp_ref_no# + '%'
			</isNotEmpty>				
			<isNotEmpty property="f_ccn_no">
			   AND  BL.CCN_NO LIKE '%' + #f_ccn_no# + '%'
			</isNotEmpty>	
			<isNotEmpty property="post_strdt">
			   AND  BL.POST_DT BETWEEN #post_strdt# AND #post_enddt#
			</isNotEmpty>
			<isNotEmpty property="opr_usrid">
				AND  BND.ISSUED_BY = #opr_usrid#
			</isNotEmpty>
	</select>		
    <!--  Master B/L List select count(House B/L 검색인 경우)  -->
    <!-- #29408 [BINEX]B/L List 검색조건 추가 -->
    <select id="selectMHBL_LIST_CNT" parameterClass="java.util.HashMap" resultClass="Integer">
        SELECT  
        		<!-- HB/L로 검색하는 경우, HB/L에 해당하는 MB/L을 COUNT -->
        		<!-- COUNT(bl.intg_bl_seq)  -->
        		COUNT(DISTINCT RLT.RLT_INTG_BL_SEQ) 
          FROM  TB_INTG_BL BL
			  JOIN  tb_add_info_bnd bnd
				ON  bl.intg_bl_seq = bnd.intg_bl_seq AND bnd.bnd_clss_cd = #bnd_clss_cd# AND bnd.delt_flg = 'N'
   LEFT OUTER JOIN  tb_bl_prnr PRNR2
				ON  bl.intg_bl_seq = prnr2.intg_bl_seq  AND prnr2.bl_trdp_tp_cd = 'P03' AND prnr2.delt_flg = 'N'
   LEFT OUTER JOIN  tb_bl_prnr SHPR
				ON  bl.intg_bl_seq = SHPR.intg_bl_seq  AND SHPR.bl_trdp_tp_cd = 'S01' AND SHPR.delt_flg = 'N'
   LEFT OUTER JOIN  tb_bl_prnr CNEE
				ON  bl.intg_bl_seq = CNEE.intg_bl_seq  AND CNEE.bl_trdp_tp_cd = 'C01' AND CNEE.delt_flg = 'N'
   LEFT OUTER JOIN  tb_bl_prnr CARR
				ON  bl.intg_bl_seq = carr.intg_bl_seq  AND carr.bl_trdp_tp_cd = 'B01' AND carr.delt_flg = 'N'
   LEFT OUTER JOIN  tb_bl_prnr LNR
				ON  bl.intg_bl_seq = lnr.intg_bl_seq  AND lnr.bl_trdp_tp_cd = 'L01' AND lnr.delt_flg = 'N'
   LEFT OUTER JOIN  tb_trdp CY
				ON  bl.cy_trdp_cd = cy.trdp_cd  AND cy.delt_flg = 'N'
   LEFT OUTER JOIN  tb_trdp CFS
				ON  bl.cfs_trdp_cd = cfs.trdp_cd  AND cfs.delt_flg = 'N'
   LEFT OUTER JOIN  tb_intg_bl_rlt RLT
				ON  bl.INTG_BL_SEQ = rlt.INTG_BL_SEQ  AND rlt.delt_flg = 'N'
   LEFT OUTER JOIN (
				SELECT  FRT.INTG_BL_SEQ, COUNT(FRT.INV_SEQ) AS CHK
				  FROM  TB_FRT FRT
				 WHERE  FRT.SELL_BUY_TP_CD = 'S'
				   AND  FRT.INV_SEQ IS NOT NULL
				   AND  FRT.DELT_FLG = 'N'
			  GROUP BY  FRT.INTG_BL_SEQ
				    ) AR_INV ON AR_INV.INTG_BL_SEQ = BL.INTG_BL_SEQ
   LEFT OUTER JOIN (
				SELECT  FRT.INTG_BL_SEQ, COUNT(FRT.INV_SEQ) AS CHK
				  FROM  TB_FRT FRT
				 WHERE  FRT.SELL_BUY_TP_CD = 'B'
				   AND  FRT.INV_SEQ IS NOT NULL
				   AND  FRT.DELT_FLG = 'N'
			  GROUP BY  FRT.INTG_BL_SEQ
				    ) AP_INV ON AP_INV.INTG_BL_SEQ = BL.INTG_BL_SEQ
   LEFT OUTER JOIN (
				SELECT  FRT.INTG_BL_SEQ, COUNT(FRT.INV_SEQ) AS CHK
				  FROM  TB_FRT FRT
				 WHERE  FRT.SELL_BUY_TP_CD IN ('D', 'C')
				   AND  FRT.INV_SEQ IS NOT NULL
				   AND  FRT.DELT_FLG = 'N'
			  GROUP BY  FRT.INTG_BL_SEQ
				    ) DC_INV ON DC_INV.INTG_BL_SEQ = BL.INTG_BL_SEQ
         WHERE  bl.bl_no IS NOT NULL
           AND  bl.delt_flg = 'N'                 AND   bl.biz_clss_cd = #biz_clss_cd#            
           AND  bl.air_sea_clss_cd = #air_sea_clss_cd#
           AND  bnd.bnd_clss_cd = #bnd_clss_cd# 
        <isNotEmpty property="f_ref_no">
			   AND  BL.REF_NO LIKE '%' + #f_ref_no# + '%'
			</isNotEmpty>
			<isNotEmpty property="f_mbl_no">
			   AND  BL.BL_NO LIKE '%' + #f_mbl_no# + '%'
			</isNotEmpty>
			<isNotEmpty property="f_lnr_bkg_no">
			   AND  BL.LNR_BKG_NO LIKE '%' + #f_lnr_bkg_no# + '%'
			</isNotEmpty>
			<isNotEmpty property="f_cntr_no">
			   AND  BL.INTG_BL_SEQ IN (SELECT  CNTR.INTG_BL_SEQ
										 FROM  TB_CNTR_LIST CNTR
										WHERE  CNTR.CNTR_NO LIKE '%' + #f_cntr_no# + '%')
			</isNotEmpty>
			<isNotEmpty property="etd_strdt">
			   AND  BL.ETD_DT_TM BETWEEN #etd_strdt# AND #etd_enddt#
			</isNotEmpty>
			<isNotEmpty property="eta_strdt">
			   AND  BL.ETA_DT_TM BETWEEN #eta_strdt# AND #eta_enddt#
			</isNotEmpty>
			<isNotEmpty property="f_eta_strdt">
			   AND  BL.F_ETA_DT_TM BETWEEN #f_eta_strdt# AND #f_eta_enddt#
			</isNotEmpty>
			<isNotEmpty property="f_pol_cd">
			   AND  BL.POL_CD = #f_pol_cd#
			</isNotEmpty>
			<isNotEmpty property="f_pol_nm">
			   AND  BL.POL_NM LIKE '%' + #f_pol_nm# + '%'
			</isNotEmpty>
			<isNotEmpty property="f_pod_cd">
			   AND  BL.POD_CD = #f_pod_cd#
			</isNotEmpty>
			<isNotEmpty property="f_pod_nm">
			   AND  BL.POD_NM LIKE '%' + #f_pod_nm# + '%'
			</isNotEmpty>
			<isNotEmpty property="f_del_cd">
			   AND  BL.DEL_CD = #f_del_cd#
			</isNotEmpty>
			<isNotEmpty property="f_del_nm">
			   AND  BL.DEL_NM LIKE '%' + #f_del_nm# + '%'
			</isNotEmpty>
			<isNotEmpty property="f_prnr_trdp_nm2">
			   AND  PRNR2.TRDP_NM LIKE '%' + #f_prnr_trdp_nm2# + '%'
			</isNotEmpty>
			<isNotEmpty property="f_shpr_trdp_nm">
			   AND  SHPR.TRDP_NM LIKE '%' + #f_shpr_trdp_nm# + '%'
			</isNotEmpty>
			<isNotEmpty property="f_cnee_trdp_nm">
			   AND  CNEE.TRDP_NM LIKE '%' + #f_cnee_trdp_nm# + '%'
			</isNotEmpty>
			<isNotEmpty property="f_carr_trdp_nm">
			   AND  CARR.TRDP_NM LIKE '%' + #f_carr_trdp_nm# + '%'
			</isNotEmpty>
			<isNotEmpty property="f_cy_trdp_nm">
			   AND  CY.ENG_NM LIKE '%' + #f_cy_trdp_nm# + '%'
			</isNotEmpty>
			<isNotEmpty property="f_cfs_trdp_nm">
			   AND  CFS.ENG_NM LIKE '%' + #f_cfs_trdp_nm# + '%'
			</isNotEmpty>
			<isNotEmpty property="f_hbl_tp_cd">
			   AND  BL.HBL_TP_CD = #f_hbl_tp_cd#
			</isNotEmpty>
			<isNotEmpty property="f_ofc_cd">
			   AND  BL.REF_OFC_CD = #f_ofc_cd#
			</isNotEmpty>
			<isNotEmpty property="f_shp_mod_cd">
			   AND  BL.SHP_MOD_CD = #f_shp_mod_cd#
			</isNotEmpty>
			<isNotEmpty property="f_pic_id">
			   AND  BL.RGST_USRID LIKE '%' + #f_pic_id# + '%'
			</isNotEmpty>
			<isNotEmpty property="f_trnk_vsl_nm">
			   AND  BL.TRNK_VSL_NM LIKE '%' + #f_trnk_vsl_nm# + '%'
			</isNotEmpty>
			<isNotEmpty property="f_imp_ref_no">
			   AND  BL.IMP_REF_NO LIKE '%' + #f_imp_ref_no# + '%'
			</isNotEmpty>				
			<isNotEmpty property="f_ccn_no">
			   AND  BL.CCN_NO LIKE '%' + #f_ccn_no# + '%'
			</isNotEmpty>				
			<isNotEmpty property="post_strdt">
			   AND  BL.POST_DT BETWEEN #post_strdt# AND #post_enddt#
			</isNotEmpty>
			<isNotEmpty property="opr_usrid">
			    AND BND.ISSUED_BY = #opr_usrid#
			</isNotEmpty>   
	</select>
    
    <!-- House B/L List select    -->
    <!-- ZOOT=LIST PAGE AR_AP_DC STAUS PROCESS -->
    <select id="selectHBL_SUB_LIST" parameterClass="java.util.HashMap" resultClass="HBLInfoVO">
    /* selectHBL_SUB_LIST  */
        SELECT  bl.intg_bl_seq,    bl.biz_clss_cd,   
        		bl.bl_no,          bl.bkg_no,     	bl.lnr_bkg_no,
                CONVERT(VARCHAR, bl.etd_dt_tm, 120) AS etd_dt_tm,
                CONVERT(VARCHAR, bl.eta_dt_tm, 120) AS eta_dt_tm,
                bl.por_cd,        bl.por_nm,        '' AS por_nod_cd,     
                bl.pol_cd,        bl.pol_nm,        bl.pol_nod_cd,
                bl.pod_cd,        bl.pod_nm,        bl.pod_nod_cd,
                bl.del_cd,        bl.del_nm,        '' AS del_nod_cd,
        
                shp.trdp_cd AS shpr_trdp_cd,      shp.trdp_nm AS shpr_trdp_nm,
                cne.trdp_cd AS cnee_trdp_cd,      cne.trdp_nm AS cnee_trdp_nm,
                lnr.trdp_cd AS lnr_trdp_cd,       lnr.trdp_nm AS lnr_trdp_nm,
                prnr.trdp_cd AS prnr_trdp_cd,     prnr.trdp_nm AS prnr_trdp_nm,
                ntfy.trdp_cd AS ntfy_trdp_cd,     ntfy.trdp_nm AS ntfy_trdp_nm,

                bnd.cfm_flg,     bnd.clz_flg,
                
                bl.pck_qty,
                (SELECT X.pck_nm FROM TB_PCK_UT_CD X WHERE X.pck_ut_cd = bl.pck_ut_cd) AS pck_ut_nm,
                bl.grs_wgt, bl.grs_wgt1,
                bl.chg_wgt, bl.chg_wgt1,
                bl.meas, bl.meas1,
                ISNULL(BLCK.BL_STS_CD1, BL.BL_STS_CD) AS BL_STS_CD,
                bl.isf_no,
                <!-- #34257 [BINEX]OIM List 하단 HBL List 항목 추가 -->
                bl.ams_no,
                bl.cust_ref_no,
                bl.org_bl_rcvd_flg,
                CASE WHEN ISNULL(bl.EXPRESS_TP_CD,'N') = 'Y' THEN 'Y' ELSE '' END AS express_tp_cd,	
			    ISNULL(bnd.AR_CHK,'X') AS AR_CHK
				,ISNULL(bnd.AP_CHK,'X') AS AP_CHK
				,ISNULL(bnd.DC_CHK,'X') AS DC_CHK
				,ISNULL(bnd.FRT_CHK,'X') AS FRT_CHK
                
          FROM  tb_intg_bl bl
          JOIN  tb_add_info_bnd bnd
            ON  bl.intg_bl_seq = bnd.intg_bl_seq
LEFT OUTER JOIN tb_bl_prnr shp
            ON  bl.intg_bl_seq = shp.intg_bl_seq  AND shp.bl_trdp_tp_cd = 'S01' AND shp.delt_flg = 'N'
         
LEFT OUTER JOIN tb_bl_prnr cne
            ON  bl.intg_bl_seq = cne.intg_bl_seq  AND cne.bl_trdp_tp_cd = 'C01' AND cne.delt_flg = 'N'

LEFT OUTER JOIN tb_bl_prnr lnr
            ON  bl.intg_bl_seq = lnr.intg_bl_seq  AND lnr.bl_trdp_tp_cd = 'L01' AND lnr.delt_flg = 'N'
            
LEFT OUTER JOIN tb_bl_prnr prnr
            ON  bl.intg_bl_seq = prnr.intg_bl_seq  AND prnr.bl_trdp_tp_cd = 'P01' AND prnr.delt_flg = 'N'
            
LEFT OUTER JOIN tb_bl_prnr ntfy
            ON  bl.intg_bl_seq = ntfy.intg_bl_seq  AND ntfy.bl_trdp_tp_cd = 'N01' AND ntfy.delt_flg = 'N'
            
LEFT OUTER JOIN(SELECT INTG_BL_SEQ AS INTG_BL_SEQ1, BL_STS_CD AS BL_STS_CD1 FROM TB_INTG_BL_BLCK) BLCK 
			ON BL.INTG_BL_SEQ = BLCK.INTG_BL_SEQ1     
			      
         WHERE  bl.delt_flg    = 'N'        AND   bnd.delt_flg = 'N'
           AND  bl.biz_clss_cd = 'H'        AND   bl.air_sea_clss_cd = #air_sea_clss_cd#
           AND  bl.intg_bl_seq = bnd.intg_bl_seq 
           AND  bnd.bnd_clss_cd= #bnd_clss_cd#
           AND  bl.intg_bl_seq IN    
                              ( SELECT  intg_bl_seq
                                  FROM  tb_intg_bl_rlt
                                 WHERE  rlt_intg_bl_seq = #hbl_intg_bl_seq#
                                   AND  intg_bl_rlt_cd  ='HTM'    )
        ORDER BY bl.intg_bl_seq
    </select>
    
    <!-- 국가별 Descrition을 조회함   -->
    <select id="selectCNTR_DESC" resultClass="String" parameterClass="HashMap">
        SELECT cnt.descr 
          FROM tb_loc loc
          JOIN tb_cnt cnt
            ON loc.cnt_cd = cnt.cnt_cd
         WHERE loc.loc_cd = #loc_cd# AND cnt.delt_flg = 'N'
    </select>
    
    <!--S/R된 HBL 수정시 해당 S/R에 속하는 HBL의 수량, 무계, 중량을 S/R 테이블에 입력하기 위한 조회  -->
    <select id="selectHBL_SR_SUM_INFO" resultClass="HBLInfoVO" parameterClass="String">
        SELECT  sum(pck_qty) AS pck_qty, sum(grs_wgt) AS grs_wgt, sum(meas) AS meas, sum(act_wgt) AS act_wgt 
          FROM  tb_intg_bl
         WHERE  sr_no = #sr_no# AND biz_clss_cd = 'H' AND delt_flg = 'N'
    </select>
    
    <!--S/R된 HBL 수정시 해당 S/R에 속하는 HBL의 수량, 무계, 중량을 S/R 테이블에 업데이트함  -->
    <update id="updateHBL_SR_SUM_INFO" parameterClass="HBLInfoVO">
        UPDATE  tb_intg_bl
           SET  pck_qty    = #pck_qty#,        grs_wgt     = #grs_wgt#,      
                meas       = #meas#,           act_wgt     = #act_wgt#,
                modi_usrid = #proc_usrid#,     modi_ofc_cd = #proc_ofccd#,  modi_tms   = GETUTCDATE()
         WHERE  sr_no = #sr_no# AND biz_clss_cd = 'M' AND delt_flg = 'N'
    </update>
    
    
    <!-- MBL과 HBL 관계 테이블 생성   -->
    <insert id="insertIMP_INTG_BL_RLT" parameterClass="HashMap">
        INSERT INTO  tb_intg_bl_rlt(
                 intg_bl_seq,     rlt_intg_bl_seq,   intg_bl_rlt_cd,
                 rgst_usrid,      rgst_ofc_cd,       rgst_tms,         
                 modi_usrid,      modi_ofc_cd,       modi_tms,          delt_flg
        )SELECT  #intg_bl_seq#,   intg_bl_seq,       #intg_bl_rlt_cd#,
                 #proc_usrid#,    #proc_ofccd#,      getdate(),
                 #proc_usrid#,    #proc_ofccd#,      GETUTCDATE(),         'N'
           FROM  tb_intg_bl 
          WHERE  bl_no = #f_mbl_no# AND biz_clss_cd = 'M' AND delt_flg = 'N'
    </insert>
    
    <!-- Job Template Sequence를 조회함   -->
    <select id="selectJB_TMPLT_SEQ" resultClass="String" parameterClass="String">
        SELECT jb_tmplt_seq  
          FROM tb_jb_tmplt 
         WHERE tmplt_nm = #value# AND delt_flg = 'N'
    </select>   

	<!--BL내용중 변경된 내용을 로그로 기록하기 위해 원 정보를 조회함  -->
	<select id="selectBL_ORGINFO_READ" resultClass="HBLInfoVO" parameterClass="String">	
		SELECT  bl.biz_clss_cd,  bl.air_sea_clss_cd,                
		        bl.pod_nm,       bl.pol_nm,           bl.del_nm,
		
		        bl.pck_qty,      bl.pck_ut_cd, 
		        bl.chg_wgt,      bl.chg_wgt_ut_cd,
		        bl.grs_wgt,      bl.grs_wgt_ut_cd,
		        bl.meas,         bl.meas_ut_cd,
		        bl.obrd_dt_tm,   bl.etd_dt_tm,        bl.eta_dt_tm,
		
		        shp.trdp_nm AS shpr_trdp_nm, 
		        cne.trdp_nm AS cnee_trdp_nm
		
	      FROM  tb_intg_bl bl
LEFT OUTER JOIN tb_bl_prnr shp
	        ON  shp.intg_bl_seq = bl.intg_bl_seq AND shp.bl_trdp_tp_cd = 'S01' AND shp.delt_flg = 'N'
		 
LEFT OUTER JOIN tb_bl_prnr cne
	        ON  cne.intg_bl_seq = bl.intg_bl_seq AND cne.bl_trdp_tp_cd = 'C01' AND shp.delt_flg = 'N'
		 WHERE  bl.intg_bl_seq  = #value#
	</select>

	<!-- PK생성   -->
    <select id="selectBL_CNG_ITM_PK" parameterClass="String" resultClass="Integer">
        SELECT ISNULL(MAX(cng_seq),0)+1
          FROM tb_bl_cng_itm
		 WHERE intg_bl_seq = #value#
    </select>

		
	<!-- History를 등록함   -->
	<insert id="insertBL_CNG_ITM" parameterClass="HashMap">
		INSERT INTO tb_bl_cng_itm(
			intg_bl_seq,  cng_seq,
			itm_lbl,      bfr_cng_txt,   aft_cng_txt,
			rgst_usrid,   rgst_ofc_cd,   rgst_tms
		)VALUES(
			#intg_bl_seq#,  #cng_seq#,
			#itm_lbl#,      #bfr_cng_txt#,   #aft_cng_txt#,
			#rgst_usrid#,   #rgst_ofc_cd#,   getdate()
		)
	</insert>
	
	<!--BL 변경내역을 조회함   -->
	<select id="selectBL_CNG_ITM_LIST" parameterClass="HashMap" resultClass="com.clt.apps.fis.see.bmd.housebl.dto.BlCngItmVO">
<!-- 
		SELECT  cng_seq,       itm_lbl,       bfr_cng_txt,   aft_cng_txt,
                rgst_usrid,    rgst_ofc_cd,   rgst_tms
		  FROM  tb_bl_cng_itm
		 WHERE  intg_bl_seq = #intg_bl_seq#
	  ORDER BY  cng_seq DESC
   -->
		SELECT  PPT.PHYS_ATTR_NM AS itm_lbl, HIS.bfr_cng_txt AS bfr_cng_txt, HIS.aft_cng_txt AS aft_cng_txt
			  , CONVERT(VARCHAR(19), HIS.rgst_tms, 120) AS rgst_tms, HIS.rgst_ofc_cd AS rgst_ofc_cd, HIS.rgst_usrid AS rgst_usrid
		  FROM  TB_INTG_CNG_HIS_AIF HIS
		  JOIN  TB_CNG_PPT PPT ON HIS.cng_attr_seq = PPT.CNG_ATTR_SEQ
		 WHERE  HIS.intg_bl_seq = #intg_bl_seq#
	  ORDER BY  HIS.rgst_tms DESC
	</select>
    
    <!-- BL번호 변경  -->
    <update id="updateCHG_BL_NO" parameterClass="HashMap">
        UPDATE  tb_intg_bl
           SET  bl_no = #bl_no#,
                modi_usrid = #proc_usrid#,     modi_ofc_cd = #proc_ofccd#,    modi_tms    = GETUTCDATE()
         WHERE  intg_bl_seq = #intg_bl_seq#  AND  biz_clss_cd = #biz_clss_cd#
    </update>
	
	<!--HBL에서 환률 기준일자로할 일자를 선택한다.  -->
    <select id="selectHBL_DT" parameterClass="String" resultClass="HBLInfoVO">
		SELECT  hbl.obrd_dt_tm, SUBSTRING(hbl.etd_dt_tm, 1, 8) AS etd_dt_tm,   SUBSTRING(hbl.eta_dt_tm, 1, 8) AS eta_dt_tm,
				 hbl.air_sea_clss_cd, bnd.bnd_clss_cd
		  FROM  tb_intg_bl hbl
		  JOIN  tb_add_info_bnd bnd
			ON  hbl.intg_bl_seq = bnd.intg_bl_seq
		 WHERE  hbl.intg_bl_seq = #value# AND hbl.biz_clss_cd = 'H'
    </select> 
    
    <select id="selectBLInv" parameterClass="HashMap" resultClass="String">
    	 SELECT  CASE WHEN COUNT(*) > 0 THEN 'N' ELSE 'Y' END AS CHKFLG
           FROM  TB_INTG_BL BL
           JOIN  TB_FRT FRT 
             ON  BL.INTG_BL_SEQ = FRT.INTG_BL_SEQ AND BL.DELT_FLG = 'N' AND FRT.DELT_FLG = 'N'
           JOIN  TB_INV INV 
             ON  FRT.INV_SEQ = INV.INV_SEQ AND INV.DELT_FLG = 'N'
          WHERE  1=1
            AND  BL.INTG_BL_SEQ = #intg_bl_seq# 
    </select>
    
    <!-- House B/L Info select    -->
    <select id="selectHBL_Info" parameterClass="java.util.HashMap" resultClass="com.clt.apps.fis.see.bmd.housebl.dto.DocumentPackageVO">
        SELECT	bl.intg_bl_seq,     bl.bl_no,			bl.hbl_tp_cd,
        		bl.flt_no,			bl.ref_ofc_cd,		rofc.ofc_eng_nm AS ref_ofc_eng_nm,
        		UPPER(rofc.cnt_cd) AS ref_ofc_cnt_cd,	rofc.sea_body,
        		shp.trdp_nm AS shpr_trdp_nm,			shp.trdp_addr AS shpr_trdp_addr,
        		cne.trdp_addr AS cnee_trdp_addr,		lnr.trdp_nm AS lnr_trdp_nm,
        		thr.trdp_nm AS thr_trdp_nm,
        		CASE (SELECT COUNT(frt.inv_seq) FROM tb_frt frt
        		WHERE frt.intg_bl_seq = bl.intg_bl_seq AND frt.sell_buy_tp_cd = 'S' AND frt.delt_flg = 'N')
        		WHEN 0 THEN 'N' ELSE 'Y' END AS loc_inv_flg,
        		(SELECT oth.intg_bl_seq FROM tb_bl_oth oth
        		WHERE oth.intg_bl_seq = bl.intg_bl_seq AND oth.wrk_tp = 'CI')AS cmc_inv_seq,
        		(SELECT oth.intg_bl_seq FROM tb_bl_oth oth
        		WHERE oth.intg_bl_seq = bl.intg_bl_seq AND oth.wrk_tp = 'PL') AS pck_inv_seq
        		, (select max(rmk_cd) from tb_bl_rmk where dft_flg = 'Y' and ofc_cd =  bl.ref_ofc_cd) as  rmk_cd
        		
          FROM  tb_intg_bl bl
          
          JOIN	tb_add_info_bnd bnd
		    ON	bnd.intg_bl_seq = bl.intg_bl_seq AND bnd.bnd_clss_cd = 'O' AND bnd.delt_flg = 'N'
          
LEFT OUTER JOIN tb_bl_prnr shp
            ON  bl.intg_bl_seq = shp.intg_bl_seq  AND shp.bl_trdp_tp_cd = 'S01' AND shp.delt_flg = 'N'

LEFT OUTER JOIN tb_bl_prnr cne
            ON  bl.intg_bl_seq = cne.intg_bl_seq  AND cne.bl_trdp_tp_cd = 'C01' AND cne.delt_flg = 'N'

LEFT OUTER JOIN tb_bl_prnr lnr
            ON  bl.intg_bl_seq = lnr.intg_bl_seq  AND lnr.bl_trdp_tp_cd = 'L01' AND lnr.delt_flg = 'N'
            
LEFT OUTER JOIN tb_bl_prnr thr
            ON  bl.intg_bl_seq = thr.intg_bl_seq  AND thr.bl_trdp_tp_cd = 'T01' AND lnr.delt_flg = 'N'
            
LEFT OUTER JOIN tb_ofc rofc
            ON  rofc.ofc_cd = bl.ref_ofc_cd AND rofc.delt_flg = 'N'
            
         WHERE  bl.delt_flg = 'N'
           AND	bl.biz_clss_cd = 'H'
           AND	bl.air_sea_clss_cd = #air_sea_clss_cd#
           AND	bl.bl_no = #f_bl_no#
    </select>
    
    <!-- Master B/L Info select    -->
    <select id="selectMBL_Info" parameterClass="java.util.HashMap" resultClass="com.clt.apps.fis.see.bmd.housebl.dto.DocumentPackageVO">
		SELECT	bl.intg_bl_seq,     	bl.bl_no,		bl.ref_ofc_cd,		bl.ref_no,
				UPPER(rofc.cnt_cd) AS ref_ofc_cnt_cd,	rofc.ofc_eng_nm AS ref_ofc_eng_nm,	
				rofc.sea_body,			
				agt.trdp_cd AS agt_trdp_cd,
				agt.trdp_addr AS agt_trdp_addr,
        		CASE
        		(SELECT COUNT(hbl.intg_bl_seq) FROM tb_intg_bl_rlt rlt
        		JOIN tb_intg_bl hbl ON hbl.intg_bl_seq = rlt.intg_bl_seq AND hbl.delt_flg = 'N'
        		WHERE rlt.rlt_intg_bl_seq = bl.intg_bl_seq AND rlt.delt_flg = 'N')
        		WHEN 0 THEN 'N' ELSE 'Y' END AS hbl_flg,
        		CASE
        		(SELECT COUNT('X') FROM tb_intg_bl_rlt rlt
        		JOIN tb_bl_oth oth ON oth.intg_bl_seq = rlt.intg_bl_seq AND oth.wrk_tp = 'CI'
        		WHERE rlt.rlt_intg_bl_seq = bl.intg_bl_seq AND rlt.delt_flg = 'N')
        		WHEN 0 THEN 'N' ELSE 'Y' END AS cmc_inv_flg,
        		CASE
        		(SELECT COUNT('X') FROM tb_intg_bl_rlt rlt
        		JOIN tb_bl_oth oth ON oth.intg_bl_seq = rlt.intg_bl_seq AND oth.wrk_tp = 'PL'
        		WHERE rlt.rlt_intg_bl_seq = bl.intg_bl_seq AND rlt.delt_flg = 'N')
        		WHEN 0 THEN 'N' ELSE 'Y' END AS pck_inv_flg,
				CASE
				(SELECT COUNT(frt.inv_seq) FROM tb_frt frt
				WHERE frt.intg_bl_seq = bl.intg_bl_seq AND frt.sell_buy_tp_cd IN ('C','D') AND frt.delt_flg = 'N')
				+
				(SELECT COUNT(frt.inv_seq) FROM tb_intg_bl_rlt rlt
				JOIN tb_frt frt ON frt.intg_bl_seq = rlt.intg_bl_seq AND frt.sell_buy_tp_cd IN ('C','D') AND frt.delt_flg = 'N'
				WHERE rlt.rlt_intg_bl_seq = bl.intg_bl_seq AND rlt.delt_flg = 'N')
				WHEN 0 THEN 'N' ELSE 'Y' END AS cr_db_flg
				, (select max(rmk_cd) from tb_bl_rmk where dft_flg = 'Y' and ofc_cd =  bl.ref_ofc_cd) as  rmk_cd
          FROM  tb_intg_bl bl     
		  JOIN	tb_add_info_bnd bnd
		    ON	bnd.intg_bl_seq = bl.intg_bl_seq AND bnd.bnd_clss_cd = 'O' AND bnd.delt_flg = 'N'
          
LEFT OUTER JOIN tb_bl_prnr agt
			 ON	bl.intg_bl_seq = agt.intg_bl_seq AND agt.bl_trdp_tp_cd = 'C01' AND agt.delt_flg = 'N'
			 
LEFT OUTER JOIN tb_ofc rofc
            ON  rofc.ofc_cd = bl.ref_ofc_cd AND rofc.delt_flg = 'N'
	
         WHERE  1=1
           AND	bl.delt_flg = 'N'
           AND	bl.biz_clss_cd = 'M'
           AND	bl.air_sea_clss_cd = #air_sea_clss_cd#
         <dynamic>
            <isNotEmpty property="bl_no">
         	AND bl.bl_no = #bl_no#
         	</isNotEmpty>
            <isNotEmpty property="ref_no">
         	AND bl.ref_no = #ref_no#
         	</isNotEmpty>
         </dynamic>	
    </select>
    
    <select id="selectCntrInfo" parameterClass="HashMap" resultClass="CntrLstVO">
    	SELECT cntr_no, seal_no1, cntr_tpsz_cd, seal_no2
		  FROM tb_cntr_list
		 WHERE intg_bl_seq = #intg_bl_seq#
    </select>
    
    <insert id="insertMBL_INTG_BL" parameterClass="SeeMasterBLVO">
    	/* insertMBL_INTG_BL */
        INSERT  tb_intg_bl(
                intg_bl_seq,        bl_no,              bl_sts_cd,          bl_ser_no,
                sr_no,              sr_seq,             sr_cre_dt,
                
                biz_clss_cd,        air_sea_clss_cd,
                lnr_bkg_no,         shp_mod_cd,         bl_iss_dt,          
        
                frt_term_cd,        rep_cmdt_cd,        rep_cmdt_nm,        pck_qty,                pck_ut_cd,
                grs_wgt,            grs_wgt_ut_cd,      act_wgt,            act_wgt_ut_cd,          meas,          meas_ut_cd,         
                fm_svc_term_cd,     to_svc_term_cd, 
             
                por_cd,             			        por_nm,             pol_cd,                 pol_nod_cd,    pol_nm,                 
                pod_cd,             pod_nod_cd,         pod_nm,             del_cd,                 del_nm,
                iss_loc_cd,         iss_loc_nm,         pay_loc_cd,         pay_loc_nm,
        
                fnl_dest_loc_cd,    fnl_dest_loc_nm,
                         
                trnk_vsl_cd,        trnk_vsl_nm,        trnk_voy,           
                etd_dt_tm,          eta_dt_tm,
                mk_txt,             desc_txt,           rmk,
        
                rgst_usrid,         rgst_ofc_cd,        rgst_tms,
                modi_usrid,         modi_ofc_cd,        dept_cd,            modi_usr_nm,            modi_tms,               DELT_FLG,

sad_txt,
hbl_tp_cd,
cargo_tp_cd,                
curr_cd,                 
ref_no,
sub_bl_no,
mbl_ref_no,
post_dt,
sub_mbl_flg,
state_cd,
grs_wgt1,
act_wgt1,
meas1,
size_ut_cd,
agent_rt,
agent_amt,
agent_curr_cd,
cust_rt,
cust_amt,
cust_curr_cd,
profit_share,
express_tp_cd,
iss_loc_cd1,
iss_loc_nm1,
trans_shipment,
itn_no,
onward_rout,
clean_on_board,
frt_term_c_cd,
frt_term_a_cd,
obrd_dt_tm1,
ref_ofc_cd,
exp_ref_no,
obl_tp_cd,
broker_rt,
cut_off_dt,
rcv_wh_cd,
sc_no,
cnt_cd,
mk_grs_wgt,
mk_grs_wgt1,
mk_meas,
mk_meas1,
f_eta_dt_tm,
d_eta_dt_tm,
avail_dt_tm,
lfd_dt_tm,
go_dt_tm,
rcvd_dt_tm,
rlsd_dt_tm,
te,
it_no,
it_loc,
bond_carr_cd,
bond_no,
goods_at,
goods_value,
door_loc_cd,
fnl_wh_cd,
org_bl_rcvd_flg,
ror_flg,
rlsd_flg,
rlsd_usrid,
te_dt_tm,
ams_no,
isf_no,
carr_trdp_cd1,
cy_trdp_cd,
cfs_trdp_cd,
rt_trdp_cd,
imp_ref_no,
cust_ref_no,
att_mk_txt,
att_desc_txt,
cntr_info,
desc_txt1,
reserve_field01,
reserve_field02,
reserve_field03,
reserve_field04,
reserve_field05,
reserve_field06,
reserve_field11,
rail_cut_off_dt,   
pu_trdp_cd,
ams_id,
etd_por_tm,
doc_cut_off_dt
,ccn_no
,ccn_dt
,pre_ccn_no
,mnf_fr_loc
,mnf_to_loc    
        )VALUES(
                #intg_bl_seq#,        #bl_no#,              #bl_sts_cd#,          #bl_ser_no#,
                #sr_no#,              #sr_seq#,             getdate(),
        
                #biz_clss_cd#,        #air_sea_clss_cd#,
                #lnr_bkg_no#,         #shp_mod_cd#,         #bl_iss_dt#,          
                
                #frt_term_cd#,        #rep_cmdt_cd#,        #rep_cmdt_nm#,        #pck_qty#,                #pck_ut_cd#,
                #grs_wgt#,            #grs_wgt_ut_cd#,      #act_wgt#,            #act_wgt_ut_cd#,          #meas#,         #meas_ut_cd#,
                #fm_svc_term_cd#,     #to_svc_term_cd#,
        
                #por_cd#,             						#por_nm#,             #pol_cd#,                 #pol_nod_cd#,   #pol_nm#,                 
                #pod_cd#,             #pod_nod_cd#,         #pod_nm#,             #del_cd#,                 #del_nm#,
                #iss_loc_cd#,         #iss_loc_nm#,         #pay_loc_cd#,         #pay_loc_nm#,
        
                #fnl_dest_loc_cd#,    #fnl_dest_loc_nm#,
                
                #trnk_vsl_cd#,        #trnk_vsl_nm#,        #trnk_voy#,           
                #etd_dt_tm#,          #eta_dt_tm#,
                #mk_txt#,             #desc_txt#,           #rmk#,
        
                #proc_usrid#,         #proc_ofccd#,         getdate(),
                #proc_usrid#,         #proc_ofccd#,         #proc_dept_cd#,       #proc_usrnm#,              GETUTCDATE(),                 'N',

#sad_txt#,
#hbl_tp_cd#,
#cargo_tp_cd#,
#curr_cd#,                
#ref_no#,
#sub_bl_no#,
#mbl_ref_no#,
#post_dt#,
#sub_mbl_flg#,
#state_cd#,
#grs_wgt1#,
#act_wgt1#,
#meas1#,
#size_ut_cd#,
#agent_rt#,
#agent_amt#,
#agent_curr_cd#,
#cust_rt#,
#cust_amt#,
#cust_curr_cd#,
#profit_share#,
#express_tp_cd#,
#iss_loc_cd1#,
#iss_loc_nm1#,
#trans_shipment#,
#itn_no#,
#onward_rout#,
#clean_on_board#,
#frt_term_c_cd#,
#frt_term_a_cd#,
#obrd_dt_tm1#,
#ref_ofc_cd#,
#exp_ref_no#,
#obl_tp_cd#,
#broker_rt#,
#cut_off_dt#,
#rcv_wh_cd#,
#sc_no#,
#cnt_cd#,
#mk_grs_wgt#,
#mk_grs_wgt1#,
#mk_meas#,
#mk_meas1#,
#f_eta_dt_tm#,
#d_eta_dt_tm#,
#avail_dt_tm#,
#lfd_dt_tm#,
#go_dt_tm#,
#rcvd_dt_tm#,
#rlsd_dt_tm#,
#te#,
#it_no#,
#it_loc#,
#bond_carr_cd#,
#bond_no#,
#goods_at#,
#goods_value#,
#door_loc_cd#,
#fnl_wh_cd#,
#org_bl_rcvd_flg#,
#ror_flg#,
#rlsd_flg#,
#rlsd_usrid#,
#te_dt_tm#,
#ams_no#,
#isf_no#,
#carr_trdp_cd1#,
#cy_trdp_cd#,
#cfs_trdp_cd#,
#rt_trdp_cd#,
#imp_ref_no#,
#cust_ref_no#,
#att_mk_txt#,
#att_desc_txt#,
#cntr_info#,
#desc_txt1#,
#reserve_field01#,
#reserve_field02#,
#reserve_field03#,
#reserve_field04#,
#reserve_field05#,
#reserve_field06#,
#reserve_field11#,
#rail_cut_off_dt#,   
#pu_trdp_cd#,
#ams_id#,
#etd_por_tm#,
#doc_cut_off_dt#
,#ccn_no#
,#ccn_dt#
,#pre_ccn_no#
,#mnf_fr_loc#
,#mnf_to_loc#
        )
    </insert>
    
    <select id="selectINTG_MBL_INFO" parameterClass="HashMap" resultClass="SeeMasterBLVO">
	/* selectINTG_MBL_INFO */
	SELECT TOP 1
	bl.intg_bl_seq, ISNULL(BLCK.BL_STS_CD1, BL.BL_STS_CD) AS BL_STS_CD, bl.bl_no, bl.hbl_tp_cd,
	bl.sr_no, bl.sr_seq, bl.sr_cre_dt, bl.bl_ser_no,

	bl.biz_clss_cd, bl.air_sea_clss_cd,
	bl.lnr_bkg_no, bl.shp_mod_cd, bl.bl_iss_dt, '' AS mrn,

	bl.frt_term_cd, bl.rep_cmdt_cd, bl.rep_cmdt_nm, bl.pck_qty, bl.pck_ut_cd,
	bl.grs_wgt, bl.grs_wgt_ut_cd, bl.act_wgt, bl.act_wgt_ut_cd, bl.meas,
	bl.meas_ut_cd,
	bl.fm_svc_term_cd, bl.to_svc_term_cd,

	bl.por_cd, '' AS por_nod_cd, bl.por_nm, bl.pol_cd, bl.pol_nod_cd, bl.pol_nm,
	bl.pod_cd, bl.pod_nod_cd, bl.pod_nm, bl.del_cd, '' AS del_nod_cd,
	bl.del_nm,
	bl.iss_loc_cd, bl.iss_loc_nm, bl.pay_loc_cd, bl.pay_loc_nm,

	bl.fnl_dest_loc_cd, '' AS fnl_dest_nod_cd, bl.fnl_dest_loc_nm,

	bl.trnk_vsl_cd, bl.trnk_vsl_nm, bl.trnk_voy,
	bl.etd_dt_tm, bl.eta_dt_tm,
	bl.mk_txt, bl.desc_txt, bl.rmk,

	bl.dept_cd, bl.modi_tms, 
	bnd.issued_by AS issued_by, 
	(select max(locl_usr_nm) from tb_usr where usrid = bnd.issued_by )  AS proc_usrnm,
	bl.modi_ofc_cd AS proc_ofccd, bl.dept_cd AS proc_dept_cd,

	CASE WHEN isNull(bnd.sls_ofc_cd,'') = '' THEN bl.modi_ofc_cd ELSE bnd.sls_ofc_cd END AS sls_ofc_cd,
	CASE WHEN isNull(bnd.sls_dept_cd,'') = '' THEN bl.dept_cd ELSE bnd.sls_dept_cd END AS sls_dept_cd ,
	CASE WHEN isNull(bnd.sls_usrid,'') = '' THEN #f_usrId# ELSE bnd.sls_usrid END AS sls_usrid,
	CASE WHEN isNull(bnd.sls_usr_nm,'') = '' THEN #f_usrNm# ELSE bnd.sls_usr_nm END AS sls_usr_nm,

	shp.trdp_cd AS shpr_trdp_cd, shp.trdp_nm AS shpr_trdp_nm, shp.trdp_addr AS
	shpr_trdp_addr,
	cne.trdp_cd AS cnee_trdp_cd, cne.trdp_nm AS cnee_trdp_nm, cne.trdp_addr AS
	cnee_trdp_addr,
	ntf.trdp_cd AS ntfy_trdp_cd, ntf.trdp_nm AS ntfy_trdp_nm, ntf.trdp_addr AS
	ntfy_trdp_addr,
	lnr.trdp_cd AS lnr_trdp_cd, lnr.trdp_nm AS lnr_trdp_nm, lnr.trdp_pic AS
	lnr_trdp_pic,
	agent.trdp_cd AS agent_trdp_cd, agent.trdp_nm AS agent_trdp_nm, agent.trdp_addr AS
	agent_trdp_addr, agent.trdp_pic AS agent_trdp_pic,
	prnr.trdp_cd AS prnr_trdp_cd, prnr.trdp_nm AS prnr_trdp_nm, prnr.trdp_addr AS
	prnr_trdp_addr,
	carr.trdp_cd AS carr_trdp_cd, carr.trdp_nm AS carr_trdp_nm, carr.trdp_pic AS
	carr_trdp_pic,
	prn2.trdp_cd AS prnr_trdp_cd2, prn2.trdp_nm AS prnr_trdp_nm2, prn2.trdp_pic AS
	prnr_trdp_pic2,
	third.trdp_cd AS third_trdp_cd, third.trdp_nm AS third_trdp_nm, third.trdp_pic AS
	third_trdp_pic,

	bl.sad_txt,
	bl.cargo_tp_cd,
	bl.curr_cd,
	bl.ref_no,
	bl.sub_bl_no,
	bl.mbl_ref_no,
	bl.post_dt,
	bl.sub_mbl_flg,
	bl.state_cd,
	bl.grs_wgt1,
	bl.act_wgt1,
	bl.meas1,
	bl.size_ut_cd,
	bl.agent_rt,
	bl.agent_amt,
	bl.agent_curr_cd,
	bl.cust_rt,
	bl.cust_amt,
	bl.cust_curr_cd,
	bl.profit_share,
	bl.express_tp_cd,
	bl.iss_loc_cd1,
	bl.iss_loc_nm1,
	bl.trans_shipment,
	bl.itn_no,
	bl.onward_rout,
	bl.clean_on_board,
	bl.frt_term_c_cd,
	bl.frt_term_a_cd,
	bl.obrd_dt_tm1,
	bl.ref_ofc_cd,
	bl.exp_ref_no,
	bl.obl_tp_cd,
	bl.broker_rt,
	bl.doc_cut_off_dt,
	bl.rcv_wh_cd,
	(SELECT eng_nm FROM tb_trdp x where x.trdp_cd = bl.rcv_wh_cd) AS rcv_wh_nm,
	bl.sc_no,
	bl.cnt_cd,
	bl.mk_grs_wgt,
	bl.mk_grs_wgt1,
	bl.mk_meas,
	bl.mk_meas1,
	bl.f_eta_dt_tm,
	bl.d_eta_dt_tm,
	bl.avail_dt_tm,
	bl.lfd_dt_tm,
	bl.go_dt_tm,
	bl.rcvd_dt_tm,
	bl.rlsd_dt_tm,
	bl.te,
	bl.it_no,
	bl.it_loc,
	bl.bond_carr_cd,
	bl.bond_no,
	bl.goods_at,
	bl.goods_value,
	bl.door_loc_cd,
	bl.fnl_wh_cd,
	(SELECT eng_nm FROM tb_trdp x where x.trdp_cd = bl.fnl_wh_cd) AS fnl_wh_nm,
	bl.org_bl_rcvd_flg,
	bl.ror_flg,
	bl.rlsd_flg,
	bl.rlsd_usrid,
	bl.te_dt_tm,
	bl.ams_no,
	bl.isf_no,
	bl.carr_trdp_cd1,
	(SELECT eng_nm FROM tb_trdp x where x.trdp_cd = carr_trdp_cd1) AS
	carr_trdp_nm1,
	bl.cy_trdp_cd,
	(SELECT eng_nm FROM tb_trdp x where x.trdp_cd = cy_trdp_cd) AS cy_trdp_nm,
	bl.cfs_trdp_cd,
	(SELECT eng_nm FROM tb_trdp x where x.trdp_cd = cfs_trdp_cd) AS cfs_trdp_nm,
	bl.rt_trdp_cd,
	(SELECT eng_nm FROM tb_trdp x where x.trdp_cd = rt_trdp_cd) AS rt_trdp_nm,
	bl.imp_ref_no,
	bl.cust_ref_no,
	bl.att_mk_txt,
	bl.att_desc_txt,
	bl.cntr_info,
	bl.desc_txt1,
	reserve_field01,
	reserve_field02,
	reserve_field03,
	reserve_field04,
	reserve_field05,
	reserve_field06,
	reserve_field11,
	bl.cut_off_dt,	<!-- #33408 OEM B/L Entry 화면에서 Port Cut-Off Date, Time 값이 저장 안됨 -->
	bl.rail_cut_off_dt,
	bl.pu_trdp_cd,
	(SELECT eng_nm FROM tb_trdp x where x.trdp_cd = bl.pu_trdp_cd) as pu_trdp_nm
	,bl.etd_por_tm
	,bl.ccn_no
	,bl.ccn_dt
	,bl.pre_ccn_no
	,bl.mnf_fr_loc
	,bl.mnf_to_loc
	,(select post_dt_imp from tb_ofc ofc where ofc.ofc_cd = bl.ref_ofc_cd and ofc.delt_flg = 'N') as i_post_dt_imp
	,bnd.ctrb_ofc_cd
	,bnd.ctrb_dept_cd
	,bnd.ctrb_ratio_yn
	,bnd.ctrb_mgn
    ,bnd.cfs_rmk
	FROM tb_intg_bl bl

	JOIN tb_add_info_bnd bnd
	ON bl.intg_bl_seq = bnd.intg_bl_seq AND bnd.bnd_clss_cd = #bnd_clss_cd#
	AND bnd.delt_flg = 'N'

	LEFT OUTER JOIN tb_bl_prnr shp
	ON bl.intg_bl_seq = shp.intg_bl_seq AND shp.bl_trdp_tp_cd = 'S01' AND
	shp.delt_flg = 'N'

	LEFT OUTER JOIN tb_bl_prnr cne
	ON bl.intg_bl_seq = cne.intg_bl_seq AND cne.bl_trdp_tp_cd = 'C01' AND
	cne.delt_flg = 'N'

	LEFT OUTER JOIN tb_bl_prnr ntf
	ON bl.intg_bl_seq = ntf.intg_bl_seq AND ntf.bl_trdp_tp_cd = 'N01' AND
	ntf.delt_flg = 'N'

	LEFT OUTER JOIN tb_bl_prnr lnr
	ON bl.intg_bl_seq = lnr.intg_bl_seq AND lnr.bl_trdp_tp_cd = 'L01' AND
	lnr.delt_flg = 'N'

	LEFT OUTER JOIN tb_bl_prnr agent
	ON bl.intg_bl_seq = agent.intg_bl_seq AND agent.bl_trdp_tp_cd = 'A01' AND
	agent.delt_flg = 'N'

	LEFT OUTER JOIN tb_bl_prnr prnr
	ON bl.intg_bl_seq = prnr.intg_bl_seq AND prnr.bl_trdp_tp_cd = 'P01' AND
	prnr.delt_flg = 'N'

	LEFT OUTER JOIN tb_bl_prnr carr
	ON bl.intg_bl_seq = carr.intg_bl_seq AND carr.bl_trdp_tp_cd = 'B01' AND
	carr.delt_flg = 'N'

	LEFT OUTER JOIN tb_bl_prnr prn2
	ON bl.intg_bl_seq = prn2.intg_bl_seq AND prn2.bl_trdp_tp_cd = 'P03' AND
	prn2.delt_flg = 'N'

	LEFT OUTER JOIN tb_bl_prnr third
	ON bl.intg_bl_seq = third.intg_bl_seq AND third.bl_trdp_tp_cd = 'T01' AND
	third.delt_flg = 'N'

	LEFT OUTER JOIN(SELECT INTG_BL_SEQ AS INTG_BL_SEQ1, BL_STS_CD AS BL_STS_CD1 FROM TB_INTG_BL_BLCK) BLCK 
	ON BL.INTG_BL_SEQ = BLCK.INTG_BL_SEQ1
	
	WHERE bl.delt_flg = 'N' AND bl.biz_clss_cd = 'M' AND bl.air_sea_clss_cd = #air_sea_clss_cd#
		<isNotEmpty property="f_intg_bl_seq">
			AND bl.intg_bl_seq = #f_intg_bl_seq#
		</isNotEmpty>
		<isNotEmpty property="f_sr_no">
			AND bl.sr_no = #f_sr_no#        AND     bl.sr_seq IS NOT NULL
		</isNotEmpty>
		<isNotEmpty property="f_bl_no">
			AND bl.bl_no = #f_bl_no#
		</isNotEmpty>
		<isNotEmpty property="f_ref_no">
			AND bl.ref_no = #f_ref_no#
		</isNotEmpty>
		<isNotEmpty property="f_lnr_bkg_no">
			AND bl.lnr_bkg_no = #f_lnr_bkg_no#
		</isNotEmpty>
        <isNotEmpty property="f_hbl_intg_bl_seq">
            AND bl.intg_bl_seq = (SELECT rlt_intg_bl_seq FROM tb_intg_bl_rlt WHERE intg_bl_seq = #f_hbl_intg_bl_seq# AND delt_flg = 'N')          
        </isNotEmpty>
    </select>
    
    <update id="updateINTG_MBL_INFO" parameterClass="SeeMasterBLVO">
        UPDATE  tb_intg_bl
           SET  lnr_bkg_no     = #lnr_bkg_no#,         shp_mod_cd     = #shp_mod_cd#,          bl_ser_no  = #bl_ser_no#,
				bl_no          = #bl_no#,
	   
                frt_term_cd    = #frt_term_cd#,        rep_cmdt_cd    = #rep_cmdt_cd#,         rep_cmdt_nm= #rep_cmdt_nm#,
                pck_qty        = #pck_qty#,            pck_ut_cd      = #pck_ut_cd#,
                grs_wgt        = #grs_wgt#,            grs_wgt_ut_cd  = #grs_wgt_ut_cd#,
                act_wgt        = #act_wgt#,            act_wgt_ut_cd  = #act_wgt_ut_cd#,
                meas           = #meas#,               meas_ut_cd     = #meas_ut_cd#,

                fm_svc_term_cd = #fm_svc_term_cd#,     to_svc_term_cd = #to_svc_term_cd#,      srd_flg    = #srd_flg#,

                por_cd         = #por_cd#,             por_nm     = #por_nm#,
                pol_cd         = #pol_cd#,             pol_nod_cd     = #pol_nod_cd#,          pol_nm     = #pol_nm#,
                pod_cd         = #pod_cd#,             pod_nod_cd     = #pod_nod_cd#,          pod_nm     = #pod_nm#,
                del_cd         = #del_cd#,             del_nm     = #del_nm#,
                iss_loc_cd     = #iss_loc_cd#,         iss_loc_nm     = #iss_loc_nm#,
	            pay_loc_cd     = #pay_loc_cd#,         pay_loc_nm     = #pay_loc_nm#,
	   
                fnl_dest_loc_cd= #fnl_dest_loc_cd#,    fnl_dest_loc_nm= #fnl_dest_loc_nm#,

                trnk_vsl_cd    = #trnk_vsl_cd#,        trnk_vsl_nm    = #trnk_vsl_nm#,         trnk_voy   = #trnk_voy#,

                bl_iss_dt      = #bl_iss_dt#,         
                etd_dt_tm      = #etd_dt_tm#,          eta_dt_tm = #eta_dt_tm#,

                mk_txt         = #mk_txt#,             desc_txt   = #desc_txt#,                 rmk       = #rmk#,

                modi_usrid     = #opr_usrid#,          modi_ofc_cd    = #opr_ofc_cd#,          dept_cd = #opr_dept_cd#,
                modi_usr_nm    = #opr_usrnm#,          modi_tms       = GETUTCDATE(),

sad_txt = #sad_txt#,
hbl_tp_cd = #hbl_tp_cd#,
cargo_tp_cd = #cargo_tp_cd#,                
curr_cd = #curr_cd#,
ref_no = #ref_no#,
sub_bl_no = #sub_bl_no#,
mbl_ref_no = #mbl_ref_no#,
post_dt = #post_dt#,
sub_mbl_flg = #sub_mbl_flg#,
state_cd = #state_cd#,
grs_wgt1 = #grs_wgt1#,
act_wgt1 = #act_wgt1#,
meas1 = #meas1#,
size_ut_cd = #size_ut_cd#,
agent_rt = #agent_rt#,
agent_amt = #agent_amt#,
agent_curr_cd = #agent_curr_cd#,
cust_rt = #cust_rt#,
cust_amt = #cust_amt#,
cust_curr_cd = #cust_curr_cd#,
profit_share = #profit_share#,
express_tp_cd = #express_tp_cd#,
iss_loc_cd1 = #iss_loc_cd1#,
iss_loc_nm1 = #iss_loc_nm1#,
trans_shipment = #trans_shipment#,
itn_no = #itn_no#,
onward_rout = #onward_rout#,
clean_on_board = #clean_on_board#,
frt_term_c_cd = #frt_term_c_cd#,
frt_term_a_cd = #frt_term_a_cd#,
obrd_dt_tm1 = #obrd_dt_tm1#,
ref_ofc_cd = #ref_ofc_cd#,
exp_ref_no = #exp_ref_no#,
obl_tp_cd = #obl_tp_cd#,
broker_rt = #broker_rt#,
cut_off_dt = #cut_off_dt#,
rcv_wh_cd = #rcv_wh_cd#,
sc_no = #sc_no#,
cnt_cd = #cnt_cd#,
mk_grs_wgt = #mk_grs_wgt#,
mk_grs_wgt1 = #mk_grs_wgt1#,
mk_meas = #mk_meas#,
mk_meas1 = #mk_meas1#,
f_eta_dt_tm = #f_eta_dt_tm#,
d_eta_dt_tm = #d_eta_dt_tm#,
avail_dt_tm = #avail_dt_tm#,
lfd_dt_tm = #lfd_dt_tm#,
go_dt_tm = #go_dt_tm#,
rcvd_dt_tm = #rcvd_dt_tm#,
rlsd_dt_tm = #rlsd_dt_tm#,
te = #te#,
it_no = #it_no#,
it_loc = #it_loc#,
bond_carr_cd = #bond_carr_cd#,
bond_no = #bond_no#,
goods_at = #goods_at#,
goods_value = #goods_value#,
door_loc_cd = #door_loc_cd#,
fnl_wh_cd = #fnl_wh_cd#,
org_bl_rcvd_flg = #org_bl_rcvd_flg#,
ror_flg = #ror_flg#,
rlsd_flg = #rlsd_flg#,
rlsd_usrid = #rlsd_usrid#,
te_dt_tm = #te_dt_tm#,
ams_no = #ams_no#,
isf_no = #isf_no#,
carr_trdp_cd1 = #carr_trdp_cd1#,
cy_trdp_cd = #cy_trdp_cd#,
cfs_trdp_cd = #cfs_trdp_cd#,
rt_trdp_cd = #rt_trdp_cd#,
imp_ref_no = #imp_ref_no#,
cust_ref_no = #cust_ref_no#,
att_mk_txt = #att_mk_txt#,
att_desc_txt = #att_desc_txt#,
cntr_info = #cntr_info#,
desc_txt1 = #desc_txt1#,
reserve_field01 = #reserve_field01#,
reserve_field02 = #reserve_field02#,
reserve_field03 = #reserve_field03#,
reserve_field04 = #reserve_field04#,
reserve_field05 = #reserve_field05#,
reserve_field06 = #reserve_field06#,
reserve_field11 = #reserve_field11#,
rail_cut_off_dt = #rail_cut_off_dt#,
pu_trdp_cd      = #pu_trdp_cd#,
etd_por_tm		= #etd_por_tm#,
doc_cut_off_dt = #doc_cut_off_dt#
,ccn_no = #ccn_no#
,ccn_dt = #ccn_dt#
,pre_ccn_no = #pre_ccn_no#
,mnf_fr_loc = #mnf_fr_loc#
,mnf_to_loc = #mnf_to_loc#
         WHERE  intg_bl_seq    = #intg_bl_seq#
    </update>
    
    <update id="updateBLREF_NO" parameterClass="HashMap">
    	 UPDATE  tb_intg_bl
            SET  ref_no     = #ref_no#  
    	  WHERE  intg_bl_seq = #intg_bl_seq# 
    	    OR   intg_bl_seq IN (SELECT intg_bl_seq FROM tb_intg_bl_rlt WHERE rlt_intg_bl_seq = #intg_bl_seq#)
    </update>
    
    <update id="updateJNREF_NO" parameterClass="HashMap">
    	 UPDATE  tb_jnr_dtl
            SET  ref_no     = #ref_no#  
    	  WHERE  ref_no     = #sel_ref_no# 
    </update>
    
    <!--BL정보를 업데이트함  -->
    <update id="updateHBL_MBL_DT" parameterClass="SeeMasterBLVO">
    	/* updateHBL_MBL_DT */
        UPDATE  tb_intg_bl
           SET  etd_dt_tm  = #etd_dt_tm#
               ,obrd_dt_tm = #etd_dt_tm#
               <!-- 30284 [BINEX]OEH On-Board Date 동기화 -->
               ,obrd_dt_tm1 = #etd_dt_tm#
               <isNotEmpty property="clean_on_board">
	           ,clean_on_board = #clean_on_board#
				</isNotEmpty>
           	   ,post_dt	   = #post_dt#
           	   ,ref_ofc_cd	   = #ref_ofc_cd#
         WHERE  intg_bl_seq IN (SELECT intg_bl_seq FROM tb_intg_bl_rlt WHERE rlt_intg_bl_seq = #intg_bl_seq#)
           AND  biz_clss_cd = 'H'
    </update>
    
    <update id="updateHBL_MBL_DT_IMP" parameterClass="SeeMasterBLVO">
    	/* updateHBL_MBL_DT_IMP */
        UPDATE  tb_intg_bl
           SET  eta_dt_tm  = #eta_dt_tm#
           	   ,post_dt	   = #post_dt#
           	   ,ref_ofc_cd	   = #ref_ofc_cd#
         WHERE  intg_bl_seq IN (SELECT intg_bl_seq FROM tb_intg_bl_rlt WHERE rlt_intg_bl_seq = #intg_bl_seq#)
           AND  biz_clss_cd = 'H'
    </update>
    
    <update id="updateMBL_FRT_INV_POST_DT" parameterClass="SeeMasterBLVO">
    	UPDATE  TB_FRT 
		   SET  INV_POST_DT = #post_dt#
		 WHERE  <![CDATA[INV_SEQ <> '']]>
		   AND  FRT_SEQ IN (
				SELECT  FRT.FRT_SEQ
				  FROM  TB_FRT FRT
	   LEFT OUTER JOIN  TB_INV_DTL IDTL ON FRT.INV_SEQ = IDTL.INV_SEQ
	   LEFT OUTER JOIN (SELECT INV_SEQ AS INV_SEQ1, INV_NO AS INV_NO1, CLT_CMPL_FLG AS CLT_CMPL_FLG1 FROM TB_INV_DTL_BLCK) BLCK ON IDTL.INV_SEQ = BLCK.INV_SEQ1 AND IDTL.INV_NO = BLCK.INV_NO1 
				 WHERE  FRT.INTG_BL_SEQ = #intg_bl_seq#
				   AND  ISNULL(ISNULL(BLCK.CLT_CMPL_FLG1, IDTL.CLT_CMPL_FLG), 'N') = 'N'
				   AND  ISNULL(IDTL.PAY_AMT, 0) = 0
		   		)
    </update>
    
    <update id="updateHBL_FRT_INV_POST_DT" parameterClass="SeeMasterBLVO">
    	UPDATE  TB_FRT 
		   SET  INV_POST_DT = #post_dt#
		 WHERE  <![CDATA[INV_SEQ <> '']]>
		   AND  FRT_SEQ IN (
				SELECT  FRT.FRT_SEQ
				  FROM  TB_FRT FRT
	   LEFT OUTER JOIN  TB_INV_DTL IDTL ON FRT.INV_SEQ = IDTL.INV_SEQ
	   LEFT OUTER JOIN (SELECT INV_SEQ AS INV_SEQ1, INV_NO AS INV_NO1, CLT_CMPL_FLG AS CLT_CMPL_FLG1 FROM TB_INV_DTL_BLCK) BLCK ON IDTL.INV_SEQ = BLCK.INV_SEQ1 AND IDTL.INV_NO = BLCK.INV_NO1 
				 WHERE  FRT.INTG_BL_SEQ IN (
						SELECT  INTG_BL_SEQ
						  FROM  TB_INTG_BL_RLT RLT
						 WHERE  RLT.RLT_INTG_BL_SEQ = #intg_bl_seq#
						)
				   AND  ISNULL(ISNULL(BLCK.CLT_CMPL_FLG1, IDTL.CLT_CMPL_FLG), 'N') = 'N'
				   AND  ISNULL(IDTL.PAY_AMT, 0) = 0
		   		)
    </update>
    
    <update id="updateMBL_INV_DTL_INV_POST_DT" parameterClass="SeeMasterBLVO">
		<!--
		UPDATE  TB_INV_DTL
		   SET  INV_POST_DT = #post_dt#
			    ,modi_tms			= getdate()
		 WHERE  INV_SEQ IN (
				SELECT  IDTL.INV_SEQ
				  FROM  TB_FRT FRT
	   LEFT OUTER JOIN  TB_INV_DTL IDTL ON FRT.INV_SEQ = IDTL.INV_SEQ
				 WHERE  FRT.INTG_BL_SEQ = #intg_bl_seq#
				   AND  ISNULL(IDTL.CLT_CMPL_FLG, 'N') = 'N'
				   AND  ISNULL(IDTL.PAY_AMT, 0) = 0
			  GROUP BY  IDTL.INV_SEQ
		   		)
		-->
		
		UPDATE  tb_inv_dtl
		   SET  inv_post_dt = #post_dt#
			   ,inv_dt = CASE WHEN y.post_dt_inv = 'POST' 
		                      THEN #post_dt#
		                      ELSE inv_dt
		                 END     
		 	   ,inv_due_dt = CASE WHEN y.post_dt_inv = 'POST' 
		                      	  THEN y.due_dt
		                          ELSE inv_due_dt
		                     END
		       ,modi_usrid 	= #proc_usrid#
		       ,modi_ofc_cd	= #proc_ofccd#              
			   ,modi_tms	= GETUTCDATE()
		  FROM  tb_inv_dtl dtl
		      , (SELECT inv.inv_seq,
		                (select post_dt_inv from tb_ofc where ofc_cd = inv.ofc_cd) AS post_dt_inv,
						CONVERT(VARCHAR
		                       ,case when trdp.cr_term_cd = 'A' 
								     then dateadd(d, convert(int, trdp.cr_term_dt), #post_dt#)
								     when trdp.cr_term_cd = 'B' 
								     then dateadd(month,1,#post_dt#)-(day(#post_dt#))
								     when trdp.cr_term_cd = 'C' 
								     then dateadd(month,2,#post_dt#)-(day(#post_dt#))
								     when trdp.cr_term_cd = 'D' 
								     then dateadd(d, convert(int, trdp.cr_term_dt), dateadd(month,1,#post_dt#)-(day(#post_dt#)))
								end
							   ,112) AS due_dt
					FROM tb_inv inv
						 JOIN tb_inv_dtl dtl ON inv.inv_seq = dtl.inv_seq
						 LEFT OUTER JOIN tb_trdp trdp ON inv.trdp_cd = trdp.trdp_cd 
						 LEFT OUTER JOIN (SELECT INV_SEQ AS INV_SEQ1, INV_NO AS INV_NO1, CLT_CMPL_FLG AS CLT_CMPL_FLG1 FROM TB_INV_DTL_BLCK) BLCK ON DTL.INV_SEQ = BLCK.INV_SEQ1 AND DTL.INV_NO = BLCK.INV_NO1 
				   WHERE inv.inv_seq IN (
										SELECT  frt.inv_seq
										  FROM  tb_frt frt
										 WHERE  ISNULL(frt.inv_seq, '') != ''
										   AND  frt.intg_bl_seq = #intg_bl_seq#
									 	 GROUP BY  frt.inv_seq
										) 
				     AND ISNULL(ISNULL(BLCK.CLT_CMPL_FLG1, DTL.CLT_CMPL_FLG), 'N') = 'N'
			         AND ISNULL(dtl.pay_amt, 0) = 0   								
				) y						
			WHERE dtl.inv_seq = y.inv_seq
			  
    </update>
    
    <update id="updateMBL_INV_DTL_INV_DT" parameterClass="SeeMasterBLVO">
		UPDATE  TB_INV_DTL
		   SET  INV_DT = #post_dt#
		 	  , INV_DUE_DT = Y.DUE_DT
			    ,modi_tms			= GETUTCDATE()
		  FROM  TB_INV_DTL DTL
		  LEFT OUTER JOIN (SELECT INV_SEQ AS INV_SEQ1, INV_NO AS INV_NO1, CLT_CMPL_FLG AS CLT_CMPL_FLG1 FROM TB_INV_DTL_BLCK) BLCK ON DTL.INV_SEQ = BLCK.INV_SEQ1 AND DTL.INV_NO = BLCK.INV_NO1 
		      , (
					SELECT INV.INV_SEQ, 
					case when trdp.cr_term_cd = 'A' then CONVERT(varchar, DATEADD(DD, CONVERT(numeric, trdp.cr_term_dt), CONVERT(datetime, #post_dt#)), 112) else
					      case when trdp.cr_term_cd = 'B' then CONVERT(varchar, DATEADD(DD, -datepart(DD, DATEADD(M, 1, CONVERT(datetime, #post_dt#))), DATEADD(M, 1, CONVERT(datetime, #post_dt#))), 112) else 
					      case when trdp.cr_term_cd = 'C' then CONVERT(varchar, DATEADD(DD, -datepart(DD, DATEADD(M, 2, CONVERT(datetime, #post_dt#))), DATEADD(M, 2, CONVERT(datetime, #post_dt#))), 112) else 
					      case when trdp.cr_term_cd = 'D' then CONVERT(varchar, DATEADD(DD, CONVERT(numeric, trdp.cr_term_dt), DATEADD(DD, -datepart(DD, DATEADD(M, 1, CONVERT(datetime, #post_dt#))), DATEADD(M, 1, CONVERT(datetime, #post_dt#)))), 112) else ''
					      end end end end AS DUE_DT
					FROM TB_INV INV
					JOIN TB_INV_DTL DTL ON INV.INV_SEQ = DTL.INV_SEQ
					LEFT OUTER JOIN TB_TRDP TRDP ON INV.TRDP_CD = TRDP.TRDP_CD
					JOIN (
							SELECT  FRT.INV_SEQ
							  FROM  TB_FRT FRT
							 WHERE  <![CDATA[FRT.INV_SEQ <> '']]>
							   AND  FRT.INTG_BL_SEQ = #intg_bl_seq#
							   AND  FRT.SELL_BUY_TP_CD != 'B'
						  GROUP BY  FRT.INV_SEQ
							
						) X ON DTL.INV_SEQ = X.INV_SEQ
						) Y
						
						WHERE DTL.INV_SEQ = Y.INV_SEQ
						  AND ISNULL(ISNULL(BLCK.CLT_CMPL_FLG1, DTL.CLT_CMPL_FLG), 'N') = 'N'
						  AND ISNULL(DTL.PAY_AMT, 0) = 0
    </update>
    
    <update id="updateHBL_INV_DTL_INV_POST_DT" parameterClass="SeeMasterBLVO">
		<!--		
		UPDATE  TB_INV_DTL
		   SET  INV_POST_DT = #post_dt#
			    ,modi_tms			= getdate()
		 WHERE  INV_SEQ IN (
				SELECT  IDTL.INV_SEQ
				  FROM  TB_FRT FRT
	   LEFT OUTER JOIN  TB_INV_DTL IDTL ON FRT.INV_SEQ = IDTL.INV_SEQ
				 WHERE  FRT.INTG_BL_SEQ IN (
						SELECT  INTG_BL_SEQ
						  FROM  TB_INTG_BL_RLT RLT
						 WHERE  RLT.RLT_INTG_BL_SEQ = #intg_bl_seq#
						)
				   AND  ISNULL(IDTL.CLT_CMPL_FLG, 'N') = 'N'
				   AND  ISNULL(IDTL.PAY_AMT, 0) = 0
			  GROUP BY  IDTL.INV_SEQ
		   		)
		-->   		
		UPDATE  tb_inv_dtl
		   SET  inv_post_dt = #post_dt#
			   ,inv_dt = CASE WHEN y.post_dt_inv = 'POST' 
		                      THEN #post_dt#
		                      ELSE inv_dt
		                 END     
		 	   ,inv_due_dt = CASE WHEN y.post_dt_inv = 'POST' 
		                      	  THEN y.due_dt
		                          ELSE inv_due_dt
		                     END
		       ,modi_usrid 	= #proc_usrid#
		       ,modi_ofc_cd	= #proc_ofccd#           
			   ,modi_tms	= GETUTCDATE()
		  FROM  tb_inv_dtl dtl
		      , (SELECT inv.inv_seq,
		                (select post_dt_inv from tb_ofc where ofc_cd = inv.ofc_cd) AS post_dt_inv,
						CONVERT(VARCHAR
		                       ,case when trdp.cr_term_cd = 'A' 
								     then dateadd(d, convert(int, trdp.cr_term_dt), #post_dt#)
								     when trdp.cr_term_cd = 'B' 
								     then dateadd(month,1,#post_dt#)-(day(#post_dt#))
								     when trdp.cr_term_cd = 'C' 
								     then dateadd(month,2,#post_dt#)-(day(#post_dt#))
								     when trdp.cr_term_cd = 'D' 
								     then dateadd(d, convert(int, trdp.cr_term_dt), dateadd(month,1,#post_dt#)-(day(#post_dt#)))
								end
							   ,112) AS due_dt
					FROM tb_inv inv
						 JOIN tb_inv_dtl dtl ON inv.inv_seq = dtl.inv_seq
						 LEFT OUTER JOIN tb_trdp trdp ON inv.trdp_cd = trdp.trdp_cd 
						 LEFT OUTER JOIN (SELECT INV_SEQ AS INV_SEQ1, INV_NO AS INV_NO1, CLT_CMPL_FLG AS CLT_CMPL_FLG1 FROM TB_INV_DTL_BLCK) BLCK ON DTL.INV_SEQ = BLCK.INV_SEQ1 AND DTL.INV_NO = BLCK.INV_NO1 
				   WHERE inv.inv_seq IN (
										SELECT  frt.inv_seq
										  FROM  tb_frt frt, tb_intg_bl_rlt rlt
										 WHERE  ISNULL(frt.inv_seq, '') != ''
										   AND  rlt.rlt_intg_bl_seq = #intg_bl_seq#
										   AND  frt.intg_bl_seq = rlt.intg_bl_seq
									 	 GROUP BY  frt.inv_seq
										) 
				     AND ISNULL(ISNULL(BLCK.CLT_CMPL_FLG1, DTL.CLT_CMPL_FLG), 'N') = 'N'
			         AND ISNULL(dtl.pay_amt, 0) = 0   								
				) y						
			WHERE dtl.inv_seq = y.inv_seq
				   		
    </update>
    
    <update id="updateHBL_INV_DTL_INV_DT" parameterClass="SeeMasterBLVO">
		UPDATE  TB_INV_DTL
		   SET  INV_DT = #post_dt#
		      , INV_DUE_DT = Y.DUE_DT
			    ,modi_tms			= GETUTCDATE()
		  FROM  TB_INV_DTL DTL
		  LEFT OUTER JOIN (SELECT INV_SEQ AS INV_SEQ1, INV_NO AS INV_NO1, CLT_CMPL_FLG AS CLT_CMPL_FLG1 FROM TB_INV_DTL_BLCK) BLCK ON DTL.INV_SEQ = BLCK.INV_SEQ1 AND DTL.INV_NO = BLCK.INV_NO1 
		      , (
					SELECT INV.INV_SEQ, 
					case when trdp.cr_term_cd = 'A' then CONVERT(varchar, DATEADD(DD, CONVERT(numeric, trdp.cr_term_dt), CONVERT(datetime, #post_dt#)), 112) else
					      case when trdp.cr_term_cd = 'B' then CONVERT(varchar, DATEADD(DD, -datepart(DD, DATEADD(M, 1, CONVERT(datetime, #post_dt#))), DATEADD(M, 1, CONVERT(datetime, #post_dt#))), 112) else 
					      case when trdp.cr_term_cd = 'C' then CONVERT(varchar, DATEADD(DD, -datepart(DD, DATEADD(M, 2, CONVERT(datetime, #post_dt#))), DATEADD(M, 2, CONVERT(datetime, #post_dt#))), 112) else 
					      case when trdp.cr_term_cd = 'D' then CONVERT(varchar, DATEADD(DD, CONVERT(numeric, trdp.cr_term_dt), DATEADD(DD, -datepart(DD, DATEADD(M, 1, CONVERT(datetime, #post_dt#))), DATEADD(M, 1, CONVERT(datetime, #post_dt#)))), 112) else ''
					      end end end end AS DUE_DT
					FROM TB_INV INV
					JOIN TB_INV_DTL DTL ON INV.INV_SEQ = DTL.INV_SEQ
					LEFT OUTER JOIN TB_TRDP TRDP ON INV.TRDP_CD = TRDP.TRDP_CD 
					JOIN (
							SELECT  FRT.INV_SEQ
							  FROM  TB_FRT FRT
							 WHERE  <![CDATA[FRT.INV_SEQ <> '']]>
							   AND  FRT.INTG_BL_SEQ IN (SELECT  BL.INTG_BL_SEQ
														  FROM  TB_INTG_BL BL
														 WHERE  BL.INTG_BL_SEQ IN (SELECT  RLT.INTG_BL_SEQ 
																					 FROM  TB_INTG_BL_RLT RLT
																					WHERE  RLT.RLT_INTG_BL_SEQ = #intg_bl_seq#
																				   )
														   AND  BL.DELT_FLG = 'N'
														)
							   AND  FRT.SELL_BUY_TP_CD != 'B'
						  GROUP BY  FRT.INV_SEQ
							
						) X ON DTL.INV_SEQ = X.INV_SEQ
						) Y
						
						WHERE DTL.INV_SEQ = Y.INV_SEQ
						  AND ISNULL(ISNULL(BLCK.CLT_CMPL_FLG1, DTL.CLT_CMPL_FLG), 'N') = 'N'
						  AND ISNULL(DTL.PAY_AMT, 0) = 0
    </update>
    
    <update id="updateFRT_SLS_OFC_CD" parameterClass="SeeMasterBLVO">
		UPDATE  TB_FRT
		   SET  SLS_OFC_CD = #ref_ofc_cd#
			   ,modi_tms   = GETUTCDATE()
	     WHERE  1=1
		   AND  FRT_SEQ IN (
							SELECT  FRT.FRT_SEQ
							  FROM  TB_FRT FRT
							 WHERE  1=1
							   AND  (FRT.INTG_BL_SEQ = #intg_bl_seq#
							         OR
							         FRT.INTG_BL_SEQ IN (SELECT  BL.INTG_BL_SEQ
														   FROM  TB_INTG_BL BL
														  WHERE  BL.INTG_BL_SEQ IN (SELECT  RLT.INTG_BL_SEQ 
																					 FROM  TB_INTG_BL_RLT RLT
																					WHERE  RLT.RLT_INTG_BL_SEQ = #intg_bl_seq#
																				   )
														   AND  BL.DELT_FLG = 'N'
														)
									)					
						   )
		   AND SLS_OFC_CD != #ref_ofc_cd#				   
    </update>
    
    <update id="updateINV_OFC_CD" parameterClass="SeeMasterBLVO">
		UPDATE  TB_INV
		   SET  OFC_CD = #ref_ofc_cd#
			   ,modi_tms   = GETUTCDATE()
	     WHERE  1=1
		   AND  INV_SEQ IN (
							SELECT  IDTL.INV_SEQ
							  FROM  TB_FRT FRT
				                    JOIN  TB_INV_DTL IDTL ON FRT.INV_SEQ = IDTL.INV_SEQ
							 WHERE  1=1
							   AND  (FRT.INTG_BL_SEQ = #intg_bl_seq#
							         OR
							         FRT.INTG_BL_SEQ IN (SELECT  BL.INTG_BL_SEQ
														   FROM  TB_INTG_BL BL
														  WHERE  BL.INTG_BL_SEQ IN (SELECT  RLT.INTG_BL_SEQ 
																					 FROM  TB_INTG_BL_RLT RLT
																					WHERE  RLT.RLT_INTG_BL_SEQ = #intg_bl_seq#
																				   )
														   AND  BL.DELT_FLG = 'N'
														)
									)		
							)
		   AND  OFC_CD != #ref_ofc_cd#					
    </update>
    
    <update id="updateJNR_DTL_OFC_CD" parameterClass="SeeMasterBLVO">
		UPDATE  TB_JNR_DTL
		   SET  OFC_CD   = #ref_ofc_cd#
		       ,P_OFC_CD = #ref_ofc_cd#
			   ,modi_tms   = GETUTCDATE()
	     WHERE  1=1
		   AND  INV_SEQ IN (
							SELECT  IDTL.INV_SEQ
							  FROM  TB_FRT FRT
				                    JOIN  TB_INV_DTL IDTL ON FRT.INV_SEQ  = IDTL.INV_SEQ
							 WHERE  1=1
							   AND  (FRT.INTG_BL_SEQ = #intg_bl_seq#
							         OR
							         FRT.INTG_BL_SEQ IN (SELECT  BL.INTG_BL_SEQ
														   FROM  TB_INTG_BL BL
														  WHERE  BL.INTG_BL_SEQ IN (SELECT  RLT.INTG_BL_SEQ 
																					 FROM  TB_INTG_BL_RLT RLT
																					WHERE  RLT.RLT_INTG_BL_SEQ = #intg_bl_seq#
																				   )
														   AND  BL.DELT_FLG = 'N'
														)
									)		
						   )
		   AND  OFC_CD != #ref_ofc_cd#					   
    </update>
    
    <!-- House B/L Info select  Chungrue 2011.11.02  -->
    <select id="selectHBL_CustomerInfo" parameterClass="java.util.HashMap" resultClass="java.util.HashMap">
        SELECT  bl.intg_bl_seq,     				bl.bl_no,
        		shp.trdp_nm AS shpr_trdp_nm,		shp.trdp_addr AS shpr_trdp_addr,
        		ntf.trdp_nm AS ntf_trdp_nm,			ntf.trdp_addr AS ntf_trdp_addr
          FROM  tb_intg_bl bl
				LEFT OUTER JOIN tb_bl_prnr shp
            ON  bl.intg_bl_seq = shp.intg_bl_seq  AND shp.bl_trdp_tp_cd = 'S01' AND shp.delt_flg = 'N'
				LEFT OUTER JOIN tb_bl_prnr ntf
            ON  bl.intg_bl_seq = ntf.intg_bl_seq  AND ntf.bl_trdp_tp_cd = 'N01' AND ntf.delt_flg = 'N'
         WHERE  bl.bl_no = #txt_hbl_no#
    </select>
    
    <!-- selectIntg_Bl_Info select  -->
    <select id="selectIntg_Bl_Info" parameterClass="java.util.HashMap" resultClass="java.util.HashMap">
        SELECT  bl.intg_bl_seq,     				bl.bl_no,
        		bl.cust_ref_no
          FROM  tb_intg_bl bl
         WHERE  bl.intg_bl_seq = #intg_bl_seq#
    </select>
    
    <select id="selectChkRlt" parameterClass="HashMap" resultClass="String">
    	SELECT RLT_INTG_BL_SEQ
		  FROM TB_INTG_BL_RLT
		 WHERE INTG_BL_SEQ = #intg_bl_seq#
    </select>
    
    <select id="selectChkRltIntgBl" parameterClass="HashMap" resultClass="String">
    	SELECT RLT_INTG_BL_SEQ
		  FROM TB_INTG_BL_RLT
		 WHERE INTG_BL_SEQ = #intg_bl_seq#
		    AND RLT_INTG_BL_SEQ = #rlt_intg_bl_seq#
    </select>
    
     <update id="deleteRltIntgBl" parameterClass="HashMap">
		/* BlCmmSQL.xml >  deleteRltIntgBl  */
        DELETE  tb_intg_bl_rlt
         WHERE  intg_bl_seq= #intg_bl_seq#
             AND RLT_INTG_BL_SEQ = #rlt_intg_bl_seq#
    </update>
    
    <insert id="insertEXP_INTG_BL_RLT" parameterClass="HashMap">
    	INSERT INTO  tb_intg_bl_rlt(
                 intg_bl_seq,     rlt_intg_bl_seq,   intg_bl_rlt_cd,
                 rgst_usrid,      rgst_ofc_cd,       rgst_tms,         
                 modi_usrid,      modi_ofc_cd,       modi_tms,     delt_flg
        )VALUES(
                #intg_bl_seq#,    #rlt_intg_bl_seq#, #intg_bl_rlt_cd#,
                #proc_usrid#,     #proc_ofccd#,      getdate(),
                #proc_usrid#,     #proc_ofccd#,      GETUTCDATE(),        'N'
        )
    </insert>
    
    <update id="updateRefInfo" parameterClass="HashMap">
    	UPDATE tb_intg_bl
    	   SET ref_no = #ref_no#
    	     , ref_ofc_cd = #ref_ofc_cd#
    	 WHERE intg_bl_seq = #intg_bl_seq#
    </update>
    
    
    
    <update id="updatePost_dt" parameterClass="HashMap">
    	UPDATE tb_intg_bl
    	   SET post_dt = ( select post_dt  from tb_intg_bl where intg_bl_seq = #rlt_intg_bl_seq# )    	    
    	 WHERE intg_bl_seq = #intg_bl_seq#
    </update>
    
    <select id="selectRefNo" parameterClass="HashMap" resultClass="String">
    /*  BlCmmSQL.xml > selectRefNo */
		 SELECT TOP 1 ISNULL(bl.air_sea_clss_cd, '')
		 	+ '^^' + ISNULL(bl.ref_ofc_cd, '')
			+ '^^' + CONVERT(varchar, bl.intg_bl_seq) 
			+ '^^' + ISNULL(bl.bl_no, '')
			+ '^^' + ISNULL(bl.trnk_vsl_nm, '')
			+ '^^' + ISNULL(bl.trnk_voy, '')
			+ '^^' + ISNULL(lnr.trdp_cd, '')
			+ '^^' + ISNULL(lnr.trdp_nm, '')
			+ '^^' + ISNULL(bl.pod_cd, '')
			+ '^^' + ISNULL(bl.pod_nm, '')
			+ '^^' + ISNULL(bl.pol_cd, '')
			+ '^^' + ISNULL(bl.pol_nm, '')
			+ '^^' + ISNULL(bl.etd_dt_tm, '')
			+ '^^' + ISNULL(bl.eta_dt_tm, '')
			+ '^^' + ISNULL(bl.flt_no, '')
			+ '^^' + ISNULL(bl.pod_nod_cd, '')
			+ '^^' + ISNULL(bl.pol_nod_cd, '')
			+ '^^' + ISNULL(bl.lnr_bkg_no, '')
			
			+ '^^' + ISNULL(bl.por_cd, '')
			+ '^^' + ISNULL(bl.por_nm, '')
			+ '^^' + ISNULL(bl.del_cd, '')
			+ '^^' + ISNULL(bl.del_nm, '')
			+ '^^' + ISNULL(bl.shp_mod_cd, '')
			
			+ '^^' + ISNULL(cnee.trdp_cd, '')
			+ '^^' + ISNULL(cnee.trdp_nm, '')
			
			+ '^^' + ISNULL(prnr2.trdp_cd, '')
			+ '^^' + ISNULL(prnr2.trdp_nm, '')
			
			+ '^^' + ISNULL(bl.it_no, '')
			+ '^^' + ISNULL(bl.te_dt_tm, '')
			+ '^^' + ISNULL(bl.it_loc, '')
			+ '^^' + ISNULL(bl.cfs_trdp_cd, '')
			+ '^^' + ISNULL((SELECT x.eng_nm FROM tb_trdp x WHERE x.trdp_cd = bl.cfs_trdp_cd), '')
			+ '^^' + ISNULL(bl.fm_svc_term_cd, '')
			+ '^^' + ISNULL(bl.to_svc_term_cd, '')
			
			+ '^^' + ISNULL(shpr.trdp_cd, '')
			+ '^^' + ISNULL(shpr.trdp_nm, '')
			+ '^^' + ISNULL(shpr.trdp_addr, '')
			
			+ '^^' + ISNULL(cnee.trdp_addr, '')
			+ '^^' + ISNULL(prnr2.trdp_addr, '')
			+ '^^' + ISNULL(bl.sub_bl_no, '')
			
			+ '^^' + ISNULL(bl.cy_trdp_cd, '')
			+ '^^' + ISNULL((SELECT x.eng_nm FROM tb_trdp x WHERE x.trdp_cd = bl.cy_trdp_cd), '')
			
			+ '^^' + ISNULL(bl.ts1_port_cd, '')
			+ '^^' + ISNULL(bl.ts1_flt_no, '')
			+ '^^' + ISNULL(bl.ts2_port_cd, '')
			+ '^^' + ISNULL(bl.ts2_flt_no, '')
			+ '^^' + ISNULL(bl.ts3_port_cd, '')
			+ '^^' + ISNULL(bl.ts3_flt_no, '')
			
			+ '^^' + ISNULL(bl.frt_loc_cd, '')
			+ '^^' + ISNULL((SELECT x.eng_nm FROM tb_trdp x WHERE x.trdp_cd = bl.frt_loc_cd), '')
			
			+ '^^' + ISNULL(bl.f_eta_dt_tm, '')
			+ '^^' + ISNULL(bl.post_dt, '')
			
			+ '^^' + ISNULL(bl.frt_loc_cd, '')
			+ '^^' + ISNULL((SELECT x.eng_nm FROM tb_trdp x WHERE x.trdp_cd = bl.frt_loc_cd), '')
			+ '^^' + ISNULL(bl.f_eta_dt_tm, '')
			+ '^^' + ISNULL(bl.post_dt, '')
			
			<!-- jsjang 2013.7.10 요구사항 #16112 (DIRECT B/L 인 경우 HBL 에 MBL 정보 COPY)  자동연계요건 Start -->
			+ '^^' + ISNULL(bl.hbl_tp_cd, '')
			+ '^^' + ISNULL('', '')
			+ '^^' + ISNULL(ntfy.trdp_cd, '')
			+ '^^' + ISNULL(ntfy.trdp_nm, '')
			+ '^^' + ISNULL(ntfy.trdp_addr, '')
			
			+ '^^' + ISNULL(bl.fnl_dest_loc_cd, '')
			+ '^^' + ISNULL(bl.fnl_dest_loc_nm, '')
			+ '^^' + ISNULL(bl.profit_share, '')
			
			+ '^^' + ISNULL(convert(varchar,bl.pck_qty), '')
			+ '^^' + ISNULL(convert(varchar,bl.pck_ut_cd), '')
			+ '^^' + ISNULL(convert(varchar,bl.grs_wgt), '')
			+ '^^' + ISNULL(convert(varchar,bl.grs_wgt1), '')
			+ '^^' + ISNULL(convert(varchar,bl.meas), '')
			+ '^^' + ISNULL(convert(varchar,bl.meas1), '')
			+ '^^' + ISNULL(CONVERT(varchar(10),convert(DATETIME, bl.bl_iss_dt), 110), '')
			+ '^^' + ISNULL(prnr.trdp_cd, '')
			+ '^^' + ISNULL(prnr.trdp_nm, '')
			+ '^^' + ISNULL(prnr.trdp_addr, '')	
			
			+ '^^' + ISNULL(bl.FRT_TERM_CD, '')	
			+ '^^' + ISNULL(bl.shp_mod_cd, '')	
			+ '^^' + ISNULL(bl.express_tp_cd, '')	
			+ '^^' + ISNULL(bl.rlsd_flg, '')	
			+ '^^' + ISNULL(CONVERT(varchar(10),convert(DATETIME, bl.rlsd_dt_tm), 110), '')				
			
			+ '^^' + ISNULL(CONVERT(varchar(10),convert(DATETIME, bl.bl_dt_tm), 110), '')
			+ '^^' + ISNULL(bl.disp_ntfy_flg, '')
			+ '^^' + ISNULL(bl.cargo_tp_cd, '')
			
			+ '^^' + ISNULL(bl.rep_cmdt_cd, '')
			+ '^^' + ISNULL(bl.rep_cmdt_nm, '')
			
			+ '^^' + ISNULL(convert(varchar,bl.chg_wgt), '')
			+ '^^' + ISNULL(convert(varchar,bl.chg_wgt1), '')
			
			+ '^^' + ISNULL(convert(varchar,bl.vol_wgt), '')
			+ '^^' + ISNULL(convert(varchar,bl.vol_meas), '')
			
			+ '^^' + ISNULL(bl.size_ut_cd, '')
			+ '^^' + ISNULL(bl.decl_cstms_val, '')
			+ '^^' + ISNULL(bl.rt_clss_cd, '')
			
			+ '^^' + ISNULL(bl.imp_ref_no, '')
			+ '^^' + ISNULL(bl.curr_cd, '')
			+ '^^' + ISNULL(bl.cntr_info, '')	<!-- jsjang 2013.8.5 요구사항 #19207 Booking Confirmation - Container Summary -->
			<!-- jsjang 2013.7.10 요구사항 #16112 (DIRECT B/L 인 경우 HBL 에 MBL 정보 COPY)  자동연계요건 End -->
			
			<!-- #20553 : ETD of Place of Receipt 추가, jsjang 2013.9.30 -->
			+ '^^' + ISNULL(CONVERT(varchar(10),convert(DATETIME, case when bl.etd_por_tm = '' then null else bl.etd_por_tm end  ), 110), '')	<!-- 94 -->
			
			<!-- #23821 : [BINEX] Issuing Carrier, MAWB -> HAWB, jsjang 2013.11.25 -->
			+ '^^' + ISNULL(iss.trdp_cd, '')
			+ '^^' + ISNULL(iss.trdp_nm, '')
			+ '^^' + ISNULL(iss.trdp_addr, '')												<!-- 97 -->
			+ '^^' + ISNULL(bl.ccn_no, '')													<!-- 98 -->
			+ '^^' + ISNULL(bl.mnf_fr_loc, '')												<!-- 99 -->
			+ '^^' + ISNULL(bl.mnf_to_loc, '')												<!-- 100 -->
			+ '^^' + ISNULL(bnd.fst_to_cd, '')	                                            <!-- 101 -->
			+ '^^' + ISNULL(bnd.fst_to_nm, '')	                                            <!-- 102 -->
			+ '^^' + ISNULL(bnd.hbl_ser_pfx, '')	                                            <!-- 103 -->
			+ '^^' + ISNULL(bnd.hbl_ser_no, '')	                                            <!-- 104 --> 
			
			+ '^^' + case when bl.sto_start_dt = '' then '' else ISNULL(CONVERT(varchar(10),convert(DATETIME,bl.sto_start_dt),110),'') end   <!-- 105 --> 

		   FROM tb_intg_bl bl
		   JOIN tb_add_info_bnd bnd
		     ON bl.intg_bl_seq = bnd.intg_bl_seq AND bnd.delt_flg = 'N'
LEFT OUTER JOIN tb_bl_prnr lnr 
			 ON bl.intg_bl_seq = lnr.intg_bl_seq AND lnr.bl_trdp_tp_cd = 'L01' AND lnr.delt_flg = 'N'
LEFT OUTER JOIN tb_bl_prnr shpr 
			 ON bl.intg_bl_seq = shpr.intg_bl_seq AND shpr.bl_trdp_tp_cd = 'S01' AND shpr.delt_flg = 'N'
LEFT OUTER JOIN tb_bl_prnr cnee 
			 ON bl.intg_bl_seq = cnee.intg_bl_seq AND cnee.bl_trdp_tp_cd = 'C01' AND cnee.delt_flg = 'N'
			 
			 <!-- jsjang 2013.7.10 요구사항 #16112 (DIRECT B/L 인 경우 HBL 에 MBL 정보 COPY)  자동연계요건 Start -->
LEFT OUTER JOIN tb_bl_prnr ntfy 
			ON bl.intg_bl_seq = ntfy.intg_bl_seq AND ntfy.bl_trdp_tp_cd = 'N01' AND ntfy.delt_flg = 'N'	
LEFT OUTER JOIN tb_bl_prnr prnr 
			ON bl.intg_bl_seq = prnr.intg_bl_seq AND prnr.bl_trdp_tp_cd = 'P01' AND prnr.delt_flg = 'N'			
			 <!-- jsjang 2013.7.10 요구사항 #16112 (DIRECT B/L 인 경우 HBL 에 MBL 정보 COPY)  자동연계요건 End -->
			 		 
LEFT OUTER JOIN tb_bl_prnr prnr2 
			ON bl.intg_bl_seq = prnr2.intg_bl_seq AND prnr2.bl_trdp_tp_cd = 'P03' AND prnr2.delt_flg = 'N'
			 
			<!-- #23821 : [BINEX] Issuing Carrier, MAWB -> HAWB, jsjang 2013.11.25 -->
LEFT OUTER JOIN tb_bl_prnr iss
            ON   bl.intg_bl_seq = iss.intg_bl_seq  AND iss.bl_trdp_tp_cd = 'I01' AND iss.delt_flg = 'N' 			 

		  WHERE ref_no = #ref_no#
		    AND biz_clss_cd = 'M'
		    AND bl.delt_flg = 'N'
		    AND bl.air_sea_clss_cd = #air_sea_clss_cd#
		    AND bnd.bnd_clss_cd = #bnd_clss_cd#
    </select>
    
    <select id="selectAesSeaHouseBLInfo1" parameterClass="String" resultClass="com.clt.apps.fis.see.bmd.housebl.dto.AesBlInfoVO">
    	/* selectAesSeaHouseBLInfo1 */
		SELECT	hbl.bl_no AS hbl_no,		hbl.lnr_bkg_no,			hbl.cnt_cd,
				(SELECT cnt_eng_nm FROM tb_cnt x WHERE x.cnt_cd = hbl.cnt_cd) AS cnt_nm,
				hbl.state_cd,
				(SELECT state_eng_nm FROM tb_state x WHERE x.state_cd = hbl.state_cd AND x.cnt_cd = 'US') AS state_nm,
				ofc.aes_rspn_email AS rsps_eml,
				(SELECT x.ams_loc_val FROM tb_loc x WHERE x.loc_cd = hbl.pol_cd) AS pol_cd,
				(SELECT x.loc_nm FROM tb_loc x WHERE x.loc_cd = hbl.pol_cd) AS pol_nm,
				hbl.etd_dt_tm,
				(SELECT x.ams_loc_val FROM tb_loc x WHERE x.loc_cd = hbl.pod_cd) AS pod_cd,
				(SELECT x.loc_nm FROM tb_loc x WHERE x.loc_cd = hbl.pod_cd) AS pod_nm,
				(SELECT scac_cd FROM tb_trdp x WHERE x.trdp_cd = lnr.trdp_cd) AS carr_trdp_cd1,
				lnr.trdp_nm  AS carr_trdp_nm1,
				hbl.trnk_vsl_cd,			hbl.trnk_vsl_nm, hbl.trnk_voy,
				(SELECT cnt_cd FROM tb_vsl x WHERE x.vsl_cd = hbl.trnk_vsl_cd) AS vsl_flg,
				hbl.rep_cmdt_cd,			hbl.rep_cmdt_nm,
				cmdt.cmdt_ut1,				cmdt.cmdt_ut2,
				hbl.pck_qty,				FLOOR(hbl.grs_wgt) AS wgt,
				'N' AS rt_flg,				'N' AS haz_flg,			'N' AS cntr_flg,
				'N' AS rcc_flg,				hbl.intg_bl_seq,
				shp.trdp_nm AS shp_nm,		shp.trdp_pic AS shp_pic_f,
				REPLACE(REPLACE(REPLACE(shp.trdp_phn,'-',''),'(',''),')','') AS shp_phn,			
				
				(select LGL_ADDR from tb_trdp where TRDP_CD = shp.trdp_cd) AS shp_addr,
				shptrdp.city_nm AS shp_city_nm,						shptrdp.state_cd AS shp_state_cd,
				REPLACE(shptrdp.rep_zip,'-','') AS shp_zip,			shptrdp.cnt_cd AS shp_cnt,
				shptrdp.tax_type AS shp_tax_type,					shptrdp.biz_no AS shp_id,
				
				cnee.trdp_nm AS ult_cnee_nm,		cnee.trdp_pic AS ult_cnee_pic,
				REPLACE(REPLACE(REPLACE(cnee.trdp_phn,'-',''),'(',''),')','')  AS ult_cnee_phn,		
				
				(select LGL_ADDR from tb_trdp where TRDP_CD = cnee.trdp_cd) AS ult_cnee_addr,
				cneetrdp.city_nm AS ult_cnee_city_nm,					cneetrdp.state_cd AS ult_cnee_state_cd,
				REPLACE(cneetrdp.rep_zip,'-','') AS ult_cnee_zip,		cneetrdp.cnt_cd AS ult_cnee_cnt,

				ofc.ofc_eng_nm AS fwd_nm,	ofc.aes_cntc_nm AS fwd_pic,
				REPLACE(REPLACE(REPLACE(ofc.ofc_phn,'-',''),'(',''),')','') AS fwd_phn,							

				isnull((select case when  CHARINDEX(CHAR(13),ofc.ofc_addr) > 0 then 
				substring(ofc.ofc_addr,0,(CHARINDEX(CHAR(13),ofc.ofc_addr))) 
				else ofc.ofc_addr end from tb_sys_opt where opt_key = 'AES_ADDR' and isnull(opt_val,'N') = 'Y'),ofc.ofc_addr) AS fwd_addr,
				
				ofc.aes_city AS fwd_city_nm,						ofc.aes_state_cd AS fwd_state_cd,
				
				REPLACE(ofc.aes_zip,'-','') AS fwd_zip,				ofc.aes_cnt_cd AS fwd_cnt,
				ofc.tax_type AS fwd_tax_type, ofc.tax_no AS fwd_id,
				'N' AS ddtc_prty_certi_flg,	'N' AS ddtc_eq_flg,
				CASE WHEN
				(SELECT COUNT('X') FROM tb_cntr_list cntr
				  WHERE cntr.intg_bl_seq = hbl.intg_bl_seq ) > 0
				THEN 'Y' ELSE 'N' END AS cntr_add_flg
		  FROM	tb_intg_bl hbl

LEFT OUTER JOIN	tb_intg_bl_rlt rlt
			 ON rlt.intg_bl_seq = hbl.intg_bl_seq AND rlt.delt_flg = 'N'

LEFT OUTER JOIN tb_intg_bl mbl
			 ON mbl.intg_bl_seq = rlt.rlt_intg_bl_seq AND mbl.delt_flg = 'N'

LEFT OUTER JOIN tb_bl_prnr shp
			 ON shp.intg_bl_seq = hbl.intg_bl_seq AND shp.bl_trdp_tp_cd = 'S01' AND shp.delt_flg = 'N'
			
LEFT OUTER JOIN tb_trdp shptrdp
			 ON shptrdp.trdp_cd = shp.trdp_cd AND shptrdp.delt_flg = 'N'
			 
LEFT OUTER JOIN tb_bl_prnr cnee
			 ON cnee.intg_bl_seq = hbl.intg_bl_seq AND cnee.bl_trdp_tp_cd = 'C01' AND cnee.delt_flg = 'N'
			
LEFT OUTER JOIN tb_trdp cneetrdp
			 ON cneetrdp.trdp_cd = cnee.trdp_cd AND cneetrdp.delt_flg = 'N'
			 
LEFT OUTER JOIN tb_bl_prnr lnr
			 ON lnr.intg_bl_seq = hbl.intg_bl_seq AND lnr.bl_trdp_tp_cd = 'L01' AND shp.delt_flg = 'N'			 
			 
LEFT OUTER JOIN tb_cmdt_cd cmdt
			 ON cmdt.cmdt_cd = hbl.rep_cmdt_cd AND cmdt.delt_flg = 'N' AND cmdt.hs_grp_cd = 'SB'
			
LEFT OUTER JOIN tb_ofc ofc
			 ON ofc.ofc_cd = hbl.ref_ofc_cd AND ofc.delt_flg = 'N'
			 
		 WHERE	hbl.bl_no = #bl_no#
		   AND	hbl.delt_flg = 'N'
		   AND	hbl.biz_clss_cd = 'H'
		   AND	hbl.air_sea_clss_cd = 'S'
    </select>
    
    <select id="selectAesAirHouseBLInfo1" parameterClass="String" resultClass="com.clt.apps.fis.see.bmd.housebl.dto.AesBlInfoVO">
    	/* selectAesAirHouseBLInfo1 */
		SELECT	hbl.bl_no AS hbl_no,		hbl.lnr_bkg_no,			'' AS cnt_cd,
				'' AS cnt_nm,
				hbl.state_cd,
				(SELECT state_eng_nm FROM tb_state x WHERE x.state_cd = hbl.state_cd AND x.cnt_cd = 'US') AS state_nm,
				ofc.aes_rspn_email AS rsps_eml,
				/* 20121131 OJG (SELECT x.ams_loc_val FROM tb_loc x WHERE x.loc_cd = hbl.pol_cd) AS pol_cd,*/
				(SELECT x.ams_loc_val FROM tb_loc x WHERE x.loc_cd = hbl.pol_cd) AS pol_cd,
				(SELECT x.loc_nm FROM tb_loc x WHERE x.loc_cd = hbl.pol_cd) AS pol_nm,
				SUBSTRING(ISNULL(hbl.etd_dt_tm,''),1,8) AS etd_dt_tm,
				(SELECT x.ams_loc_val FROM tb_loc x WHERE x.loc_cd = hbl.pod_cd) AS pod_cd,
				(SELECT x.loc_nm FROM tb_loc x WHERE x.loc_cd = hbl.pod_cd) AS pod_nm,
				(SELECT x.iata_cd FROM tb_bl_prnr lnr JOIN tb_trdp x ON x.trdp_cd = lnr.trdp_cd
				WHERE lnr.intg_bl_seq = hbl.intg_bl_seq AND lnr.bl_trdp_tp_cd = 'L01' AND lnr.delt_flg = 'N') AS carr_trdp_cd1,
				(SELECT lnr.trdp_nm FROM tb_bl_prnr lnr WHERE lnr.intg_bl_seq = hbl.intg_bl_seq
				AND lnr.bl_trdp_tp_cd = 'L01' AND lnr.delt_flg = 'N') AS carr_trdp_nm1,
				hbl.trnk_vsl_cd,			hbl.flt_no AS trnk_vsl_nm,
				(SELECT cnt_cd FROM tb_vsl x WHERE x.vsl_cd = hbl.trnk_vsl_cd) AS vsl_flg,
				hbl.rep_cmdt_cd,			hbl.rep_cmdt_nm,
				cmdt.cmdt_ut1,				cmdt.cmdt_ut2,
				hbl.pck_qty,				FLOOR(hbl.grs_wgt) AS wgt,
				'N' AS rt_flg,				'N' AS haz_flg,			'N' AS cntr_flg,
				'N' AS rcc_flg,				hbl.intg_bl_seq,
				shp.trdp_nm AS shp_nm,		shp.trdp_pic AS shp_pic_f,
				REPLACE(REPLACE(REPLACE(shp.trdp_phn,'-',''),'(',''),')','') AS shp_phn,
				(select LGL_ADDR from tb_trdp where TRDP_CD = shp.trdp_cd) AS shp_addr,
				shptrdp.city_nm AS shp_city_nm,						shptrdp.state_cd AS shp_state_cd,
				shptrdp.rep_zip AS shp_zip,							shptrdp.cnt_cd AS shp_cnt,
				shptrdp.tax_type AS shp_tax_type,					shptrdp.biz_no AS shp_id,
				
				cnee.trdp_nm AS ult_cnee_nm, cnee.trdp_pic AS ult_cnee_pic,
				REPLACE(REPLACE(REPLACE(cnee.trdp_phn,'-',''),'(',''),')','')  AS ult_cnee_phn,
				(select LGL_ADDR from tb_trdp where TRDP_CD = cnee.trdp_cd) AS ult_cnee_addr,
				cneetrdp.city_nm AS ult_cnee_city_nm,					cneetrdp.state_cd AS ult_cnee_state_cd,
				cneetrdp.rep_zip AS ult_cnee_zip,						cneetrdp.cnt_cd AS ult_cnee_cnt,
				
				ofc.ofc_eng_nm AS fwd_nm,	ofc.aes_cntc_nm AS fwd_pic,
				REPLACE(REPLACE(REPLACE(ofc.ofc_phn,'-',''),'(',''),')','') AS fwd_phn,			
				
				isnull((select case when  CHARINDEX(CHAR(13),ofc.ofc_addr) > 0 then 
				substring(ofc.ofc_addr,0,(CHARINDEX(CHAR(13),ofc.ofc_addr))) 
				else ofc.ofc_addr end from tb_sys_opt where opt_key = 'AES_ADDR' and isnull(opt_val,'N') = 'Y'),ofc.ofc_addr) AS fwd_addr,
					
				ofc.aes_city AS fwd_city_nm,						ofc.aes_state_cd AS fwd_state_cd,
				ofc.aes_zip AS fwd_zip,		ofc.aes_cnt_cd AS fwd_cnt,
				ofc.tax_type AS fwd_tax_type, ofc.tax_no AS fwd_id,
				'N' AS ddtc_prty_certi_flg,	'N' AS ddtc_eq_flg,		hbl.decl_cstms_val,
				CASE WHEN
				(SELECT COUNT('X') FROM tb_cntr_list cntr
				  WHERE cntr.intg_bl_seq = hbl.intg_bl_seq ) > 0
				THEN 'Y' ELSE 'N' END AS cntr_add_flg
		  FROM	tb_intg_bl hbl

LEFT OUTER JOIN	tb_intg_bl_rlt rlt
			 ON rlt.intg_bl_seq = hbl.intg_bl_seq AND rlt.delt_flg = 'N'

LEFT OUTER JOIN tb_intg_bl mbl
			 ON mbl.intg_bl_seq = rlt.rlt_intg_bl_seq AND mbl.delt_flg = 'N'

LEFT OUTER JOIN tb_bl_prnr shp
			 ON shp.intg_bl_seq = hbl.intg_bl_seq AND shp.bl_trdp_tp_cd = 'S01' AND shp.delt_flg = 'N'
			
LEFT OUTER JOIN tb_trdp shptrdp
			 ON shptrdp.trdp_cd = shp.trdp_cd AND shptrdp.delt_flg = 'N'
			 
LEFT OUTER JOIN tb_bl_prnr cnee
			 ON cnee.intg_bl_seq = hbl.intg_bl_seq AND cnee.bl_trdp_tp_cd = 'C01' AND cnee.delt_flg = 'N'
			
LEFT OUTER JOIN tb_trdp cneetrdp
			 ON cneetrdp.trdp_cd = cnee.trdp_cd AND cneetrdp.delt_flg = 'N'
			 
LEFT OUTER JOIN tb_cmdt_cd cmdt
			 ON cmdt.cmdt_cd = hbl.rep_cmdt_cd AND cmdt.delt_flg = 'N'
			
LEFT OUTER JOIN tb_ofc ofc
			 ON ofc.ofc_cd = hbl.ref_ofc_cd AND ofc.delt_flg = 'N'
			 
		 WHERE	hbl.bl_no = #bl_no#
		   AND	hbl.delt_flg = 'N'
		   AND	hbl.biz_clss_cd = 'H'
		   AND	hbl.air_sea_clss_cd = 'A'
    </select>
    
    <select id="selectAesSeaHouseBLInfo2" parameterClass="String" resultClass="com.clt.apps.fis.see.bmd.housebl.dto.AesBlInfoVO">
    	/*	selectAesSeaHouseBLInfo2 */
		SELECT	hbl.bl_no AS hbl_no,		mbl.lnr_bkg_no,			hbl.cnt_cd,
				(SELECT cnt_eng_nm FROM tb_cnt x WHERE x.cnt_cd = hbl.cnt_cd) AS cnt_nm,
				hbl.state_cd,
				(SELECT state_eng_nm FROM tb_state x WHERE x.state_cd = hbl.state_cd AND x.cnt_cd = 'US') AS state_nm,
				aes.pol_cd,					aes.pol_nm,				hbl.etd_dt_tm,
				aes.pod_cd,					aes.pod_nm,
				aes.carr_cd AS carr_trdp_cd1,						aes.carr_nm AS carr_trdp_nm1, hbl.trnk_voy ,
				hbl.trnk_vsl_cd,			hbl.trnk_vsl_nm,
				(SELECT cnt_cd FROM tb_vsl x WHERE x.vsl_cd = hbl.trnk_vsl_cd) AS vsl_flg,
				hbl.rep_cmdt_cd,			hbl.rep_cmdt_nm,
				cmdt.cmdt_ut1,				cmdt.cmdt_ut2,
				hbl.pck_qty,				FLOOR(hbl.grs_wgt) AS wgt,
				aes.trs_cd,					aes.ibd_tp,				aes.imp_en_no,
				aes.ftz_cd,					aes.exp_cd,				aes.rsps_eml,
				aes.rt_flg,					aes.haz_flg,			aes.cntr_flg,
				aes.rcc_flg,				aes.aes_sts,			aes.it_no,
				hbl.intg_bl_seq,
				aes.shp_nm,					aes.shp_pic_f,			aes.shp_pic_l,
				REPLACE(REPLACE(REPLACE(aes.shp_phn,'-',''),'(',''),')','') AS shp_phn,
				aes.shp_addr,				aes.shp_city_nm,		aes.shp_state_cd,
				aes.shp_zip,				aes.shp_cnt,			aes.shp_tax_type,
				aes.shp_id,					aes.fwd_nm,				aes.fwd_pic,
				REPLACE(REPLACE(REPLACE(aes.fwd_phn,'-',''),'(',''),')','') AS fwd_phn,				aes.fwd_addr,
				aes.fwd_city_nm,
				aes.fwd_state_cd,			aes.fwd_zip,			aes.fwd_cnt,
				aes.fwd_tax_type,			aes.fwd_id,
				aes.ult_cnee_nm,			aes.ult_cnee_pic,		REPLACE(REPLACE(REPLACE(aes.ult_cnee_phn,'-',''),'(',''),')','') AS ult_cnee_phn,
				aes.ult_cnee_addr,			aes.ult_cnee_city_nm,	aes.ult_cnee_state_cd,
				aes.ult_cnee_zip,			aes.ult_cnee_cnt,		aes.ult_cnee_tp,
				aes.inter_cnee_nm,
				aes.inter_cnee_pic,			REPLACE(REPLACE(REPLACE(aes.inter_cnee_phn,'-',''),'(',''),')','') AS inter_cnee_phn,
				aes.inter_cnee_addr,
				aes.inter_cnee_city_nm,		aes.inter_cnee_state_cd,
				aes.inter_cnee_zip,			aes.inter_cnee_cnt,
				aes.licen_tp,				aes.licen_no,			aes.ddtc_itar_no,
				aes.eccn_no,				aes.ddtc_usml_cd,		aes.ddtc_regi_no,
				aes.ddtc_pck_qty,			aes.ddtc_pck_ut_cd,		aes.ddtc_prty_certi_flg,
				aes.ddtc_eq_flg,			aes.file_tp,
				CASE WHEN
				(SELECT COUNT('X') FROM tb_cntr_list cntr
				  WHERE cntr.intg_bl_seq = hbl.intg_bl_seq ) > 0
				THEN 'Y' ELSE 'N' END AS cntr_add_flg
		  FROM	tb_intg_bl hbl

		  JOIN	tb_aes aes
			ON	aes.intg_bl_seq = hbl.intg_bl_seq

LEFT OUTER JOIN tb_intg_bl_rlt rlt
			 ON rlt.intg_bl_seq = hbl.intg_bl_seq AND rlt.delt_flg = 'N'

LEFT OUTER JOIN tb_intg_bl mbl
			 ON mbl.intg_bl_seq = rlt.rlt_intg_bl_seq AND mbl.delt_flg = 'N'
			 
LEFT OUTER JOIN tb_cmdt_cd cmdt
			 ON cmdt.cmdt_cd = hbl.rep_cmdt_cd AND cmdt.delt_flg = 'N' AND cmdt.hs_grp_cd = 'SB'

		 WHERE	hbl.BL_NO = #bl_no#
		   AND	hbl.delt_flg = 'N'
		   AND	hbl.biz_clss_cd = 'H'
		   AND	hbl.air_sea_clss_cd = 'S'
    </select>
    
    <select id="selectAesAirHouseBLInfo2" parameterClass="String" resultClass="com.clt.apps.fis.see.bmd.housebl.dto.AesBlInfoVO">
    	/* selectAesAirHouseBLInfo2 */
		SELECT	hbl.bl_no AS hbl_no,		mbl.lnr_bkg_no,			aes.cnt_cd,
				(SELECT cnt_eng_nm FROM tb_cnt x WHERE x.cnt_cd = aes.cnt_cd) AS cnt_nm,
				aes.state_cd,
				(SELECT state_eng_nm FROM tb_state x WHERE x.state_cd = aes.state_cd AND x.cnt_cd = 'US') AS state_nm,
				aes.pol_cd,					aes.pol_nm,				SUBSTRING(ISNULL(hbl.etd_dt_tm,''),1,8) AS etd_dt_tm,
				aes.pod_cd,					aes.pod_nm,					
				aes.carr_cd AS carr_trdp_cd1,						aes.carr_nm AS carr_trdp_nm1,
				hbl.trnk_vsl_cd,			hbl.flt_no AS trnk_vsl_nm,
				(SELECT cnt_cd FROM tb_vsl x WHERE x.vsl_cd = hbl.trnk_vsl_cd) AS vsl_flg,
				hbl.rep_cmdt_cd,			hbl.rep_cmdt_nm,
				cmdt.cmdt_ut1,				cmdt.cmdt_ut2,
				hbl.pck_qty,				FLOOR(hbl.grs_wgt) AS wgt,
				aes.trs_cd,					aes.ibd_tp,				aes.imp_en_no,
				aes.ftz_cd,					aes.exp_cd,				aes.rsps_eml,
				aes.rt_flg,					aes.haz_flg,			aes.cntr_flg,
				aes.rcc_flg,				aes.aes_sts,			aes.it_no,
				hbl.intg_bl_seq,
				aes.shp_nm,					aes.shp_pic_f,			aes.shp_pic_l,
				REPLACE(REPLACE(REPLACE(aes.shp_phn,'-',''),'(',''),')','') AS shp_phn,
				aes.shp_addr,				aes.shp_city_nm,		aes.shp_state_cd,
				aes.shp_zip,				aes.shp_cnt,			aes.shp_tax_type,
				aes.shp_id,					aes.fwd_nm,				aes.fwd_pic,
				REPLACE(REPLACE(REPLACE(aes.fwd_phn,'-',''),'(',''),')','') AS fwd_phn,				aes.fwd_addr,
				aes.fwd_city_nm,
				aes.fwd_state_cd,			aes.fwd_zip,			aes.fwd_cnt,
				aes.fwd_tax_type,			aes.fwd_id,
				aes.ult_cnee_nm,			aes.ult_cnee_pic,		REPLACE(REPLACE(REPLACE(aes.ult_cnee_phn,'-',''),'(',''),')','') AS ult_cnee_phn,
				aes.ult_cnee_addr,			aes.ult_cnee_city_nm,	aes.ult_cnee_state_cd,
				aes.ult_cnee_zip,			aes.ult_cnee_cnt,		aes.ult_cnee_tp ,
				aes.inter_cnee_nm,
				aes.inter_cnee_pic,			REPLACE(REPLACE(REPLACE(aes.inter_cnee_phn,'-',''),'(',''),')','') AS inter_cnee_phn,
				aes.inter_cnee_addr,
				aes.inter_cnee_city_nm,		aes.inter_cnee_state_cd,
				aes.inter_cnee_zip,			aes.inter_cnee_cnt,
				aes.licen_tp,				aes.licen_no,			aes.ddtc_itar_no,
				aes.eccn_no,				aes.ddtc_usml_cd,		aes.ddtc_regi_no,
				aes.ddtc_pck_qty,			aes.ddtc_pck_ut_cd,		aes.ddtc_prty_certi_flg,
				aes.ddtc_eq_flg,			hbl.decl_cstms_val,	    aes.file_tp,
				CASE WHEN
				(SELECT COUNT('X') FROM tb_cntr_list cntr
				  WHERE cntr.intg_bl_seq = hbl.intg_bl_seq ) > 0
				THEN 'Y' ELSE 'N' END AS cntr_add_flg
		  FROM	tb_intg_bl hbl

		  JOIN	tb_aes aes
			ON	aes.intg_bl_seq = hbl.intg_bl_seq

LEFT OUTER JOIN tb_intg_bl_rlt rlt
			 ON rlt.intg_bl_seq = hbl.intg_bl_seq AND rlt.delt_flg = 'N'

LEFT OUTER JOIN tb_intg_bl mbl
			 ON mbl.intg_bl_seq = rlt.rlt_intg_bl_seq AND mbl.delt_flg = 'N'

LEFT OUTER JOIN tb_cmdt_cd cmdt
			 ON cmdt.cmdt_cd = hbl.rep_cmdt_cd AND cmdt.delt_flg = 'N'

		 WHERE	hbl.BL_NO = #bl_no#
		   AND	hbl.delt_flg = 'N'
		   AND	hbl.biz_clss_cd = 'H'
		   AND	hbl.air_sea_clss_cd = 'A'
    </select>
    
    <select id="searchAesCmdtList" parameterClass="String" resultClass="com.clt.apps.fis.see.bmd.housebl.dto.AesCmdtVO">
		SELECT	intg_bl_seq,				aes_cmdt_seq,			org_tp,
				cmdt_cd,					cmdt_desc,				pck_qty,
				pck_ut_cd,					pck_qty1,				pck_ut_cd1,
				usd_val,					grs_wgt
		  FROM	tb_aes_cmdt
		 WHERE	intg_bl_seq = #intg_bl_seq#
		ORDER BY aes_cmdt_seq
    </select>
    
    <select id="searchAesVhcList" parameterClass="String" resultClass="com.clt.apps.fis.see.bmd.housebl.dto.AesVhcVO">
		SELECT	intg_bl_seq,				aes_vhc_seq,			vhc_id_tp,
				vhc_id,						vhc_ttl,				vhc_ttl_state
		  FROM	tb_aes_vhc
		 WHERE	intg_bl_seq = #intg_bl_seq#
		ORDER BY aes_vhc_seq
    </select>
    
    <insert id="insertAesInfo" parameterClass="HashMap">
    	INSERT INTO tb_aes(
			intg_bl_seq,				trs_cd,						ibd_tp,
			cnt_cd,						state_cd,
			imp_en_no,					ftz_cd,						exp_cd,
			rsps_eml,					pol_cd,						pol_nm,
			pod_cd,						pod_nm,						rt_flg,
			haz_flg,					cntr_flg,					rcc_flg,
			carr_cd,					carr_nm,
			aes_sts,					it_no,						shp_cd,
			file_tp,
			shp_nm,						shp_pic_f,					shp_pic_l,
			shp_phn,
			shp_addr,					shp_city_nm,				shp_state_cd,
			shp_zip,					shp_cnt,					shp_tax_type,
			shp_id,						fwd_cd,						fwd_nm,
			fwd_pic,					fwd_phn,					fwd_addr,
			fwd_city_nm,				fwd_state_cd,				fwd_zip,
			fwd_cnt,					fwd_tax_type,				fwd_id,
			ult_cnee_cd,				ult_cnee_nm,				ult_cnee_pic,
			ult_cnee_phn,				ult_cnee_addr,				ult_cnee_city_nm,
			ult_cnee_state_cd,			ult_cnee_zip,				ult_cnee_cnt,
			ult_cnee_tp , 				
			inter_cnee_cd,				inter_cnee_nm,				inter_cnee_pic,
			inter_cnee_phn,				inter_cnee_addr,			inter_cnee_city_nm,
			inter_cnee_state_cd,		inter_cnee_zip,				inter_cnee_cnt,
			licen_tp,					licen_no,					ddtc_itar_no,
			eccn_no,					ddtc_usml_cd,				ddtc_regi_no,
			ddtc_pck_qty,				ddtc_pck_ut_cd,				ddtc_prty_certi_flg,
			ddtc_eq_flg,				rgst_usrid,					rgst_ofc_cd,
			rgst_tms,					modi_usrid,					modi_ofc_cd,
			modi_tms
    	)VALUES(
    		#intg_bl_seq#,				#trs_cd#,					#ibd_tp#,
    		#cnt_cd#,					#state_cd#,
			#imp_en_no#,				#ftz_cd#,					#exp_cd#,
			#rsps_eml#,					#pol_cd#,					#pol_nm#,
			#pod_cd#,					#pod_nm#,					#rt_flg#,
			#haz_flg#,					#cntr_flg#,					#rcc_flg#,
			#carr_trdp_cd1#,			#carr_trdp_nm1#,
			#aes_sts#,					#it_no#,					#shp_cd#,
			#file_tp#,
			#shp_nm#,					#shp_pic_f#,				#shp_pic_l#,
			#shp_phn#,
			#shp_addr#,					#shp_city_nm#,				#shp_state_cd#,
			#shp_zip#,					#shp_cnt#,					#shp_tax_type#,
			#shp_id#,					#fwd_cd#,					#fwd_nm#,
			#fwd_pic#,					#fwd_phn#,					#fwd_addr#,
			#fwd_city_nm#,				#fwd_state_cd#,				#fwd_zip#,
			#fwd_cnt#,					#fwd_tax_type#,				#fwd_id#,
			#ult_cnee_cd#,				#ult_cnee_nm#,				#ult_cnee_pic#,
			#ult_cnee_phn#,				#ult_cnee_addr#,			#ult_cnee_city_nm#,
			#ult_cnee_state_cd#,		#ult_cnee_zip#,				#ult_cnee_cnt#,
			#ult_cnee_tp#,				
			#inter_cnee_cd#,			#inter_cnee_nm#,			#inter_cnee_pic#,
			#inter_cnee_phn#,			#inter_cnee_addr#,			#inter_cnee_city_nm#,
			#inter_cnee_state_cd#,		#inter_cnee_zip#,			#inter_cnee_cnt#,
			#licen_tp#,					#licen_no#,					#ddtc_itar_no#,
			#eccn_no#,					#ddtc_usml_cd#,				#ddtc_regi_no#,
			#ddtc_pck_qty#,				#ddtc_pck_ut_cd#,			#ddtc_prty_certi_flg#,
			#ddtc_eq_flg#,				#rgst_usrid#,				#rgst_ofc_cd#,
			GETDATE(),					#modi_usrid#,				#modi_ofc_cd#,
			GETUTCDATE()
    	)
    </insert>
    
    <update id="updateAesInfo" parameterClass="HashMap">
    	UPDATE	tb_aes
    	   SET	trs_cd = #trs_cd#,				ibd_tp = #ibd_tp#,				imp_en_no = #imp_en_no#,
    	   		cnt_cd = #cnt_cd#,				state_cd = #state_cd#,
    	   		ftz_cd = #ftz_cd#,				exp_cd = #exp_cd#,				rsps_eml = #rsps_eml#,
				pol_cd = #pol_cd#,				pol_nm = #pol_nm#,				pod_cd = #pod_cd#,
				pod_nm = #pod_nm#,				rt_flg = #rt_flg#,				haz_flg = #haz_flg#,
				cntr_flg = #cntr_flg#,			rcc_flg = #rcc_flg#,			aes_sts = #aes_sts#,
				carr_cd = #carr_trdp_cd1#,		carr_nm = #carr_trdp_nm1#,
				it_no = #it_no#,				shp_cd = #shp_cd#,				shp_nm = #shp_nm#,
				file_tp = #file_tp#, 
				shp_pic_f = #shp_pic_f#,		shp_pic_l = #shp_pic_l#,		shp_phn = #shp_phn#,
				shp_addr = #shp_addr#,
				shp_city_nm = #shp_city_nm#,	shp_state_cd = #shp_state_cd#,	shp_zip = #shp_zip#,
				shp_cnt = #shp_cnt#,			shp_tax_type = #shp_tax_type#,	shp_id = #shp_id#,
				fwd_cd = #fwd_cd#,				fwd_nm = #fwd_nm#,				fwd_pic = #fwd_pic#,
				fwd_phn = #fwd_phn#,			fwd_addr = #fwd_addr#,			fwd_city_nm = #fwd_city_nm#,
				fwd_state_cd = #fwd_state_cd#,	fwd_zip = #fwd_zip#,			fwd_cnt = #fwd_cnt#,
				fwd_tax_type = #fwd_tax_type#,	fwd_id = #fwd_id#,				ult_cnee_cd = #ult_cnee_cd#,
				ult_cnee_nm = #ult_cnee_nm#,	ult_cnee_pic = #ult_cnee_pic#,	ult_cnee_phn = #ult_cnee_phn#,
				ult_cnee_addr = #ult_cnee_addr#,								ult_cnee_city_nm = #ult_cnee_city_nm#,
				ult_cnee_state_cd = #ult_cnee_state_cd#,						ult_cnee_zip = #ult_cnee_zip#,
				ult_cnee_cnt = #ult_cnee_cnt#,	ult_cnee_tp = #ult_cnee_tp#,	
				inter_cnee_cd = #inter_cnee_cd#,inter_cnee_nm = #inter_cnee_nm#,
				inter_cnee_pic = #inter_cnee_pic#,								inter_cnee_phn = #inter_cnee_phn#,
				inter_cnee_addr = #inter_cnee_addr#,							inter_cnee_city_nm = #inter_cnee_city_nm#,
				inter_cnee_state_cd = #inter_cnee_state_cd#,					inter_cnee_zip = #inter_cnee_zip#,
				inter_cnee_cnt = #inter_cnee_cnt#,								licen_tp = #licen_tp#,
				licen_no = #licen_no#,			ddtc_itar_no = #ddtc_itar_no#,	eccn_no = #eccn_no#,
				ddtc_usml_cd = #ddtc_usml_cd#,	ddtc_regi_no = #ddtc_regi_no#,	ddtc_pck_qty = #ddtc_pck_qty#,
				ddtc_pck_ut_cd = #ddtc_pck_ut_cd#,								ddtc_prty_certi_flg = #ddtc_prty_certi_flg#,
				ddtc_eq_flg = #ddtc_eq_flg#,	modi_usrid = #modi_usrid#,		modi_ofc_cd = #modi_ofc_cd#,
				modi_tms = GETUTCDATE()
		 WHERE	intg_bl_seq = #intg_bl_seq#
    </update>
    
    <insert id="insertAesCmdt" parameterClass="com.clt.apps.fis.see.bmd.housebl.dto.AesCmdtVO">
    	<!-- MSSQL 2008 Ver
    	INSERT INTO tb_aes_cmdt(
    		intg_bl_seq,
    		aes_cmdt_seq,
    		org_tp,						cmdt_cd,					cmdt_desc,
    		pck_qty,					pck_ut_cd,					pck_qty1,
    		pck_ut_cd1,					usd_val,					grs_wgt,
    		rgst_usrid,					rgst_ofc_cd,				rgst_tms,
    		modi_usrid,					modi_ofc_cd,				modi_tms
    	)VALUES(
    		#intg_bl_seq#,
    		(SELECT ISNULL(MAX(aes_cmdt_seq),0)+1 FROM tb_aes_cmdt WHERE intg_bl_seq = #intg_bl_seq#),
    		#org_tp#,					#cmdt_cd#,					#cmdt_desc#,
    		#pck_qty#,					#pck_ut_cd#,				#pck_qty1#,
    		#pck_ut_cd1#,				#usd_val#,					#grs_wgt#,
    		#rgst_usrid#,				#rgst_ofc_cd#,				GETDATE(),
    		#modi_usrid#,				#modi_ofc_cd#,				GETDATE()
    	)
    	-->    	
    	<!-- 2013.06.05 LHK, MSSQL 2005 version 으로 Query 수정 (Insert into () values()구문에 하위 쿼리 사용할 수 없슴) -->
    	INSERT INTO tb_aes_cmdt(
    		intg_bl_seq,
    		aes_cmdt_seq,
    		org_tp,						cmdt_cd,					cmdt_desc,
    		pck_qty,					pck_ut_cd,					pck_qty1,
    		pck_ut_cd1,					usd_val,					grs_wgt,
    		rgst_usrid,					rgst_ofc_cd,				rgst_tms,
    		modi_usrid,					modi_ofc_cd,				modi_tms
		) SELECT
    		#intg_bl_seq#,
    		(SELECT ISNULL(MAX(aes_cmdt_seq),0)+1 FROM tb_aes_cmdt WHERE intg_bl_seq = #intg_bl_seq#),
    		#org_tp#,					#cmdt_cd#,					#cmdt_desc#,
    		#pck_qty#,					#pck_ut_cd#,				#pck_qty1#,
    		#pck_ut_cd1#,				#usd_val#,					#grs_wgt#,
    		#rgst_usrid#,				#rgst_ofc_cd#,				GETDATE(),
    		#modi_usrid#,				#modi_ofc_cd#,				GETUTCDATE()
    	
    </insert>
    
    <update id="updateAesCmdt" parameterClass="com.clt.apps.fis.see.bmd.housebl.dto.AesCmdtVO">
    	UPDATE	tb_aes_cmdt
    	   SET	org_tp = #org_tp#,				cmdt_cd = #cmdt_cd#,			cmdt_desc = #cmdt_desc#,
				pck_qty = #pck_qty#,			pck_ut_cd = #pck_ut_cd#,		pck_qty1 = #pck_qty1#,
    			pck_ut_cd1 = #pck_ut_cd1#,		usd_val = #usd_val#,			grs_wgt = #grs_wgt#,
    			modi_usrid = #modi_usrid#,		modi_ofc_cd = #modi_ofc_cd#,	modi_tms = GETUTCDATE()
    	 WHERE	intg_bl_seq = #intg_bl_seq#
    	   AND	aes_cmdt_seq = #aes_cmdt_seq#
    </update>
    
    <delete id="deleteAesCmdt" parameterClass="com.clt.apps.fis.see.bmd.housebl.dto.AesCmdtVO">
    	DELETE	tb_aes_cmdt
    	 WHERE	intg_bl_seq = #intg_bl_seq#
    	   AND	aes_cmdt_seq = #aes_cmdt_seq#
    </delete>
    
    <insert id="insertAesVhc" parameterClass="com.clt.apps.fis.see.bmd.housebl.dto.AesVhcVO">
    	<!-- MSSQL 2008 Ver
    	INSERT INTO tb_aes_vhc(
    		intg_bl_seq,
    		aes_vhc_seq,
    		vhc_id_tp,					vhc_id,						vhc_ttl,
    		vhc_ttl_state,
    		rgst_usrid,					rgst_ofc_cd,				rgst_tms,
    		modi_usrid,					modi_ofc_cd,				modi_tms
    	)VALUES(
    		#intg_bl_seq#,
    		(SELECT ISNULL(MAX(aes_vhc_seq),0)+1 FROM tb_aes_vhc WHERE intg_bl_seq = #intg_bl_seq#),
    		#vhc_id_tp#,				#vhc_id#,					#vhc_ttl#,
    		#vhc_ttl_state#,
    		#rgst_usrid#,				#rgst_ofc_cd#,				GETDATE(),
    		#modi_usrid#,				#modi_ofc_cd#,				GETDATE()
    	)
    	-->    	
    	<!-- 2013.06.05 LHK, MSSQL 2005 version 으로 Query 수정 (Insert into () values()구문에 하위 쿼리 사용할 수 없슴) -->
    	INSERT INTO tb_aes_vhc(
    		intg_bl_seq,
    		aes_vhc_seq,
    		vhc_id_tp,					vhc_id,						vhc_ttl,
    		vhc_ttl_state,
    		rgst_usrid,					rgst_ofc_cd,				rgst_tms,
    		modi_usrid,					modi_ofc_cd,				modi_tms
    	) SELECT
    		#intg_bl_seq#,
    		(SELECT ISNULL(MAX(aes_vhc_seq),0)+1 FROM tb_aes_vhc WHERE intg_bl_seq = #intg_bl_seq#),
    		#vhc_id_tp#,				#vhc_id#,					#vhc_ttl#,
    		#vhc_ttl_state#,
    		#rgst_usrid#,				#rgst_ofc_cd#,				GETDATE(),
    		#modi_usrid#,				#modi_ofc_cd#,				GETUTCDATE()
    	
    </insert>
    
    <update id="updateAesVhc" parameterClass="com.clt.apps.fis.see.bmd.housebl.dto.AesVhcVO">
    	UPDATE	tb_aes_vhc
    	   SET	vhc_id_tp = #vhc_id_tp#,		vhc_id = #vhc_id#,				vhc_ttl = #vhc_ttl#,
				vhc_ttl_state = #vhc_ttl_state#,
    			modi_usrid = #modi_usrid#,		modi_ofc_cd = #modi_ofc_cd#,	modi_tms = GETUTCDATE()
    	 WHERE	intg_bl_seq = #intg_bl_seq#
    	   AND	aes_vhc_seq = #aes_vhc_seq#
    </update>
    
    <delete id="deleteAesVhc" parameterClass="com.clt.apps.fis.see.bmd.housebl.dto.AesVhcVO">
    	DELETE	tb_aes_vhc
    	 WHERE	intg_bl_seq = #intg_bl_seq#
    	   AND	aes_vhc_seq = #aes_vhc_seq#
    </delete>
    
    <select id="searchAesCmdtCnt" parameterClass="String" resultClass="Integer">
		SELECT	COUNT('X')
		  FROM	tb_aes_cmdt
		 WHERE	intg_bl_seq = #intg_bl_seq#
	</select>
    
    <select id="searchAesVhcCnt" parameterClass="String" resultClass="Integer">
		SELECT	COUNT('X')
		  FROM	tb_aes_vhc
		 WHERE	intg_bl_seq = #intg_bl_seq#
    </select>
    
    <!--Master Container 목록 조회  -->
    <!--#20419 [BINEX] MLB/IPI 건들 2nd Arrival Notice (Final DSTN) jsjang 2013.9.11 - dg, remark, pickup, lfd, cntr_go_date hbl 자동연계  -->
    <select id="selectMasterCNTR_LIST" parameterClass="HashMap" resultClass="CntrLstVO">
    	/* selectMasterCNTR_LIST */
         SELECT lst.intg_bl_seq,        lst.cntr_list_seq,       lst.rgst_cntr_yn,
                lst.cntr_no,            lst.cntr_tpsz_cd,
                lst.cgo_pck_qty,        lst.cgo_pck_ut,          lst.cgo_wgt,           lst.cgo_meas,         lst.vol_meas,
                lst.soc_flg,            lst.dg_gds_flg,          lst.cntr_rmk,		    lst.cgo_wgt1, 		  lst.cgo_meas1,
                lst.seal_no1,           lst.seal_no2,            lst.seal_no3, 
                lst.cntr_sprl_trdp_cd,  prn.eng_nm AS cntr_sprl_trdp_nm, 
                bl.shp_mod_cd
                ,lst.dg_gds_flg, lst.cntr_rmk, lst.pickup_number, CONVERT(VARCHAR, ISNULL(lst.lfd, ''), 120) AS lfd
                ,CONVERT(VARCHAR, ISNULL(lst.cntr_go_date, ''), 120) AS cntr_go_date
                ,lst.temp_cd, lst.vent_cd ,lst.temp_val
                , lst.emty_rt_dt
		   FROM TB_INTG_BL BL
		   JOIN TB_CNTR_LIST LST ON BL.INTG_BL_SEQ = LST.INTG_BL_SEQ AND LST.DELT_FLG = 'N'
LEFT OUTER JOIN tb_trdp prn
             ON LST.cntr_sprl_trdp_cd = prn.trdp_cd  AND prn.delt_flg = 'N'
 		  WHERE 1=1
 		    AND bl.biz_clss_cd = 'M'
 		  <isNotEmpty property="f_rlt_intg_bl_seq">
   			AND BL.intg_bl_seq = #f_rlt_intg_bl_seq#
 		  </isNotEmpty>
 		  <isNotEmpty property="f_cntr_no">
   			AND LST.CNTR_NO LIKE '%' + #f_cntr_no# + '%'
 		  </isNotEmpty>
 		  <isNotEmpty property="f_cntr_tpsz_cd">
   			AND LST.CNTR_TPSZ_CD = #f_cntr_tpsz_cd#
 		  </isNotEmpty>
       ORDER BY lst.cntr_list_seq ASC
    </select>
    
    <select id="selectMasterCNTR_LIST_CNT" parameterClass="HashMap" resultClass="Integer">
         SELECT COUNT(*)
		   FROM TB_INTG_BL BL
		   JOIN TB_CNTR_LIST LST ON BL.INTG_BL_SEQ = LST.INTG_BL_SEQ AND LST.DELT_FLG = 'N'
LEFT OUTER JOIN tb_trdp prn
             ON LST.cntr_sprl_trdp_cd = prn.trdp_cd  AND prn.delt_flg = 'N'
 		  WHERE 1=1
 		    AND bl.biz_clss_cd = 'M'
 		  <isNotEmpty property="f_ref_no">
   			AND BL.REF_NO = #f_ref_no#
 		  </isNotEmpty>
 		  <isNotEmpty property="f_cntr_no">
   			AND LST.CNTR_NO LIKE '%' + #f_cntr_no# + '%'
 		  </isNotEmpty>
 		  <isNotEmpty property="f_cntr_tpsz_cd">
   			AND LST.CNTR_TPSZ_CD = #f_cntr_tpsz_cd#
 		  </isNotEmpty>
    </select>
    
    <select id="selectRefCNTR_LIST" parameterClass="HashMap" resultClass="CntrLstVO">
    	/* selectRefCNTR_LIST */
         SELECT lst.intg_bl_seq,        lst.cntr_list_seq,       lst.rgst_cntr_yn,
                lst.cntr_no,            lst.cntr_tpsz_cd,
                lst.cgo_pck_qty,        lst.cgo_pck_ut,          lst.cgo_wgt,           lst.cgo_meas,         lst.vol_meas,
                lst.soc_flg,            lst.dg_gds_flg,          lst.cntr_rmk,		    lst.cgo_wgt1, 		  lst.cgo_meas1,
                lst.seal_no1,           lst.seal_no2,            lst.seal_no3, 
                lst.cntr_sprl_trdp_cd,  prn.eng_nm AS cntr_sprl_trdp_nm, 
                bl.shp_mod_cd
                ,lst.dg_gds_flg, lst.cntr_rmk, lst.pickup_number, CONVERT(VARCHAR, ISNULL(lst.lfd, ''), 120) AS lfd
                ,CONVERT(VARCHAR, ISNULL(lst.cntr_go_date, ''), 120) AS cntr_go_date
                ,lst.temp_cd, lst.vent_cd ,lst.temp_val
                , lst.emty_rt_dt
		   FROM TB_INTG_BL BL
		   JOIN TB_CNTR_LIST LST ON BL.INTG_BL_SEQ = LST.INTG_BL_SEQ AND LST.DELT_FLG = 'N'
LEFT OUTER JOIN tb_trdp prn
             ON LST.cntr_sprl_trdp_cd = prn.trdp_cd  AND prn.delt_flg = 'N'
 		  WHERE 1=1
 		    AND bl.biz_clss_cd = 'M'
   			AND BL.ref_no = #f_ref_no#
       ORDER BY lst.cntr_list_seq ASC
    </select>
    
    <!-- Local Invoice    -->
    <select id="selectLocalInvSeq" parameterClass="String" resultClass="String">
		SELECT  dtl.inv_seq
		  FROM	tb_frt frt
		  
		  JOIN	tb_inv_dtl dtl
			ON	dtl.inv_seq = frt.inv_seq
			
		 WHERE	frt.intg_bl_seq = #intg_bl_seq#
		   AND	frt.sell_buy_tp_cd = 'S'
		GROUP BY dtl.inv_seq
    </select>
    
    <!-- Credit/Debit Note    -->
    <select id="selectCrDbInvSeq" parameterClass="String" resultClass="com.clt.apps.fis.see.bmd.housebl.dto.DocumentPackageVO">
		SELECT	data_tp,	data_seq,	data_trdp_cd,	trdp_nm,
				bl_no,		sort_no
		  FROM	(
				SELECT 'MCRDB' AS data_tp, dtl.inv_seq AS data_seq, agt.trdp_cd AS data_trdp_cd,
						ISNULL(agt.trdp_nm,'ZZZZZZZ') AS trdp_nm,		mbl.bl_no,
						9 AS sort_no
				FROM tb_intg_bl mbl
				JOIN tb_frt frt ON frt.intg_bl_seq = mbl.intg_bl_seq
				AND frt.sell_buy_tp_cd IN ('C','D') AND frt.delt_flg = 'N'
				JOIN tb_inv_dtl dtl ON dtl.inv_seq = frt.inv_seq AND dtl.delt_flg = 'N'
				LEFT OUTER JOIN tb_bl_prnr agt
				ON agt.intg_bl_seq = mbl.intg_bl_seq AND agt.bl_trdp_tp_cd = 'C01' AND agt.delt_flg = 'N'
				WHERE mbl.intg_bl_seq = #intg_bl_seq# AND mbl.delt_flg = 'N'
				
				UNION
				
				SELECT 'HCRDB' AS data_tp, dtl.inv_seq AS data_seq, agt.trdp_cd AS data_trdp_cd,
						ISNULL(agt.trdp_nm,'ZZZZZZZ') AS trdp_nm,		hbl.bl_no,
						2 AS sort_no
				FROM tb_intg_bl_rlt rlt
				JOIN tb_intg_bl hbl ON hbl.intg_bl_seq = rlt.intg_bl_seq
				AND hbl.delt_flg = 'N'
				JOIN tb_frt frt ON frt.intg_bl_seq = hbl.intg_bl_seq
				AND frt.sell_buy_tp_cd IN ('C','D') AND frt.delt_flg = 'N'
				JOIN tb_inv_dtl dtl ON dtl.inv_seq = frt.inv_seq AND dtl.delt_flg = 'N'
				LEFT OUTER JOIN tb_bl_prnr agt
				ON agt.intg_bl_seq = hbl.intg_bl_seq AND agt.bl_trdp_tp_cd = 'P01' AND agt.delt_flg = 'N'
				WHERE rlt.rlt_intg_bl_seq = #intg_bl_seq# AND rlt.delt_flg = 'N'
				)inval	
		GROUP BY data_tp, data_seq, data_trdp_cd, trdp_nm, bl_no, sort_no
    </select>
    
	<!-- House B/L    -->
    <select id="selectHblSeq" parameterClass="String" resultClass="com.clt.apps.fis.see.bmd.housebl.dto.DocumentPackageVO">
		SELECT	'HBL' AS data_tp,		hbl.intg_bl_seq AS data_seq,		agt.trdp_cd AS data_trdp_cd,
				ISNULL(agt.trdp_nm,'ZZZZZZZ') AS trdp_nm,					hbl.bl_no,
				1 AS sort_no,			hbl.hbl_tp_cd,						hbl.flt_no,
				shp.trdp_nm AS shpr_trdp_nm,								lnr.trdp_nm AS lnr_trdp_nm,
				thr.trdp_nm AS thr_trdp_nm, CASE WHEN isnull(sub_mbl_flg,'') = 'Y' THEN 'N' ELSE 'Y' END AS frt_flg
		  FROM	tb_intg_bl_rlt rlt

		  JOIN	tb_intg_bl hbl
			ON	hbl.intg_bl_seq = rlt.intg_bl_seq AND hbl.delt_flg = 'N'
			
LEFT OUTER JOIN tb_bl_prnr agt
			ON	agt.intg_bl_seq = hbl.intg_bl_seq AND agt.bl_trdp_tp_cd = 'P01' AND agt.delt_flg = 'N'
			
LEFT OUTER JOIN tb_bl_prnr shp
			ON	shp.intg_bl_seq = hbl.intg_bl_seq AND shp.bl_trdp_tp_cd = 'S01' AND shp.delt_flg = 'N'
			
LEFT OUTER JOIN tb_bl_prnr lnr
			ON	lnr.intg_bl_seq = hbl.intg_bl_seq AND lnr.bl_trdp_tp_cd = 'L01' AND lnr.delt_flg = 'N'
			
LEFT OUTER JOIN tb_bl_prnr thr
			ON	thr.intg_bl_seq = hbl.intg_bl_seq AND thr.bl_trdp_tp_cd = 'T01' AND thr.delt_flg = 'N'

		 WHERE	rlt.rlt_intg_bl_seq = #intg_bl_seq#
		   AND	rlt.delt_flg = 'N'
    </select>
    
	<!-- Commercial Invoice    -->
    <select id="selectCmcInvSeq" parameterClass="String" resultClass="com.clt.apps.fis.see.bmd.housebl.dto.DocumentPackageVO">
		SELECT	'CMC' AS data_tp,		oth.intg_bl_seq AS data_seq,		agt.trdp_cd AS data_trdp_cd,
				ISNULL(agt.trdp_nm,'ZZZZZZZ') AS trdp_nm,					hbl.bl_no,
				3 AS sort_no
		  FROM	tb_intg_bl_rlt rlt

		  JOIN	tb_intg_bl hbl
			ON	hbl.intg_bl_seq = rlt.intg_bl_seq AND hbl.delt_flg = 'N'
			
LEFT OUTER JOIN tb_bl_prnr agt
			ON	agt.intg_bl_seq = hbl.intg_bl_seq AND agt.bl_trdp_tp_cd = 'P01' AND agt.delt_flg = 'N'
			
		  JOIN	tb_bl_oth oth
			ON	oth.intg_bl_seq = hbl.intg_bl_seq AND oth.wrk_tp = 'CI'

		 WHERE	rlt.rlt_intg_bl_seq = #intg_bl_seq#
		   AND	rlt.delt_flg = 'N'
    </select>
    
    <!-- Packing List    -->
    <select id="selectPckInvSeq" parameterClass="String" resultClass="com.clt.apps.fis.see.bmd.housebl.dto.DocumentPackageVO">
		SELECT	'PCK' AS data_tp,		oth.intg_bl_seq AS data_seq,		agt.trdp_cd AS data_trdp_cd,
				ISNULL(agt.trdp_nm,'ZZZZZZZ') AS trdp_nm,					hbl.bl_no,
				4 AS sort_no
		  FROM	tb_intg_bl_rlt rlt
		  
		  JOIN	tb_intg_bl hbl
			ON	hbl.intg_bl_seq = rlt.intg_bl_seq AND hbl.delt_flg = 'N'
			
LEFT OUTER JOIN tb_bl_prnr agt
			ON	agt.intg_bl_seq = hbl.intg_bl_seq AND agt.bl_trdp_tp_cd = 'P01' AND agt.delt_flg = 'N'

		  JOIN	tb_bl_oth oth
			ON	oth.intg_bl_seq = hbl.intg_bl_seq AND oth.wrk_tp = 'PL'

		 WHERE	rlt.rlt_intg_bl_seq = #intg_bl_seq#
		   AND	rlt.delt_flg = 'N'
    </select>
    
    <!-- COMMERCIAL INVOICE BL_NO로 INTG_BL_SEQ 조회  -->
    <select id="selectINTG_BL_SEQ" parameterClass="HashMap" resultClass="String">
	    /* BlCmmSQL.xml > selectINTG_BL_SEQ */
    	SELECT BL.intg_bl_seq
    	  FROM TB_INTG_BL BL
		  	JOIN  TB_ADD_INFO_BND BND
		    ON  BL.INTG_BL_SEQ = BND.INTG_BL_SEQ AND BND.DELT_FLG = 'N'
    	 WHERE BL.bl_no = #bl_no#
		<isNotEmpty property="air_sea_clss_cd">
		    AND BL.air_sea_clss_cd = #air_sea_clss_cd#
		</isNotEmpty>
		<!-- #33414 [BINEX] Certificate of Origin 이 출력 오류 -->
		<isNotEmpty property="biz_clss_cd">
		 	AND  BL.biz_clss_cd  = #biz_clss_cd#
		</isNotEmpty>
		<isNotEmpty property="biz_clss_cd">
			AND  BND.BND_CLSS_CD = #bnd_clss_cd#
		</isNotEmpty>
    </select>
    
    <!-- COMMERCIAL INVOICE BL_NO로 INTG_BL_SEQ 조회 Commercial Invoice/ Packing List화면에서 사용  -->
    <select id="selectINTG_BL_SEQ_CI_PL" parameterClass="String" resultClass="String">
	    /* BlCmmSQL.xml > selectINTG_BL_SEQ */
    	SELECT intg_bl_seq
    	  FROM TB_INTG_BL
    	 WHERE bl_no = #bl_no#
    	   AND biz_clss_cd ='H'
    </select>
    
        <!-- COMMERCIAL INVOICE BL_NO로 INTG_BL_SEQ 조회 Commercial Invoice/ Packing List화면에서 사용  -->
    <select id="selectINTG_BL_SEQ_DOOR_RECEIPT" parameterClass="HashMap" resultClass="String">
	    /* BlCmmSQL.xml > selectINTG_BL_SEQ_DOOR_RECEIPT */
    	SELECT intg_bl_seq
    	  FROM TB_INTG_BL
    	 WHERE biz_clss_cd ='M'
    	   AND delt_flg = 'N'
    	 <isNotEmpty property="f_ref_no">
   		   AND REF_NO = #f_ref_no#
 		  </isNotEmpty>
 		  <isNotEmpty property="f_bl_no">
    	   AND BL_NO = #f_bl_no#
    	  </isNotEmpty>  
    </select>
    
    <!-- COMMERCIAL INVOICE TB_BL_OTH   -->
    <select id="selectBLINFO_OTH" parameterClass="HashMap" resultClass="PLCIBLInfoVO">
   		/* BlCmmSQL.xml > selectBLINFO_OTH */
		SELECT seller_addr
		      ,cnee_addr
		      ,notify_addr
		      ,vsl_flt
		      ,pol_nm
		      ,pod_nm
		      ,inv_no
		      ,inv_dt
		      ,lc_no
		      ,lc_dt
		      ,lc_issue_bank
		      ,por_nm
		      ,carr_trdp_cd
		      ,carr_trdp_nm
		      ,svc_term
		      ,CONVERT(varchar(8), etd_dttm, 120)   AS etd_dttm
		      ,mk_txt
		      ,qty + char(13)+char(10) AS qty
		      ,desc_txt
		      ,price + char(13)+char(10) AS price
		      ,amount + char(13)+char(10) AS amount
		      ,grs_wgt
		      ,chg_wgt
		      ,meas
		      ,intg_bl_seq
		      ,wrk_tp
		  FROM TB_BL_OTH
		 WHERE intg_bl_seq = #intg_bl_seq#
		   AND WRK_TP = 'CI'
	</select>
	
	
	
	<!-- PACKING LIST TB_BL_OTH   -->
    <select id="selectBLINFO_OTH_PL" parameterClass="HashMap" resultClass="PLCIBLInfoVO">
      /* BlCmmSQL.xml > selectBLINFO_OTH_PL */
		SELECT seller_addr
		      ,cnee_addr
		      ,notify_addr
		      ,vsl_flt
		      ,pol_nm
		      ,pod_nm
		      ,inv_no
		      ,inv_dt
		      ,lc_no
		      ,lc_dt
		      ,lc_issue_bank
		      ,carr_trdp_cd
		      ,carr_trdp_nm
		      ,por_nm
		      ,svc_term
		      ,CONVERT(varchar(8), etd_dttm, 120)   AS etd_dttm
		      ,mk_txt
		      ,qty + char(13)+char(10) AS qty
		      ,desc_txt
		      ,price
		      ,amount
		      ,grs_wgt + char(13)+char(10) AS grs_wgt
		      ,chg_wgt + char(13)+char(10) AS chg_wgt
		      ,meas + char(13)+char(10) AS meas
		      ,intg_bl_seq
		      ,wrk_tp
		  FROM TB_BL_OTH
		 WHERE intg_bl_seq = #intg_bl_seq#
		   AND WRK_TP = 'PL'
	</select>
	
	
	<!-- CERTIFICATE OF ORIGIN TB_BL_OTH   -->
    <select id="selectBLINFO_OTH_CO" parameterClass="HashMap" resultClass="PLCIBLInfoVO">
   		/* BlCmmSQL.xml > selectBLINFO_OTH_CO */
		SELECT seller_addr	AS shpr_addr
		      ,cnee_addr
		      ,notify_addr
		      ,bl_no
		      ,bl_no as doc_recpt_no	/* 20130406 OJG*/
		      ,bl_dt
		      ,cnt_origin
		      ,exp_ref_no
		      ,cnt_origin
		      ,exp_carrier
		      ,vsl_flt
		      ,pol_nm
		      ,pod_nm
		      ,inv_no
		      ,inv_dt
		      ,por_nm
		      ,chamber
		      ,state_nm
		      ,svc_term
		      ,CONVERT(varchar(8), etd_dttm, 120)   AS etd_dttm
		      ,mk_txt
		      ,qty + char(13)+char(10) AS qty
		      ,desc_txt
		      ,price
		      ,amount
		      ,grs_wgt + char(13)+char(10) AS grs_wgt
		      ,chg_wgt + char(13)+char(10) AS chg_wgt
		      ,meas + char(13)+char(10) AS meas
		      ,intg_bl_seq
		      ,wrk_tp
		  FROM TB_BL_OTH
		 WHERE intg_bl_seq = #intg_bl_seq#
		   AND WRK_TP = 'CO'
	</select>
	
	
	<!-- COMMERCIAL INVOICE TB_INTG_BL   -->
    <select id="selectBLINFO_INTG_BL" parameterClass="HashMap" resultClass="PLCIBLInfoVO">
        /* BlCmmSQL.xml > selectBLINFO_INTG_BL */
		SELECT   bl.BL_NO
		        ,bl.DOC_RECPT_NO 		/* 20130405 OJG */
				,bl.ACT_SHP_INFO    				AS SELLER_ADDR
				,shpr.TRDP_ADDR						AS SHPR_ADDR
				,cnee.TRDP_ADDR						AS CNEE_ADDR
				,nty.TRDP_ADDR						AS NOTIFY_ADDR
				,bl.bl_dt_tm						AS BL_DT
				/*,(select x.cnt_eng_nm from TB_CNT x where x.CNT_CD = bl.cnt_cd and x.delt_flg = 'N') AS cnt_origin 	20130403 OJG*/
				,CASE AIR_SEA_CLSS_CD WHEN 'S' THEN ( select MAX(y.CNT_ENG_NM) from TB_STATE x,  TB_CNT y where x.STATE_CD = bl.STATE_CD  	and x.CNT_CD = y.CNT_CD and x.USE_FLG = 'Y') 
				                                  WHEN 'A' THEN (select x.cnt_eng_nm from TB_CNT x where x.CNT_CD = bl.cnt_cd and x.delt_flg = 'N') END AS cnt_origin 	/* 20130405 OJG*/
				,bl.exp_ref_no						AS EXP_REF_NO
				,CASE WHEN bl.air_sea_clss_cd = 'S' THEN  bl.TRNK_VSL_NM + ' / ' + bl.TRNK_VOY  /*(SELECT x.ENG_NM FROM TB_TRDP x WHERE x.TRDP_CD = bl.CARR_TRDP_CD1)	20130403 OJG */
				      ELSE bl.flt_no
				 END AS EXP_CARRIER
				,CASE WHEN bl.air_sea_clss_cd = 'A' THEN bl.flt_no
   				      WHEN bl.air_sea_clss_cd = 'S' AND ISNULL(bl.TRNK_VSL_NM,'') = '' AND ISNULL(TRNK_VOY,'') = '' THEN '' 
				      ELSE bl.TRNK_VSL_NM+ '/' + TRNK_VOY 
				 END AS VSL_FLT
				,bl.POL_NM
				,bl.POD_NM
				,bl.POR_NM
				,CASE WHEN bl.AIR_SEA_CLSS_CD = 'A' 
						THEN CASE WHEN bl.FRT_TERM_CD = 'PP' THEN 'FREIGHT PREPAID'
							      WHEN bl.FRT_TERM_CD = 'CC' THEN 'FREIGHT COLLECT'  
							 END
				      WHEN bl.AIR_SEA_CLSS_CD = 'S' 
						THEN CASE WHEN bl.FRT_TERM_C_CD = 'PP' THEN 'FREIGHT PREPAID'
							      WHEN bl.FRT_TERM_C_CD = 'CC' THEN 'FREIGHT COLLECT'
							 END
				 END								AS SVC_TERM
				,CONVERT(varchar(8), bl.ETD_DT_TM, 120) AS etd_dttm
				,bl.MK_TXT
				,CONVERT(VARCHAR, bl.PCK_QTY) + ' ' + pcd.PCK_NM	AS QTY
				,bl.DESC_TXT
				,CONVERT(VARCHAR,bl.GRS_WGT) + ' KGS' + char(13)+char(10) + CONVERT(VARCHAR,bl.GRS_WGT1)+ ' LBS' + char(13)+char(10)	AS GRS_WGT
				,CONVERT(VARCHAR,bl.CHG_WGT) + ' KGS' + char(13)+char(10) + CONVERT(VARCHAR,bl.CHG_WGT1)+ ' LBS' + char(13)+char(10)	AS CHG_WGT
				,CASE WHEN bl.AIR_SEA_CLSS_CD = 'A' THEN  CONVERT(VARCHAR,bl.VOL_MEAS) + ' CBM'
				      ELSE CONVERT(VARCHAR,bl.MEAS) + ' CBM' + char(13)+char(10) + CONVERT(VARCHAR,bl.MEAS1)+ ' CFT'	+ char(13)+char(10)		
				 END AS MEAS
				,'' AS WRK_TP 
				,'' AS LC_NO
				,'' AS LC_DT
				,'' AS LC_ISSUE_BANK
				,LNR.TRDP_CD AS CARR_TRDP_CD
			    ,LNR.TRDP_NM AS CARR_TRDP_NM
		  FROM TB_INTG_BL bl
			 LEFT OUTER JOIN tb_bl_prnr shpr
			      ON bl.intg_bl_seq = shpr.intg_bl_seq  
			      AND shpr.bl_trdp_tp_cd = 'S01' 
			      AND shpr.delt_flg = 'N'  
			 LEFT OUTER JOIN tb_bl_prnr cnee
			      ON bl.intg_bl_seq = cnee.intg_bl_seq  
			      AND cnee.bl_trdp_tp_cd = 'C01' 
			      AND cnee.delt_flg = 'N' 
			 LEFT OUTER JOIN tb_bl_prnr nty
			      ON  bl.intg_bl_seq = nty.intg_bl_seq  
			      AND nty.bl_trdp_tp_cd = 'N01' 
			      AND nty.delt_flg = 'N'
			 LEFT OUTER JOIN tb_pck_ut_cd pcd        
	              ON bl.pck_ut_cd = pcd.pck_ut_cd 
	              AND pcd.use_flg = 'Y'
	         LEFT OUTER JOIN tb_bl_prnr lnr
		 	      ON bl.intg_bl_seq = lnr.intg_bl_seq
  			      AND lnr.bl_trdp_tp_cd = 'L01'
		          AND lnr.delt_flg = 'N'                        
			 WHERE bl.intg_bl_seq = #intg_bl_seq#
	</select>
	
	
	
	
	<!--COMMERCIAL INVOICE 등록   -->
    <insert id="insertCI_BLINFO" parameterClass="HashMap">
    	/* BlCmmSQL.xml > insertCI_BLINFO */
    	INSERT INTO TB_BL_OTH( intg_bl_seq
					           ,wrk_tp
					           ,seller_addr
					           ,cnee_addr
					           ,vsl_flt
					           ,etd_dttm
					           ,bl_no
					
					           ,inv_no
					           ,inv_dt
					           
					           ,lc_no
					           ,lc_dt
					           ,lc_issue_bank
					           ,carr_trdp_cd
					           ,carr_trdp_nm
					           
					           ,por_nm
					           ,pol_nm
					           ,pod_nm
					           ,notify_addr
					           ,svc_term
					           ,mk_txt
					           ,desc_txt
					           ,qty
					
					           ,price
					           ,amount
					           ,rgst_usrid
					           ,rgst_ofc_cd
					           ,rgst_tms
					           ,modi_usrid
					           ,modi_ofc_cd
					           ,modi_tms
					    	)VALUES(
					    		#intg_bl_seq#
					           ,'CI'
					           ,#f_seller#
					           ,#f_consignee#
					           ,#f_vslflt#
					           ,#f_dept_dt#
					           ,#txt_hbl_no#
					
					           ,#f_inv_no#
					           ,#f_inv_dt#
					           
					           ,#f_lc_no#
					           ,#f_lc_dt#
					           ,#f_lc_issue_bank#
					           ,#f_carr_trdp_cd#
					           ,#f_carr_trdp_nm#
					           
					           ,#f_por#
					           ,#f_dept#
					           ,#f_dest#
					           ,#f_notify#
					           ,#f_termpay#
					           ,#f_mark_num#
					           ,#f_desc_good#
					           ,#f_qty#
					
					           ,#f_unit#
					           ,#f_amt#
					           ,#proc_usrid#
					           ,#proc_ofccd#
					           ,getdate()
					           ,#proc_usrid#
					           ,#proc_ofccd#
					           ,GETUTCDATE()
    	)
    
    </insert>
    
    
    <!--COMMERCIAL INVOICE 수정   -->
    <update id="updateCI_BLINFO" parameterClass="HashMap">
    	/* BlCmmSQL.xml > updateCI_BLINFO */
    	UPDATE TB_BL_OTH
    	   SET seller_addr		= #f_seller#
	           ,cnee_addr		= #f_consignee#
	           ,notify_addr		= #f_notify#
	           ,vsl_flt			= #f_vslflt#
	           ,etd_dttm		= #f_dept_dt#
	           ,inv_no			= #f_inv_no#
	           ,inv_dt			= #f_inv_dt#
	           ,lc_no			= #f_lc_no#
	           ,lc_dt			= #f_lc_dt#
	           ,lc_issue_bank 	= #f_lc_issue_bank#
	           ,carr_trdp_cd 	= #f_carr_trdp_cd#
	           ,carr_trdp_nm 	= #f_carr_trdp_nm#
	           ,por_nm			= #f_por#
	           ,pol_nm			= #f_dept#
	           ,pod_nm			= #f_dest#
	           ,svc_term		= #f_termpay#
	           ,mk_txt			= #f_mark_num#
	           ,desc_txt		= #f_desc_good#
	           ,qty				= #f_qty#
	           ,price			= #f_unit#
	           ,amount			= #f_amt#
	           ,modi_usrid		= #proc_usrid#
	           ,modi_ofc_cd		= #proc_ofccd#
	           ,modi_tms		= GETUTCDATE()
	     WHERE intg_bl_seq  	= #intg_bl_seq#
	       AND wrk_tp 			= 'CI'  
    </update>
    
    
    
    
    <!--PACKING LIST 등록   -->
    <insert id="insertPL_BLINFO" parameterClass="HashMap">
    	/* BlCmmSQL.xml > insertPL_BLINFO */
    	INSERT INTO TB_BL_OTH(  intg_bl_seq
					           ,wrk_tp
					           ,seller_addr
					           ,cnee_addr
					           ,notify_addr
					           ,vsl_flt
					           ,etd_dttm
					           ,bl_no
					           ,inv_no
					           ,inv_dt
					           
					           ,lc_no
					           ,lc_dt
					           ,lc_issue_bank
					           ,carr_trdp_cd
					           ,carr_trdp_nm
					           
					           ,por_nm
					           ,pol_nm
					           ,pod_nm
					           ,svc_term
					           ,mk_txt
					           ,desc_txt
					           ,qty
					
					           ,grs_wgt
					           ,chg_wgt
					           ,meas
					           ,rgst_usrid
					           ,rgst_ofc_cd
					           ,rgst_tms
					           ,modi_usrid
					           ,modi_ofc_cd
					           ,modi_tms
					    	)VALUES(
					    		#intg_bl_seq#
					           ,'PL'
					           ,#f_seller#
					           ,#f_consignee#
					           ,#f_notify#
					           ,#f_vslflt#
					           ,#f_dept_dt#
					           ,#txt_hbl_no#
					
					           ,#f_inv_no#
					           ,#f_inv_dt#
					           
					           ,#f_lc_no#
					           ,#f_lc_dt#
					           ,#f_lc_issue_bank#
					           ,#f_carr_trdp_cd#
					           ,#f_carr_trdp_nm#
					           
					           ,#f_por#
					           ,#f_dept#
					           ,#f_dest#
					
					           ,#f_termpay#
					           ,#f_mark_num#
					           ,#f_desc_good#
					           ,#f_qty#
					
					           ,#f_grs_wgt#
					           ,#f_chg_wgt#
					           ,#f_meas#
					           ,#proc_usrid#
					           ,#proc_ofccd#
					           ,getdate()
					           ,#proc_usrid#
					           ,#proc_ofccd#
					           ,getutcdate()
    		)
    
    </insert>
    
    
    
    <!--PACKING LIST 수정   -->
    <update id="updatePL_BLINFO" parameterClass="HashMap">
    	/* BlCmmSQL.xml > updatePL_BLINFO */
    	UPDATE TB_BL_OTH
    	   SET seller_addr		= #f_seller#
	           ,cnee_addr		= #f_consignee#
	           ,notify_addr		= #f_notify#	           
	           ,vsl_flt			= #f_vslflt#
	           ,etd_dttm		= #f_dept_dt#
	           ,inv_no			= #f_inv_no#
	           ,inv_dt			= #f_inv_dt#
	           ,lc_no			= #f_lc_no#
	           ,lc_dt			= #f_lc_dt#
	           ,lc_issue_bank 	= #f_lc_issue_bank#
	           ,carr_trdp_cd	= #f_carr_trdp_cd#
	           ,carr_trdp_nm	= #f_carr_trdp_nm#
	           ,por_nm			= #f_por#
	           ,pol_nm			= #f_dept#
	           ,pod_nm			= #f_dest#
	           ,svc_term		= #f_termpay#
	           ,mk_txt			= #f_mark_num#
	           ,desc_txt		= #f_desc_good#
	           ,qty				= #f_qty#
	           ,grs_wgt			= #f_grs_wgt#
	           ,chg_wgt			= #f_chg_wgt#
	           ,meas			= #f_meas#
	           ,modi_usrid		= #proc_usrid#
	           ,modi_ofc_cd		= #proc_ofccd#
	           ,modi_tms		= GETUTCDATE()     WHERE intg_bl_seq  	= #intg_bl_seq#
	       AND wrk_tp 			= 'PL'  
    </update>
    
    
    
    <!-- CERTIFICATE OF ORIGIN 등록   -->
    <insert id="insertCO_BLINFO" parameterClass="HashMap">
    	/* BlCmmSQL.xml > insertCO_BLINFO */
    	INSERT INTO TB_BL_OTH(
    		intg_bl_seq
           ,wrk_tp
           ,seller_addr
           ,cnee_addr
           ,bl_no
		   ,bl_dt	
		   ,exp_ref_no
		   ,cnt_origin
		   ,exp_carrier
		   ,chamber
		   ,state_nm
           ,pol_nm
           ,pod_nm
           ,notify_addr
           ,mk_txt
           ,desc_txt
           ,qty
           ,grs_wgt
           ,chg_wgt
           ,meas
           ,rgst_usrid
           ,rgst_ofc_cd
           ,rgst_tms
           ,modi_usrid
           ,modi_ofc_cd
           ,modi_tms
    	)VALUES(
    		#intg_bl_seq#
           ,'CO'
           ,#f_seller#
           ,#f_consignee#
           ,#f_bl_no#
		   ,#f_bl_dt#	
		   ,#f_exp_ref#
		   ,#f_cnt_origin#
		   ,#f_exp_carrier#
		   ,#f_chamber#
		   ,#f_state_nm#
           ,#f_pol_nm#
           ,#f_pod_nm#
           ,#f_notify#
           ,#f_mark_num#
           ,#f_desc_good#
           ,#f_qty#
           ,#f_grs_wgt#
           ,#f_chg_wgt#
           ,#f_meas#
           ,#proc_usrid#
           ,#proc_ofccd#
           ,getdate()
           ,#proc_usrid#
           ,#proc_ofccd#
           ,GETUTCDATE()
    	)
    </insert>
    
    
    <!--CERTIFICATE OF ORIGIN 수정   -->
    <update id="updateCO_BLINFO" parameterClass="HashMap">
    	/* BlCmmSQL.xml > updateCO_BLINFO */
    	UPDATE TB_BL_OTH
    	   SET  seller_addr	= #f_seller#
	           ,cnee_addr	= #f_consignee#
	           ,bl_no		= #f_bl_no#
			   ,bl_dt		= #f_bl_dt#
			   ,exp_ref_no	= #f_exp_ref#
			   ,cnt_origin	= #f_cnt_origin#
			   ,exp_carrier	= #f_exp_carrier#
			   ,chamber		= #f_chamber#
			   ,state_nm	= #f_state_nm#
	           ,pol_nm		= #f_pol_nm#
	           ,pod_nm		= #f_pod_nm#
	           ,notify_addr	= #f_notify#
	           ,mk_txt		= #f_mark_num#
	           ,desc_txt	= #f_desc_good#
	           ,qty			= #f_qty#
	           ,grs_wgt		= #f_grs_wgt#
	           ,chg_wgt		= #f_chg_wgt#
	           ,meas		= #f_meas#
	           ,modi_usrid	= #proc_usrid#
	           ,modi_ofc_cd	= #proc_ofccd#
	           ,modi_tms	= GETUTCDATE()
	     WHERE intg_bl_seq  = #intg_bl_seq#
	       AND wrk_tp 		= 'CO'  
    </update>
    
    
    
    <!-- Ocean Export > Master BL > Package Label   -->
    <select id="selectSEE_BMD_0061_MBL" parameterClass="java.util.HashMap" resultClass="java.util.HashMap">
	/* BlCmmSQL > selectSEE_BMD_0061_MBL */    
		SELECT	a1.intg_bl_seq
				,ISNULL(a1.pck_qty, 0) AS mbl_pck_qty
				
		  		,(SELECT ISNULL(SUM(hbl.pck_qty), 0) FROM tb_intg_bl hbl, tb_intg_bl_rlt rlt
					WHERE rlt.rlt_intg_bl_seq = a1.intg_bl_seq AND hbl.intg_bl_seq = rlt.intg_bl_seq
					AND rlt.delt_flg = 'N' AND hbl.delt_flg = 'N') AS pck_qty
				, '1/' + CONVERT(VARCHAR, (SELECT ISNULL(SUM(hbl.pck_qty), 0) FROM tb_intg_bl hbl, tb_intg_bl_rlt rlt
					WHERE rlt.rlt_intg_bl_seq = a1.intg_bl_seq AND hbl.intg_bl_seq = rlt.intg_bl_seq
					AND rlt.delt_flg = 'N' AND hbl.delt_flg = 'N')) pack_qty_no1
				, CONVERT(VARCHAR, (SELECT ISNULL(SUM(hbl.pck_qty), 0) FROM tb_intg_bl hbl, tb_intg_bl_rlt rlt
					WHERE rlt.rlt_intg_bl_seq = a1.intg_bl_seq AND hbl.intg_bl_seq = rlt.intg_bl_seq
					AND rlt.delt_flg = 'N' AND hbl.delt_flg = 'N')) + '/' + CONVERT(VARCHAR, (SELECT ISNULL(SUM(hbl.pck_qty), 0) FROM tb_intg_bl hbl, tb_intg_bl_rlt rlt
					WHERE rlt.rlt_intg_bl_seq = a1.intg_bl_seq AND hbl.intg_bl_seq = rlt.intg_bl_seq
					AND rlt.delt_flg = 'N' AND hbl.delt_flg = 'N')) pack_qty_no2
			    ,a1.bl_no as mbl_no
				,'' as hbl_no
				,a1.pod_nm
				,a3.trdp_cd
				,a3.trdp_nm
				,a3.trdp_addr
				,a3.trdp_phn
				,a3.trdp_fax
				,(select lgl_addr from tb_trdp where trdp_cd = a3.trdp_cd) as lgl_addr 
				,a4.eng_nm
				,a4.lgl_addr
				,a5.pic_nm
				,a5.pic_eml
				,a5.pic_phn
				,a5.pic_fax
				,(SELECT count(*) FROM tb_intg_bl_rlt rlt WHERE rlt.rlt_intg_bl_seq = a1.intg_bl_seq  AND rlt.delt_flg = 'N' ) AS hbl_cnt 
	 FROM tb_intg_bl a1 
		LEFT OUTER JOIN tb_bl_prnr a3 ON a3.intg_bl_seq = a1.intg_bl_seq
	                                 AND a3.bl_trdp_tp_cd = 'P01'
	    LEFT OUTER JOIN tb_trdp a4 ON a4.trdp_cd =  a3.trdp_cd AND a4.DELT_FLG = 'N' 
	    LEFT OUTER JOIN tb_trdp_cntc_pson a5 ON a5.trdp_cd =  a4.trdp_cd  AND rep_flg = 'Y' AND a5.DELT_FLG = 'N'    
	 WHERE a1.intg_bl_seq = #s_intg_bl_seq#
    </select>    
    
    <!-- Ocean Export > House BL > Package Label   -->
    <select id="selectSEE_BMD_0061_HBL" parameterClass="java.util.HashMap" resultClass="java.util.HashMap">
	/* BlCmmSQL > selectSEE_BMD_0061_HBL */    
	SELECT a1.intg_bl_seq
	      ,a1.pck_qty
	      , '1/' + CONVERT(VARCHAR, a1.pck_qty) pack_qty_no1
	      , CONVERT(VARCHAR, a1.pck_qty) + '/' + CONVERT(VARCHAR, a1.pck_qty) pack_qty_no2
	      ,(SELECT y1.bl_no
	          FROM tb_intg_bl y1
	         WHERE y1.intg_bl_seq = (SELECT x1.rlt_intg_bl_seq
	                                   FROM tb_intg_bl_rlt x1
	                                  WHERE x1.intg_bl_seq = a1.intg_bl_seq)) mbl_no
	      ,a1.bl_no hbl_no
	      ,a1.pod_nm
	      ,a3.trdp_cd
	      ,a3.trdp_nm
	      ,a3.trdp_addr
	      ,a3.trdp_phn
	      ,a3.trdp_fax
	      ,(select lgl_addr from tb_trdp where trdp_cd = a3.trdp_cd) as lgl_addr 
	      ,a4.eng_nm
	      ,a4.lgl_addr
	      ,a5.pic_nm
	      ,a5.pic_eml
	      ,a5.pic_phn
	      ,a5.pic_fax
	 FROM tb_intg_bl a1 
		LEFT OUTER JOIN tb_bl_prnr a3 ON a3.intg_bl_seq = a1.intg_bl_seq
	                                 AND a3.bl_trdp_tp_cd = 'P01'
	    LEFT OUTER JOIN tb_trdp a4 ON a4.trdp_cd =  a3.trdp_cd AND a4.DELT_FLG = 'N' 
	    LEFT OUTER JOIN tb_trdp_cntc_pson a5 ON a5.trdp_cd =  a4.trdp_cd  AND rep_flg = 'Y' AND a5.DELT_FLG = 'N'    
	 WHERE a1.intg_bl_seq = #s_intg_bl_seq#
    </select>    
    
    
    
    <!-- Air Export > Master BL > Air Label   -->
    <select id="selectAIE_BMD_0061_MBL" parameterClass="java.util.HashMap" resultClass="java.util.HashMap">
		SELECT	mbl.intg_bl_seq,			mbl.bl_no AS mbl_no,
				ISNULL(mbl.pck_qty, 0) AS mbl_pck_qty,
				'' AS hbl_no,
				(SELECT ISNULL(SUM(hbl.pck_qty), 0) FROM tb_intg_bl hbl, tb_intg_bl_rlt rlt
				  WHERE rlt.rlt_intg_bl_seq = mbl.intg_bl_seq AND hbl.intg_bl_seq = rlt.intg_bl_seq
				    AND rlt.delt_flg = 'N' AND hbl.delt_flg = 'N') AS pck_qty
				,(SELECT count(*) FROM tb_intg_bl_rlt rlt WHERE rlt.rlt_intg_bl_seq = mbl.intg_bl_seq  AND rlt.delt_flg = 'N' ) AS hbl_cnt 
		  FROM	tb_intg_bl mbl
		 WHERE	mbl.intg_bl_seq = #intg_bl_seq#
		   AND	mbl.delt_flg = 'N'
    </select>    



    <!-- Air Export > House BL > Air Label   -->
    <select id="selectAIE_BMD_0061_HBL" parameterClass="java.util.HashMap" resultClass="java.util.HashMap">
		SELECT	hbl.intg_bl_seq,			mbl.bl_no AS mbl_no,
				ISNULL(mbl.pck_qty, 0) AS mbl_pck_qty,
				hbl.bl_no AS hbl_no,		hbl.pck_qty
				,1 as hbl_cnt
		  FROM	tb_intg_bl hbl
  
LEFT OUTER JOIN	tb_intg_bl_rlt rlt
			 ON	rlt.intg_bl_seq = hbl.intg_bl_seq AND rlt.delt_flg = 'N'

LEFT OUTER JOIN tb_intg_bl mbl
			 ON	mbl.intg_bl_seq = rlt.rlt_intg_bl_seq AND mbl.delt_flg = 'N'

		 WHERE	hbl.intg_bl_seq = #intg_bl_seq#
		   AND	hbl.delt_flg = 'N'
    </select>    



    <!-- Ocean Import > House BL > P.O.D.(Proof Of Delivery)   -->
    <select id="selectSEE_BMD_0062" parameterClass="java.util.HashMap" resultClass="java.util.HashMap">
	/* BlCmmSQL > selectSEE_BMD_0062 */    
	SELECT a1.intg_bl_seq
	      ,a1.bl_no hbl_no
	      ,cne.trdp_cd AS trdp_cd
	      ,cne.trdp_nm AS trdp_nm
	      ,isnull(trdp.lgl_addr,'') + 
				 (case when isnull(trdp.city_nm,'') != '' and isnull(trdp.state_cd,'') != '' and isnull(trdp.rep_zip,'') != '' then char(13) + trdp.city_nm + ', ' + trdp.state_cd + ' ' + trdp.rep_zip
				  	   when isnull(trdp.city_nm,'') != '' and isnull(trdp.state_cd,'') != '' and isnull(trdp.rep_zip,'') = '' then char(13) + trdp.city_nm + ' ' + trdp.state_cd
					   when isnull(trdp.city_nm,'') != '' and isnull(trdp.state_cd,'') = '' and isnull(trdp.rep_zip,'') = '' then char(13) + trdp.city_nm
					   when isnull(trdp.city_nm,'') != '' and isnull(trdp.state_cd,'') = '' and isnull(trdp.rep_zip,'') != '' then char(13) + trdp.city_nm + ', ' + trdp.rep_zip
					   else '' end) as trdp_addr 
	      ,cne.trdp_pic as trdp_pic_nm
	      ,cne.trdp_phn AS trdp_phn
	      ,cne.trdp_fax AS trdp_fax                       
	  FROM tb_intg_bl a1 
	   LEFT OUTER JOIN tb_bl_prnr cne
	   		   ON a1.intg_bl_seq = cne.intg_bl_seq  
	          AND cne.bl_trdp_tp_cd = 'C01'
	          AND cne.delt_flg = 'N'
	   LEFT OUTER JOIN tb_trdp trdp
			    ON cne.trdp_cd = trdp.trdp_cd
	  WHERE a1.intg_bl_seq = #s_intg_bl_seq#
    </select>   
    
    
    
    
    <!-- Air Import > House BL > P.O.D.(Proof Of Delivery)   -->
    <select id="selectSEE_BMD_0063" parameterClass="java.util.HashMap" resultClass="java.util.HashMap">
/* BlCmmSQL > selectSEE_BMD_0063 */    
	SELECT a1.intg_bl_seq
	      ,a1.bl_no hbl_no
	      ,cne.trdp_cd AS trdp_cd
	      ,cne.trdp_nm AS trdp_nm
	      ,isnull(trdp.lgl_addr,'') + 
				 (case when isnull(trdp.city_nm,'') != '' and isnull(trdp.state_cd,'') != '' and isnull(trdp.rep_zip,'') != '' then char(13) + trdp.city_nm + ', ' + trdp.state_cd + ' ' + trdp.rep_zip
				  	   when isnull(trdp.city_nm,'') != '' and isnull(trdp.state_cd,'') != '' and isnull(trdp.rep_zip,'') = '' then char(13) + trdp.city_nm + ' ' + trdp.state_cd
					   when isnull(trdp.city_nm,'') != '' and isnull(trdp.state_cd,'') = '' and isnull(trdp.rep_zip,'') = '' then char(13) + trdp.city_nm
					   when isnull(trdp.city_nm,'') != '' and isnull(trdp.state_cd,'') = '' and isnull(trdp.rep_zip,'') != '' then char(13) + trdp.city_nm + ', ' + trdp.rep_zip
					   else '' end) as trdp_addr 
	      ,cne.trdp_pic as trdp_pic_nm
	      ,cne.trdp_phn AS trdp_phn
	      ,cne.trdp_fax AS trdp_fax                       
	  FROM tb_intg_bl a1 
	   LEFT OUTER JOIN tb_bl_prnr cne
	   		   ON a1.intg_bl_seq = cne.intg_bl_seq  
	          AND cne.bl_trdp_tp_cd = 'C01'
	          AND cne.delt_flg = 'N'
	   LEFT OUTER JOIN tb_trdp trdp
			    ON cne.trdp_cd = trdp.trdp_cd
	  WHERE a1.intg_bl_seq = #s_intg_bl_seq#
    </select>   
    
    
    
    <!-- Ocean Import > House BL > USDA Hold Notice   -->
    <select id="selectSEE_BMD_0064" parameterClass="java.util.HashMap" resultClass="java.util.HashMap">
    <![CDATA[
		/* BlCmmSQL > selectSEE_BMD_0064 */    
		SELECT a1.intg_bl_seq
		      ,a1.bl_no hbl_no
		      ,(
				select max(cntr_txt1) + max(cntr_txt2) + max(cntr_txt3) + max(cntr_txt4) + max(cntr_txt5) +
					   max(cntr_txt6) + max(cntr_txt7) + max(cntr_txt8) + max(cntr_txt9) + max(cntr_txt10) +
					   max(cntr_txt11) + max(cntr_txt12) + max(cntr_txt13) + max(cntr_txt14) + max(cntr_txt15) +
					   max(cntr_txt16) + max(cntr_txt17) + max(cntr_txt18) + max(cntr_txt19) + max(cntr_txt20) as cntr_info
				from (
					SELECT
						CASE WHEN A.RNUM = 1 THEN A.cntr_list+CHAR(13) ELSE '' END cntr_txt1,
						CASE WHEN A.RNUM = 2 THEN A.cntr_list+CHAR(13) ELSE '' END cntr_txt2,
						CASE WHEN A.RNUM = 3 THEN A.cntr_list+CHAR(13) ELSE '' END cntr_txt3,
						CASE WHEN A.RNUM = 4 THEN A.cntr_list+CHAR(13) ELSE '' END cntr_txt4,
						CASE WHEN A.RNUM = 5 THEN A.cntr_list+CHAR(13) ELSE '' END cntr_txt5,
						CASE WHEN A.RNUM = 6 THEN A.cntr_list+CHAR(13) ELSE '' END cntr_txt6,
						CASE WHEN A.RNUM = 7 THEN A.cntr_list+CHAR(13) ELSE '' END cntr_txt7,
						CASE WHEN A.RNUM = 8 THEN A.cntr_list+CHAR(13) ELSE '' END cntr_txt8,
						CASE WHEN A.RNUM = 9 THEN A.cntr_list+CHAR(13) ELSE '' END cntr_txt9,
						CASE WHEN A.RNUM = 10 THEN A.cntr_list+CHAR(13) ELSE '' END cntr_txt10,
						CASE WHEN A.RNUM = 11 THEN A.cntr_list+CHAR(13) ELSE '' END cntr_txt11,
						CASE WHEN A.RNUM = 12 THEN A.cntr_list+CHAR(13) ELSE '' END cntr_txt12,
						CASE WHEN A.RNUM = 13 THEN A.cntr_list+CHAR(13) ELSE '' END cntr_txt13,
						CASE WHEN A.RNUM = 14 THEN A.cntr_list+CHAR(13) ELSE '' END cntr_txt14,
						CASE WHEN A.RNUM = 15 THEN A.cntr_list+CHAR(13) ELSE '' END cntr_txt15,
						CASE WHEN A.RNUM = 16 THEN A.cntr_list+CHAR(13) ELSE '' END cntr_txt16,
						CASE WHEN A.RNUM = 17 THEN A.cntr_list+CHAR(13) ELSE '' END cntr_txt17,
						CASE WHEN A.RNUM = 18 THEN A.cntr_list+CHAR(13) ELSE '' END cntr_txt18,
						CASE WHEN A.RNUM = 19 THEN A.cntr_list+CHAR(13) ELSE '' END cntr_txt19,
						CASE WHEN A.RNUM = 20 THEN A.cntr_list+CHAR(13) ELSE '' END cntr_txt20
					FROM
					(
						SELECT ROW_NUMBER() over(order by CNTR_LIST_SEQ) as rnum,
						CNTR_NO + ' / ' + CNTR_TPSZ_CD + ' / ' + SEAL_NO1 as cntr_list
						FROM tb_cntr_list 
						WHERE intg_bl_seq = #s_intg_bl_seq# AND delt_flg = 'N'
					) A WHERE A.rnum > 0 AND A.rnum < 21
					) inval
				) as cntr_info
		  FROM tb_intg_bl a1 
		 WHERE a1.intg_bl_seq = #s_intg_bl_seq#
 	]]>
    </select>   
    
    <!-- Ocean Import > Master BL > USDA Hold Notice   -->
    <select id="selectSEE_BMD_0065" parameterClass="java.util.HashMap" resultClass="java.util.HashMap">
/* BlCmmSQL > selectSEE_BMD_0065 */    
SELECT a1.intg_bl_seq
      ,a1.bl_no mbl_no
      ,a1.ref_no
  FROM tb_intg_bl a1 
 WHERE a1.intg_bl_seq = #s_rlt_intg_bl_seq#
    </select>   
    
    
    <!-- Ocean Import > Master BL > USDA Hold Notice   -->
    <select id="selectSEE_BMD_0065_List" parameterClass="java.util.HashMap" resultClass="java.util.HashMap">
/* BlCmmSQL > selectSEE_BMD_0065_List */   
WITH bl_info AS (
				SELECT
		            hbl.intg_bl_seq,
		            hbl.bl_no,
		            hbl.cust_ref_no,
					cust.trdp_cd AS cust_cd,
		            cust.trdp_nm AS cust_nm,
					brk.trdp_cd AS brk_cd,
		            brk.trdp_nm AS brk_nm
		        FROM
		            tb_intg_bl_rlt rlt        
		        JOIN
		            tb_intg_bl hbl      
		                ON hbl.intg_bl_seq = rlt.intg_bl_seq      
		        LEFT OUTER JOIN
					tb_bl_prnr cust      
						ON hbl.intg_bl_seq = cust.intg_bl_seq 
						AND cust.bl_trdp_tp_cd = 'C01' 
						AND cust.delt_flg = 'N' 
				LEFT OUTER JOIN
		            tb_bl_prnr brk      
		                ON brk.intg_bl_seq = hbl.intg_bl_seq 
		                AND brk.bl_trdp_tp_cd = 'N01' 
		                AND brk.delt_flg = 'N'   
		        WHERE
		            rlt.rlt_intg_bl_seq =  #s_rlt_intg_bl_seq#
		)
		
		SELECT bl.intg_bl_seq, MAX(bl.bl_no) AS bl_no, MAX(bl.cust_ref_no) AS cust_ref_no, 
		       MAX(bl.cust_cd) AS cust_cd, MAX(bl.cust_nm) AS cust_nm,
			   CASE WHEN MAX(cust_pic_eml) != '' THEN 'Y' ELSE 'N' END AS cust_eml_flg,
			   CASE WHEN MAX(cust_pic_eml) != '' THEN MAX(cust_pic_eml) ELSE '' END AS cust_eml,
			   CASE WHEN MAX(cust_pic_fax) != '' THEN 'Y' ELSE 'N' END AS cust_fax_flg,
			   CASE WHEN MAX(cust_pic_fax) != '' THEN MAX(cust_pic_fax) ELSE '' END AS cust_fax,
			   MAX(bl.brk_cd) AS brk_cd, MAX(bl.brk_nm) AS brk_nm, 
			   CASE WHEN MAX(brk_pic_eml) != '' THEN 'Y' ELSE 'N' END AS brk_eml_flg,
			   CASE WHEN MAX(brk_pic_eml) != '' THEN MAX(brk_pic_eml) ELSE '' END AS brk_eml,
			   CASE WHEN MAX(brk_pic_fax) != '' THEN 'Y' ELSE 'N' END AS brk_fax_flg,
			   CASE WHEN MAX(brk_pic_fax) != '' THEN MAX(brk_pic_fax) ELSE '' END AS brk_fax
		FROM
		(
		SELECT bl.intg_bl_seq,
			   cust_eml.pic_eml AS cust_pic_eml,
			   '' AS cust_pic_fax,
			   '' AS brk_pic_eml,
			   '' AS brk_pic_fax,
			   row_number() over(partition by intg_bl_seq order by intg_bl_seq, cust_eml.pic_eml) row_no
		FROM bl_info bl 
		LEFT OUTER JOIN
		    tb_trdp_cntc_pson cust_eml   
		        ON cust_eml.trdp_cd = bl.cust_cd
				AND cust_eml.delt_flg = 'N'
				AND cust_eml.pic_eml_flg = 'Y'
				AND isnull(cust_eml.pic_eml, '') != ''
				AND (
		            isnull(cust_eml.trd_div_cd, '') = ''               
		            or cust_eml.trd_div_cd = substring(#s_rpt_biz_tp#, 1, 2)               
		            or cust_eml.trd_div_cd = substring(#s_rpt_biz_tp#, 1, 1)              
		            or cust_eml.trd_div_cd = substring(#s_rpt_biz_tp#, 2, 1)                    
		        )  
		GROUP BY intg_bl_seq, cust_eml.pic_eml   
		
		UNION ALL
		
		SELECT bl.intg_bl_seq,
			   '' AS cust_pic_eml,
			   cust_fax.pic_fax AS cust_pic_fax,
			   '' AS brk_pic_eml,
			   '' AS brk_pic_fax,
			   row_number() over(partition by intg_bl_seq order by intg_bl_seq, cust_fax.pic_fax) row_no     
		FROM bl_info bl    
		LEFT OUTER JOIN
		    tb_trdp_cntc_pson cust_fax      
		        ON cust_fax.trdp_cd = bl.cust_cd
				AND cust_fax.delt_flg = 'N'
				AND isnull(cust_fax.pic_fax, '') != ''
				AND (
		            isnull(cust_fax.trd_div_cd, '') = ''               
		            or cust_fax.trd_div_cd = substring(#s_rpt_biz_tp#, 1, 2)               
		            or cust_fax.trd_div_cd = substring(#s_rpt_biz_tp#, 1, 1)              
		            or cust_fax.trd_div_cd = substring(#s_rpt_biz_tp#, 2, 1)                    
		        )  
		GROUP BY intg_bl_seq, cust_fax.pic_fax
		
		UNION ALL
		
		SELECT bl.intg_bl_seq,   
			   '' AS cust_pic_eml,
			   '' AS cust_pic_fax,
			   brk_eml.pic_eml AS brk_pic_eml,
			   '' AS brk_pic_fax,
			   row_number() over(partition by intg_bl_seq order by intg_bl_seq, brk_eml.pic_eml) row_no
		FROM bl_info bl 
		LEFT OUTER JOIN
		    tb_trdp_cntc_pson brk_eml   
		        ON brk_eml.trdp_cd = bl.brk_cd
				AND brk_eml.delt_flg = 'N'
				AND brk_eml.pic_eml_flg = 'Y'
				AND isnull(brk_eml.pic_eml, '') != ''
				AND (
		            isnull(brk_eml.trd_div_cd, '') = ''               
		            or brk_eml.trd_div_cd = substring(#s_rpt_biz_tp#, 1, 2)               
		            or brk_eml.trd_div_cd = substring(#s_rpt_biz_tp#, 1, 1)              
		            or brk_eml.trd_div_cd = substring(#s_rpt_biz_tp#, 2, 1)                    
		        )    
		GROUP BY intg_bl_seq, brk_eml.pic_eml
		
		UNION ALL
		
		SELECT bl.intg_bl_seq,     
			   '' AS cust_pic_eml,
			   '' AS cust_pic_fax,
			   '' AS brk_pic_eml,
			   brk_fax.pic_fax AS brk_pic_fax,
			   row_number() over(partition by intg_bl_seq order by intg_bl_seq, brk_fax.pic_fax) row_no     
		FROM bl_info bl    
		LEFT OUTER JOIN
		    tb_trdp_cntc_pson brk_fax      
		        ON brk_fax.trdp_cd = bl.brk_cd
				AND brk_fax.delt_flg = 'N'
				AND isnull(brk_fax.pic_fax, '') != ''
				AND (
		            isnull(brk_fax.trd_div_cd, '') = ''               
		            or brk_fax.trd_div_cd = substring(#s_rpt_biz_tp#, 1, 2)               
		            or brk_fax.trd_div_cd = substring(#s_rpt_biz_tp#, 1, 1)              
		            or brk_fax.trd_div_cd = substring(#s_rpt_biz_tp#, 2, 1)                    
		        )   
		GROUP BY intg_bl_seq, brk_fax.pic_fax 
		) inval
		JOIN bl_info bl ON inval.intg_bl_seq = bl.intg_bl_seq
		GROUP BY bl.intg_bl_seq, row_no
		ORDER BY bl.intg_bl_seq, row_no
    </select>   



	
	
	<!-- LOAD PLAN MBL INFO   -->
    <select id="selectLP_MBL_INFO" parameterClass="HashMap" resultClass="LPBLVO">
    	SELECT bl.LNR_BKG_NO	AS bkg_no
		      ,bl.REF_NO
		      ,agent.TRDP_NM	AS agent_nm
		      ,bl.TRNK_VSL_NM
		      ,bl.TRNK_VOY
		      ,bl.POL_NM
		      ,CONVERT(varchar(8), bl.etd_dt_tm, 120)   AS etd_dt_tm
		      ,CONVERT(varchar(8), bl.eta_dt_tm, 120)   AS eta_dt_tm
		      ,bl.POD_NM
		      ,bl.FNL_DEST_LOC_NM
		      ,bl.BL_NO			AS mbl_no
		      ,bl.INTG_BL_SEQ
		  FROM TB_INTG_BL bl
		LEFT OUTER JOIN TB_BL_PRNR agent
			ON bl.intg_bl_seq = agent.intg_bl_seq  AND agent.bl_trdp_tp_cd = 'C01' AND agent.delt_flg = 'N'  
		 WHERE bl.DELT_FLG = 'N'
		   AND bl.BIZ_CLSS_CD = 'M'
		 <isNotNull property="s_ref_no">
		 	AND bl.REF_NO = #s_ref_no#
		 </isNotNull>
		 <isNotNull property="s_mbl_no">
		 	AND bl.BL_NO = #s_mbl_no#
		 </isNotNull>  
		   
    </select>
    
    
    <!-- LOAD PLAN HBL LIST   -->
    <select id="searchLPHblList" parameterClass="HashMap" resultClass="LPBLVO">
    	SELECT hbl.BL_NO
			  ,hbl.PCK_QTY
			  ,hbl.DOC_RECPT_NO
			  ,hbl.GRS_WGT
			  ,hbl.GRS_WGT1
			  ,hbl.MEAS
			  ,hbl.MEAS1
			  ,hbl.FNL_DEST_LOC_NM
			  ,shp.TRDP_NM			AS shpr_nm
			  ,hbl.intg_bl_seq
		  FROM TB_INTG_BL mbl
		LEFT OUTER JOIN tb_intg_bl_rlt rlt
			ON mbl.intg_bl_seq = rlt.rlt_intg_bl_seq AND rlt.delt_flg = 'N'
		LEFT OUTER JOIN tb_intg_bl hbl
			ON rlt.intg_bl_seq = hbl.intg_bl_seq AND hbl.biz_clss_cd = 'H' AND hbl.delt_flg = 'N'      
		LEFT OUTER JOIN tb_bl_prnr shp
			ON hbl.intg_bl_seq = shp.intg_bl_seq  AND shp.bl_trdp_tp_cd = 'S01' AND shp.delt_flg = 'N'	    
		 WHERE mbl.DELT_FLG = 'N'    
		   AND mbl.BIZ_CLSS_CD = 'M'   
		 <isNotNull property="s_ref_no">
		 	AND mbl.REF_NO = #s_ref_no#
		 </isNotNull>
		 <isNotNull property="s_mbl_no">
		 	AND mbl.BL_NO = #s_mbl_no#
		 </isNotNull>
    </select>
    
    
    
    <!-- LOAD PLAN CONTAINER LIST   -->
    <select id="searchLPCntrList" parameterClass="HashMap" resultClass="HashMap">
    	SELECT cntr_no
		      ,seal_no1
		      ,cntr_tpsz_cd
		      ,cntr_list_seq	
		      ,intg_bl_seq		AS cntr_intg_bl_seq
		  FROM TB_CNTR_LIST
		 WHERE INTG_BL_SEQ = #f_intg_bl_seq#
		   AND DELT_FLG = 'N'
    </select>


     <!-- Devanning/Segregation MBL INFO   -->
     <select id="selectDS_MBL_INFO" parameterClass="HashMap" resultClass="LPBLVO">
          /* BlCmmSQL.xml > selectDS_MBL_INFO */
          SELECT BL.REF_NO,
                 BL.TRNK_VSL_NM,
                 BL.TRNK_VOY,
                 BL.BL_NO AS MBL_NO,
                 BL.INTG_BL_SEQ,
                 BL.CFS_LOC_CD,
                 BL.CFS_LOC_NM,
                 BL.CFS_TRDP_CD,
                 BL.PCK_QTY,
                 BND.RMK_DEV,
                 BL.IT_NO AS MBL_IT_NO,
                 CFS.ENG_NM AS CFS_TRDP_NM,
		         CFS.IATA_CD AS CFS_FIRM_CD,
		         CFS.CITY_NM AS CFS_CITY_NM,
		         CFS.REP_ZIP AS CFS_ZIP_CD,
		         CFS.STATE_CD AS CFS_STATE_CD,
		         CFS.LGL_ADDR AS CFS_LGL_ADDR,
                 BL.CY_TRDP_CD,
                 (SELECT ENG_NM
                    FROM TB_TRDP
                   WHERE TRDP_CD = BL.CY_TRDP_CD) AS CY_TRDP_NM,
		<![CDATA[(SELECT PIC_NM + '<' + PIC_EML + '>'
                    FROM TB_TRDP_CNTC_PSON
                   WHERE TRDP_CD = BL.CFS_TRDP_CD AND REP_FLG = 'Y') AS PIC_EML]]>
            FROM TB_INTG_BL BL
            JOIN TB_ADD_INFO_BND BND
              ON BL.INTG_BL_SEQ = BND.INTG_BL_SEQ
             AND BND.BND_CLSS_CD =  #bnd_clss_cd# /**P*/
             AND BND.DELT_FLG = 'N'
        LEFT OUTER JOIN  TB_TRDP CFS   
           ON   BL.CFS_TRDP_CD = CFS.TRDP_CD  AND CFS.DELT_FLG = 'N'  
           WHERE BL.DELT_FLG = 'N'
             AND BL.BIZ_CLSS_CD = 'M'
             AND BL.AIR_SEA_CLSS_CD = #air_sea_clss_cd#
		<isNotNull property="s_ref_no">
             AND BL.REF_NO = #s_ref_no#
		</isNotNull>
		<isNotNull property="s_mbl_no">
             AND BL.BL_NO = #s_mbl_no#
		</isNotNull>
		<isNotNull property="s_intg_bl_seq">
             AND BL.INTG_BL_SEQ = #s_intg_bl_seq#
		</isNotNull>
     </select>


    <!-- Devanning/Segregation HBL LIST   -->
    <select id="searchDSHblList" parameterClass="HashMap" resultClass="LPBLVO">
    	/* searchDSHblList */
    	select   	  MIN(hbl.bl_no) AS bl_no
    	 			 ,MIN(hbl.rep_cmdt_nm) AS rep_cmdt_nm
					  ,CASE WHEN COUNT(cntr.cntr_no) > 1 THEN SUM(cntr.cgo_pck_qty) ELSE MIN(hbl.pck_qty) END  AS pck_qty 
					  ,CASE WHEN COUNT(cntr.cntr_no) > 1 THEN SUM(cntr.cgo_wgt) ELSE MIN(hbl.grs_wgt) END  AS grs_wgt 
					  ,CASE WHEN COUNT(cntr.cntr_no) > 1 THEN SUM(cntr.cgo_wgt1) ELSE MIN(hbl.grs_wgt1) END  AS grs_wgt1 
					  ,CASE WHEN COUNT(cntr.cntr_no) > 1 THEN SUM(cntr.cgo_meas) ELSE MIN(hbl.meas) END  AS meas 
					  ,CASE WHEN COUNT(cntr.cntr_no) > 1 THEN SUM(cntr.cgo_meas1) ELSE MIN(hbl.meas1) END  AS meas1 
					  ,MIN(hbl.fnl_dest_loc_nm) AS fnl_dest_loc_nm
					  ,MIN(hbl.intg_bl_seq) AS intg_bl_seq
					  ,MIN(hbl.it_no) AS it_no
					  ,MIN(hbl.pol_cd) AS pol_cd
					  ,MIN(pol.ams_loc_val) AS pol_ams_cd
					  ,MIN(pol.iata_loc_cd) AS pol_iata_cd
					  ,MIN(hbl.pol_nm) AS  pol_nm
					  ,MIN(hbl.pol_cd) AS  pod_cd   
					  ,MIN(hbl.pod_nm) AS  pod_nm
					  ,MIN(pod.ams_loc_val) AS pod_ams_cd
					  ,MIN(pod.iata_loc_cd) AS pod_iata_cd
					  ,MIN(lnr.trdp_cd) AS lnr_trdp_cd
					  ,MIN(lnr.trdp_nm) AS lnr_trdp_nm
					  ,MIN(lnr.trdp_cd) AS lnr_scac_cd
					  ,MIN(cne.trdp_cd) AS cnee_trdp_cd
					  ,MIN(cne.trdp_nm) AS cnee_trdp_nm
					  ,MIN(cne.trdp_addr) AS cnee_trdp_addr
					  ,MIN(hbl.ref_no) AS ref_no
					  ,MIN(hbl.trnk_vsl_cd) AS trnk_vsl_cd
					  ,MIN(hbl.trnk_vsl_nm) AS trnk_vsl_nm
					  ,MIN(hbl.trnk_voy) AS  trnk_voy
					  ,MIN(hbl.eta_dt_tm) AS eta_dt_tm
					  ,MIN(hbl.etd_dt_tm) AS etd_dt_tm
					  ,MIN(del.loc_cd) AS fnl_dest_loc_cd   
					  ,MIN(del.loc_nm) AS fnl_dest_loc_nm
					  ,MIN(del.ams_loc_val) AS fdest_ams_loc_cd
					  ,MIN(del.un_loc_cd) AS fdest_un_loc_cd
					  ,MIN(cntr.cntr_no) AS cntr_no
					  ,MIN(cntr.cntr_tpsz_cd) AS cntr_tpsz_cd
					  ,MIN(cntr.seal_no1) AS seal_no1
					  ,MIN(hbl.ams_no) AS ams_no
					  ,MIN(hbl.pck_ut_cd) AS pck_ut_cd
					  ,MIN(hbl.pck_qty) AS pck_qty
					  ,MIN(pcd.pck_nm) AS pck_nm
					  ,MIN(brk.trdp_nm) AS cust_trdp_nm
					  ,MIN(hbl.it_no) AS it_no
					  ,MIN(hbl.te_dt_tm) AS te_dt_tm
					  ,MIN(hbl.it_loc) AS it_loc
					  ,MIN(hbl.mk_txt) AS mk_txt 
					  ,MIN(hbl.desc_txt) AS desc_txt
					  ,MIN(hbl.por_nm) AS por_nm
					  ,MIN(hbl.del_nm) AS del_nm
					  ,MIN(cneX.lgl_addr) AS cnee_lgl_addr
					  ,MIN(cneX.city_nm) AS cnee_city_nm
				      ,MIN(cneX.REP_ZIP ) AS cnee_zip_cd
				      ,MIN(cneX.STATE_CD ) AS cnee_state_cd 
				      ,MIN(shr.trdp_nm) AS shpr_trdp_nm
				      ,MIN(shrX.lgl_addr) AS shpr_lgl_addr
				      ,MIN(shrX.city_nm ) AS shpr_city_nm
				      ,MIN(shrX.REP_ZIP ) AS shpr_zip_cd
				      ,MIN(shrX.STATE_CD ) AS shpr_state_cd
				      ,MIN(ntfy.trdp_nm ) AS ntfy_trdp_nm
				      ,MIN(ntfyX.lgl_addr) AS ntfy_lgl_addr
				      ,MIN(ntfyX.city_nm ) AS ntfy_city_nm 
				      ,MIN(ntfyX.REP_ZIP ) AS ntfy_zip_cd
				      ,MIN(ntfyX.STATE_CD ) AS ntfy_state_cd
				      ,(SELECT TOP 1 CFS.IATA_CD FROM TB_TRDP CFS WHERE CFS.TRDP_CD = HBL.CFS_TRDP_CD   AND CFS.DELT_FLG != 'Y') AS cfs_firm_cd
		  FROM tb_intg_bl_rlt rlt 
		        JOIN tb_intg_bl hbl on hbl.intg_bl_seq = rlt.intg_bl_seq
                LEFT OUTER JOIN tb_loc pol 
		   ON pol.loc_cd = hbl.pol_cd
		    	LEFT OUTER JOIN tb_loc pod 
		   ON pod.loc_cd = hbl.pod_cd
		        LEFT OUTER JOIN tb_loc del 
		   ON del.loc_cd = hbl.fnl_dest_loc_cd	
				LEFT OUTER JOIN tb_bl_prnr lnr
           ON   hbl.intg_bl_seq = lnr.intg_bl_seq  AND lnr.bl_trdp_tp_cd = 'L01' AND lnr.delt_flg = 'N'
				LEFT OUTER JOIN tb_bl_prnr cne
           ON   hbl.intg_bl_seq = cne.intg_bl_seq  AND cne.bl_trdp_tp_cd = 'C01' AND cne.delt_flg = 'N'
          		LEFT OUTER JOIN  tb_trdp cneX   
           ON   cne.trdp_cd = cneX.trdp_cd  
           		LEFT OUTER JOIN  tb_bl_prnr shr            
           ON   hbl.intg_bl_seq = shr.intg_bl_seq  AND shr.bl_trdp_tp_cd = 'S01' AND shr.delt_flg = 'N'     
     			LEFT OUTER JOIN tb_trdp shrX            
           ON   shr.trdp_cd = shrX.trdp_cd  
    			LEFT OUTER JOIN tb_bl_prnr ntfy            
           ON   hbl.intg_bl_seq = ntfy.intg_bl_seq  AND ntfy.bl_trdp_tp_cd = 'N01' AND ntfy.delt_flg = 'N'     
    			LEFT OUTER JOIN tb_trdp ntfyX            
           ON   ntfy.trdp_cd = ntfyX.trdp_cd 
           		LEFT OUTER JOIN tb_bl_prnr brk
           ON   hbl.intg_bl_seq = brk.intg_bl_seq  AND brk.bl_trdp_tp_cd = 'C03' AND brk.delt_flg = 'N'
		        LEFT OUTER JOIN  tb_cntr_list cntr
           ON   hbl.intg_bl_seq = cntr.intg_bl_seq and cntr.DELT_FLG = 'N'
           		LEFT OUTER JOIN tb_pck_ut_cd pcd        
           ON   hbl.pck_ut_cd   = pcd.pck_ut_cd    AND pcd.delt_flg = 'N'
       WHERE  rlt.RLT_INTG_BL_SEQ = (SELECT INTG_BL_SEQ from TB_INTG_BL where intg_bl_seq = #s_intg_bl_seq#)
           AND hbl.delt_flg = 'N'    
		   AND hbl.biz_clss_cd = 'H' 
		<isNotNull property="s_cntr_no">
		   AND cntr.CNTR_NO = #s_cntr_no#
		</isNotNull>
		 GROUP BY 	  hbl.bl_no
    	      				  ,hbl.rep_cmdt_nm
							  ,hbl.pck_qty
							  ,hbl.grs_wgt
							  ,hbl.grs_wgt1
							  ,hbl.meas
							  ,hbl.meas1
							  ,hbl.fnl_dest_loc_nm
							  ,hbl.intg_bl_seq
							  ,hbl.it_no
							  ,hbl.pol_cd
							  ,pol.ams_loc_val 
							  ,pol.iata_loc_cd 
							  ,hbl.pol_nm 
							  ,hbl.pol_cd   
							  ,hbl.pod_nm 
							  ,pod.ams_loc_val 
							  ,pod.iata_loc_cd 
							  ,lnr.trdp_cd 
							  ,lnr.trdp_nm 
							  ,lnr.trdp_cd 
							  ,cne.trdp_cd 
							  ,cne.trdp_nm 
							  ,cne.trdp_addr
							  ,hbl.ref_no
							  ,hbl.trnk_vsl_cd
							  ,hbl.trnk_vsl_nm
							  ,hbl.trnk_voy 
							  ,hbl.eta_dt_tm
							  ,del.loc_cd
							  ,del.loc_nm
							  ,del.ams_loc_val
							  ,hbl.ams_no
							  ,hbl.pck_ut_cd
							  ,hbl.pck_qty
							  ,pcd.pck_nm
							  ,brk.trdp_nm
							  ,hbl.it_no
							  ,hbl.te_dt_tm
							  ,hbl.it_loc
							  ,hbl.mk_txt
							  ,hbl.desc_txt
							  ,hbl.por_nm
							  ,hbl.del_nm
							  ,hbl.cfs_trdp_cd
    </select>


	<select id="sumHblValueSeaExp" parameterClass="HashMap" resultClass="String">
		SELECT CONVERT(VARCHAR, SUM(K.GRS_WGT)) 
	  + '^^' + CONVERT(VARCHAR, SUM(K.MEAS))
	  + '^^' + CONVERT(VARCHAR, SUM(K.PCK))
	  + '^^' + CONVERT(VARCHAR, SUM(K.GRS_WGT1))
	  + '^^' + CONVERT(VARCHAR, SUM(K.MEAS1))
		  FROM (
<!--			SELECT SUM(BL.GRS_WGT) AS GRS_WGT, SUM(BL.MEAS) AS MEAS, SUM(BL.PCK_QTY) AS PCK -->
             SELECT SUM(CONVERT(NUMERIC(14,2),replace(BL.MK_GRS_WGT,',',''))) AS GRS_WGT,
                    <!--  SUM(isnull(BL.MK_MEAS,0)) AS MEAS,
                          SUM(isnull(BL.PCK_QTY,0)) AS PCK
                      -->
                    SUM(CONVERT(NUMERIC(16,6),replace(BL.MK_MEAS,',','')))    AS MEAS,
                    SUM(isnull(BL.PCK_QTY,0)) AS PCK,
                    SUM(CONVERT(NUMERIC(14,2),replace(BL.MK_GRS_WGT1,',',''))) AS GRS_WGT1,
                    SUM(CONVERT(NUMERIC(16,6),replace(BL.MK_MEAS1,',','')))    AS MEAS1
			  FROM TB_INTG_BL BL
			 WHERE BL.INTG_BL_SEQ IN (
					SELECT RLT.INTG_BL_SEQ 
					  FROM TB_INTG_BL_RLT RLT
					  JOIN TB_INTG_BL BL ON RLT.INTG_BL_SEQ = BL.INTG_BL_SEQ AND BL.DELT_FLG = 'N'
					 WHERE RLT_INTG_BL_SEQ = #intg_bl_seq#
					   AND SUB_MBL_FLG != 'Y'
				 )
			   AND BL.DELT_FLG = 'N'
		) K
	</select>
	
	<select id="sumHblValueSeaImp" parameterClass="HashMap" resultClass="String">
		SELECT CONVERT(VARCHAR, SUM(K.GRS_WGT)) 
	  + '^^' + CONVERT(VARCHAR, SUM(K.MEAS))
	  + '^^' + CONVERT(VARCHAR, SUM(K.PCK))
	  + '^^' + CONVERT(VARCHAR, SUM(K.GRS_WGT1))
	  + '^^' + CONVERT(VARCHAR, SUM(K.MEAS1))
		 
		  FROM (
			SELECT SUM(isnull(BL.GRS_WGT,0)) AS GRS_WGT, SUM(isnull(BL.MEAS,0)) AS MEAS, SUM(isnull(BL.PCK_QTY,0)) AS PCK, SUM(isnull(BL.GRS_WGT1,0)) AS GRS_WGT1, SUM(isnull(BL.MEAS1,0)) AS MEAS1
			  FROM TB_INTG_BL BL
			 WHERE BL.INTG_BL_SEQ IN (
					SELECT RLT.INTG_BL_SEQ 
					  FROM TB_INTG_BL_RLT RLT
					  JOIN TB_INTG_BL BL ON RLT.INTG_BL_SEQ = BL.INTG_BL_SEQ AND BL.DELT_FLG = 'N'
					 WHERE RLT_INTG_BL_SEQ = #intg_bl_seq#
					   AND SUB_MBL_FLG != 'Y'
				 )
			   AND BL.DELT_FLG = 'N'
		) K
	</select>
	
	<select id="selectANLISTPK" resultClass="Integer">
		SELECT ISNULL(MAX(AN_SEQ), 0)+1
          FROM TB_AN_LIST 
         WHERE INTG_BL_SEQ = #intg_bl_seq#
	</select>
	
	<insert id="insertANLIST" parameterClass="com.clt.apps.fis.see.bmd.housebl.dto.AnListVO">
		INSERT INTO TB_AN_LIST
		(
			an_seq, intg_bl_seq, frt_cd, frt_cd_nm,
			descr, frt_term_cd, amt,
			rgst_usrid, rgst_ofc_cd, rgst_tms,
			modi_usrid, modi_ofc_cd, modi_tms,
			delt_flg
		) VALUES
		(
			#an_seq#, #intg_bl_seq#, #frt_cd#, #frt_cd_nm#,
			#descr#, #an_frt_term_cd#, #amt#,
			#rgst_usrid#, #rgst_ofc_cd#, GETDATE(),
			#modi_usrid#, #modi_ofc_cd#, GETUTCDATE(),
			#delt_flg#
		)
	</insert>
	
	<update id="updateANLIST" parameterClass="com.clt.apps.fis.see.bmd.housebl.dto.AnListVO">
		UPDATE TB_AN_LIST
		   SET  
			<isNotNull property="frt_cd">
			   frt_cd = #frt_cd#,
			</isNotNull>
			<isNotNull property="frt_cd_nm">
			   frt_cd_nm = #frt_cd_nm#,
			</isNotNull>
			<isNotNull property="descr">
			   descr = #descr#,
			</isNotNull>
			<isNotNull property="an_frt_term_cd">
			   frt_term_cd = #an_frt_term_cd#,
			</isNotNull>
			<isNotNull property="amt">
			   amt = #amt#,
			</isNotNull>
			<isNotNull property="modi_usrid">
			   modi_usrid = #modi_usrid#,
			</isNotNull>
			<isNotNull property="modi_ofc_cd">
			   modi_ofc_cd = #modi_ofc_cd#,
			</isNotNull>		   
			<isNotNull property="delt_flg">
			   delt_flg = #delt_flg#,
			</isNotNull>
			   modi_tms = GETUTCDATE()		   
		 WHERE INTG_BL_SEQ = #intg_bl_seq#
		   AND AN_SEQ = #an_seq#
	</update>
	
	<delete id="deleteANLIST" parameterClass="com.clt.apps.fis.see.bmd.housebl.dto.AnListVO">
		DELETE FROM TB_AN_LIST
		 WHERE INTG_BL_SEQ = #intg_bl_seq#
		   AND AN_SEQ = #an_seq#
	</delete>
	
	<select id="selectANLIST" parameterClass="HashMap" resultClass="com.clt.apps.fis.see.bmd.housebl.dto.AnListVO">
		SELECT an_seq, intg_bl_seq, frt_cd, frt_cd_nm, descr,
			   frt_term_cd AS an_frt_term_cd, amt, delt_flg
		  FROM TB_AN_LIST
		 WHERE INTG_BL_SEQ = #intg_bl_seq#
	</select>
	
	<select id="searchOfcCntCd" parameterClass="HashMap" resultClass="String">
		SELECT cnt_cd
		  FROM tb_ofc
		 WHERE ofc_cd = #f_ref_ofc_cd#
	</select>
	
	<select id="searchINTG_BL_RLT" parameterClass="HashMap" resultClass="com.clt.apps.fis.see.bmd.housebl.dto.BlCommonVO">
		SELECT INTG_BL_SEQ
		  FROM TB_INTG_BL
		 WHERE INTG_BL_SEQ IN (
					SELECT INTG_BL_SEQ
		  			  FROM TB_INTG_BL_RLT
		 			 WHERE RLT_INTG_BL_SEQ = #rlt_intg_bl_seq#)
	  ORDER BY BL_NO
	</select>
	
	<update id="updateBL_SER_NO" parameterClass="HashMap">
		UPDATE TB_INTG_BL
		   SET BL_SER_NO = #bl_ser_no#
		 WHERE INTG_BL_SEQ = #intg_bl_seq#
	</update>
	
	<select id="selectHblDesc_CNT" parameterClass="HashMap" resultClass="Integer">
		SELECT  COUNT(*)
		  FROM  TB_INTG_BL_RLT RLT
		 WHERE  RLT.RLT_INTG_BL_SEQ = (
					SELECT  BL.INTG_BL_SEQ
					  FROM  TB_INTG_BL BL
					  JOIN  TB_ADD_INFO_BND BND
					    ON  BL.INTG_BL_SEQ = BND.INTG_BL_SEQ AND BND.DELT_FLG = 'N'
					 WHERE  1=1
					   AND  BL.REF_NO = #f_ref_no#
					   AND  BL.BIZ_CLSS_CD = #f_biz_clss_cd#
					   AND  BL.AIR_SEA_CLSS_CD = #f_air_sea_clss_cd#
					   AND  BND.BND_CLSS_CD = #f_bnd_clss_cd#
					)
	</select>
	
	<select id="selectHblDesc" parameterClass="HashMap" resultClass="java.util.HashMap">
		SELECT  DESC_TXT1 + CHAR(13) + CHAR(10) + CHAR(13) + CHAR(10) + DESC_TXT AS DESC_TXT,
		        MK_TXT
		  FROM  TB_INTG_BL BL
		 WHERE  BL.INTG_BL_SEQ = (
				SELECT  RLT.INTG_BL_SEQ
				  FROM  TB_INTG_BL_RLT RLT
				 WHERE  RLT.RLT_INTG_BL_SEQ = (
						SELECT  BL.INTG_BL_SEQ
						  FROM  TB_INTG_BL BL
						  JOIN  TB_ADD_INFO_BND BND
						    ON  BL.INTG_BL_SEQ = BND.INTG_BL_SEQ AND BND.DELT_FLG = 'N'
						 WHERE  1=1
						   AND  BL.REF_NO = #f_ref_no#
						   AND  BL.BIZ_CLSS_CD = #f_biz_clss_cd#
						   AND  BL.AIR_SEA_CLSS_CD = #f_air_sea_clss_cd#
						   AND  BND.BND_CLSS_CD = #f_bnd_clss_cd#
						)
				)
	</select>
	
	<update id="updateClose_MBL_EXP_INFO" parameterClass="com.clt.apps.fis.see.bmd.masterbl.dto.SeeMasterBLVO">
		UPDATE  TB_INTG_BL
		   SET  MK_TXT = #mk_txt#, 
				DESC_TXT = #desc_txt#,
				SAD_TXT = #sad_txt#,
				RMK = #rmk#,
				TRNK_VSL_CD = #trnk_vsl_cd#,
				TRNK_VOY = #trnk_voy#
		 WHERE  INTG_BL_SEQ = #intg_bl_seq#
	</update>
	
	<update id="updateClose_MBL_IMP_INFO" parameterClass="com.clt.apps.fis.see.bmd.masterbl.dto.SeeMasterBLVO">
		UPDATE  TB_INTG_BL
		   SET  POD_CD = #pod_cd#,
		   		POD_NM = #pod_nm#,
		   		ETA_DT_TM = #eta_dt_tm#,
				CY_TRDP_CD = #cy_trdp_cd#,
				CFS_TRDP_CD = #cfs_trdp_cd#,
				IT_NO = #it_no#,
				TE_DT_TM = #te_dt_tm#,
				IT_LOC = #it_loc#
		 WHERE  INTG_BL_SEQ = #intg_bl_seq#
	</update>
	
	<update id="updateClose_HBL_EXP_INFO" parameterClass="com.clt.apps.fis.see.bmd.housebl.dto.SeeHouseBLVO">
		UPDATE  TB_INTG_BL
		   SET  POL_CD = #pol_cd#,
		   		POL_NM = #pol_nm#,
		   		POD_CD = #pod_cd#,
		   		POD_NM = #pod_nm#,
		   		DEL_CD = #del_cd#,
		   		DEL_NM = #del_nm#,
		   		SAD_TXT = #sad_txt#,
				MK_GRS_WGT = #mk_grs_wgt#,
				MK_GRS_WGT1 = #mk_grs_wgt1#,
				MK_MEAS = #mk_meas#,
				MK_MEAS1 = #mk_meas1#,
				MK_TXT = #mk_txt#,
				DESC_TXT1 = #desc_txt1#,
				DESC_TXT = #desc_txt#,
				CLEAN_ON_BOARD = #clean_on_board#,
				ATT_MK_TXT = #att_mk_txt#,
				ATT_DESC_TXT = #att_desc_txt#,
				SAY_TXT = #say_txt#,
				RMK = #rmk#
		 WHERE  INTG_BL_SEQ = #intg_bl_seq#
	</update>
	
	<update id="updateClose_HBL_IMP_INFO" parameterClass="com.clt.apps.fis.see.bmd.housebl.dto.SeeHouseBLVO">
		UPDATE  TB_INTG_BL
		   SET  FM_SVC_TERM_CD = #fm_svc_term_cd#,
				TO_SVC_TERM_CD = #to_svc_term_cd#,
				CFS_NOD_CD = #cfs_nod_cd#,
				GO_DT_TM = #go_dt_tm#,
				LFD_DT_TM = #lfd_dt_tm#,
				AVAIL_DT_TM = #avail_dt_tm#,
				F_ETA_DT_TM = #f_eta_dt_tm#,
				D_ETA_DT_TM = #d_eta_dt_tm#,
				CFS_TRDP_CD = #cfs_trdp_cd#,
				DOOR_LOC_CD = #door_loc_cd#,
				FNL_DEST_LOC_CD = #fnl_dest_loc_cd#,
				TE_DT_TM = #te_dt_tm#,
				IT_NO = #it_no#,
				IT_LOC = #it_loc#,
		   		SAD_TXT = #sad_txt#,
				MK_TXT = #mk_txt#,
				DESC_TXT = #desc_txt#,
				RMK = #rmk#,
				SAY_TXT = #say_txt#,
				DESC_TXT1 = #desc_txt1#,
				ORG_BL_RCVD_FLG = #org_bl_rcvd_flg#,
				RCVD_DT_TM = #rcvd_dt_tm#,
				RLSD_FLG = #rlsd_flg#,
				RLSD_DT_TM = #rlsd_dt_tm#
		 WHERE  INTG_BL_SEQ = #intg_bl_seq#
	</update>
	
	<select id="selectClose_TRDP_CD_LIST" parameterClass="HashMap" resultClass="BlCmmVO">
        SELECT  shp.trdp_cd AS shpr_trdp_cd,
                cne.trdp_cd AS cnee_trdp_cd,
                ntf.trdp_cd AS ntfy_trdp_cd
        
         FROM   tb_intg_bl bl
        
         JOIN   tb_add_info_bnd bnd
           ON   bl.intg_bl_seq = bnd.intg_bl_seq AND bnd.bnd_clss_cd = #bnd_clss_cd#   AND bnd.delt_flg = 'N'
        
LEFT OUTER JOIN tb_bl_prnr shp
           ON   bl.intg_bl_seq = shp.intg_bl_seq  AND shp.bl_trdp_tp_cd = 'S01' AND shp.delt_flg = 'N'
         
LEFT OUTER JOIN tb_bl_prnr cne
           ON   bl.intg_bl_seq = cne.intg_bl_seq  AND cne.bl_trdp_tp_cd = 'C01' AND cne.delt_flg = 'N'

LEFT OUTER JOIN tb_bl_prnr ntf
           ON   bl.intg_bl_seq = ntf.intg_bl_seq  AND ntf.bl_trdp_tp_cd = 'N01' AND ntf.delt_flg = 'N'


        WHERE bl.delt_flg = 'N' AND bl.intg_bl_seq = #intg_bl_seq#
    </select>
    
    <update id="updateMBL_STS_CD" parameterClass="com.clt.apps.fis.see.bmd.masterbl.dto.SeeMasterBLVO">
		UPDATE  TB_INTG_BL
		   SET  BL_STS_CD = #bl_sts_cd#
		 WHERE  INTG_BL_SEQ = #intg_bl_seq#
	</update>
	
	<update id="updateHBL_STS_CD" parameterClass="HashMap">
		UPDATE  TB_INTG_BL
		   SET  BL_STS_CD = #bl_sts_cd#
		 WHERE  INTG_BL_SEQ = #intg_bl_seq#
	</update>
	
	<select id="selectMBL_INV_SLIP_DT" parameterClass="com.clt.apps.fis.see.bmd.masterbl.dto.SeeMasterBLVO" resultClass="String">
		SELECT  MAX(ISNULL(MST.ACCT_DT, '19990101')) AS slip_date
		  FROM (
				SELECT  FRT.INTG_BL_SEQ, FRT.INV_SEQ
				  FROM  TB_FRT FRT
				 WHERE  FRT.INTG_BL_SEQ = #intg_bl_seq#
				   AND  FRT.INV_SEQ <![CDATA[<>]]> ''
			  GROUP BY  FRT.INTG_BL_SEQ, FRT.INV_SEQ
				) FRT LEFT OUTER JOIN TB_SLIP_MST MST ON FRT.INV_SEQ = MST.REF_NO
	  GROUP BY  FRT.INTG_BL_SEQ
	</select>
	
	<select id="selectHBL_INV_SLIP_DT" parameterClass="com.clt.apps.fis.see.bmd.masterbl.dto.SeeMasterBLVO" resultClass="HashMap">
		SELECT  FRT.INTG_BL_SEQ AS intg_bl_seq, MAX(ISNULL(MST.ACCT_DT, '19990101')) AS slip_date
		  FROM  (
				SELECT  FRT.INTG_BL_SEQ, FRT.INV_SEQ
				  FROM  TB_FRT FRT
				  JOIN  (
						SELECT  RLT.INTG_BL_SEQ
						  FROM  TB_INTG_BL_RLT RLT 
						  JOIN  TB_INTG_BL BL ON RLT.INTG_BL_SEQ = BL.INTG_BL_SEQ
						 WHERE  RLT.RLT_INTG_BL_SEQ = #intg_bl_seq#
						) BL ON FRT.INTG_BL_SEQ = BL.INTG_BL_SEQ
				 WHERE  FRT.INV_SEQ <![CDATA[<>]]> ''
			  GROUP BY  FRT.INTG_BL_SEQ, FRT.INV_SEQ
				) FRT LEFT OUTER JOIN TB_SLIP_MST MST ON FRT.INV_SEQ = MST.REF_NO
	  GROUP BY  FRT.INTG_BL_SEQ
	</select>
	
	<!-- Job Templete 저장   -->
	<insert id="insertJobTmplt" parameterClass="com.clt.apps.fis.see.bmd.housebl.dto.WrkFlowVO">
		INSERT INTO tb_jb_tmplt_list(
			 JB_TMPLT_SEQ
			,BL_STS_CD
			,DUR_TM_QTY
			,SRT_SEQ
			,RGST_USRID
			,RGST_OFC_CD
			,RGST_TMS
			,MODI_USRID
			,MODI_OFC_CD
			,MODI_TMS
			,DELT_FLG
			,BL_STS_LBL
		)VALUES(
			 #jb_tmplt_seq#
			,#bl_sts_cd#
			,#dur_tm_qty#
			,#srt_seq#
			,#proc_usrid#
			,#proc_ofccd#
			,getdate()
			,#proc_usrid#
			,#proc_ofccd#
			,getutcdate()
			,'N'
			,(SELECT top 1 CD_NM FROM tb_com_cd_dtl WHERE com_cd = #com_cd# AND cd_val = #bl_sts_cd#)
		)
	</insert>
	
	
	<!-- Job Templete 저장   -->
	<update id="updateJobTmplt" parameterClass="com.clt.apps.fis.see.bmd.housebl.dto.WrkFlowVO">
		UPDATE tb_jb_tmplt_list
		   SET DELT_FLG = 'N'
		 WHERE JB_TMPLT_SEQ = #jb_tmplt_seq#
		   AND BL_STS_CD    = #bl_sts_cd#
	</update>
	
	<!-- WorkFlow 저장   -->
	<insert id="insertWrkFlow" parameterClass="com.clt.apps.fis.see.bmd.housebl.dto.WrkFlowVO">
		<!-- MSSQL 2008 Ver
		INSERT INTO tb_wrk_flow(
			 INTG_BL_SEQ
			,JB_STS_CD
			<isNotEmpty property="jb_pln_dt_tm">
				,JB_PLN_DT_TM
			</isNotEmpty>
			<isNotEmpty property="jb_act_dt_tm">
				,JB_ACT_DT_TM
			</isNotEmpty>
			,SRT_SEQ
			,RGST_USRID
			,RGST_OFC_CD
			,RGST_TMS
			,MODI_USRID
			,MODI_OFC_CD
			,MODI_TMS
			,DELT_FLG
		)VALUES(
			 #intg_bl_seq#
			,#jb_sts_nm#
			<isNotEmpty property="jb_pln_dt_tm">
				,CONVERT(DATETIME, #jb_pln_dt_tm#, 120)
			</isNotEmpty>
			<isNotEmpty property="jb_act_dt_tm">
				,CONVERT(DATETIME, #jb_act_dt_tm#, 120)
			</isNotEmpty>
			
			,(SELECT ISNULL(MAX(SRT_SEQ),0) + 1 FROM tb_wrk_flow WHERE INTG_BL_SEQ = #intg_bl_seq# AND DELT_FLG = 'N')
			,#proc_usrid#
			,#proc_ofccd#
			,getdate()
			,#proc_usrid#
			,#proc_ofccd#
			,getdate()
			,'N'
		)
		-->    	
    	<!-- 2013.06.05 LHK, MSSQL 2005 version 으로 Query 수정 (Insert into () values()구문에 하위 쿼리 사용할 수 없슴) -->
		INSERT INTO tb_wrk_flow(
			 INTG_BL_SEQ
			,JB_STS_CD
			<isNotEmpty property="jb_pln_dt_tm">
				,JB_PLN_DT_TM
			</isNotEmpty>
			<isNotEmpty property="jb_act_dt_tm">
				,JB_ACT_DT_TM
			</isNotEmpty>
			,SRT_SEQ
			,RGST_USRID
			,RGST_OFC_CD
			,RGST_TMS
			,MODI_USRID
			,MODI_OFC_CD
			,MODI_TMS
			,DELT_FLG
		) SELECT
			 #intg_bl_seq#
			,#jb_sts_nm#
			<isNotEmpty property="jb_pln_dt_tm">
				,CONVERT(DATETIME, #jb_pln_dt_tm#, 120)
			</isNotEmpty>
			<isNotEmpty property="jb_act_dt_tm">
				,CONVERT(DATETIME, #jb_act_dt_tm#, 120)
			</isNotEmpty>
			
			,(SELECT ISNULL(MAX(SRT_SEQ),0) + 1 FROM tb_wrk_flow WHERE INTG_BL_SEQ = #intg_bl_seq# AND DELT_FLG = 'N')
			,#proc_usrid#
			,#proc_ofccd#
			,getdate()
			,#proc_usrid#
			,#proc_ofccd#
			,getutcdate()
			,'N'
		
	</insert>
	
	<update id="updateWrkFlow" parameterClass="com.clt.apps.fis.see.bmd.housebl.dto.WrkFlowVO">
		UPDATE tb_wrk_flow
		   SET   MODI_USRID	  = #proc_usrid#
				,MODI_OFC_CD  = #proc_ofccd#
				,MODI_TMS	  = GETUTCDATE()
		   	   <isNotEmpty property="jb_pln_dt_tm">
				,JB_PLN_DT_TM = CONVERT(DATETIME, #jb_pln_dt_tm#, 120)
			   </isNotEmpty>
			   <isEmpty property="jb_pln_dt_tm">
			    ,JB_PLN_DT_TM = NULL
			   </isEmpty>
			   <isNotEmpty property="jb_act_dt_tm">
				,JB_ACT_DT_TM = CONVERT(DATETIME, #jb_act_dt_tm#, 120)
			   </isNotEmpty>
			   <isEmpty property="jb_act_dt_tm">
			    ,JB_ACT_DT_TM = NULL
			   </isEmpty>
	     WHERE INTG_BL_SEQ = #intg_bl_seq#
	       AND JB_STS_CD   = #jb_sts_nm#
	</update>
	
	<update id="updateItNextNumber" parameterClass="HashMap">
        UPDATE  TB_OFC
           SET  IT_NEXT_NO = #it_next_no#
         WHERE  OFC_CD = #ofc_cd#
    </update>
	
	<select id="selectItNextNumber" parameterClass="HashMap" resultClass="String">
	     SELECT 
		     IT_NEXT_NO
		 FROM TB_OFC
	     WHERE OFC_CD = #ofc_cd#
	</select>
	
	<select id="selectItEndNumber" parameterClass="HashMap" resultClass="String">
	     SELECT 
		    IT_END
		 FROM TB_OFC
	     WHERE OFC_CD = #ofc_cd#
	</select>

	<update id="updateSeaCCN" parameterClass="HashMap">
        UPDATE  TB_OFC
           SET  OI_CCN_SEQNO = #ccn_no#
         WHERE  OFC_CD = #ofc_cd#
    </update>
	
	<select id="selectSeaCCN" parameterClass="HashMap" resultClass="HashMap">
	     SELECT 
		     OI_CCN_SEQNO AS CCN_NO
		     ,CCN_PRFX
		 FROM TB_OFC
	     WHERE OFC_CD = #ofc_cd#
	</select>
		
	<update id="updateAirCCN" parameterClass="HashMap">
        UPDATE  TB_OFC
           SET  AI_CCN_SEQNO = #ccn_no#
         WHERE  OFC_CD = #ofc_cd#
    </update>
	
	<select id="selectAirCCN" parameterClass="HashMap" resultClass="HashMap">
	     SELECT 
		     AI_CCN_SEQNO AS CCN_NO
		     ,CCN_PRFX
		 FROM TB_OFC
	     WHERE OFC_CD = #ofc_cd#
	</select>
	
	<select id="checkDuplCcn" parameterClass="HashMap" resultClass="Integer">
	/* BlCmmSQL.xml > checkDuplCcn */
		SELECT count(CCN_NO)
		FROM  tb_intg_bl
		WHERE intg_bl_seq != #bl_seq#               
		AND  CCN_NO = #ccn_no#   
		AND  BIZ_CLSS_CD = 'H'
		AND  DELT_FLG != 'Y'
	</select>
		
	<update id="updateHouseCCN" parameterClass="HashMap" >
	/* BlCmmSQL.xml > updateHouseCCN */
		UPDATE tb_intg_bl SET  ccn_no = #pre_ccn_no#
		WHERE intg_bl_seq in (SELECT intg_bl_seq 
		  FROM tb_intg_bl_rlt 
		 WHERE rlt_intg_bl_seq = #intg_bl_seq#)
		 AND  BIZ_CLSS_CD = 'H'
		 AND CCN_NO = PRE_CCN_NO
		 AND  DELT_FLG != 'Y'
	</update>
	
	<update id="updateHousePreCCN" parameterClass="HashMap" >
	/* BlCmmSQL.xml > updateHousePreCCN */
		UPDATE tb_intg_bl SET  pre_ccn_no = #pre_ccn_no#
		WHERE intg_bl_seq in (SELECT intg_bl_seq 
		  FROM tb_intg_bl_rlt 
		 WHERE rlt_intg_bl_seq = #intg_bl_seq#)
		 AND  BIZ_CLSS_CD = 'H'
		 AND  DELT_FLG != 'Y'
	</update>
	
	<select id="searchHouseBlSeq" parameterClass="HashMap" resultClass="HashMap">
		SELECT bl.intg_bl_seq as HBL_SEQ
		FROM  tb_intg_bl_rlt rlt            
		JOIN  tb_intg_bl bl ON  rlt.intg_bl_seq = bl.intg_bl_seq 
		WHERE  rlt.rlt_intg_bl_seq = #mbl_seq#               
		AND  rlt.delt_flg = 'N'     
	</select>
	
    <!-- BL Dock Receipt search   -->
    <select id="selectBlDockReceipt" parameterClass="HashMap" resultClass="PLCIBLInfoVO">
   		/* BlCmmSQL.xml > selectBlDockReceipt */
		SELECT BL.INTG_BL_SEQ
		      ,BL.REF_NO
		      ,BL.BL_NO  BL_NO
		      ,BL.LNR_BKG_NO BKG_NO
		      ,'' WRK_TP
		      ,'' CNT_ORIGIN
			  ,SHPR.TRDP_ADDR   AS SELLER_ADDR     
			  ,CNEE.TRDP_ADDR   AS CNEE_ADDR     
			  ,NTY.TRDP_ADDR    AS NOTIFY_ADDR     
			  ,(SELECT X.CNT_ENG_NM 
		         FROM TB_CNT X 
		        WHERE X.CNT_CD = BL.CNT_CD 
		          AND X.DELT_FLG = 'N') AS CNT_ORIGIN     
		      ,BL.EXP_REF_NO      AS EXP_REF_NO     
		      ,CASE WHEN BL.AIR_SEA_CLSS_CD = 'A' THEN BL.FLT_NO              
		            WHEN BL.AIR_SEA_CLSS_CD = 'S' AND ISNULL(BL.TRNK_VSL_NM,'') = '' AND ISNULL(TRNK_VOY,'') = '' THEN ''            
		            ELSE BL.TRNK_VSL_NM+ '/' + TRNK_VOY       
		        END AS VSL_FLT     
		      ,BL.POL_NM     
		      ,BL.POD_NM     
		      ,(SELECT ENG_NM FROM TB_TRDP WHERE TRDP_CD = BL.RCV_WH_CD) POR_NM     
			  ,BL.MK_TXT     
			  ,CONVERT(VARCHAR,BL.PCK_QTY) + ' ' + PCD.PCK_NM AS QTY     
			  ,BL.DESC_TXT     
			  ,CONVERT(VARCHAR,BL.GRS_WGT) + ' KGS' + CHAR(13)+CHAR(10) + CONVERT(VARCHAR,BL.GRS_WGT1)+ ' LBS' + CHAR(13)+CHAR(10) AS GRS_WGT     
			  ,CONVERT(VARCHAR,BL.CHG_WGT) + ' KGS' + CHAR(13)+CHAR(10) + CONVERT(VARCHAR,BL.CHG_WGT1)+ ' LBS' + CHAR(13)+CHAR(10) AS CHG_WGT     
			  ,CASE WHEN BL.AIR_SEA_CLSS_CD = 'A' THEN  CONVERT(VARCHAR,BL.VOL_MEAS) + ' CBM'
		            ELSE CONVERT(VARCHAR, BL.MEAS) + ' CBM' + CHAR(13)+CHAR(10) + CONVERT(VARCHAR,BL.MEAS1)+ ' CFT' + CHAR(13)+CHAR(10)        
		        END AS MEAS     
		      ,LNR.TRDP_CD AS CARR_TRDP_CD        
		      ,LNR.TRDP_NM AS CARR_TRDP_NM     
		  FROM TB_INTG_BL BL     
		  LEFT OUTER JOIN TB_BL_PRNR SHPR          
		    ON BL.INTG_BL_SEQ = SHPR.INTG_BL_SEQ            
		   AND SHPR.BL_TRDP_TP_CD = 'S01'           
		   AND SHPR.DELT_FLG = 'N'       
		  LEFT OUTER JOIN TB_BL_PRNR CNEE          
		    ON BL.INTG_BL_SEQ = CNEE.INTG_BL_SEQ            
		   AND CNEE.BL_TRDP_TP_CD = 'C01'           
		   AND CNEE.DELT_FLG = 'N'      
		  LEFT OUTER JOIN TB_BL_PRNR NTY          
		    ON  BL.INTG_BL_SEQ = NTY.INTG_BL_SEQ            
		   AND NTY.BL_TRDP_TP_CD = 'N01'           
		   AND NTY.DELT_FLG = 'N'
		  LEFT OUTER JOIN TB_PCK_UT_CD PCD                        
		    ON BL.PCK_UT_CD = PCD.PCK_UT_CD                 
		   AND PCD.USE_FLG = 'Y'           
		  LEFT OUTER JOIN TB_BL_PRNR LNR           
		    ON BL.INTG_BL_SEQ = LNR.INTG_BL_SEQ            
		   AND LNR.BL_TRDP_TP_CD = 'L01'             
		   AND LNR.DELT_FLG = 'N'
		 WHERE 1=1
		   AND BL.DELT_FLG = 'N'
		   AND BL.INTG_BL_SEQ = #intg_bl_seq#
	</select>
	    <!-- BL Dock Receipt search   -->
    <select id="selectDockReceipt" parameterClass="HashMap" resultClass="PLCIBLInfoVO">
   		/* BlCmmSQL.xml > selectDockReceipt */
		  SELECT INTG_BL_SEQ
				,WRK_TP
				,SELLER_ADDR
				,CNEE_ADDR
				,NOTIFY_ADDR
				,VSL_FLT
				,CNT_ORIGIN
				,BL_NO AS BKG_NO
				,CARR_TRDP_NM
				,POR_NM
				,POL_NM
				,POD_NM
				,INLAND_TRDP_CD
				,INLAND_TRDP_NM
				,INLAND_PIC_NM
				,INLAND_PIC_PHN
				,INLAND_PIC_FAX
				,MK_TXT
				,DESC_TXT
				,QTY
				,GRS_WGT
				,MEAS
		   FROM TB_BL_OTH OTH
		  WHERE OTH.WRK_TP = 'DR'
		    AND OTH.INTG_BL_SEQ = #intg_bl_seq#
 	</select>
 	
	    <!--DOCK RECEIPT 등록   -->
    <insert id="insertDockReceipt" parameterClass="HashMap">
    	/* BlCmmSQL.xml > insertDockReceipt */
    	INSERT INTO TB_BL_OTH(  INTG_BL_SEQ
					           ,WRK_TP
					           ,SELLER_ADDR
					           ,CNEE_ADDR
					           ,NOTIFY_ADDR
					           ,VSL_FLT
					           ,CNT_ORIGIN
					           ,BL_NO
					           ,CARR_TRDP_NM
					           ,POR_NM
					           ,POL_NM
					           ,POD_NM
					           ,INLAND_TRDP_CD
							   ,INLAND_TRDP_NM
							   ,INLAND_PIC_NM
							   ,INLAND_PIC_PHN
							   ,INLAND_PIC_FAX
					           ,MK_TXT
					           ,DESC_TXT
					           ,QTY
					           ,GRS_WGT
					           ,MEAS
					           ,RGST_USRID
					           ,RGST_OFC_CD
					           ,RGST_TMS
					           ,MODI_USRID
					           ,MODI_OFC_CD
					           ,MODI_TMS
					    	)VALUES(
					    		#f_intg_bl_seq#
					           ,'DR'
					           ,#f_seller#
					           ,#f_consignee#
					           ,#f_notify#
					           ,#f_vslflt#
					           ,#f_cnt_origin#
					           ,#f_bkg_no#
					           ,#f_carr_trdp_nm#
					           ,#f_por_nm#
					           ,#f_pol_nm#
					           ,#f_pod_nm#
					           ,#f_inland_trdp_cd#	
							   ,#f_inland_trdp_nm# 	
							   ,#f_inland_pic_nm# 		
							   ,#f_inland_pic_phn#		
							   ,#f_inland_pic_fax#
					           ,#f_mark_num#
					           ,#f_desc_good#
					           ,#f_qty#
					           ,#f_grs_wgt#
					           ,#f_meas#
					           ,#proc_usrid#
					           ,#proc_ofccd#
					           ,getdate()
					           ,#proc_usrid#
					           ,#proc_ofccd#
					           ,GETUTCDATE()
    		)
    </insert>
    
    <!--DOCK RECEIPT 수정   -->
    <update id="updateDockReceipt" parameterClass="HashMap">
    	/* BlCmmSQL.xml > updateDockReceipt */
    	UPDATE TB_BL_OTH
    	   SET SELLER_ADDR		= #f_seller#
			  ,CNEE_ADDR      	= #f_consignee#
			  ,NOTIFY_ADDR    	= #f_notify#
			  ,VSL_FLT        	= #f_vslflt#
			  ,CNT_ORIGIN       = #f_cnt_origin#
			  ,BL_NO          	= #f_bkg_no#
			  ,CARR_TRDP_NM   	= #f_carr_trdp_nm#
			  ,POR_NM         	= #f_por_nm#
			  ,POL_NM         	= #f_pol_nm#
			  ,POD_NM         	= #f_pod_nm#
			  ,INLAND_TRDP_CD 	= #f_inland_trdp_cd#
			  ,INLAND_TRDP_NM   = #f_inland_trdp_nm#
			  ,INLAND_PIC_NM    = #f_inland_pic_nm#
			  ,INLAND_PIC_PHN   = #f_inland_pic_phn#
			  ,INLAND_PIC_FAX   = #f_inland_pic_fax#
			  ,MK_TXT         	= #f_mark_num#
			  ,DESC_TXT       	= #f_desc_good#
			  ,QTY            	= #f_qty#
			  ,GRS_WGT        	= #f_grs_wgt#
			  ,MEAS           	= #f_meas#
			  ,MODI_USRID     	= #proc_usrid#
			  ,MODI_OFC_CD    	= #proc_ofccd#
			  ,MODI_TMS       	= GETUTCDATE()
	     WHERE INTG_BL_SEQ  	= #f_intg_bl_seq#
	       AND WRK_TP 		    = 'DR'
    </update>
    
    <!-- 20130330 OJG   -->
    <select id="selectMblItNo" parameterClass="HashMap" resultClass="HashMap">
		SELECT IT_NO ,TE_DT_TM,IT_LOC
		FROM TB_INTG_BL WHERE REF_NO = #ref_no# AND BIZ_CLSS_CD = 'M'
	</select>
	<!-- 20130330 OJG   -->
	
	<!-- MBL 의 Carrier Bkg. No.를 HBL 에 UPDATE 해준다. -->
    <update id="updateHblListLnrBkgNo" parameterClass="HashMap">
		UPDATE TB_INTG_BL
		SET    LNR_BKG_NO = #lnr_bkg_no#
		WHERE  INTG_BL_SEQ IN (SELECT INTG_BL_SEQ FROM TB_INTG_BL_RLT WHERE RLT_INTG_BL_SEQ = #intg_bl_seq#)
	</update>
	
	<!-- HBL Sync 업데이트  -->
	<select id="selectHBL_SEQ_LIST" parameterClass="String" resultClass="HashMap">
        SELECT  intg_bl_seq
               ,pol_cd
               ,pol_nm  
               ,pod_cd
               ,pod_nm                                                  
          FROM  tb_intg_bl
         WHERE  intg_bl_seq in (SELECT intg_bl_seq 
	                              FROM tb_intg_bl_rlt 
	                             WHERE rlt_intg_bl_seq = #intg_bl_seq#)
    </select>
	
	<insert id="insertMBL_PRNR_COPY" parameterClass="HashMap">
        INSERT INTO tb_bl_prnr(                                                      
              intg_bl_seq,          bl_trdp_tp_cd,    
              trdp_cd,              trdp_addr,          trdp_nm,
              
              trdp_pic_usr_id,      trdp_pic,           trdp_phn,      trdp_fax,     trdp_eml,
              
              rgst_usrid,           rgst_ofc_cd,        rgst_tms,        
              modi_usrid,           modi_ofc_cd,        modi_tms,      delt_flg
                                                               
        )SELECT   #intg_bl_seq#,    bl_trdp_tp_cd,
                  trdp_cd,          trdp_addr,          trdp_nm,
                  trdp_pic_usr_id,  trdp_pic,           trdp_phn,      trdp_fax,     trdp_eml,
                  #proc_usrid#,     #proc_ofccd#,       getdate(),
                  #proc_usrid#,     #proc_ofccd#,       GETUTCDATE(),     delt_flg

           FROM  tb_bl_prnr
          WHERE  intg_bl_seq = #org_intg_bl_seq# 
            AND  bl_trdp_tp_cd = #bl_trdp_tp_cd# 
            AND  delt_flg = 'N'
    </insert>
    
    <insert id="insertMBL_PRNR_CHANGE_COPY" parameterClass="HashMap">
        INSERT INTO tb_bl_prnr(                                                      
              intg_bl_seq,          bl_trdp_tp_cd,    
              trdp_cd,              trdp_addr,          trdp_nm,
              
              trdp_pic_usr_id,      trdp_pic,           trdp_phn,      trdp_fax,     trdp_eml,
              
              rgst_usrid,           rgst_ofc_cd,        rgst_tms,        
              modi_usrid,           modi_ofc_cd,        modi_tms,      delt_flg
                                                               
        )SELECT   #intg_bl_seq#,    #bl_trdp_tp_cd#,
                  trdp_cd,          trdp_addr,          trdp_nm,
                  trdp_pic_usr_id,  trdp_pic,           trdp_phn,      trdp_fax,     trdp_eml,
                  #proc_usrid#,     #proc_ofccd#,       getdate(),
                  #proc_usrid#,     #proc_ofccd#,       GETUTCDATE(),     delt_flg

           FROM  tb_bl_prnr
          WHERE  intg_bl_seq = #mbl_intg_bl_seq# 
            AND  bl_trdp_tp_cd = #mbl_bl_trdp_tp_cd# 
            AND  delt_flg = 'N'
    </insert>
	
    <update id="updateHBL_OE_SYNC" parameterClass="HBLInfoVO">
    	/* updateHBL_OE_SYNC */
        UPDATE  tb_intg_bl
           SET  trnk_vsl_cd = #trnk_vsl_cd#,   			trnk_vsl_nm = #trnk_vsl_nm#,  			trnk_voy 	= #trnk_voy#,
		        etd_dt_tm  	= #etd_dt_tm#,     			eta_dt_tm   = #eta_dt_tm#,	    		
		        <isEqual property="shp_mod_sync_flg" compareValue="Y">
				   shp_mod_cd = #shp_mod_cd#,
				</isEqual>
				<isEqual property="svc_term_sync_flg" compareValue="Y">
				   fm_svc_term_cd = #fm_svc_term_cd#,
				   to_svc_term_cd = #to_svc_term_cd#,
				</isEqual>
				doc_recpt_no = CASE WHEN ISNULL(doc_recpt_no,'') = '' AND ISNULL((SELECT OPT_VAL FROM TB_SYS_OPT WHERE OPT_KEY = 'HBL_DOCNO_SYNC'),'F') = 'M' THEN #mbl_no# ELSE doc_recpt_no END,
				modi_tms  = GETUTCDATE()		
         WHERE  intg_bl_seq in (SELECT intg_bl_seq 
	                              FROM tb_intg_bl_rlt 
	                             WHERE rlt_intg_bl_seq = #intg_bl_seq#)
    </update>
    
    <update id="updateHBL_OI_SYNC" parameterClass="HBLInfoVO">
    	/* updateHBL_OI_SYNC */
        UPDATE  tb_intg_bl
           SET  trnk_vsl_cd = #trnk_vsl_cd#,   		trnk_vsl_nm = #trnk_vsl_nm#,  			trnk_voy 	= #trnk_voy#,
		        etd_dt_tm  	= #etd_dt_tm#,     		eta_dt_tm   = #eta_dt_tm#,	  			d_eta_dt_tm = #d_eta_dt_tm#,	
		        <isEqual property="shp_mod_sync_flg" compareValue="Y">
				   shp_mod_cd = #shp_mod_cd#,
				</isEqual>
				<isEqual property="svc_term_sync_flg" compareValue="Y">
				   fm_svc_term_cd = #fm_svc_term_cd#,
				   to_svc_term_cd = #to_svc_term_cd#,
				</isEqual>
				<isEqual property="cfs_trdp_sync_flg" compareValue="Y">
					cfs_trdp_cd = (case when (#shp_mod_cd# = 'FAK' and isnull(cfs_trdp_cd,'') != '') or ISNULL((SELECT OPT_VAL FROM TB_SYS_OPT WHERE OPT_KEY = 'CFS_SYNC'),'Y') = 'N' then cfs_trdp_cd else #cfs_trdp_cd# end),
				</isEqual>
			   	modi_tms  = GETUTCDATE()
         WHERE  intg_bl_seq in (SELECT intg_bl_seq 
	                              FROM tb_intg_bl_rlt 
	                             WHERE rlt_intg_bl_seq = #intg_bl_seq#)
    </update>
    
    <update id="updateHBL_AE_SYNC" parameterClass="AirHBLInfoVO">
    	/*	updateHBL_AE_SYNC */
        UPDATE  tb_intg_bl
           SET  flt_no = #flt_no#,   
		        etd_dt_tm  	= #etd_dt_tm#,     	eta_dt_tm   = #eta_dt_tm#,	  
		        pol_cd      = #pol_cd#,
				pol_nm      = (case when pol_cd = #pol_cd# then pol_nm else #pol_nm# end),
		        pod_cd 		= #pod_cd#,
		        pod_nm      = (case when pod_cd = #pod_cd# then pod_nm else #pod_nm# end),
		        ts1_port_cd = #ts1_port_cd#, 	ts1_flt_no = #ts1_flt_no#,
		        ts2_port_cd = #ts2_port_cd#, 	ts2_flt_no = #ts2_flt_no#,
		        ts3_port_cd = #ts3_port_cd#, 	ts3_flt_no = #ts3_flt_no#,
		        cargo_tp_cd = #cargo_tp_cd#
         WHERE  intg_bl_seq in (SELECT intg_bl_seq 
	                              FROM tb_intg_bl_rlt 
	                             WHERE rlt_intg_bl_seq = #intg_bl_seq#)
    </update>
    
     <update id="updateHBL_AE_ADDINFO_SYNC" parameterClass="AirHBLInfoVO">
    	/*	updateHBL_AE_ADDINFO_SYNC */
        UPDATE  tb_add_info_bnd
           SET  fst_to_cd 	= #fst_to_cd#,   
		        fst_to_nm 	= #fst_to_nm#
         WHERE  intg_bl_seq in (SELECT intg_bl_seq 
	                              FROM tb_intg_bl_rlt 
	                             WHERE rlt_intg_bl_seq = #intg_bl_seq#)
    </update>
    
    <update id="updateHBL_AI_SYNC" parameterClass="AirHBLInfoVO">
    	/*	updateHBL_AI_SYNC */
        UPDATE  tb_intg_bl
           SET  flt_no = #flt_no#,   
		        etd_dt_tm  	= #etd_dt_tm#,
		        eta_dt_tm   = #eta_dt_tm#,	  
		        pol_cd      = #pol_cd#,
				pol_nm      = (case when pol_cd = #pol_cd# then pol_nm else #pol_nm# end),
		        pod_cd 		= #pod_cd#,
		        pod_nm      = (case when pod_cd = #pod_cd# then pod_nm else #pod_nm# end),
		        ts1_port_cd = #ts1_port_cd#, 	ts1_flt_no = #ts1_flt_no#,
		        ts2_port_cd = #ts2_port_cd#, 	ts2_flt_no = #ts2_flt_no#,
		        ts3_port_cd = #ts3_port_cd#, 	ts3_flt_no = #ts3_flt_no#,
		        cfs_trdp_cd = #cfs_trdp_cd#
         WHERE  intg_bl_seq in (SELECT intg_bl_seq 
	                              FROM tb_intg_bl_rlt 
	                             WHERE rlt_intg_bl_seq = #intg_bl_seq#)
    </update>
    
    <!-- #18782 OBL RCV and Release update jsjang, 2013.9.14  -->
    <update id="updateListInfo" parameterClass="HBLInfoVO">
        UPDATE  tb_intg_bl
           SET  
           		rlsd_usrid = #rlsd_usrid#,
           		rlsd_flg      = #rlsd_flg#,        
           		rlsd_dt_tm  = #rlsd_dt_tm#, 
                modi_tms    = GETUTCDATE()
         WHERE  intg_bl_seq= #intg_bl_seq#
    </update>	
    
    <!-- #18782 OBL RCV and Release update jsjang, 2013.9.14  -->
    <update id="updateListInfo_house" parameterClass="HBLInfoVO">
        UPDATE  tb_intg_bl
           SET  
           		rlsd_usrid = #rlsd_usrid#,
           		rlsd_flg      = #rlsd_flg#,        
           		rlsd_dt_tm  = #rlsd_dt_tm#, 
           		org_bl_rcvd_flg = #org_bl_rcvd_flg#,
           		rcvd_dt_tm = #rcvd_dt_tm#,
                modi_tms    = GETUTCDATE()
         WHERE  intg_bl_seq= #intg_bl_seq#
    </update>	    
    
    <select id="getMaxBlockOrJnrNextDt" parameterClass="HashMap" resultClass="String">
		<![CDATA[  
		SELECT (CASE WHEN (DATEDIFF(DAY, MAX(BLOCK_DT), MAX(JNR_DT)) < 0)
		             THEN CASE WHEN MAX(BLOCK_DT)!= '' THEN CONVERT(NVARCHAR(8),DATEADD(DD, 1,MAX(BLOCK_DT)),112) ELSE '' END
		             ELSE CASE WHEN MAX(JNR_DT)!= '' THEN CONVERT(NVARCHAR(8),DATEADD(DD, 1,MAX(JNR_DT)),112) ELSE '' END
		         END) AS nextBlkJnrDt 
		  FROM (
		         SELECT MAX(ISNULL(BLK.BLOCK_DT,'')) AS BLOCK_DT, MAX(ISNULL(DTL.JNR_DT,'')) AS JNR_DT
		    	   FROM TB_INV_DTL DTL 
    	   			LEFT OUTER JOIN TB_INV_DTL_BLCK BLK
    	   			ON DTL.INV_SEQ = BLK.INV_SEQ
		    	  WHERE DTL.DELT_FLG !='Y'
		    	 
		    	 UNION ALL
		    	 
		    	 SELECT MAX(ISNULL(BLK.BLOCK_DT,'')) AS BLOCK_DT, MAX(ISNULL(MST.JNR_DT,'')) AS JNR_DT
		    	   FROM TB_JNR_MST MST 
		    	   LEFT OUTER JOIN TB_JNR_MST_BLCK BLK
		    	   ON MST.JNR_NO =BLK.JNR_NO 
		    	  WHERE MST.DELT_FLG !='Y'
		    	 ) A 
		 ]]>   	 
	</select>  
	
    <!-- Office post_dt_imp 조회   -->
    <select id="selectImpPostRefCheck" parameterClass="HashMap" resultClass="String">
        SELECT  post_dt_imp
          FROM  tb_ofc ofc 
          WHERE  ofc.ofc_cd = #f_ofc_cd# 
           AND  ofc.delt_flg = 'N'
    </select>	
    
    <!-- Office post_dt_exp 조회   -->
    <select id="selectExpPostRefCheck" parameterClass="HashMap" resultClass="String">
        SELECT  post_dt_exp
          FROM  tb_ofc ofc 
          WHERE  ofc.ofc_cd = #f_ofc_cd# 
           AND  ofc.delt_flg = 'N'
    </select>	

    <select id="selectBlBlockStatus" parameterClass="HashMap" resultClass="String">
			select ISNULL(BLCK.BL_STS_CD1, BL.BL_STS_CD) AS BL_STS_CD
			from tb_intg_bl bl
			LEFT OUTER JOIN(SELECT INTG_BL_SEQ AS INTG_BL_SEQ1, BL_STS_CD AS BL_STS_CD1 FROM TB_INTG_BL_BLCK) BLCK ON BL.INTG_BL_SEQ = BLCK.INTG_BL_SEQ1
			WHERE bl.INTG_BL_SEQ = #intg_bl_seq#
	</select>  



    <select id="searchDuplicateLinerBkgNo" parameterClass="HashMap" resultClass="java.util.HashMap">
			select LNR_BKG_NO from tb_intg_bl
			where   1=1  
			AND LNR_BKG_NO = #lnr_bkg_no#
			AND AIR_SEA_CLSS_CD = #air_sea_clss_cd#
			AND DELT_FLG ='N' 
	</select>  
	
		
	<select id="selectTs1Info" parameterClass="HashMap" resultClass="HBLInfoVO">
		/*	selectTs1Info */
		SELECT  PRE_VSL_CD, PRE_VSL_NM, PRE_VOY
		            , bnd.TS1_PORT_CD
		            , bnd.TS1_PORT_NM
				    , SUBSTRING(TS1_ETD_DT_TM, 1, 8) AS TS1_ETD_DT_TM
				    , SUBSTRING(TS1_ETA_DT_TM, 1, 8) AS TS1_ETA_DT_TM
		  FROM  tb_intg_bl bl
		  JOIN  tb_add_info_bnd bnd
			ON  bl.intg_bl_seq = bnd.intg_bl_seq
		  LEFT OUTER JOIN   tb_loc loc
           ON   bl.ts1_port_cd = loc.loc_cd 
		 WHERE  bl.intg_bl_seq = #intg_bl_seq# 
    </select> 
    
    <insert id="insertBlUdf" parameterClass="com.clt.apps.fis.see.bmd.housebl.dto.BlUdfVO">
	    INSERT INTO TB_BL_UDF
	           (INTG_BL_SEQ
	           ,UDF_CD
	           ,UDF_VAL
	           ,RGST_USRID
	           ,RGST_OFC_CD
	           ,RGST_TMS
	           ,MODI_USRID
	           ,MODI_OFC_CD
	           ,MODI_TMS)
	     VALUES
	           (#intg_bl_seq#
	           ,#udf_cd#
	           ,#udf_val#
	           ,#rgst_usrid#
	           ,#rgst_ofc_cd#
	           ,GETDATE()
	           ,#modi_usrid#
	           ,#modi_ofc_cd#
	           ,GETUTCDATE())
	</insert>       
	
	<update id="updateBlUdf" parameterClass="com.clt.apps.fis.see.bmd.housebl.dto.BlUdfVO">
		UPDATE TB_BL_UDF
		       SET UDF_VAL = #udf_val#
		     		 ,MODI_USRID = #modi_usrid#
		     		 ,MODI_OFC_CD = #modi_ofc_cd#
		      		 ,MODI_TMS = GETUTCDATE()
		 WHERE INTG_BL_SEQ = #intg_bl_seq#
		     AND UDF_CD = #udf_cd#    
   </update>
   
   <delete id="deleteBlUdf" parameterClass="com.clt.apps.fis.see.bmd.housebl.dto.BlUdfVO">
		DELETE TB_BL_UDF
		WHERE INTG_BL_SEQ = #intg_bl_seq#
		    AND UDF_VAL = #udf_val#    
   </delete>
   
   <select id="selectBlUdfList" parameterClass="HashMap"  resultClass="com.clt.apps.fis.see.bmd.housebl.dto.BlUdfVO">
	   SELECT INTG_BL_SEQ, UDF_CD, UDF_VAL 
		FROM TB_BL_UDF A
		  JOIN TB_COM_CD_DTL B ON A.UDF_CD = B.CD_VAL AND B.COM_CD = 'T002' 
	   WHERE INTG_BL_SEQ = #intg_bl_seq#
	   ORDER BY B.SRT_SEQ
	</select>
	
	<insert id="insertHwiFrt" parameterClass="com.clt.apps.fis.see.bmd.housebl.dto.HwiFrtVO">
		/*	insertHwiFrt */
		INSERT INTO TB_HWI_FRT
           (INTG_BL_SEQ
           ,FRT_NM
           ,RU
           ,GRS_WGT1
           ,MEAS1
           ,COD_AMT
           ,ADV_AMT
           ,INV_AMT
           ,DELT_FLG
           ,RGST_USRID
           ,RGST_OFC_CD
           ,RGST_TMS
           ,MODI_USRID
           ,MODI_OFC_CD
           ,MODI_TMS)
     VALUES
           (#intg_bl_seq#
           ,#frt_nm#
           ,#ru#
           ,#grs_wgt1#
           ,#meas1#
           ,#cod_amt#
           ,#adv_amt#
           ,#inv_amt#
           ,'N'
           ,#proc_usrid#
           ,#proc_ofccd#
           ,GETDATE()
           ,#proc_usrid#
           ,#proc_ofccd#
           ,GETUTCDATE())
	</insert>       
	
	<update id="updateHwiFrt" parameterClass="com.clt.apps.fis.see.bmd.housebl.dto.HwiFrtVO">
		/*	updateHwiFrt */
		UPDATE TB_HWI_FRT
		   SET FRT_NM = #frt_nm#
		      ,RU = #ru#
		      ,GRS_WGT1 = #grs_wgt1#
		      ,MEAS1 = #meas1#
		      ,COD_AMT = #cod_amt#
		      ,ADV_AMT = #adv_amt#
		      ,INV_AMT = #inv_amt#
		      ,MODI_USRID = #proc_usrid#
		      ,MODI_OFC_CD = #proc_ofccd#
		      ,MODI_TMS = GETUTCDATE()
		 WHERE INTG_BL_SEQ = #intg_bl_seq#
		   AND FRT_SEQ = #frt_seq#    
   	</update>
   
	<delete id="deleteHwiFrt" parameterClass="com.clt.apps.fis.see.bmd.housebl.dto.HwiFrtVO">
   		/*	deleteHwiFrt */
		UPDATE TB_HWI_FRT
		   SET DELT_FLG = 'Y'
		      ,MODI_USRID = #proc_usrid#
		      ,MODI_OFC_CD = #proc_ofccd#
		      ,MODI_TMS = GETUTCDATE()
		 WHERE INTG_BL_SEQ = #intg_bl_seq#
		   AND FRT_SEQ = #frt_seq#    
   	</delete>
   
	<select id="selectHwiFrtList" parameterClass="HashMap"  resultClass="com.clt.apps.fis.see.bmd.housebl.dto.HwiFrtVO">
		/*	selectHwiFrtList */
   		SELECT FRT_SEQ
		      ,INTG_BL_SEQ
		      ,FRT_NM
		      ,RU
		      ,GRS_WGT1
		      ,MEAS1
		      ,COD_AMT
		      ,ADV_AMT
		      ,INV_AMT
		      ,DELT_FLG
		      ,RGST_USRID
		      ,RGST_OFC_CD
		      ,RGST_TMS
		      ,MODI_USRID
		      ,MODI_OFC_CD
		      ,MODI_TMS
		 FROM TB_HWI_FRT
		WHERE INTG_BL_SEQ = #intg_bl_seq#
		  AND DELT_FLG = 'N'
		ORDER BY FRT_SEQ
	</select>
	
	<!-- #27398 -->
    <update id="updateRmkDevSeg" parameterClass="HashMap">
         UPDATE  tb_add_info_bnd
           SET  RMK_DEV 	= #rmk_dev#
         WHERE  intg_bl_seq  = #intg_bl_seq#
    </update>	 
	
	<select id="selectHBL_PRINT_LIST" parameterClass="HashMap" resultClass="HashMap">
		SELECT  BL.BL_NO, BL.INTG_BL_SEQ, BL.FLT_NO, BL.HBL_TP_CD
			  , ISNULL(LNR.TRDP_NM,'') AS LNR_TRDP_NM
			  , ISNULL(THIRD.TRDP_NM,'') AS THIRD_TRDP_NM
			  , ISNULL(PRNR.TRDP_CD,'') AS PRNR_TRDP_CD
			  , ISNULL(PRNR.TRDP_NM,'') AS PRNR_TRDP_NM
			  , ISNULL(SHPR.TRDP_CD,'') AS SHPR_TRDP_CD
			  , ISNULL(SHPR.TRDP_NM,'') AS SHPR_TRDP_NM
			  , (SELECT x.ofc_eng_nm FROM tb_ofc x WHERE x.ofc_cd = BL.ref_ofc_cd AND x.delt_flg = 'N') AS REF_OFC_ENG_NM
			  ,	ISNULL(iss.trdp_nm,'') AS iss_trdp_nm
			  , (select TRDP_NM from tb_bl_prnr m_shpr where mbl.intg_bl_seq = m_shpr.intg_bl_seq  AND m_shpr.bl_trdp_tp_cd = 'S01' AND m_shpr.delt_flg = 'N') m_shpr_trdp_nm
			  , (select max(cnt_cd) from tb_ofc where ofc_cd = bl.ref_ofc_cd) cnt_cd
			  , BL.ORG_BL_QTY
			  , RMK.RMK_CD
		  FROM  TB_INTG_BL BL
		  JOIN  TB_INTG_BL_RLT RLT ON  BL.INTG_BL_SEQ = RLT.INTG_BL_SEQ
		  LEFT  OUTER JOIN TB_BL_PRNR LNR ON BL.INTG_BL_SEQ = LNR.INTG_BL_SEQ AND LNR.BL_TRDP_TP_CD = 'L01'
		  LEFT  OUTER JOIN TB_BL_PRNR THIRD ON BL.INTG_BL_SEQ = THIRD.INTG_BL_SEQ AND THIRD.BL_TRDP_TP_CD = 'T01'
		  LEFT  OUTER JOIN TB_BL_PRNR PRNR ON BL.INTG_BL_SEQ = PRNR.INTG_BL_SEQ AND PRNR.BL_TRDP_TP_CD = 'P01'
		  LEFT  OUTER JOIN TB_BL_PRNR SHPR ON BL.INTG_BL_SEQ = SHPR.INTG_BL_SEQ AND SHPR.BL_TRDP_TP_CD = 'S01'
		  LEFT  OUTER JOIN tb_bl_prnr iss  ON   BL.intg_bl_seq = iss.intg_bl_seq  AND iss.bl_trdp_tp_cd = 'I01' AND iss.delt_flg = 'N'
		  LEFT  OUTER JOIN tb_intg_bl mbl ON  rlt.rlt_intg_bl_seq = mbl.intg_bl_seq AND mbl.biz_clss_cd = 'M' AND mbl.delt_flg = 'N'
		  LEFT  OUTER JOIN tb_bl_rmk rmk ON  rmk.ofc_cd = mbl.ref_ofc_cd AND rmk.use_flg = 'Y'
		 WHERE  RLT.RLT_INTG_BL_SEQ = #intg_bl_seq#
		   AND  BL.DELT_FLG = 'N'
	</select>
	
	<select id="selectRefNoValidCheck" parameterClass="HashMap" resultClass="Integer">
        SELECT  count(bl.bl_no)
          FROM  tb_intg_bl bl 
          JOIN  tb_add_info_bnd bnd 
            ON  bl.INTG_BL_SEQ = bnd.INTG_BL_SEQ AND bnd.delt_flg = 'N'
         WHERE  bl.biz_clss_cd = 'M' 
           AND  bl.air_sea_clss_cd = #f_air_sea_clss_cd#
           AND  bnd.bnd_clss_cd = #f_bnd_clss_cd#
           AND  bl.ref_no = #f_ref_no# 
           AND  bl.intg_bl_seq = #f_rlt_intg_bl_seq# 
           AND  bl.delt_flg = 'N'
    </select>
    
    <!--Booking 정보 조회  -->
    <select id="selectBKG_INFO" parameterClass="HashMap" resultClass="HBLInfoVO">
    	/* BlCmmSQL.xml > selectBKG_INFO */
        SELECT BKG.BKG_NO 
		      ,BKG.BKG_SEQ 
		      ,BKG.INTG_BL_SEQ
		      ,BL.BL_NO
		      ,BKG.BKG_DT_TM 
		      ,BKG.PO_NO 
		      ,BKG.LC_NO 
		      ,BKG.PRNR_TRDP_CD 
		      ,BKG.PRNR_TRDP_NM 
		      ,BKG.ACT_SHPR_TRDP_CD 
		      ,BKG.ACT_SHPR_TRDP_NM 
		      ,BKG.SHPR_TRDP_CD 
		      ,BKG.SHPR_TRDP_NM 
		      ,BKG.SHPR_TRDP_ADDR 
		      ,BKG.CNEE_TRDP_CD 
		      ,BKG.CNEE_TRDP_NM 
		      ,BKG.CNEE_TRDP_ADDR 
		      ,BKG.NTFY_TRDP_CD 
		      ,BKG.NTFY_TRDP_NM 
		      ,BKG.NTFY_TRDP_ADDR 
		      ,BKG.EXP_REF_NO 
		      ,BKG.PU_TRDP_CD 
		      ,BKG.PU_TRDP_NM 
		      ,BKG.CGO_PU_TRDP_CD 
		      ,BKG.CGO_PU_TRDP_NM 
		      ,BKG.CGO_PU_TRDP_ADDR 
		      ,BKG.RCV_WH_CD 
		      ,BKG.RCV_WH_NM 
		      ,BKG.TRK_TRDP_CD 
		      ,BKG.TRK_TRDP_NM 
		      ,BKG.CUST_REF_NO 
		      ,BKG.CNTR_INFO 
		      ,BKG.TRNK_VSL_CD 
		      ,BKG.TRNK_VSL_NM 
		      ,BKG.TRNK_VOY 
		      ,BKG.POR_CD 
		      ,BKG.POR_NOD_CD 
		      ,BKG.POR_NM 
		      ,BKG.POL_CD 
		      ,BKG.POL_NOD_CD 
		      ,BKG.POL_NM 
		      ,BKG.POD_CD 
		      ,BKG.POD_NOD_CD 
		      ,BKG.POD_NM 
		      ,BKG.DEL_CD 
		      ,BKG.DEL_NOD_CD 
		      ,BKG.DEL_NM 
		      ,BKG.FNL_DEST_LOC_CD 
		      ,BKG.FNL_DEST_NOD_CD 
		      ,BKG.FNL_DEST_LOC_NM 
		      ,BKG.LNR_TRDP_CD 
		      ,BKG.LNR_TRDP_NM 
		      ,BKG.LNR_BKG_NO 
		      ,BKG.ETD_DT_TM 
		      ,BKG.ETA_DT_TM 
		      ,BKG.ETD_POR_TM 
		      ,BKG.SHP_MOD_CD 
		      ,BKG.REP_CMDT_CD 
		      ,BKG.REP_CMDT_NM 
		      ,BKG.PCK_QTY 
		      ,BKG.PCK_UT_CD 
		      ,BKG.GRS_WGT_UT_CD 
		      ,BKG.GRS_WGT 
		      ,BKG.GRS_WGT1 
		      ,BKG.MEAS_UT_CD 
		      ,BKG.MEAS 
		      ,BKG.MEAS1 
		      ,BKG.FM_SVC_TERM_CD 
		      ,BKG.TO_SVC_TERM_CD 
		      ,BKG.CARGO_TP_CD 
		      ,BKG.CUT_OFF_DT 
		      ,BKG.RAIL_CUT_OFF_DT 
		      ,BKG.WH_CUT_OFF_DT 
		      ,BKG.DOC_CUT_OFF_DT 
		      ,BKG.SLS_OFC_CD 
		      ,BKG.SLS_DEPT_CD 
		      ,BKG.SLS_USRID 
		      ,BKG.SLS_USR_NM 
		      ,BKG.RMK 
		      ,BKG.DEPT_CD 
		      ,BKG.RGST_USRID 
		      ,BKG.RGST_OFC_CD 
		      ,BKG.RGST_TMS 
		      ,BKG.MODI_USRID 
		      ,BKG.MODI_OFC_CD 
		      ,BKG.MODI_TMS 
		      ,BKG.DELT_FLG 
		      ,BKG.LNR_CTRT_NO
        	  ,BKG.FRT_TERM_CD
		  FROM TB_BKG BKG
	LEFT OUTER JOIN TB_INTG_BL BL
		   ON  BL.INTG_BL_SEQ = BKG.INTG_BL_SEQ AND BL.AIR_SEA_CLSS_CD = 'S' AND  BL.BIZ_CLSS_CD = 'H' AND BL.DELT_FLG = 'N'
		 WHERE 1 = 1
		   AND BKG.DELT_FLG = 'N'
        <dynamic>
        
        	<isNotEmpty property="f_bkg_no">
                AND BKG.BKG_no = #f_bkg_no#
            </isNotEmpty>
        
            <isNotEmpty property="f_bkg_seq">
                AND BKG.BKG_seq = #f_bkg_seq#
            </isNotEmpty> 
        </dynamic>
    </select>
    
    <!-- PO를 조회함  -->
    <select id="selectBKG_PO_INFO" parameterClass="HashMap" resultClass="BkgPoItemInfoVO">
		SELECT  bkg.bkg_seq,
				bkg.po_sys_no,
				po.cust_po_no,
				bkg.po_cmdt_seq,
				bkg.cust_itm_id,
				custitm.item_nm 	as cust_itm_nm,
				bkg.pck_ut_cd 		as cmdt_pck_ut_cd,
				unit.pck_nm 		as cmdt_pck_ut_nm, 
				bkg.pck_inr_qty 	as cmdt_pck_inr_qty,
		        bkg.pck_qty 		as cmdt_pck_qty,
		        bkg.ea_cnt 			as cmdt_ea_cnt,
		        bkg.ttl_qty 		as cmdt_ttl_qty,
		        bkg.cmdt_kgs_wgt,
		        bkg.cmdt_lbs_wgt,		        
		        bkg.cmdt_cbm_meas,
		        bkg.cmdt_cft_meas
		  FROM  tb_bkg_po bkg
		 INNER  JOIN tb_po po ON bkg.po_sys_no = po.po_sys_no AND po.delt_flg = 'N'
		  LEFT  OUTER JOIN tb_po_cmdt po_cmdt ON bkg.po_sys_no = po_cmdt.po_sys_no AND bkg.po_cmdt_seq = po_cmdt.po_cmdt_seq AND po_cmdt.delt_flg = 'N'
	      LEFT  OUTER JOIN tl_ctrt_cust_item custitm ON po_cmdt.ctrt_no = custitm.ctrt_no AND po_cmdt.item_sys_no = custitm.item_sys_no AND po_cmdt.cust_itm_id = custitm.item_cd AND custitm.item_use_flg = 'Y'
		  LEFT  OUTER JOIN tb_pck_ut_cd unit ON bkg.pck_ut_cd = unit.pck_ut_cd AND unit.use_flg = 'Y'
		 WHERE  bkg.bkg_seq = #f_bkg_seq# 
		   AND  bkg.delt_flg = 'N'
	  ORDER BY  bkg.po_sys_no, bkg.po_cmdt_seq ASC
    </select>
    
    <!-- Booking No. 중복 체크   -->
    <select id="selectBkgNoDuplCheck" parameterClass="HashMap" resultClass="Integer">
        SELECT  count(bkg_no)
          FROM  tb_bkg
         WHERE  bkg_no = #f_bkg_no# 
           AND  delt_flg = 'N'
    </select>
    
    <!-- Booking Entry에서 HBL 생성 여부 체크   -->
    <select id="searchHBLCreateChk" parameterClass="HashMap" resultClass="String">
    	SELECT  CASE WHEN COUNT(*) > 0 THEN 'N' ELSE 'Y' END AS CHKFLG
           FROM  TB_BKG BKG 
           JOIN  TB_INTG_BL BL
             ON  BL.INTG_BL_SEQ = BKG.INTG_BL_SEQ AND BL.AIR_SEA_CLSS_CD = 'S' AND BL.BIZ_CLSS_CD = 'H' AND BL.DELT_FLG = 'N'
          WHERE  1=1            
            AND  BKG.BKG_NO = #bkg_no#
            AND  BKG.DELT_FLG = 'N'
    </select>
    
    <!--Booking 테이블 등록   -->
    <insert id="insertBKG_INFO" parameterClass="HBLInfoVO">
	    /** BlCmmSQL.xml > insertBKG_INFO **/
	    INSERT INTO tb_bkg
           (bkg_no 
           ,bkg_seq 
           ,bkg_dt_tm 
           ,po_no 
           ,lc_no 
           ,prnr_trdp_cd 
           ,prnr_trdp_nm 
           ,act_shpr_trdp_cd 
           ,act_shpr_trdp_nm 
           ,shpr_trdp_cd 
           ,shpr_trdp_nm 
           ,shpr_trdp_addr 
           ,cnee_trdp_cd 
           ,cnee_trdp_nm 
           ,cnee_trdp_addr 
           ,ntfy_trdp_cd 
           ,ntfy_trdp_nm 
           ,ntfy_trdp_addr 
           ,exp_ref_no 
           ,pu_trdp_cd 
           ,pu_trdp_nm 
           ,cgo_pu_trdp_cd 
           ,cgo_pu_trdp_nm 
           ,cgo_pu_trdp_addr 
           ,rcv_wh_cd 
           ,rcv_wh_nm 
           ,trk_trdp_cd 
           ,trk_trdp_nm 
           ,cust_ref_no 
           ,cntr_info 
           ,trnk_vsl_cd 
           ,trnk_vsl_nm 
           ,trnk_voy 
           ,por_cd 
           ,por_nod_cd 
           ,por_nm 
           ,pol_cd 
           ,pol_nod_cd 
           ,pol_nm 
           ,pod_cd 
           ,pod_nod_cd 
           ,pod_nm 
           ,del_cd 
           ,del_nod_cd 
           ,del_nm 
           ,fnl_dest_loc_cd 
           ,fnl_dest_nod_cd 
           ,fnl_dest_loc_nm 
           ,lnr_trdp_cd 
           ,lnr_trdp_nm 
           ,lnr_bkg_no 
           ,etd_dt_tm 
           ,eta_dt_tm 
           ,etd_por_tm 
           ,shp_mod_cd 
           ,rep_cmdt_cd 
           ,rep_cmdt_nm 
           ,pck_qty 
           ,pck_ut_cd 
           ,grs_wgt_ut_cd 
           ,grs_wgt 
           ,grs_wgt1 
           ,meas_ut_cd 
           ,meas 
           ,meas1 
           ,fm_svc_term_cd 
           ,to_svc_term_cd 
           ,cargo_tp_cd 
           ,cut_off_dt 
           ,rail_cut_off_dt 
           ,wh_cut_off_dt 
           ,doc_cut_off_dt 
           ,sls_ofc_cd 
           ,sls_dept_cd 
           ,sls_usrid 
           ,sls_usr_nm 
           ,rmk 
           ,dept_cd 
           ,rgst_usrid 
           ,rgst_ofc_cd 
           ,rgst_tms 
           ,modi_usrid 
           ,modi_ofc_cd 
           ,modi_tms 
           ,delt_flg
           ,lnr_ctrt_no
           ,frt_term_cd 
           )
     VALUES
           (#bkg_no# 
           ,#bkg_seq#
           ,#bkg_dt_tm#
           ,#po_no# 
           ,#lc_no# 
           ,#prnr_trdp_cd# 
           ,#prnr_trdp_nm# 
           ,#act_shpr_trdp_cd# 
           ,#act_shpr_trdp_nm# 
           ,#shpr_trdp_cd# 
           ,#shpr_trdp_nm# 
           ,#shpr_trdp_addr# 
           ,#cnee_trdp_cd# 
           ,#cnee_trdp_nm# 
           ,#cnee_trdp_addr# 
           ,#ntfy_trdp_cd# 
           ,#ntfy_trdp_nm# 
           ,#ntfy_trdp_addr# 
           ,#exp_ref_no# 
           ,#pu_trdp_cd# 
           ,#pu_trdp_nm# 
           ,#cgo_pu_trdp_cd# 
           ,#cgo_pu_trdp_nm# 
           ,#cgo_pu_trdp_addr# 
           ,#rcv_wh_cd# 
           ,#rcv_wh_nm# 
           ,#trk_trdp_cd# 
           ,#trk_trdp_nm# 
           ,#cust_ref_no# 
           ,#cntr_info# 
           ,#trnk_vsl_cd# 
           ,#trnk_vsl_nm# 
           ,#trnk_voy# 
           ,#por_cd# 
           ,#por_nod_cd# 
           ,#por_nm# 
           ,#pol_cd# 
           ,#pol_nod_cd# 
           ,#pol_nm# 
           ,#pod_cd# 
           ,#pod_nod_cd# 
           ,#pod_nm# 
           ,#del_cd# 
           ,#del_nod_cd# 
           ,#del_nm# 
           ,#fnl_dest_loc_cd# 
           ,#fnl_dest_nod_cd# 
           ,#fnl_dest_loc_nm# 
           ,#lnr_trdp_cd# 
           ,#lnr_trdp_nm# 
           ,#lnr_bkg_no# 
           ,#etd_dt_tm# 
           ,#eta_dt_tm# 
           ,#etd_por_tm# 
           ,#shp_mod_cd# 
           ,#rep_cmdt_cd# 
           ,#rep_cmdt_nm# 
           ,#pck_qty# 
           ,#pck_ut_cd# 
           ,#grs_wgt_ut_cd# 
           ,#grs_wgt# 
           ,#grs_wgt1# 
           ,#meas_ut_cd# 
           ,#meas# 
           ,#meas1# 
           ,#fm_svc_term_cd# 
           ,#to_svc_term_cd# 
           ,#cargo_tp_cd# 
           ,#cut_off_dt# 
           ,#rail_cut_off_dt# 
           ,#wh_cut_off_dt# 
           ,#doc_cut_off_dt# 
           ,#sls_ofc_cd# 
           ,#sls_dept_cd# 
           ,#sls_usrid# 
           ,#sls_usr_nm# 
           ,#rmk# 
           ,#proc_dept_cd# 
           ,#proc_usrid# 
           ,#proc_ofccd# 
           ,getdate() 
           ,#proc_usrid# 
           ,#proc_ofccd# 
           ,GETUTCDATE() 
           ,'N'
           ,#lnr_ctrt_no#
           ,#frt_term_cd#)
    </insert>
    
    <!-- Booking 내용 수정   -->
   <update id="updateBKG_INFO" parameterClass="HBLInfoVO">
   		/** BlCmmSQL.xml > updateBKG_INFO **/
   		UPDATE tb_bkg
		   SET bkg_no = #bkg_no#
		      ,bkg_dt_tm = #bkg_dt_tm#
		      ,po_no = #po_no#
		      ,lc_no = #lc_no#
		      ,prnr_trdp_cd = #prnr_trdp_cd#
		      ,prnr_trdp_nm = #prnr_trdp_nm#
		      ,act_shpr_trdp_cd = #act_shpr_trdp_cd#
		      ,act_shpr_trdp_nm = #act_shpr_trdp_nm#
		      ,shpr_trdp_cd = #shpr_trdp_cd#
		      ,shpr_trdp_nm = #shpr_trdp_nm#
		      ,shpr_trdp_addr = #shpr_trdp_addr#
		      ,cnee_trdp_cd = #cnee_trdp_cd#
		      ,cnee_trdp_nm = #cnee_trdp_nm#
		      ,cnee_trdp_addr = #cnee_trdp_addr#
		      ,ntfy_trdp_cd = #ntfy_trdp_cd#
		      ,ntfy_trdp_nm = #ntfy_trdp_nm#
		      ,ntfy_trdp_addr = #ntfy_trdp_addr#
		      ,exp_ref_no = #exp_ref_no#
		      ,pu_trdp_cd = #pu_trdp_cd#
		      ,pu_trdp_nm = #pu_trdp_nm#
		      ,cgo_pu_trdp_cd = #cgo_pu_trdp_cd#
		      ,cgo_pu_trdp_nm = #cgo_pu_trdp_nm#
		      ,cgo_pu_trdp_addr = #cgo_pu_trdp_addr#
		      ,rcv_wh_cd = #rcv_wh_cd#
		      ,rcv_wh_nm = #rcv_wh_nm#
		      ,trk_trdp_cd = #trk_trdp_cd#
		      ,trk_trdp_nm = #trk_trdp_nm#
		      ,cust_ref_no = #cust_ref_no#
		      ,cntr_info = #cntr_info#
		      ,trnk_vsl_cd = #trnk_vsl_cd#
		      ,trnk_vsl_nm = #trnk_vsl_nm#
		      ,trnk_voy = #trnk_voy#
		      ,por_cd = #por_cd#
		      ,por_nod_cd = #por_nod_cd#
		      ,por_nm = #por_nm#
		      ,pol_cd = #pol_cd#
		      ,pol_nod_cd = #pol_nod_cd#
		      ,pol_nm = #pol_nm#
		      ,pod_cd = #pod_cd#
		      ,pod_nod_cd = #pod_nod_cd#
		      ,pod_nm = #pod_nm#
		      ,del_cd = #del_cd#
		      ,del_nod_cd = #del_nod_cd#
		      ,del_nm = #del_nm#
		      ,fnl_dest_loc_cd = #fnl_dest_loc_cd#
		      ,fnl_dest_nod_cd = #fnl_dest_nod_cd#
		      ,fnl_dest_loc_nm = #fnl_dest_loc_nm#
		      ,lnr_trdp_cd = #lnr_trdp_cd#
		      ,lnr_trdp_nm = #lnr_trdp_nm#
		      ,lnr_bkg_no = #lnr_bkg_no#
		      ,etd_dt_tm = #etd_dt_tm#
		      ,eta_dt_tm = #eta_dt_tm#
		      ,etd_por_tm = #etd_por_tm#
		      ,shp_mod_cd = #shp_mod_cd#
		      ,rep_cmdt_cd = #rep_cmdt_cd#
		      ,rep_cmdt_nm = #rep_cmdt_nm#
		      ,pck_qty = #pck_qty#
		      ,pck_ut_cd = #pck_ut_cd#
		      ,grs_wgt_ut_cd = #grs_wgt_ut_cd#
		      ,grs_wgt = #grs_wgt#
		      ,grs_wgt1 = #grs_wgt1#
		      ,meas_ut_cd = #meas_ut_cd#
		      ,meas = #meas#
		      ,meas1 = #meas1#
		      ,fm_svc_term_cd = #fm_svc_term_cd#
		      ,to_svc_term_cd = #to_svc_term_cd#
		      ,cargo_tp_cd = #cargo_tp_cd#
		      ,cut_off_dt = #cut_off_dt#
		      ,rail_cut_off_dt = #rail_cut_off_dt#
		      ,wh_cut_off_dt = #wh_cut_off_dt#
		      ,doc_cut_off_dt = #doc_cut_off_dt#
		      ,sls_ofc_cd = #sls_ofc_cd#
		      ,sls_dept_cd = #sls_dept_cd#
		      ,sls_usrid = #sls_usrid#
		      ,sls_usr_nm = #sls_usr_nm#
		      ,rmk = #rmk#
		      ,dept_cd = #proc_dept_cd#
		      ,modi_usrid = #proc_usrid#
		      ,modi_ofc_cd = #proc_ofccd#
		      ,modi_tms = GETUTCDATE()
		      ,delt_flg = 'N'
		      ,frt_term_cd = #frt_term_cd#
        	  ,lnr_ctrt_no = #lnr_ctrt_no#
		 WHERE bkg_seq = #bkg_seq#
    </update>
    
    <!--자동채번 버튼한 Booking저장  -->
    <update id="updateBKG_NO" parameterClass="HashMap">
        UPDATE  tb_bkg
           SET  bkg_no      = #bkg_no#
               ,modi_tms    = GETUTCDATE()
         WHERE  bkg_seq 	= #bkg_seq#
    </update>
    
    <update id="removeBKG_INFO" parameterClass="HashMap">
        UPDATE  tb_bkg
           SET  delt_flg   = #delt_flg#,
                modi_usrid = #proc_usrid#
               ,modi_ofc_cd = #proc_ofccd#
               ,modi_tms   = GETUTCDATE()
         WHERE  bkg_no = #bkg_no#
    </update>
    
    <!-- PO을 입력함  -->
	<insert id="insertBKG_PO_INFO" parameterClass="BkgPoItemInfoVO">
		INSERT INTO tb_bkg_po(
				bkg_seq,     	 	po_sys_no,		  	po_cmdt_seq,
				cust_itm_id,	 	pck_ut_cd,		  	pck_inr_qty,
				pck_qty,		 	ea_cnt,		  		ttl_qty,
				cmdt_kgs_wgt,	 	cmdt_lbs_wgt,    	cmdt_cbm_meas,
				cmdt_cft_meas,
		        rgst_usrid,      	rgst_ofc_cd,     	rgst_tms,
                modi_usrid,      	modi_ofc_cd,     	modi_tms,      		delt_flg
		)VALUES(
                #bkg_seq#,   	 	#po_sys_no#, 	  	#po_cmdt_seq#,
                #cust_itm_id#,	 	#cmdt_pck_ut_cd#,	#cmdt_pck_inr_qty#,
				#cmdt_pck_qty#,		#cmdt_ea_cnt#,		#cmdt_ttl_qty#,
				#cmdt_kgs_wgt#,	 	#cmdt_lbs_wgt#,  	#cmdt_cbm_meas#,
				#cmdt_cft_meas#,
				#proc_usrid#,    	#proc_ofccd#,    	getdate(),
                #proc_usrid#,    	#proc_ofccd#,    	GETUTCDATE(),     	'N'
		)
    </insert>
    
    <!-- CNTR을 입력함  -->
	<select id="selectBKG_CNTR_INFO" parameterClass="HashMap" resultClass="BkgCntrListVO">
		SELECT  
				bkg_seq,     	 	cntr_seq,		  	cntr_tpsz_cd,
				qty,				delt_flg 
		FROM    tb_bkg_cntr 
		WHERE 
                bkg_seq = #f_bkg_seq#
        AND     delt_flg = 'N'
    </select>
    
    <!-- CNTR을 입력함  -->
	<insert id="insertBKG_CNTR_INFO" parameterClass="BkgCntrListVO">
		INSERT INTO tb_bkg_cntr(
				bkg_seq,     	 	cntr_tpsz_cd,
				qty,			 	
		        rgst_usrid,      	rgst_ofc_cd,     	rgst_tms,
                modi_usrid,      	modi_ofc_cd,     	modi_tms,      		delt_flg
		)VALUES(
                #bkg_seq#,   	 	#cntr_tpsz_cd#,
                #qty#,	
				#proc_usrid#,    	#proc_ofccd#,    	getdate(),
                #proc_usrid#,    	#proc_ofccd#,    	GETUTCDATE(),     	'N'
		)
    </insert>
    
    <!-- CNTR을 수정함  -->
    <update id="updateBKG_CNTR_INFO" parameterClass="BkgCntrListVO">
        UPDATE  tb_bkg_cntr 
           SET  cntr_tpsz_cd	= #cntr_tpsz_cd#,  
				qty 			= #qty#, 
		        modi_usrid = #proc_usrid#,    
		        modi_ofc_cd = #proc_ofccd#,   
		        modi_tms= GETUTCDATE() 
		 WHERE  bkg_seq= #bkg_seq#  
		   AND  cntr_seq = #cntr_seq# 
    </update>
    
    <!-- CNTR을 삭제처리함  -->
    <update id="deleteBKG_CNTR_INFO" parameterClass="BkgCntrListVO">
        UPDATE  tb_bkg_cntr 
           SET  delt_flg	= 'Y',  
		        modi_usrid = #proc_usrid#,    
		        modi_ofc_cd = #proc_ofccd#,   
		        modi_tms= GETUTCDATE() 
		 WHERE  bkg_seq= #bkg_seq#  
		   AND  cntr_seq = #cntr_seq# 
    </update>
	
	<!-- Dimension을 수정함  -->
    <update id="updateBKG_PO_INFO" parameterClass="BkgPoItemInfoVO">
        UPDATE  tb_bkg_po
           SET  cust_itm_id	= #cust_itm_id#,  
				pck_ut_cd = #cmdt_pck_ut_cd#,	  
				pck_inr_qty	= #cmdt_pck_inr_qty#,	  
				pck_qty	= #cmdt_pck_qty#,	  
				ea_cnt	= #cmdt_ea_cnt#,	  
				ttl_qty	= #cmdt_ttl_qty#,	  
				cmdt_kgs_wgt = #cmdt_kgs_wgt#,	  
				cmdt_lbs_wgt = #cmdt_lbs_wgt#,
				cmdt_cbm_meas = #cmdt_cbm_meas#,
				cmdt_cft_meas = #cmdt_cft_meas#,
		        modi_usrid = #proc_usrid#,    
		        modi_ofc_cd = #proc_ofccd#,   
		        modi_tms= GETUTCDATE()
		 WHERE  bkg_seq= #bkg_seq#  
		   AND  po_sys_no = #po_sys_no# 
		   AND  po_cmdt_seq = #po_cmdt_seq#
    </update>
	
    <update id="deleteBKG_PO_INFO" parameterClass="BkgPoItemInfoVO">
    	DELETE  FROM tb_bkg_po
         WHERE  bkg_seq= #bkg_seq#  
         <isNotEmpty property="po_sys_no">
		   AND  po_sys_no = #po_sys_no# 
		 </isNotEmpty>
		 <isNotEmpty property="po_cmdt_seq">
		   AND  po_cmdt_seq = #po_cmdt_seq# 
		 </isNotEmpty>
    </update>
    
    <!-- Buyer PO No로 PO_SYS_NO 조회해오기   -->
    <select id="searchCustPoNo" parameterClass="HashMap" resultClass="HashMap">
        SELECT  po_sys_no, 
				buyr_trdp_nm,
				vndr_trdp_nm,
				org_loc_nm,
				dest_loc_nm,
				ord_dt,
				shpwin_fr_dt,
				shpwin_to_dt
          FROM  tb_po
         WHERE  cust_po_no = #s_cust_po_no#
           AND  delt_flg = 'N'
    </select>
    
    <!-- Booking List select    -->
    <select id="selectBKG_LIST" parameterClass="java.util.HashMap" resultClass="HBLInfoVO">
		/* BlCmmSQL.xml > selectBKG_LIST */
   		SELECT a1.*
		  FROM (
         	SELECT  ROW_NUMBER() OVER (ORDER BY  BKG.BKG_DT_TM DESC, BKG.MODI_TMS DESC) as ROWNUM,
					BKG.BKG_SEQ, BKG.BKG_NO, BKG.BKG_DT_TM,
					BL.BL_NO AS HBL_NO, BKG.RGST_OFC_CD, 
					BKG.ETD_DT_TM, BKG.ETA_DT_TM,
					BKG.POR_CD, BKG.POR_NM, 
					BKG.POL_CD, BKG.POL_NM, 
					BKG.POD_CD, BKG.POD_NM, 
					BKG.DEL_CD, BKG.DEL_NM,

					BKG.PRNR_TRDP_CD, BKG.PRNR_TRDP_NM,
					BKG.SHPR_TRDP_CD, BKG.SHPR_TRDP_NM,
					BKG.CNEE_TRDP_CD, BKG.CNEE_TRDP_NM,
					BKG.ACT_SHPR_TRDP_CD, BKG.ACT_SHPR_TRDP_NM,
					BKG.LNR_TRDP_CD, BKG.LNR_TRDP_NM,
					BKG.NTFY_TRDP_CD, BKG.NTFY_TRDP_NM,
					BKG.TRK_TRDP_CD, BKG.TRK_TRDP_NM,
					
					BKG.SHP_MOD_CD, BKG.RGST_USRID, 
					BKG.CUST_REF_NO, BKG.LNR_BKG_NO, BKG.EXP_REF_NO,
					(SELECT max(X.LOCL_USR_NM) FROM TB_USR X WHERE X.USR_TP = 'I' AND X.USRID = BKG.RGST_USRID ) AS PROC_USRNM,
					BKG.TRNK_VSL_NM, BKG.TRNK_VOY, 
					
					BKG.PCK_QTY, BKG.GRS_WGT, BKG.GRS_WGT1, BKG.MEAS,

  					CASE WHEN CHARINDEX(CHAR(13)+CHAR(10), BKG.PO_NO) = 0 THEN BKG.PO_NO
					ELSE SUBSTRING(BKG.PO_NO, 1, CHARINDEX(CHAR(13)+CHAR(10), BKG.PO_NO)-1) END AS PO_NO , 					
					BKG.LC_NO
			  FROM  TB_BKG BKG
   LEFT OUTER JOIN  TB_INTG_BL BL
				ON  BL.INTG_BL_SEQ = BKG.INTG_BL_SEQ AND BL.AIR_SEA_CLSS_CD = 'S' AND BL.BIZ_CLSS_CD = 'H' AND BL.DELT_FLG = 'N'
			 WHERE  BKG.DELT_FLG = 'N'
			<isNotEmpty property="f_bkg_no">
			   AND  BKG.BKG_NO LIKE '%' + #f_bkg_no# + '%'
			</isNotEmpty>
			<isNotEmpty property="f_hbl_no">
			   AND  BL.BL_NO LIKE '%' + #f_hbl_no# + '%'
			</isNotEmpty>
			<isNotEmpty property="f_bkg_strdt">
			   AND  BKG.BKG_DT_TM BETWEEN #f_bkg_strdt# AND #f_bkg_enddt#
			</isNotEmpty>
			<isNotEmpty property="f_pol_cd">
			   AND  BKG.POL_CD = #f_pol_cd#
			</isNotEmpty>
			<isNotEmpty property="f_pol_nm">
			   AND  BKG.POL_NM LIKE '%' + #f_pol_nm# + '%'
			</isNotEmpty>
			<isNotEmpty property="f_pod_cd">
			   AND  BKG.POD_CD = #f_pod_cd#
			</isNotEmpty>
			<isNotEmpty property="f_pod_nm">
			   AND  BKG.POD_NM LIKE '%' + #f_pod_nm# + '%'
			</isNotEmpty>
			<isNotEmpty property="f_prnr_trdp_nm">
			   AND  BKG.PRNR_TRDP_NM LIKE '%' + #f_prnr_trdp_nm# + '%'
			</isNotEmpty>
			<isNotEmpty property="f_shpr_trdp_nm">
			   AND  BKG.SHPR_TRDP_NM LIKE '%' + #f_shpr_trdp_nm# + '%'
			</isNotEmpty>
			<isNotEmpty property="f_cnee_trdp_nm">
			   AND  BKG.CNEE_TRDP_NM LIKE '%' + #f_cnee_trdp_nm# + '%'
			</isNotEmpty>
			<isNotEmpty property="f_ahpr_trdp_nm">
			   AND  BKG.ACT_SHPR_TRDP_NM LIKE '%' + #f_ahpr_trdp_nm# + '%'
			</isNotEmpty>
			<isNotEmpty property="f_ntfy_trdp_nm">
			   AND  BKG.NTFY_TRDP_NM LIKE '%' + #f_ntfy_trdp_nm# + '%'
			</isNotEmpty>
			<isNotEmpty property="f_ofc_cd">
			   AND  BKG.RGST_OFC_CD = #f_ofc_cd#
			</isNotEmpty>
			<isNotEmpty property="f_shp_mod_cd">
			   AND  BKG.SHP_MOD_CD = #f_shp_mod_cd#
			</isNotEmpty>
			<isNotEmpty property="f_trnk_vsl_nm">
			   AND  BKG.TRNK_VSL_NM LIKE '%' + #f_trnk_vsl_nm# + '%'
			</isNotEmpty>
			<isNotEmpty property="f_po_no">
			   AND  EXISTS (SELECT 1 
			   			    FROM  TB_BKG_PO BKGPO 
			   			    INNER JOIN TB_PO PO ON BKGPO.PO_SYS_NO = PO.PO_SYS_NO AND PO.DELT_FLG = 'N'
			   			    WHERE BKG.BKG_SEQ = BKGPO.BKG_SEQ 
			   			    AND   BKGPO.DELT_FLG = 'N' 
			   			    AND   PO.CUST_PO_NO LIKE '%' + #f_po_no# + '%')
			</isNotEmpty>
			<isNotEmpty property="f_lc_no">
			   AND  BKG.LC_NO = #f_lc_no#
			</isNotEmpty>
			<isNotEmpty property="f_lnr_bkg_no">
			   AND  BKG.LNR_BKG_NO = #f_lnr_bkg_no#
			</isNotEmpty>
			<isNotEmpty property="f_cust_ref_no">
			   AND  BKG.CUST_REF_NO LIKE '%' + #f_cust_ref_no# + '%'
			</isNotEmpty>	
			 ) a1
			<![CDATA[ where a1.ROWNUM > #beginIdx# AND a1.ROWNUM <= #topCnt#	]]>
    </select>
    
    <!--  House B/L List select count    -->
    <select id="selectBKG_LIST_CNT" parameterClass="java.util.HashMap" resultClass="Integer">
            SELECT  COUNT(bkg.bkg_seq)    
          	  FROM  TB_BKG BKG
   LEFT OUTER JOIN  TB_INTG_BL BL
				ON  BL.INTG_BL_SEQ = BKG.INTG_BL_SEQ AND BL.AIR_SEA_CLSS_CD = 'S' AND BL.BIZ_CLSS_CD = 'H' AND BL.DELT_FLG = 'N'
			 WHERE  BKG.DELT_FLG = 'N'
			<isNotEmpty property="f_bkg_no">
			   AND  BKG.BKG_NO LIKE '%' + #f_bkg_no# + '%'
			</isNotEmpty>
			<isNotEmpty property="f_hbl_no">
			   AND  BL.BL_NO LIKE '%' + #f_hbl_no# + '%'
			</isNotEmpty>
			<isNotEmpty property="f_bkg_strdt">
			   AND  BKG.BKG_DT_TM BETWEEN #f_bkg_strdt# AND #f_bkg_enddt#
			</isNotEmpty>
			<isNotEmpty property="f_pol_cd">
			   AND  BKG.POL_CD = #f_pol_cd#
			</isNotEmpty>
			<isNotEmpty property="f_pol_nm">
			   AND  BKG.POL_NM LIKE '%' + #f_pol_nm# + '%'
			</isNotEmpty>
			<isNotEmpty property="f_pod_cd">
			   AND  BKG.POD_CD = #f_pod_cd#
			</isNotEmpty>
			<isNotEmpty property="f_pod_nm">
			   AND  BKG.POD_NM LIKE '%' + #f_pod_nm# + '%'
			</isNotEmpty>
			<isNotEmpty property="f_prnr_trdp_nm">
			   AND  BKG.PRNR_TRDP_NM LIKE '%' + #f_prnr_trdp_nm# + '%'
			</isNotEmpty>
			<isNotEmpty property="f_shpr_trdp_nm">
			   AND  BKG.SHPR_TRDP_NM LIKE '%' + #f_shpr_trdp_nm# + '%'
			</isNotEmpty>
			<isNotEmpty property="f_cnee_trdp_nm">
			   AND  BKG.CNEE_TRDP_NM LIKE '%' + #f_cnee_trdp_nm# + '%'
			</isNotEmpty>
			<isNotEmpty property="f_ahpr_trdp_nm">
			   AND  BKG.ACT_SHPR_TRDP_NM LIKE '%' + #f_ahpr_trdp_nm# + '%'
			</isNotEmpty>
			<isNotEmpty property="f_ntfy_trdp_nm">
			   AND  BKG.NTFY_TRDP_NM LIKE '%' + #f_ntfy_trdp_nm# + '%'
			</isNotEmpty>
			<isNotEmpty property="f_ofc_cd">
			   AND  BKG.RGST_OFC_CD = #f_ofc_cd#
			</isNotEmpty>
			<isNotEmpty property="f_shp_mod_cd">
			   AND  BKG.SHP_MOD_CD = #f_shp_mod_cd#
			</isNotEmpty>
			<isNotEmpty property="f_trnk_vsl_nm">
			   AND  BKG.TRNK_VSL_NM LIKE '%' + #f_trnk_vsl_nm# + '%'
			</isNotEmpty>
			<isNotEmpty property="f_po_no">
			   AND  EXISTS (SELECT 1 
			   			    FROM  TB_BKG_PO BKGPO 
			   			    INNER JOIN TB_PO PO ON BKGPO.PO_SYS_NO = PO.PO_SYS_NO AND PO.DELT_FLG = 'N'
			   			    WHERE BKG.BKG_SEQ = BKGPO.BKG_SEQ 
			   			    AND   BKGPO.DELT_FLG = 'N' 
			   			    AND   PO.CUST_PO_NO LIKE '%' + #f_po_no# + '%')
			</isNotEmpty>
			<isNotEmpty property="f_lc_no">
			   AND  BKG.LC_NO = #f_lc_no#
			</isNotEmpty>
			<isNotEmpty property="f_lnr_bkg_no">
			   AND  BKG.LNR_BKG_NO = #f_lnr_bkg_no#
			</isNotEmpty>
			<isNotEmpty property="f_cust_ref_no">
			   AND  BKG.CUST_REF_NO LIKE '%' + #f_cust_ref_no# + '%'
			</isNotEmpty>
	</select>
	
	<select id="selectBkgNo" parameterClass="HashMap" resultClass="String">
		SELECT TOP 1 
		      ISNULL(BKG_NO, '') 
		      + '^^' + ISNULL(BKG_SEQ, '') 
		      + '^^' + ISNULL(BKG_DT_TM, '')
		      + '^^' + ISNULL(LC_NO, '') 
		      + '^^' + ISNULL(ACT_SHPR_TRDP_CD, '') 
		      + '^^' + ISNULL(ACT_SHPR_TRDP_NM, '') 
		      + '^^' + ISNULL(SHPR_TRDP_CD, '') 
		      + '^^' + ISNULL(SHPR_TRDP_NM, '') 
		      + '^^' + ISNULL(SHPR_TRDP_ADDR, '') 
		      + '^^' + ISNULL(CNEE_TRDP_CD, '') 
		      + '^^' + ISNULL(CNEE_TRDP_NM, '') 
		      + '^^' + ISNULL(CNEE_TRDP_ADDR, '') 
		      + '^^' + ISNULL(NTFY_TRDP_CD, '') 
		      + '^^' + ISNULL(NTFY_TRDP_NM, '') 
		      + '^^' + ISNULL(NTFY_TRDP_ADDR, '') 
		      + '^^' + ISNULL(EXP_REF_NO, '')
		      + '^^' + ISNULL(CGO_PU_TRDP_CD, '') 
		      + '^^' + ISNULL(CGO_PU_TRDP_NM, '') 
		      + '^^' + ISNULL(CGO_PU_TRDP_ADDR, '') 
		      + '^^' + ISNULL(TRK_TRDP_CD, '') 
		      + '^^' + ISNULL(TRK_TRDP_NM, '') 
		      + '^^' + ISNULL(CUST_REF_NO, '') 
		      + '^^' + ISNULL(CNTR_INFO, '') 
		      + '^^' + ISNULL(POR_CD, '') 
		      + '^^' + ISNULL(POR_NM, '') 
		      + '^^' + ISNULL(DEL_CD, '') 
		      + '^^' + ISNULL(DEL_NM, '') 
		      + '^^' + ISNULL(FNL_DEST_LOC_CD, '') 
		      + '^^' + ISNULL(FNL_DEST_LOC_NM, '') 
		      + '^^' + ISNULL(ETD_POR_TM, '')
		      + '^^' + ISNULL(SHP_MOD_CD, '') 
		      + '^^' + ISNULL(REP_CMDT_CD, '') 
		      + '^^' + ISNULL(REP_CMDT_NM, '') 
		      + '^^' + ISNULL(convert(varchar,PCK_QTY), '') 
		      + '^^' + ISNULL(PCK_UT_CD, '') 
		      + '^^' + ISNULL(GRS_WGT_UT_CD, '') 
		      + '^^' + ISNULL(convert(varchar,GRS_WGT), '') 
		      + '^^' + ISNULL(convert(varchar,GRS_WGT1), '') 
		      + '^^' + ISNULL(convert(varchar,MEAS), '') 
		      + '^^' + ISNULL(convert(varchar,MEAS1), '') 
		      + '^^' + ISNULL(FM_SVC_TERM_CD, '') 
		      + '^^' + ISNULL(TO_SVC_TERM_CD, '') 
		      + '^^' + ISNULL(CARGO_TP_CD, '') 
		      + '^^' + ISNULL(SUBSTRING(WH_CUT_OFF_DT,1,8), '')
		      + '^^' + ISNULL(SUBSTRING(WH_CUT_OFF_DT,9,12), '')
		      + '^^' + ISNULL(SLS_OFC_CD, '') 
		      + '^^' + ISNULL(SLS_DEPT_CD, '') 
		      + '^^' + ISNULL(SLS_USRID, '') 
		      + '^^' + ISNULL(SLS_USR_NM, '')  
		  FROM TB_BKG 
		 WHERE BKG_NO = #f_bkg_no#
		   AND DELT_FLG = 'N'
    </select>
    
    
    <!--HBL Entry에서 Booking저장시 매핑  -->
    <update id="updateHBL_BKG_NO" parameterClass="HBLInfoVO">
    	UPDATE  tb_bkg
    	   SET  intg_bl_seq = ''
    	 WHERE  bkg_seq in (select bkg_seq from tb_bkg where intg_bl_seq = #intg_bl_seq# and delt_flg = 'N')
    	   AND  delt_flg = 'N';
    
        UPDATE  tb_bkg
           SET  intg_bl_seq = #intg_bl_seq#
               ,modi_tms 	= GETUTCDATE()
         WHERE  bkg_no		= #bkg_no#
           AND  bkg_seq		= #bkg_seq#;
    </update>


    <!-- ZOOT-실적처리 실시간 처리 START --> 
    <!-- BL VOL 실적 처리 프로시저 -->
	<procedure id="blVolProcess" parameterClass="HashMap">
		 { CALL SP_BL_VOL(#intg_bl_seq#, #iud_flag#, #cmd#) } 
	</procedure>
	<!-- BL VOL 실적 처리 프로시저 -->
	<procedure id="blPrfProcess" parameterClass="HashMap">
		 { CALL SP_BL_PRF(#intg_bl_seq#, #iud_flag#, #cmd#) } 
	</procedure>	
	<!-- BL SUB_MBL_FLG에 따른  실적 처리 체크 쿼리  -->
	<select id="selectCheckSubMblFlag" parameterClass="java.util.HashMap" resultClass="HashMap">
    /* BlCmmSQL.xml > selectCheckSubMblFlag */
        SELECT ISNULL(MAX(INV_SEQ),'') AS INV_SEQ, ISNULL(MAX(SUB_MBL_FLG),'') AS SUB_MBL_FLG
			FROM(
				SELECT ISNULL(MAX(INV_SEQ),'') AS INV_SEQ , '' AS SUB_MBL_FLG
						  FROM TB_FRT FRT 
						 WHERE FRT.DELT_FLG  = 'N'
						   AND ISNULL(FRT.OTH_SEQ, '') = ''						   
						<![CDATA[ 
						   AND ISNULL(FRT.AIR_SEA_CLSS_CD,'')<>'G'							   
						]]>    
						   AND ((FRT.INTG_BL_SEQ = #intg_bl_seq# AND FRT.INTG_BL_SEQ_2 IS NOT NULL) 
						    	 OR (FRT.INTG_BL_SEQ = #intg_bl_seq# AND FRT.INTG_BL_SEQ_2 IS NULL))
				UNION ALL
				SELECT '' AS INV_SEQ, ISNULL(MAX(SUB_MBL_FLG),'') AS SUB_MBL_FLG
						  FROM TB_INTG_BL
						 WHERE INTG_BL_SEQ = #intg_bl_seq#
			) A 					 		 	
    </select>
    <!-- ZOOT-실적처리 실시간 처리 END --> 
    
    <!-- HB/L 생성시 MBL 에 Invoice 가 있는 경우 실시간 실적 처리 체크  -->
	<select id="selectMblInvoice" parameterClass="java.util.HashMap" resultClass="HashMap">
    /* BlCmmSQL.xml > selectMblInvoice */
        SELECT ISNULL(MAX(INV_SEQ),'') AS INV_SEQ
		  FROM TB_FRT FRT, TB_INTG_BL_RLT RLT 
		 WHERE FRT.DELT_FLG  = 'N'
		   AND RLT.DELT_FLG  = 'N'
		   AND FRT.INTG_BL_SEQ = RLT.RLT_INTG_BL_SEQ
		   AND RLT.INTG_BL_SEQ = #intg_bl_seq# 					 		 	
    </select>
    <!-- ZOOT-실적처리 실시간 처리 END --> 
    
        <!-- HB/L UPDATE 시에 FILE 에 Invoice 가 있는 경우 실시간 실적 처리 체크  -->
	<select id="selectFileInvoice" parameterClass="java.util.HashMap" resultClass="HashMap">
    /* BlCmmSQL.xml > selectFileInvoice */
        SELECT ISNULL(MAX(INV_SEQ),'') AS INV_SEQ
		  FROM (
				SELECT ISNULL(MAX(INV_SEQ),'') AS INV_SEQ
						  FROM TB_FRT FRT, TB_INTG_BL_RLT RLT 
						 WHERE FRT.DELT_FLG  = 'N'
						   AND RLT.DELT_FLG  = 'N'
						   AND FRT.INTG_BL_SEQ = RLT.RLT_INTG_BL_SEQ
						   AND RLT.RLT_INTG_BL_SEQ = #rlt_intg_bl_seq# 		
				UNION 		   
						   
				SELECT ISNULL(INV_SEQ,'') AS INV_SEQ
						  FROM TB_FRT FRT, TB_INTG_BL_RLT RLT 
						 WHERE FRT.DELT_FLG  = 'N'
						   AND RLT.DELT_FLG  = 'N'
						   AND ((FRT.INTG_BL_SEQ = RLT.INTG_BL_SEQ AND FRT.INTG_BL_SEQ_2 IS NOT NULL) 
						    	 OR (FRT.INTG_BL_SEQ = RLT.INTG_BL_SEQ AND FRT.INTG_BL_SEQ_2 IS NULL))
						   AND RLT.RLT_INTG_BL_SEQ = #rlt_intg_bl_seq# 
				) A						 		 	
    </select>
    <!-- ZOOT-실적처리 실시간 처리 END --> 
    
     <!-- BL 정보 확인을 위한 Query  -->
	<select id="selectOrgBlInfo" parameterClass="String" resultClass="HashMap">
    /* BlCmmSQL.xml > selectOrgBlInfo */
        SELECT ISNULL(RLT_INTG_BL_SEQ,'') AS ORG_RLT_INTG_BL_SEQ
		  FROM TB_INTG_BL BL, TB_INTG_BL_RLT RLT 
		 WHERE BL.DELT_FLG  = 'N'
		   AND RLT.DELT_FLG  = 'N'
		   AND BL.INTG_BL_SEQ = RLT.INTG_BL_SEQ
		   AND BL.INTG_BL_SEQ = #intg_bl_seq# 				 		 	
    </select>
    <!-- ZOOT-실적처리 실시간 처리 END -->
    
    
    <!-- ZOOT-AR/AP/DC CHK 실시간 처리 START -->
    <!-- BL AR/AP/DC CHK  -->
    <update id="updateBlArApDcStatus" parameterClass="HashMap">
    /* BlCmmSQL.xml > updateBlArApDcStatus */
        ;WITH BLINFO AS (
			SELECT A.* FROM TB_INTG_BL A WHERE EXISTS (SELECT INTG_BL_SEQ FROM tb_frt B WHERE B.INTG_BL_SEQ = A.INTG_BL_SEQ AND INV_SEQ = #inv_seq# )
		), INVINFO AS(
			SELECT T1.INTG_BL_SEQ,
			<![CDATA[ 
				CASE 
					 WHEN Isnull(inv_sum.ar_cnt, 0) = 0 THEN 'X' 
					 WHEN inv_sum.ar_bal_amt = 0 THEN 'Y' 
					 WHEN inv_sum.ar_inv_sum_amt = inv_sum.ar_bal_amt THEN 'N' 
					 WHEN inv_sum.ar_bal_amt < 0 THEN 'O' 
					 ELSE 'P' 
				   END AS AR_CHK, 
				   CASE 
					 WHEN Isnull(inv_sum.ap_cnt, 0) = 0 THEN 'X' 
					 WHEN inv_sum.ap_bal_amt = 0 THEN 'Y' 
					 WHEN inv_sum.ap_inv_sum_amt = inv_sum.ap_bal_amt THEN 'N' 
					 WHEN inv_sum.ap_bal_amt < 0 THEN 'O' 
					 ELSE 'P' 
				   END AS AP_CHK, 
				   CASE 
					 WHEN Isnull(inv_sum.dc_cnt, 0) = 0 THEN 'X' 
					 WHEN inv_sum.dc_bal_amt = 0 THEN 'Y' 
					 WHEN inv_sum.dc_inv_sum_amt = inv_sum.dc_bal_amt THEN 'N' 
					 WHEN inv_sum.dc_bal_amt < 0 THEN 'O' 
					 ELSE 'P' 
				   END AS DC_CHK  
			]]>    
			FROM (	BLINFO AS T1
				LEFT OUTER JOIN (			
					SELECT frt.intg_bl_seq, 
								SUM(CASE 
										WHEN frt.sell_buy_tp_cd = 'S' THEN 1 
										ELSE 0 
									END) AS ar_cnt, 
								SUM(CASE 
										WHEN frt.sell_buy_tp_cd = 'S' THEN 
										dtl.inv_sum_amt 
										ELSE 0 
									END) AS ar_inv_sum_amt, 
								SUM(CASE 
										WHEN frt.sell_buy_tp_cd = 'S' THEN 
										dtl.bal_amt 
										ELSE 0 
									END) AS ar_bal_amt, 
								SUM(CASE 
										WHEN frt.sell_buy_tp_cd = 'B' THEN 1 
										ELSE 0 
									END) AS ap_cnt, 
								SUM(CASE 
										WHEN frt.sell_buy_tp_cd = 'B' THEN 
										dtl.inv_sum_amt 
										ELSE 0 
									END) AS ap_inv_sum_amt, 
								SUM(CASE 
										WHEN frt.sell_buy_tp_cd = 'B' THEN 
										dtl.bal_amt 
										ELSE 0 
									END) AS ap_bal_amt, 
								SUM(CASE 
										WHEN frt.sell_buy_tp_cd = 'D' 
											OR frt.sell_buy_tp_cd = 'C' THEN 1 
										ELSE 0 
									END) AS dc_cnt, 
								SUM(CASE 
										WHEN frt.sell_buy_tp_cd = 'D' 
											OR frt.sell_buy_tp_cd = 'C' THEN 
										dtl.inv_sum_amt 
										ELSE 0 
									END) AS dc_inv_sum_amt, 
								SUM(CASE 
										WHEN frt.sell_buy_tp_cd = 'D' 
											OR frt.sell_buy_tp_cd = 'C' THEN 
										dtl.bal_amt 
										ELSE 0 
									END) AS dc_bal_amt 
						FROM   tb_frt frt WITH(nolock) 
								JOIN tb_inv_dtl dtl WITH(INDEX(xif1tb_inv_dtl), nolock) 
									ON dtl.delt_flg = 'N' 
									AND frt.inv_seq = dtl.inv_seq 
						WHERE  frt.delt_flg = 'N' 
							and     frt.INTG_BL_SEQ  IN (SELECT INTG_BL_SEQ FROM tb_frt WHERE INV_SEQ = #inv_seq# ) 
						GROUP  BY frt.intg_bl_seq
					) inv_sum
					ON T1.intg_bl_seq = inv_sum.intg_bl_seq 
			) 
		)
		UPDATE A SET AR_CHK = B.AR_CHK,AP_CHK = B.AP_CHK,DC_CHK = B.DC_CHK
		,FRT_CHK = (CASE WHEN (SELECT <!-- 50599 [BNX] FREIGHT INPUT STATUS인것들 확인 방법   -->
				                COUNT(1) 
				            FROM
				                TB_FRT FRT                            
				            WHERE
				                FRT.INTG_BL_SEQ      = B.INTG_BL_SEQ	 		 	                 
				                AND FRT.INV_STS_CD  = 'FI'                      
				                AND FRT.DELT_FLG = 'N'                    ) 	<![CDATA[ > ]]> 0 THEN 'O'
				                ELSE 'X' END) 
		FROM TB_ADD_INFO_BND AS A, INVINFO AS B
		WHERE A.INTG_BL_SEQ = B.INTG_BL_SEQ	 		 	
    </update>
    <!-- BL AR/AP/DC CHK  -->
    <update id="updateOthArApDcStatus" parameterClass="HashMap">
    /* BlCmmSQL.xml > updateOthArApDcStatus */
        ;WITH OTHINFO AS (
			SELECT A.* FROM TB_OTH_SALES A WHERE EXISTS (SELECT oth_seq FROM tb_frt B WHERE B.oth_seq = A.oth_seq AND INV_SEQ = #inv_seq# )
		), INVINFO AS(
			SELECT T1.oth_seq,
			<![CDATA[ 
				CASE 
					 WHEN Isnull(inv_sum.ar_cnt, 0) = 0 THEN 'X' 
					 WHEN inv_sum.ar_bal_amt = 0 THEN 'Y' 
					 WHEN inv_sum.ar_inv_sum_amt = inv_sum.ar_bal_amt THEN 'N' 
					 WHEN inv_sum.ar_bal_amt < 0 THEN 'O' 
					 ELSE 'P' 
				   END AS AR_CHK, 
				   CASE 
					 WHEN Isnull(inv_sum.ap_cnt, 0) = 0 THEN 'X' 
					 WHEN inv_sum.ap_bal_amt = 0 THEN 'Y' 
					 WHEN inv_sum.ap_inv_sum_amt = inv_sum.ap_bal_amt THEN 'N' 
					 WHEN inv_sum.ap_bal_amt < 0 THEN 'O' 
					 ELSE 'P' 
				   END AS AP_CHK, 
				   CASE 
					 WHEN Isnull(inv_sum.dc_cnt, 0) = 0 THEN 'X' 
					 WHEN inv_sum.dc_bal_amt = 0 THEN 'Y' 
					 WHEN inv_sum.dc_inv_sum_amt = inv_sum.dc_bal_amt THEN 'N' 
					 WHEN inv_sum.dc_bal_amt < 0 THEN 'O' 
					 ELSE 'P' 
				   END AS DC_CHK  
			]]>    
			FROM (	OTHINFO AS T1
				LEFT OUTER JOIN (			
					SELECT frt.oth_seq, 
								SUM(CASE 
										WHEN frt.sell_buy_tp_cd = 'S' THEN 1 
										ELSE 0 
									END) AS ar_cnt, 
								SUM(CASE 
										WHEN frt.sell_buy_tp_cd = 'S' THEN 
										dtl.inv_sum_amt 
										ELSE 0 
									END) AS ar_inv_sum_amt, 
								SUM(CASE 
										WHEN frt.sell_buy_tp_cd = 'S' THEN 
										dtl.bal_amt 
										ELSE 0 
									END) AS ar_bal_amt, 
								SUM(CASE 
										WHEN frt.sell_buy_tp_cd = 'B' THEN 1 
										ELSE 0 
									END) AS ap_cnt, 
								SUM(CASE 
										WHEN frt.sell_buy_tp_cd = 'B' THEN 
										dtl.inv_sum_amt 
										ELSE 0 
									END) AS ap_inv_sum_amt, 
								SUM(CASE 
										WHEN frt.sell_buy_tp_cd = 'B' THEN 
										dtl.bal_amt 
										ELSE 0 
									END) AS ap_bal_amt, 
								SUM(CASE 
										WHEN frt.sell_buy_tp_cd = 'D' 
											OR frt.sell_buy_tp_cd = 'C' THEN 1 
										ELSE 0 
									END) AS dc_cnt, 
								SUM(CASE 
										WHEN frt.sell_buy_tp_cd = 'D' 
											OR frt.sell_buy_tp_cd = 'C' THEN 
										dtl.inv_sum_amt 
										ELSE 0 
									END) AS dc_inv_sum_amt, 
								SUM(CASE 
										WHEN frt.sell_buy_tp_cd = 'D' 
											OR frt.sell_buy_tp_cd = 'C' THEN 
										dtl.bal_amt 
										ELSE 0 
									END) AS dc_bal_amt 
						FROM   tb_frt frt WITH(nolock) 
								JOIN tb_inv_dtl dtl WITH(INDEX(xif1tb_inv_dtl), nolock) 
									ON dtl.delt_flg = 'N' 
									AND frt.inv_seq = dtl.inv_seq 
						WHERE  frt.delt_flg = 'N' 
							and     frt.oth_seq  IN (SELECT oth_seq FROM tb_frt WHERE INV_SEQ = #inv_seq# ) 
						GROUP  BY frt.oth_seq
					) inv_sum
					ON T1.oth_seq = inv_sum.oth_seq 
			) 
		)UPDATE A SET AR_CHK = B.AR_CHK,AP_CHK = B.AP_CHK,DC_CHK = B.DC_CHK
		FROM TB_OTH_SALES AS A, INVINFO AS B
		WHERE A.OTH_SEQ = B.OTH_SEQ	 	
    </update> 
    <!-- ZOOT-AR/AP/DC CHK 실시간 처리 END -->   
    
    <!-- WMS ACCOUNT LKH 2015.01.20 -->
    <update id="updateWmsArApDcStatus" parameterClass="HashMap">
    /* BlCmmSQL.xml > updateWmsArApDcStatus */
        ;WITH OTHINFO AS (
			SELECT A.* FROM TB_WM_DOC_MST A WHERE EXISTS (SELECT wms_seq FROM tb_frt B WHERE B.wms_seq = A.wm_doc_seq AND INV_SEQ = #inv_seq# )
		), INVINFO AS(
			SELECT T1.WM_DOC_SEQ,
			<![CDATA[ 
				CASE 
					 WHEN Isnull(inv_sum.ar_cnt, 0) = 0 THEN 'X' 
					 WHEN inv_sum.ar_bal_amt = 0 THEN 'Y' 
					 WHEN inv_sum.ar_inv_sum_amt = inv_sum.ar_bal_amt THEN 'N' 
					 WHEN inv_sum.ar_bal_amt < 0 THEN 'O' 
					 ELSE 'P' 
				   END AS AR_CHK, 
				   CASE 
					 WHEN Isnull(inv_sum.ap_cnt, 0) = 0 THEN 'X' 
					 WHEN inv_sum.ap_bal_amt = 0 THEN 'Y' 
					 WHEN inv_sum.ap_inv_sum_amt = inv_sum.ap_bal_amt THEN 'N' 
					 WHEN inv_sum.ap_bal_amt < 0 THEN 'O' 
					 ELSE 'P' 
				   END AS AP_CHK, 
				   CASE 
					 WHEN Isnull(inv_sum.dc_cnt, 0) = 0 THEN 'X' 
					 WHEN inv_sum.dc_bal_amt = 0 THEN 'Y' 
					 WHEN inv_sum.dc_inv_sum_amt = inv_sum.dc_bal_amt THEN 'N' 
					 WHEN inv_sum.dc_bal_amt < 0 THEN 'O' 
					 ELSE 'P' 
				   END AS DC_CHK  
			]]>    
			FROM (	OTHINFO AS T1
				LEFT OUTER JOIN (			
					SELECT frt.wms_seq, 
								SUM(CASE 
										WHEN frt.sell_buy_tp_cd = 'S' THEN 1 
										ELSE 0 
									END) AS ar_cnt, 
								SUM(CASE 
										WHEN frt.sell_buy_tp_cd = 'S' THEN 
										dtl.inv_sum_amt 
										ELSE 0 
									END) AS ar_inv_sum_amt, 
								SUM(CASE 
										WHEN frt.sell_buy_tp_cd = 'S' THEN 
										dtl.bal_amt 
										ELSE 0 
									END) AS ar_bal_amt, 
								SUM(CASE 
										WHEN frt.sell_buy_tp_cd = 'B' THEN 1 
										ELSE 0 
									END) AS ap_cnt, 
								SUM(CASE 
										WHEN frt.sell_buy_tp_cd = 'B' THEN 
										dtl.inv_sum_amt 
										ELSE 0 
									END) AS ap_inv_sum_amt, 
								SUM(CASE 
										WHEN frt.sell_buy_tp_cd = 'B' THEN 
										dtl.bal_amt 
										ELSE 0 
									END) AS ap_bal_amt, 
								SUM(CASE 
										WHEN frt.sell_buy_tp_cd = 'D' 
											OR frt.sell_buy_tp_cd = 'C' THEN 1 
										ELSE 0 
									END) AS dc_cnt, 
								SUM(CASE 
										WHEN frt.sell_buy_tp_cd = 'D' 
											OR frt.sell_buy_tp_cd = 'C' THEN 
										dtl.inv_sum_amt 
										ELSE 0 
									END) AS dc_inv_sum_amt, 
								SUM(CASE 
										WHEN frt.sell_buy_tp_cd = 'D' 
											OR frt.sell_buy_tp_cd = 'C' THEN 
										dtl.bal_amt 
										ELSE 0 
									END) AS dc_bal_amt 
						FROM   tb_frt frt WITH(nolock) 
								JOIN tb_inv_dtl dtl WITH(INDEX(xif1tb_inv_dtl), nolock) 
									ON dtl.delt_flg = 'N' 
									AND frt.inv_seq = dtl.inv_seq 
						WHERE  frt.delt_flg = 'N' 
							and     frt.wms_seq  IN (SELECT wms_seq FROM tb_frt WHERE INV_SEQ = #inv_seq# ) 
						GROUP  BY frt.wms_seq
					) inv_sum
					ON T1.WM_DOC_SEQ = inv_sum.wms_seq 
			) 
		)UPDATE A SET AR_CHK = B.AR_CHK,AP_CHK = B.AP_CHK,DC_CHK = B.DC_CHK
		FROM TB_WM_DOC_MST AS A, INVINFO AS B
		WHERE A.WM_DOC_SEQ = B.WM_DOC_SEQ	 	
    </update> 
    
    <!-- ZOOT-AR/AP/DC CHK 실시간 처리 START -->
    <!-- BL AR/AP/DC CHK  -->
    <update id="updateBlArApDcStatusForDelete" parameterClass="HashMap">
    /* BlCmmSQL.xml > updateBlArApDcStatusForDelete */
        ;WITH BLINFO AS (
			SELECT A.* FROM TB_INTG_BL A WHERE A.INTG_BL_SEQ = #intg_bl_seq#
		), INVINFO AS(
			SELECT T1.INTG_BL_SEQ,
			<![CDATA[ 
				CASE 
					 WHEN Isnull(inv_sum.ar_cnt, 0) = 0 THEN 'X' 
					 WHEN inv_sum.ar_bal_amt = 0 THEN 'Y' 
					 WHEN inv_sum.ar_inv_sum_amt = inv_sum.ar_bal_amt THEN 'N' 
					 WHEN inv_sum.ar_bal_amt < 0 THEN 'O' 
					 ELSE 'P' 
				   END AS AR_CHK, 
				   CASE 
					 WHEN Isnull(inv_sum.ap_cnt, 0) = 0 THEN 'X' 
					 WHEN inv_sum.ap_bal_amt = 0 THEN 'Y' 
					 WHEN inv_sum.ap_inv_sum_amt = inv_sum.ap_bal_amt THEN 'N' 
					 WHEN inv_sum.ap_bal_amt < 0 THEN 'O' 
					 ELSE 'P' 
				   END AS AP_CHK, 
				   CASE 
					 WHEN Isnull(inv_sum.dc_cnt, 0) = 0 THEN 'X' 
					 WHEN inv_sum.dc_bal_amt = 0 THEN 'Y' 
					 WHEN inv_sum.dc_inv_sum_amt = inv_sum.dc_bal_amt THEN 'N' 
					 WHEN inv_sum.dc_bal_amt < 0 THEN 'O' 
					 ELSE 'P' 
				   END AS DC_CHK  
			]]>    
			FROM (	BLINFO AS T1
				LEFT OUTER JOIN (			
					SELECT frt.intg_bl_seq, 
								SUM(CASE 
										WHEN frt.sell_buy_tp_cd = 'S' THEN 1 
										ELSE 0 
									END) AS ar_cnt, 
								SUM(CASE 
										WHEN frt.sell_buy_tp_cd = 'S' THEN 
										dtl.inv_sum_amt 
										ELSE 0 
									END) AS ar_inv_sum_amt, 
								SUM(CASE 
										WHEN frt.sell_buy_tp_cd = 'S' THEN 
										dtl.bal_amt 
										ELSE 0 
									END) AS ar_bal_amt, 
								SUM(CASE 
										WHEN frt.sell_buy_tp_cd = 'B' THEN 1 
										ELSE 0 
									END) AS ap_cnt, 
								SUM(CASE 
										WHEN frt.sell_buy_tp_cd = 'B' THEN 
										dtl.inv_sum_amt 
										ELSE 0 
									END) AS ap_inv_sum_amt, 
								SUM(CASE 
										WHEN frt.sell_buy_tp_cd = 'B' THEN 
										dtl.bal_amt 
										ELSE 0 
									END) AS ap_bal_amt, 
								SUM(CASE 
										WHEN frt.sell_buy_tp_cd = 'D' 
											OR frt.sell_buy_tp_cd = 'C' THEN 1 
										ELSE 0 
									END) AS dc_cnt, 
								SUM(CASE 
										WHEN frt.sell_buy_tp_cd = 'D' 
											OR frt.sell_buy_tp_cd = 'C' THEN 
										dtl.inv_sum_amt 
										ELSE 0 
									END) AS dc_inv_sum_amt, 
								SUM(CASE 
										WHEN frt.sell_buy_tp_cd = 'D' 
											OR frt.sell_buy_tp_cd = 'C' THEN 
										dtl.bal_amt 
										ELSE 0 
									END) AS dc_bal_amt 
						FROM   tb_frt frt WITH(nolock) 
								JOIN tb_inv_dtl dtl WITH(INDEX(xif1tb_inv_dtl), nolock) 
									ON dtl.delt_flg = 'N' 
									AND frt.inv_seq = dtl.inv_seq 
						WHERE  frt.delt_flg = 'N' 
							and     frt.INTG_BL_SEQ = #intg_bl_seq#
						GROUP  BY frt.intg_bl_seq
					) inv_sum
					ON T1.intg_bl_seq = inv_sum.intg_bl_seq 
			) 
		)
		UPDATE A SET AR_CHK = B.AR_CHK,AP_CHK = B.AP_CHK,DC_CHK = B.DC_CHK
		,FRT_CHK = (CASE WHEN (SELECT			<!-- 50599 [BNX] FREIGHT INPUT STATUS인것들 확인 방법   -->
				                COUNT(1) 
				            FROM
				                TB_FRT FRT                            
				            WHERE
				                FRT.INTG_BL_SEQ      = B.INTG_BL_SEQ	 		 	                 
				                AND FRT.INV_STS_CD  = 'FI'                      
				                AND FRT.DELT_FLG = 'N'                    ) 	<![CDATA[ > ]]> 0 THEN 'O'
				                ELSE 'X' END) 
		FROM TB_ADD_INFO_BND AS A, INVINFO AS B
		WHERE A.INTG_BL_SEQ = B.INTG_BL_SEQ	 		 	
    </update>
    <!-- BL AR/AP/DC CHK  -->
    <update id="updateOthArApDcStatusForDelete" parameterClass="HashMap">
    /* BlCmmSQL.xml > updateOthArApDcStatusForDelete */
        ;WITH OTHINFO AS (
			SELECT A.* FROM TB_OTH_SALES A WHERE A.oth_seq = #intg_bl_seq#
		), INVINFO AS(
			SELECT T1.oth_seq,
			<![CDATA[ 
				CASE 
					 WHEN Isnull(inv_sum.ar_cnt, 0) = 0 THEN 'X' 
					 WHEN inv_sum.ar_bal_amt = 0 THEN 'Y' 
					 WHEN inv_sum.ar_inv_sum_amt = inv_sum.ar_bal_amt THEN 'N' 
					 WHEN inv_sum.ar_bal_amt < 0 THEN 'O' 
					 ELSE 'P' 
				   END AS AR_CHK, 
				   CASE 
					 WHEN Isnull(inv_sum.ap_cnt, 0) = 0 THEN 'X' 
					 WHEN inv_sum.ap_bal_amt = 0 THEN 'Y' 
					 WHEN inv_sum.ap_inv_sum_amt = inv_sum.ap_bal_amt THEN 'N' 
					 WHEN inv_sum.ap_bal_amt < 0 THEN 'O' 
					 ELSE 'P' 
				   END AS AP_CHK, 
				   CASE 
					 WHEN Isnull(inv_sum.dc_cnt, 0) = 0 THEN 'X' 
					 WHEN inv_sum.dc_bal_amt = 0 THEN 'Y' 
					 WHEN inv_sum.dc_inv_sum_amt = inv_sum.dc_bal_amt THEN 'N' 
					 WHEN inv_sum.dc_bal_amt < 0 THEN 'O' 
					 ELSE 'P' 
				   END AS DC_CHK  
			]]>    
			FROM (	OTHINFO AS T1
				LEFT OUTER JOIN (			
					SELECT frt.oth_seq, 
								SUM(CASE 
										WHEN frt.sell_buy_tp_cd = 'S' THEN 1 
										ELSE 0 
									END) AS ar_cnt, 
								SUM(CASE 
										WHEN frt.sell_buy_tp_cd = 'S' THEN 
										dtl.inv_sum_amt 
										ELSE 0 
									END) AS ar_inv_sum_amt, 
								SUM(CASE 
										WHEN frt.sell_buy_tp_cd = 'S' THEN 
										dtl.bal_amt 
										ELSE 0 
									END) AS ar_bal_amt, 
								SUM(CASE 
										WHEN frt.sell_buy_tp_cd = 'B' THEN 1 
										ELSE 0 
									END) AS ap_cnt, 
								SUM(CASE 
										WHEN frt.sell_buy_tp_cd = 'B' THEN 
										dtl.inv_sum_amt 
										ELSE 0 
									END) AS ap_inv_sum_amt, 
								SUM(CASE 
										WHEN frt.sell_buy_tp_cd = 'B' THEN 
										dtl.bal_amt 
										ELSE 0 
									END) AS ap_bal_amt, 
								SUM(CASE 
										WHEN frt.sell_buy_tp_cd = 'D' 
											OR frt.sell_buy_tp_cd = 'C' THEN 1 
										ELSE 0 
									END) AS dc_cnt, 
								SUM(CASE 
										WHEN frt.sell_buy_tp_cd = 'D' 
											OR frt.sell_buy_tp_cd = 'C' THEN 
										dtl.inv_sum_amt 
										ELSE 0 
									END) AS dc_inv_sum_amt, 
								SUM(CASE 
										WHEN frt.sell_buy_tp_cd = 'D' 
											OR frt.sell_buy_tp_cd = 'C' THEN 
										dtl.bal_amt 
										ELSE 0 
									END) AS dc_bal_amt 
						FROM   tb_frt frt WITH(nolock) 
								JOIN tb_inv_dtl dtl WITH(INDEX(xif1tb_inv_dtl), nolock) 
									ON dtl.delt_flg = 'N' 
									AND frt.inv_seq = dtl.inv_seq 
						WHERE  frt.delt_flg = 'N' 
							and     frt.oth_seq = #intg_bl_seq#
						GROUP  BY frt.oth_seq
					) inv_sum
					ON T1.oth_seq = inv_sum.oth_seq 
			) 
		)UPDATE A SET AR_CHK = B.AR_CHK,AP_CHK = B.AP_CHK,DC_CHK = B.DC_CHK
		FROM TB_OTH_SALES AS A, INVINFO AS B
		WHERE A.OTH_SEQ = B.OTH_SEQ	 	
    </update> 
    <!-- ZOOT-AR/AP/DC CHK 실시간 처리 END -->   
    <!-- WMS ACCOUNT LKH 2015.01.20 -->
    <update id="updateWmsArApDcStatusForDelete" parameterClass="HashMap">
    /* BlCmmSQL.xml > updateWmsArApDcStatusForDelete */
        ;WITH OTHINFO AS (
			SELECT A.* FROM TB_WM_DOC_MST A WHERE A.wm_doc_seq = #intg_bl_seq#
		), INVINFO AS(
			SELECT T1.WM_DOC_SEQ,
			<![CDATA[ 
				CASE 
					 WHEN Isnull(inv_sum.ar_cnt, 0) = 0 THEN 'X' 
					 WHEN inv_sum.ar_bal_amt = 0 THEN 'Y' 
					 WHEN inv_sum.ar_inv_sum_amt = inv_sum.ar_bal_amt THEN 'N' 
					 WHEN inv_sum.ar_bal_amt < 0 THEN 'O' 
					 ELSE 'P' 
				   END AS AR_CHK, 
				   CASE 
					 WHEN Isnull(inv_sum.ap_cnt, 0) = 0 THEN 'X' 
					 WHEN inv_sum.ap_bal_amt = 0 THEN 'Y' 
					 WHEN inv_sum.ap_inv_sum_amt = inv_sum.ap_bal_amt THEN 'N' 
					 WHEN inv_sum.ap_bal_amt < 0 THEN 'O' 
					 ELSE 'P' 
				   END AS AP_CHK, 
				   CASE 
					 WHEN Isnull(inv_sum.dc_cnt, 0) = 0 THEN 'X' 
					 WHEN inv_sum.dc_bal_amt = 0 THEN 'Y' 
					 WHEN inv_sum.dc_inv_sum_amt = inv_sum.dc_bal_amt THEN 'N' 
					 WHEN inv_sum.dc_bal_amt < 0 THEN 'O' 
					 ELSE 'P' 
				   END AS DC_CHK  
			]]>    
			FROM (	OTHINFO AS T1
				LEFT OUTER JOIN (			
					SELECT frt.wms_seq, 
								SUM(CASE 
										WHEN frt.sell_buy_tp_cd = 'S' THEN 1 
										ELSE 0 
									END) AS ar_cnt, 
								SUM(CASE 
										WHEN frt.sell_buy_tp_cd = 'S' THEN 
										dtl.inv_sum_amt 
										ELSE 0 
									END) AS ar_inv_sum_amt, 
								SUM(CASE 
										WHEN frt.sell_buy_tp_cd = 'S' THEN 
										dtl.bal_amt 
										ELSE 0 
									END) AS ar_bal_amt, 
								SUM(CASE 
										WHEN frt.sell_buy_tp_cd = 'B' THEN 1 
										ELSE 0 
									END) AS ap_cnt, 
								SUM(CASE 
										WHEN frt.sell_buy_tp_cd = 'B' THEN 
										dtl.inv_sum_amt 
										ELSE 0 
									END) AS ap_inv_sum_amt, 
								SUM(CASE 
										WHEN frt.sell_buy_tp_cd = 'B' THEN 
										dtl.bal_amt 
										ELSE 0 
									END) AS ap_bal_amt, 
								SUM(CASE 
										WHEN frt.sell_buy_tp_cd = 'D' 
											OR frt.sell_buy_tp_cd = 'C' THEN 1 
										ELSE 0 
									END) AS dc_cnt, 
								SUM(CASE 
										WHEN frt.sell_buy_tp_cd = 'D' 
											OR frt.sell_buy_tp_cd = 'C' THEN 
										dtl.inv_sum_amt 
										ELSE 0 
									END) AS dc_inv_sum_amt, 
								SUM(CASE 
										WHEN frt.sell_buy_tp_cd = 'D' 
											OR frt.sell_buy_tp_cd = 'C' THEN 
										dtl.bal_amt 
										ELSE 0 
									END) AS dc_bal_amt 
						FROM   tb_frt frt WITH(nolock) 
								JOIN tb_inv_dtl dtl WITH(INDEX(xif1tb_inv_dtl), nolock) 
									ON dtl.delt_flg = 'N' 
									AND frt.inv_seq = dtl.inv_seq 
						WHERE  frt.delt_flg = 'N' 
							and     frt.wms_seq = #intg_bl_seq#
						GROUP  BY frt.wms_seq
					) inv_sum
					ON T1.WM_DOC_SEQ = inv_sum.wms_seq 
			) 
		)UPDATE A SET AR_CHK = B.AR_CHK,AP_CHK = B.AP_CHK,DC_CHK = B.DC_CHK
		FROM TB_WM_DOC_MST AS A, INVINFO AS B
		WHERE A.WM_DOC_SEQ = B.WM_DOC_SEQ 	
    </update> 
    
    <!-- 중복 체크   -->
    <select id="selectHblSerialNoDuplCheck" parameterClass="HashMap" resultClass="Integer">
        SELECT  count(*)
          FROM  tb_add_info_bnd bnd
         WHERE  bnd.intg_bl_seq != #intg_bl_seq# 
           AND  bnd.delt_flg = 'N'
           AND  bnd.hbl_ser_no = #hbl_ser_no#
    </select>
    
      <select id="selectModifyHBL_LIST" parameterClass="java.util.HashMap" resultClass="HBLInfoVO">
		/* BlCmmSQL.xml > selectModifyHBL_LIST NEW IN/OUT */		
     	  		SELECT a1.*
				  FROM (
		         	SELECT  ROW_NUMBER() OVER (ORDER BY  BL.POST_DT DESC, BL.MODI_TMS DESC) as ROWNUM,
							BL.INTG_BL_SEQ, X.RLT_INTG_BL_SEQ, 
							BL.BL_NO AS HBL_NO, BL.REF_NO, BL.REF_OFC_CD, X.BL_NO AS MBL_NO,
							(SELECT UPPER(X.CNT_CD) FROM TB_OFC X WHERE X.OFC_CD = BL.REF_OFC_CD AND X.DELT_FLG = 'N') AS REF_OFC_CNT,
							BL.ETD_DT_TM, BL.ETA_DT_TM,
							BL.POR_CD, BL.POR_NM, 
							BL.POL_CD, BL.POL_NM, 
							BL.POD_CD, BL.POD_NM, 
							BL.DEL_CD, BL.DEL_NM,		
							PRNR.TRDP_CD AS PRNR_TRDP_CD, PRNR.TRDP_NM AS PRNR_TRDP_NM,
							SHPR.TRDP_CD AS SHPR_TRDP_CD, SHPR.TRDP_NM AS SHPR_TRDP_NM,
							CNEE.TRDP_CD AS CNEE_TRDP_CD, CNEE.TRDP_NM AS CNEE_TRDP_NM,
							ACT.TRDP_CD AS ACT_SHPR_TRDP_CD, ACT.TRDP_NM AS ACT_SHPR_TRDP_NM,
							LNR.TRDP_CD AS LNR_TRDP_CD, LNR.TRDP_NM AS LNR_TRDP_NM,
							NTFY.TRDP_CD AS NTFY_TRDP_CD, NTFY.TRDP_NM AS NTFY_TRDP_NM,
							TRK.TRDP_CD TRK_TRDP_CD, TRK.TRDP_NM TRK_TRDP_NM,
							CUST.TRDP_CD AS CUST_TRDP_CD, CUST.TRDP_NM AS CUST_TRDP_NM,
							VNDR.TRDP_CD VNDR_TRDP_CD, VNDR.TRDP_NM VNDR_TRDP_NM,
							BL.CFS_TRDP_CD, CFS.ENG_NM AS CFS_TRDP_NM,							
							BL.HBL_TP_CD, BL.SHP_MOD_CD, BL.INCO_CD, BL.RGST_USRID, BL.REP_CMDT_NM,
							BL.CUST_REF_NO, BL.LNR_BKG_NO, BL.EXP_REF_NO,
							(SELECT x.cnt_cd FROM TB_OFC x WHERE x.OFC_CD = bl.rgst_ofc_cd) AS BL_CNT, 
							(SELECT max(X.LOCL_USR_NM) FROM TB_USR X WHERE X.USR_TP = 'I' AND X.USRID = bnd.issued_by ) AS PROC_USRNM,
							BL.POST_DT, BL.TRNK_VSL_NM, BL.TRNK_VOY, BL.DOC_RECPT_NO, BL.IT_NO,							
							BL.PCK_QTY, BL.GRS_WGT, BL.GRS_WGT1, BL.MEAS,							
							BL.RLSD_FLG, BL.RLSD_DT_TM,
							CASE WHEN bl.EXPRESS_TP_CD ='Y' THEN 'YES' ELSE 'NO' END EXPRESS_TP_CD,
							BL.ORG_BL_RCVD_FLG, BL.RCVD_DT_TM,							
							(SELECT MAX(X.CNTR_NO) FROM TB_CNTR_LIST X WHERE X.INTG_BL_SEQ = BL.INTG_BL_SEQ AND X.DELT_FLG = 'N') AS CNTR_NO,
							ISNULL(DBO.FC_MK_MEMO_SCRIPT(BL.INTG_BL_SEQ), '') AS MEMO,
		  					CASE WHEN CHARINDEX(CHAR(13)+CHAR(10), BL.PO_NO) = 0 THEN BL.PO_NO
							ELSE SUBSTRING(BL.PO_NO, 1, CHARINDEX(CHAR(13)+CHAR(10), BL.PO_NO)-1) END AS PO_NO , 					
							BL.LC_NO, 
							BL.INV_NO,
							BL.AMS_ID,
							BL_STS_CD,
							BL.ISF_NO,
							BL.AMS_NO
		    				,BL.CCN_NO
							,BL.CCN_DT
							,BL.PRE_CCN_NO
							,BL.MNF_FR_LOC
							,BL.MNF_TO_LOC
							,ISNULL(bnd.AR_CHK,'X') AS AR_CHK
							,ISNULL(bnd.AP_CHK,'X') AS AP_CHK
							,ISNULL(bnd.DC_CHK,'X') AS DC_CHK
							,ISNULL(bnd.FRT_CHK,'X') AS FRT_CHK
					  FROM  TB_INTG_BL BL
					  <isEqual property="bnd_clss_cd" compareValue="O">
							with(index(IDX_ETD_DT_TM), nolock)
					  </isEqual>     
					  <isEqual property="bnd_clss_cd" compareValue="I">
							with(index(IDX_ETA_DT_TM), nolock)
					  </isEqual>  
					  JOIN  tb_add_info_bnd bnd
						ON  bl.intg_bl_seq = bnd.intg_bl_seq AND bnd.bnd_clss_cd = #bnd_clss_cd# AND bnd.delt_flg = 'N'
		   LEFT OUTER JOIN  tb_bl_prnr PRNR
						ON  bl.intg_bl_seq = prnr.intg_bl_seq  AND prnr.bl_trdp_tp_cd = 'P01' AND prnr.delt_flg = 'N'
		   LEFT OUTER JOIN  tb_bl_prnr SHPR
						ON  bl.intg_bl_seq = SHPR.intg_bl_seq  AND SHPR.bl_trdp_tp_cd = 'S01' AND SHPR.delt_flg = 'N'
		   LEFT OUTER JOIN  tb_bl_prnr CNEE
						ON  bl.intg_bl_seq = CNEE.intg_bl_seq  AND CNEE.bl_trdp_tp_cd = 'C01' AND CNEE.delt_flg = 'N'
		   LEFT OUTER JOIN  tb_bl_prnr ACT
						ON  bl.intg_bl_seq = act.intg_bl_seq  AND act.bl_trdp_tp_cd = 'S02' AND act.delt_flg = 'N'
		   LEFT OUTER JOIN  tb_bl_prnr LNR
						ON  bl.intg_bl_seq = lnr.intg_bl_seq  AND lnr.bl_trdp_tp_cd = 'L01' AND lnr.delt_flg = 'N'
		   LEFT OUTER JOIN  tb_bl_prnr NTFY
						ON  bl.intg_bl_seq = ntfy.intg_bl_seq  AND ntfy.bl_trdp_tp_cd = 'N01' AND ntfy.delt_flg = 'N'
		   LEFT OUTER JOIN tb_bl_prnr TRK 
		   				ON bl.intg_bl_seq = TRK.intg_bl_seq  AND TRK.bl_trdp_tp_cd = 'T02' AND TRK.delt_flg = 'N'
		   LEFT OUTER JOIN	tb_bl_prnr CUST
		           		ON	bl.intg_bl_seq = cust.intg_bl_seq  AND cust.bl_trdp_tp_cd = 'C03' AND cust.delt_flg = 'N'
		   LEFT OUTER JOIN tb_bl_prnr VNDR 
						ON bl.intg_bl_seq = VNDR.intg_bl_seq  AND VNDR.bl_trdp_tp_cd = 'V01' AND VNDR.delt_flg = 'N'
		   LEFT OUTER JOIN  tb_trdp CFS
						ON  bl.cfs_trdp_cd = cfs.trdp_cd  AND cfs.delt_flg = 'N'
		   LEFT OUTER JOIN (
						SELECT  rlt.intg_bl_seq, mbl.bl_no, rlt.rlt_intg_bl_seq
						  FROM  tb_intg_bl mbl
			   LEFT OUTER JOIN  tb_intg_bl_rlt rlt 
							ON  rlt.rlt_intg_bl_seq = mbl.intg_Bl_seq AND mbl.delt_flg = 'N'  
							) X ON X.intg_bl_seq = bl.intg_Bl_seq													   			
					 WHERE  bl.delt_flg = 'N'
					   AND  bl.air_sea_clss_cd= #air_sea_clss_cd#
					   AND  bl.biz_clss_cd  = #biz_clss_cd#					
					<isNotEmpty property="f_pol_cd">
					   AND  BL.POL_CD = #f_pol_cd#
					</isNotEmpty>
					<isNotEmpty property="f_pol_nm">
					   AND  BL.POL_NM LIKE '%' + #f_pol_nm# + '%'
					</isNotEmpty>
					
					<isNotEmpty property="f_ofc_cd">
					   AND  BL.REF_OFC_CD = #f_ofc_cd#
					</isNotEmpty>
					
					<isNotEmpty property="f_trnk_vsl_nm">
					   AND  BL.TRNK_VSL_NM LIKE '%' + #f_trnk_vsl_nm# + '%'
					</isNotEmpty>
					<isNotEmpty property="f_trnk_voy">
					   AND  BL.TRNK_VOY LIKE '%' + #f_trnk_voy# + '%'
					</isNotEmpty>
											
					 ) a1
		 <![CDATA[ where a1.ROWNUM > #beginIdx# AND a1.ROWNUM <= #topCnt#	]]> 				
    </select>
    
    <!--  House B/L List select count    -->
    
    <select id="selectModifyHBL_LIST_CNT" parameterClass="java.util.HashMap" resultClass="Integer">
        SELECT  COUNT(bl.intg_bl_seq)    
          FROM  TB_INTG_BL BL          
			  JOIN  tb_add_info_bnd bnd
				ON  bl.intg_bl_seq = bnd.intg_bl_seq AND bnd.bnd_clss_cd = #bnd_clss_cd# AND bnd.delt_flg = 'N'
   LEFT OUTER JOIN  tb_bl_prnr PRNR
				ON  bl.intg_bl_seq = prnr.intg_bl_seq  AND prnr.bl_trdp_tp_cd = 'P01' AND prnr.delt_flg = 'N'
   LEFT OUTER JOIN  tb_bl_prnr SHPR
				ON  bl.intg_bl_seq = SHPR.intg_bl_seq  AND SHPR.bl_trdp_tp_cd = 'S01' AND SHPR.delt_flg = 'N'
   LEFT OUTER JOIN  tb_bl_prnr CNEE
				ON  bl.intg_bl_seq = CNEE.intg_bl_seq  AND CNEE.bl_trdp_tp_cd = 'C01' AND CNEE.delt_flg = 'N'
   LEFT OUTER JOIN  tb_bl_prnr ACT
				ON  bl.intg_bl_seq = act.intg_bl_seq  AND act.bl_trdp_tp_cd = 'S02' AND act.delt_flg = 'N'
   LEFT OUTER JOIN  tb_bl_prnr LNR
				ON  bl.intg_bl_seq = lnr.intg_bl_seq  AND lnr.bl_trdp_tp_cd = 'L01' AND lnr.delt_flg = 'N'
   LEFT OUTER JOIN  tb_bl_prnr NTFY
				ON  bl.intg_bl_seq = ntfy.intg_bl_seq  AND ntfy.bl_trdp_tp_cd = 'N01' AND ntfy.delt_flg = 'N'
   LEFT OUTER JOIN	tb_bl_prnr CUST
           		ON	bl.intg_bl_seq = cust.intg_bl_seq  AND cust.bl_trdp_tp_cd = 'C03' AND cust.delt_flg = 'N'
   LEFT OUTER JOIN	tb_bl_prnr trk
           		ON	bl.intg_bl_seq = cust.intg_bl_seq  AND cust.bl_trdp_tp_cd = 'T02' AND cust.delt_flg = 'N'
   LEFT OUTER JOIN	tb_bl_prnr vndr
           		ON	bl.intg_bl_seq = vndr.intg_bl_seq  AND vndr.bl_trdp_tp_cd = 'V01' AND vndr.delt_flg = 'N'
   LEFT OUTER JOIN  tb_trdp CFS
				ON  bl.cfs_trdp_cd = cfs.trdp_cd  AND cfs.delt_flg = 'N'
   LEFT OUTER JOIN (
				SELECT  rlt.intg_bl_seq, mbl.bl_no
				  FROM  tb_intg_bl mbl
	   LEFT OUTER JOIN  tb_intg_bl_rlt rlt 
					ON  rlt.rlt_intg_bl_seq = mbl.intg_Bl_seq AND mbl.delt_flg = 'N'  
					) X ON X.intg_bl_seq = bl.intg_Bl_seq   
        WHERE   bl.delt_flg = 'N'  AND bl.air_sea_clss_cd= #air_sea_clss_cd#
          AND bl.biz_clss_cd  = #biz_clss_cd#
    		<isNotEmpty property="f_pol_cd">
				   AND  BL.POL_CD = #f_pol_cd#
			</isNotEmpty>
			<isNotEmpty property="f_pol_nm">
				   AND  BL.POL_NM LIKE '%' + #f_pol_nm# + '%'
			</isNotEmpty>					
			<isNotEmpty property="f_ofc_cd">
				   AND  BL.REF_OFC_CD = #f_ofc_cd#
			</isNotEmpty>					
			<isNotEmpty property="f_trnk_vsl_nm">
				   AND  BL.TRNK_VSL_NM LIKE '%' + #f_trnk_vsl_nm# + '%'
			</isNotEmpty>
			<isNotEmpty property="f_trnk_voy">
					   AND  BL.TRNK_VOY LIKE '%' + #f_trnk_voy# + '%'
			</isNotEmpty>						
	</select>
	
	<update id="updateBL_MODI_ETDETA" parameterClass="HashMap">
        UPDATE  tb_intg_bl
           SET  etd_dt_tm  = #etd_dt_tm#
           ,    eta_dt_tm  = #eta_dt_tm#            
         WHERE  intg_bl_seq= #intg_bl_seq#
    </update>
    
    <select id="searchCtrbMgn" parameterClass="HashMap" resultClass="HBLInfoVO">
    	SELECT TOP 1 CTRB_OFC_CD, CTRB_RATIO_YN, CTRB_MGN
          FROM TB_CTRB_MGN
         WHERE DELT_FLG = 'N'
           AND CUST_CD = #s_cust_cd#
           AND #s_post_dt# BETWEEN FM_DT AND TO_DT
         ORDER BY CTRB_MGN_SEQ DESC
    </select>
    
    <!--Vinh.Vo (S)  -->
    
    <select id="selectMBL_LIST_Excel_All" parameterClass="java.util.HashMap" resultClass="java.util.HashMap">
           /* BlCmmSQL.xml > selectMBL_LIST_Excel_All */
            	SELECT a1.*
				  FROM (
		         	SELECT  row_number() over (order by  bl.post_dt desc, bl.modi_tms desc) as no,
		         			bl.intg_bl_seq,
							bl.bl_no, bl.ref_no, bl.ref_ofc_cd, bl.lnr_bkg_no,
							
							(case when bl.etd_dt_tm = '' THEN '' when ISNULL(bl.etd_dt_tm,'') = '' then '' 
								else substring(bl.etd_dt_tm,5,2)  + '-' + substring(bl.etd_dt_tm,7,2) + '-' +substring(bl.etd_dt_tm,1,4)END) as etd_dt_tm
 
							,(case when bl.eta_dt_tm = '' THEN '' when ISNULL(bl.eta_dt_tm,'') = '' then '' 
								else substring(bl.eta_dt_tm,5,2)  + '-' +substring(bl.eta_dt_tm,7,2) + '-' +substring(bl.eta_dt_tm,1,4) END) as eta_dt_tm

							,(case when bl.f_eta_dt_tm = '' THEN '' when ISNULL(bl.f_eta_dt_tm,'') = '' then ''
								else substring(bl.f_eta_dt_tm,5,2)  + '-' +substring(bl.f_eta_dt_tm,7,2) + '-' +substring(bl.f_eta_dt_tm,1,4)END) as f_eta_dt_tm
							,bl.por_cd, bl.por_nm, 
							bl.pol_cd, bl.pol_nm, 
							bl.pod_cd, bl.pod_nm, 
							bl.del_cd, bl.del_nm,
		
							(select max(x.cntr_no) from tb_cntr_list x where x.intg_bl_seq = bl.intg_bl_seq and x.delt_flg = 'N') as cntr_no,
							(select count(x.cntr_no)-1 from tb_cntr_list x where x.intg_bl_seq = bl.intg_bl_seq and x.delt_flg = 'N') as cntr_cnt,
							prnr2.trdp_cd as prnr_trdp_cd2, prnr2.trdp_nm as prnr_trdp_nm2,
							shpr.trdp_cd as shpr_trdp_cd, shpr.trdp_nm as shpr_trdp_nm,
							cnee.trdp_cd as cnee_trdp_cd, cnee.trdp_nm as cnee_trdp_nm,
							lnr.trdp_cd as lnr_trdp_cd, lnr.trdp_nm as lnr_trdp_nm,
							carr.trdp_cd as carr_trdp_cd, carr.trdp_nm as carr_trdp_nm,
							bl.cy_trdp_cd, cy.eng_nm as cy_trdp_nm,
							bl.cfs_trdp_cd, cfs.eng_nm as cfs_trdp_nm,
							bl.hbl_tp_cd, bl.shp_mod_cd, bl.inco_cd, bl.rgst_usrid, bl.rep_cmdt_nm,
							bl.cust_ref_no,
							(select x.cnt_cd from tb_ofc x where x.ofc_cd = bl.rgst_ofc_cd) as bl_cnt, 
							(select max(x.locl_usr_nm) from tb_usr x where x.usr_tp = 'I' and x.usrid = bnd.issued_by) as proc_usr_nm,
							(case when bl.post_dt = '' THEN '' when ISNULL(bl.post_dt,'') = '' then '' 
								else substring(bl.post_dt,5,2)  + '-' + substring(bl.post_dt,7,2) + '-' +substring(bl.post_dt,1,4)END) as post_dt,
							bl.trnk_vsl_nm, bl.trnk_voy,
							(  select count(*) from tb_intg_bl_rlt rlt where  rlt.rlt_intg_bl_seq = bl.intg_bl_seq and rlt.delt_flg = 'N') as hbl_cnt,    
							isnull(dbo.fc_mk_memo_script(bl.intg_bl_seq), '') as memo,
							ams_id
							, bl.rlsd_flg, bl.rlsd_dt_tm , isnull(blck.bl_sts_cd1, bl.bl_sts_cd) as bl_sts_cd
	    					,bl.ccn_no
							,bl.ccn_dt
							,bl.pre_ccn_no
							,bl.mnf_fr_loc
							,bl.mnf_to_loc
							,bl.imp_ref_no
							,isnull(bnd.ar_chk,'X') as ar_chk
							,isnull(bnd.ap_chk,'X') as ap_chk
							,isnull(bnd.dc_chk,'X') as dc_chk
							,isnull(bnd.frt_chk,'X') as frt_chk
					  FROM  TB_INTG_BL BL
					  <isEqual property="bnd_clss_cd" compareValue="O">
							with(index(IDX_ETD_DT_TM), nolock)
					  </isEqual>     
					  <isEqual property="bnd_clss_cd" compareValue="I">
							with(index(IDX_ETA_DT_TM), nolock)
					  </isEqual>  
					  JOIN  tb_add_info_bnd bnd
						ON  bl.intg_bl_seq = bnd.intg_bl_seq AND bnd.bnd_clss_cd = #bnd_clss_cd# AND bnd.delt_flg = 'N'
		   LEFT OUTER JOIN  tb_bl_prnr PRNR2
						ON  bl.intg_bl_seq = prnr2.intg_bl_seq  AND prnr2.bl_trdp_tp_cd = 'P03' AND prnr2.delt_flg = 'N'
		   LEFT OUTER JOIN  tb_bl_prnr SHPR
						ON  bl.intg_bl_seq = SHPR.intg_bl_seq  AND SHPR.bl_trdp_tp_cd = 'S01' AND SHPR.delt_flg = 'N'
		   LEFT OUTER JOIN  tb_bl_prnr CNEE
						ON  bl.intg_bl_seq = CNEE.intg_bl_seq  AND CNEE.bl_trdp_tp_cd = 'C01' AND CNEE.delt_flg = 'N'
		   LEFT OUTER JOIN  tb_bl_prnr CARR
						ON  bl.intg_bl_seq = carr.intg_bl_seq  AND carr.bl_trdp_tp_cd = 'B01' AND carr.delt_flg = 'N'
		   LEFT OUTER JOIN  tb_bl_prnr LNR
						ON  bl.intg_bl_seq = lnr.intg_bl_seq  AND lnr.bl_trdp_tp_cd = 'L01' AND lnr.delt_flg = 'N'
		   LEFT OUTER JOIN  tb_trdp CY
						ON  bl.cy_trdp_cd = cy.trdp_cd  AND cy.delt_flg = 'N'
		   LEFT OUTER JOIN  tb_trdp CFS
						ON  bl.cfs_trdp_cd = cfs.trdp_cd  AND cfs.delt_flg = 'N'  
		   LEFT OUTER JOIN(SELECT INTG_BL_SEQ AS INTG_BL_SEQ1, BL_STS_CD AS BL_STS_CD1 FROM TB_INTG_BL_BLCK) BLCK 
		   				ON BL.INTG_BL_SEQ = BLCK.INTG_BL_SEQ1		            
					 WHERE  bl.delt_flg = 'N'
					   AND  bl.air_sea_clss_cd = #air_sea_clss_cd#
					   AND  bl.biz_clss_cd  = #biz_clss_cd#
					<isNotEmpty property="f_ref_no">
					   AND  BL.REF_NO LIKE '%' + #f_ref_no# + '%'
					</isNotEmpty>
					<isNotEmpty property="f_mbl_no">
					   AND  BL.BL_NO LIKE '%' + #f_mbl_no# + '%'
					</isNotEmpty>
					<isNotEmpty property="f_lnr_bkg_no">
					   AND  BL.LNR_BKG_NO LIKE '%' + #f_lnr_bkg_no# + '%'
					</isNotEmpty>
					<isNotEmpty property="f_cntr_no">
					   AND  BL.INTG_BL_SEQ IN (SELECT  CNTR.INTG_BL_SEQ
												 FROM  TB_CNTR_LIST CNTR
												WHERE  CNTR.CNTR_NO LIKE '%' + #f_cntr_no# + '%')
					</isNotEmpty>
					<isNotEmpty property="etd_strdt">
					   AND  BL.ETD_DT_TM BETWEEN #etd_strdt# AND #etd_enddt#
					</isNotEmpty>
					<isNotEmpty property="eta_strdt">
					   AND  BL.ETA_DT_TM BETWEEN #eta_strdt# AND #eta_enddt#
					</isNotEmpty>
					<isNotEmpty property="f_eta_strdt">
					   AND  BL.F_ETA_DT_TM BETWEEN #f_eta_strdt# AND #f_eta_enddt#
					</isNotEmpty>
					<isNotEmpty property="f_pol_cd">
					   AND  BL.POL_CD = #f_pol_cd#
					</isNotEmpty>
					<isNotEmpty property="f_pol_nm">
					   AND  BL.POL_NM LIKE '%' + #f_pol_nm# + '%'
					</isNotEmpty>
					<isNotEmpty property="f_por_cd">
					   AND  BL.POR_CD = #f_por_cd#
					</isNotEmpty>
					<isNotEmpty property="f_por_nm">
					   AND  BL.POR_NM LIKE '%' + #f_por_nm# + '%'
					</isNotEmpty>
					<isNotEmpty property="f_pod_cd">
					   AND  BL.POD_CD = #f_pod_cd#
					</isNotEmpty>
					<isNotEmpty property="f_pod_nm">
					   AND  BL.POD_NM LIKE '%' + #f_pod_nm# + '%'
					</isNotEmpty>
					<isNotEmpty property="f_del_cd">
					   AND  BL.DEL_CD = #f_del_cd#
					</isNotEmpty>
					<isNotEmpty property="f_del_nm">
					   AND  BL.DEL_NM LIKE '%' + #f_del_nm# + '%'
					</isNotEmpty>
					<isNotEmpty property="f_prnr_trdp_nm2">
					   AND  PRNR2.TRDP_NM LIKE '%' + #f_prnr_trdp_nm2# + '%'
					</isNotEmpty>
					<isNotEmpty property="f_shpr_trdp_nm">
					   AND  SHPR.TRDP_NM LIKE '%' + #f_shpr_trdp_nm# + '%'
					</isNotEmpty>
					<isNotEmpty property="f_cnee_trdp_nm">
					   AND  CNEE.TRDP_NM LIKE '%' + #f_cnee_trdp_nm# + '%'
					</isNotEmpty>
					<isNotEmpty property="f_carr_trdp_nm">
					   AND  LNR.TRDP_NM LIKE '%' + #f_carr_trdp_nm# + '%'
					</isNotEmpty>
					<isNotEmpty property="f_cy_trdp_nm">
					   AND  CY.ENG_NM LIKE '%' + #f_cy_trdp_nm# + '%'
					</isNotEmpty>
					<isNotEmpty property="f_cfs_trdp_nm">
					   AND  CFS.ENG_NM LIKE '%' + #f_cfs_trdp_nm# + '%'
					</isNotEmpty>
					<isNotEmpty property="f_hbl_tp_cd">
					   AND  BL.HBL_TP_CD = #f_hbl_tp_cd#
					</isNotEmpty>
					<isNotEmpty property="f_ofc_cd">
					   AND  BL.REF_OFC_CD = #f_ofc_cd#
					</isNotEmpty>
					<isNotEmpty property="f_shp_mod_cd">
					   AND  BL.SHP_MOD_CD = #f_shp_mod_cd#
					</isNotEmpty>
					<isNotEmpty property="f_pic_id">
					   AND  BL.RGST_USRID LIKE '%' + #f_pic_id# + '%'
					</isNotEmpty>
					<isNotEmpty property="f_trnk_vsl_nm">
					   AND  BL.TRNK_VSL_NM LIKE '%' + #f_trnk_vsl_nm# + '%'
					</isNotEmpty>
					<isNotEmpty property="f_imp_ref_no">
					   AND  BL.IMP_REF_NO LIKE '%' + #f_imp_ref_no# + '%'
					</isNotEmpty>				
					<isNotEmpty property="f_ccn_no">
					   AND  BL.CCN_NO LIKE '%' + #f_ccn_no# + '%'
					</isNotEmpty>		
					<isNotEmpty property="post_strdt">
					   AND  BL.POST_DT BETWEEN #post_strdt# AND #post_enddt#
					</isNotEmpty>		
					<isNotEmpty property="opr_usrid">
					   AND  BND.ISSUED_BY = #opr_usrid#
					</isNotEmpty>
			  ) a1
			  ORDER BY a1.no  
    </select>
    
    <select id="selectHBL_LIST_Excel_All" parameterClass="java.util.HashMap" resultClass="java.util.HashMap">
		/* BlCmmSQL.xml > selectHBL_LIST_Excel_All */		
     	  		SELECT a1.*
				  FROM (
		         	SELECT  row_number() over (order by  bl.post_dt desc, bl.modi_tms desc) as no,
							bl.intg_bl_seq, x.rlt_intg_bl_seq, 
							bl.bl_no, bl.ref_no, bl.ref_ofc_cd, x.bl_no as mbl_no,
							(select upper(x.cnt_cd) from tb_ofc x where x.ofc_cd = bl.ref_ofc_cd and x.delt_flg = 'N') as ref_ofc_cnt,
							(case when bl.etd_dt_tm = '' THEN '' when ISNULL(bl.etd_dt_tm,'') = '' then '' 
								else substring(bl.etd_dt_tm,5,2)  + '-' + substring(bl.etd_dt_tm,7,2) + '-' +substring(bl.etd_dt_tm,1,4)END) as etd_dt_tm
							,(case when bl.eta_dt_tm = '' THEN '' when ISNULL(bl.eta_dt_tm,'') = '' then '' 
								else substring(bl.eta_dt_tm,5,2)  + '-' + substring(bl.eta_dt_tm,7,2) + '-' +substring(bl.eta_dt_tm,1,4)END) as eta_dt_tm,
							bl.por_cd, bl.por_nm, 
							bl.pol_cd, bl.pol_nm, 
							bl.pod_cd, bl.pod_nm, 
							bl.del_cd, bl.del_nm,		
							prnr.trdp_cd as prnr_trdp_cd, prnr.trdp_nm as prnr_trdp_nm,
							shpr.trdp_cd as shp_trdp_cd, shpr.trdp_nm as shp_trdp_nm,
							cnee.trdp_cd as cne_trdp_cd, cnee.trdp_nm as cne_trdp_nm,
							act.trdp_cd as act_trdp_cd, act.trdp_nm as act_trdp_nm,
							lnr.trdp_cd as lnr_trdp_cd, lnr.trdp_nm as lnr_trdp_nm,
							ntfy.trdp_cd as ntfy_trdp_cd, ntfy.trdp_nm as ntfy_trdp_nm,
							trk.trdp_cd trk_trdp_cd, trk.trdp_nm trk_trdp_nm,
							cust.trdp_cd as cust_trdp_cd, cust.trdp_nm as cust_trdp_nm,
							vndr.trdp_cd vndr_trdp_cd, vndr.trdp_nm vndr_trdp_nm,
							bl.cfs_trdp_cd, cfs.eng_nm as cfs_trdp_nm,							
							bl.hbl_tp_cd, bl.shp_mod_cd, bl.inco_cd, bl.rgst_usrid, bl.rep_cmdt_nm,
							bl.cust_ref_no, bl.lnr_bkg_no, bl.exp_ref_no,
							(select x.cnt_cd from tb_ofc x where x.ofc_cd = bl.rgst_ofc_cd) as bl_cnt, 
							(select max(x.locl_usr_nm) from tb_usr x where x.usr_tp = 'I' and x.usrid = bnd.issued_by ) as proc_usr_nm,
							(case when bl.post_dt = '' THEN '' when ISNULL(bl.post_dt,'') = '' then '' 
								else substring(bl.post_dt,5,2)  + '-' + substring(bl.post_dt,7,2) + '-' +substring(bl.post_dt,1,4)END) as post_dt,
							bl.trnk_vsl_nm, bl.trnk_voy, bl.doc_recpt_no, bl.it_no,							
							bl.pck_qty, bl.grs_wgt, bl.grs_wgt1, bl.meas,							
							bl.rlsd_flg, 
							(case when bl.rlsd_dt_tm = '' then '' when isnull(bl.rlsd_dt_tm,'') = '' then '' 
								else substring(bl.rlsd_dt_tm,5,2)  + '-' + substring(bl.rlsd_dt_tm,7,2) + '-' +substring(bl.rlsd_dt_tm,1,4)end) as rlsd_dt_tm,
							case when bl.express_tp_cd ='Y' then 'YES' else 'NO' end express_tp_cd,
							bl.org_bl_rcvd_flg, 
							(case when bl.rcvd_dt_tm = '' then '' when isnull(bl.rcvd_dt_tm,'') = '' then '' 
								else substring(bl.rcvd_dt_tm,5,2)  + '-' + substring(bl.rcvd_dt_tm,7,2) + '-' +substring(bl.rcvd_dt_tm,1,4)end) as rcvd_dt_tm,
							(select max(x.cntr_no) from tb_cntr_list x where x.intg_bl_seq = bl.intg_bl_seq and x.delt_flg = 'N') as cntr_no,
							(select count(x.cntr_no)-1 from tb_cntr_list x where x.intg_bl_seq = bl.intg_bl_seq and x.delt_flg = 'N') as cntr_cnt,
							isnull(dbo.fc_mk_memo_script(bl.intg_bl_seq), '') as memo,
		  					case when charindex(char(13)+char(10), bl.po_no) = 0 then bl.po_no
							else substring(bl.po_no, 1, charindex(char(13)+char(10), bl.po_no)-1) end as po_no , 					
							bl.lc_no, 
							bl.inv_no,
							bl.ams_id,
							isnull(blck.bl_sts_cd1, bl.bl_sts_cd) as bl_sts_cd,
							bl.isf_no,
							bl.ams_no
		    				,bl.ccn_no
							,bl.ccn_dt
							,bl.pre_ccn_no
							,bl.mnf_fr_loc
							,bl.mnf_to_loc
							,isnull(bnd.ar_chk,'X') as ar_chk
							,isnull(bnd.ap_chk,'X') as ap_chk
							,isnull(bnd.dc_chk,'X') as dc_chk
							,isnull(bnd.frt_chk,'X') as frt_chk
							,bnd.hbl_ser_no
							,bl.fnl_dest_loc_cd
							,bl.fnl_dest_loc_nm
							,(case when bl.f_eta_dt_tm = '' then '' when isnull(bl.f_eta_dt_tm,'') = '' then '' 
								else substring(bl.f_eta_dt_tm,5,2)  + '-' + substring(bl.f_eta_dt_tm,7,2) + '-' +substring(bl.f_eta_dt_tm,1,4)end) as f_eta_dt_tm
							,bnd.entr_no
							,(case when bnd.pkup_dt = '' then '' when isnull(bnd.pkup_dt,'') = '' then '' 
								else substring(bnd.pkup_dt,5,2)  + '-' + substring(bnd.pkup_dt,7,2) + '-' +substring(bnd.pkup_dt,1,4)end) as pkup_dt
							,bl.sub_bl_no
							,CASE WHEN ISNULL(bnd.AN_EML_SND_DT,'') = ''
							      THEN ''
							      ELSE (SUBSTRING(bnd.AN_EML_SND_DT,5,2)+'-'+SUBSTRING(bnd.AN_EML_SND_DT,7,2)+'-'+SUBSTRING(bnd.AN_EML_SND_DT,1,4)+' '+
							            SUBSTRING(bnd.AN_EML_SND_DT,9,2)+':'+SUBSTRING(bnd.AN_EML_SND_DT,11,2)) 
                              END AS an_eml_snd_dt
							,CASE WHEN ISNULL(bnd.AN_FAX_SND_DT,'') = ''
							      THEN ''
							      ELSE (SUBSTRING(bnd.AN_FAX_SND_DT,5,2)+'-'+SUBSTRING(bnd.AN_FAX_SND_DT,7,2)+'-'+SUBSTRING(bnd.AN_FAX_SND_DT,1,4)+' '+
							            SUBSTRING(bnd.AN_FAX_SND_DT,9,2)+':'+SUBSTRING(bnd.AN_FAX_SND_DT,11,2)) 
                              END AS an_fax_snd_dt
					  FROM  TB_INTG_BL BL
					  <isEqual property="bnd_clss_cd" compareValue="O">
							with(index(IDX_ETD_DT_TM), nolock)
					  </isEqual>     
					  <isEqual property="bnd_clss_cd" compareValue="I">
							with(index(IDX_ETA_DT_TM), nolock)
					  </isEqual>  
					  JOIN  tb_add_info_bnd bnd
						ON  bl.intg_bl_seq = bnd.intg_bl_seq AND bnd.bnd_clss_cd = #bnd_clss_cd# AND bnd.delt_flg = 'N'
						<isNotEmpty property="f_bl_ser_no_frm">
						   	<isNotEmpty property="f_bl_ser_no_to">
						  	 	AND  bnd.hbl_ser_no between #f_bl_ser_no_frm# and #f_bl_ser_no_to#
							</isNotEmpty>
						</isNotEmpty>
		   LEFT OUTER JOIN  tb_bl_prnr PRNR
						ON  bl.intg_bl_seq = prnr.intg_bl_seq  AND prnr.bl_trdp_tp_cd = 'P01' AND prnr.delt_flg = 'N'
		   LEFT OUTER JOIN  tb_bl_prnr SHPR
						ON  bl.intg_bl_seq = SHPR.intg_bl_seq  AND SHPR.bl_trdp_tp_cd = 'S01' AND SHPR.delt_flg = 'N'
		   LEFT OUTER JOIN  tb_bl_prnr CNEE
						ON  bl.intg_bl_seq = CNEE.intg_bl_seq  AND CNEE.bl_trdp_tp_cd = 'C01' AND CNEE.delt_flg = 'N'
		   LEFT OUTER JOIN  tb_bl_prnr ACT
						ON  bl.intg_bl_seq = act.intg_bl_seq  AND act.bl_trdp_tp_cd = 'S02' AND act.delt_flg = 'N'
		   LEFT OUTER JOIN  tb_bl_prnr LNR
						ON  bl.intg_bl_seq = lnr.intg_bl_seq  AND lnr.bl_trdp_tp_cd = 'L01' AND lnr.delt_flg = 'N'
		   LEFT OUTER JOIN  tb_bl_prnr NTFY
						ON  bl.intg_bl_seq = ntfy.intg_bl_seq  AND ntfy.bl_trdp_tp_cd = 'N01' AND ntfy.delt_flg = 'N'
		   LEFT OUTER JOIN tb_bl_prnr TRK 
		   				ON bl.intg_bl_seq = TRK.intg_bl_seq  AND TRK.bl_trdp_tp_cd = 'T02' AND TRK.delt_flg = 'N'
		   LEFT OUTER JOIN	tb_bl_prnr CUST
		           		ON	bl.intg_bl_seq = cust.intg_bl_seq  AND cust.bl_trdp_tp_cd = 'C03' AND cust.delt_flg = 'N'
		   LEFT OUTER JOIN tb_bl_prnr VNDR 
						ON bl.intg_bl_seq = VNDR.intg_bl_seq  AND VNDR.bl_trdp_tp_cd = 'V01' AND VNDR.delt_flg = 'N'
		   LEFT OUTER JOIN  tb_trdp CFS
						ON  bl.cfs_trdp_cd = cfs.trdp_cd  AND cfs.delt_flg = 'N'
		   LEFT OUTER JOIN (
						SELECT  rlt.intg_bl_seq, mbl.bl_no, rlt.rlt_intg_bl_seq
						  FROM  tb_intg_bl mbl
			   LEFT OUTER JOIN  tb_intg_bl_rlt rlt 
							ON  rlt.rlt_intg_bl_seq = mbl.intg_Bl_seq AND mbl.delt_flg = 'N'  
							) X ON X.intg_bl_seq = bl.intg_Bl_seq
		   LEFT OUTER JOIN(SELECT INTG_BL_SEQ AS INTG_BL_SEQ1, BL_STS_CD AS BL_STS_CD1 FROM TB_INTG_BL_BLCK) BLCK 
		   				ON BL.INTG_BL_SEQ = BLCK.INTG_BL_SEQ1																   			
					 WHERE  bl.delt_flg = 'N'
					   AND  bl.air_sea_clss_cd= #air_sea_clss_cd#
					   AND  bl.biz_clss_cd  = #biz_clss_cd#
					<isNotEmpty property="f_hbl_no">
					   AND  BL.BL_NO LIKE '%' + #f_hbl_no# + '%'
					</isNotEmpty>
					<isNotEmpty property="f_ref_no">
					   AND  BL.REF_NO LIKE '%' + #f_ref_no# + '%'
					</isNotEmpty>
					<isNotEmpty property="f_mbl_no">
					   AND  X.BL_NO LIKE '%' + #f_mbl_no# + '%'
					</isNotEmpty>
					<isNotEmpty property="f_cntr_no">
					   AND  BL.INTG_BL_SEQ IN (SELECT  CNTR.INTG_BL_SEQ
												 FROM  TB_CNTR_LIST CNTR
												WHERE  CNTR.CNTR_NO LIKE '%' + #f_cntr_no# + '%' )
					</isNotEmpty>
					<isNotEmpty property="etd_strdt">
					   AND  BL.ETD_DT_TM BETWEEN #etd_strdt# AND #etd_enddt#
					</isNotEmpty>
					<isNotEmpty property="eta_strdt">
					   AND  BL.ETA_DT_TM BETWEEN #eta_strdt# AND #eta_enddt#
					</isNotEmpty>
					<isNotEmpty property="f_pol_cd">
					   AND  BL.POL_CD = #f_pol_cd#
					</isNotEmpty>
					<isNotEmpty property="f_pol_nm">
					   AND  BL.POL_NM LIKE '%' + #f_pol_nm# + '%'
					</isNotEmpty>
					<isNotEmpty property="f_por_cd">
					   AND  BL.POR_CD = #f_por_cd#
					</isNotEmpty>
					<isNotEmpty property="f_por_nm">
					   AND  BL.POR_NM LIKE '%' + #f_por_nm# + '%'
					</isNotEmpty>
					<isNotEmpty property="f_pod_cd">
					   AND  BL.POD_CD = #f_pod_cd#
					</isNotEmpty>
					<isNotEmpty property="f_pod_nm">
					   AND  BL.POD_NM LIKE '%' + #f_pod_nm# + '%'
					</isNotEmpty>
					<isNotEmpty property="f_del_cd">
					   AND  BL.DEL_CD = #f_del_cd#
					</isNotEmpty>
					<isNotEmpty property="f_del_nm">
					   AND  BL.DEL_NM LIKE '%' + #f_del_nm# + '%'
					</isNotEmpty>
					<isNotEmpty property="f_prnr_trdp_nm">
					   AND  PRNR.TRDP_NM LIKE '%' + #f_prnr_trdp_nm# + '%'
					</isNotEmpty>
					<isNotEmpty property="f_shpr_trdp_nm">
					   AND  SHPR.TRDP_NM LIKE '%' + #f_shpr_trdp_nm# + '%'
					</isNotEmpty>
					<isNotEmpty property="f_cnee_trdp_nm">
					   AND  CNEE.TRDP_NM LIKE '%' + #f_cnee_trdp_nm# + '%'
					</isNotEmpty>
					<isNotEmpty property="f_ahpr_trdp_nm">
					   AND  ACT.TRDP_NM LIKE '%' + #f_ahpr_trdp_nm# + '%'
					</isNotEmpty>
					<isNotEmpty property="f_ntfy_trdp_nm">
					   AND  NTFY.TRDP_NM LIKE '%' + #f_ntfy_trdp_nm# + '%'
					</isNotEmpty>
					<isNotEmpty property="f_cfs_trdp_nm">
					   AND  CFS.ENG_NM LIKE '%' + #f_cfs_trdp_nm# + '%'
					</isNotEmpty>
					<isNotEmpty property="f_hbl_tp_cd">
					   AND  BL.HBL_TP_CD = #f_hbl_tp_cd#
					</isNotEmpty>
					<isNotEmpty property="f_ofc_cd">
					   AND  BL.REF_OFC_CD = #f_ofc_cd#
					</isNotEmpty>
					<isNotEmpty property="f_shp_mod_cd">
					   AND  BL.SHP_MOD_CD = #f_shp_mod_cd#
					</isNotEmpty>
					<isNotEmpty property="f_inco_cd">
					   AND  BL.INCO_CD = #f_inco_cd#
					</isNotEmpty>
					<isNotEmpty property="f_pic_id">
					   AND  BL.RGST_USRID LIKE '%' + #f_pic_id# + '%'
					</isNotEmpty>
					<isNotEmpty property="f_cmdt_nm">
					   AND  BL.REP_CMDT_NM LIKE '%' + #f_cmdt_nm# + '%'
					</isNotEmpty>
					<isNotEmpty property="f_trnk_vsl_nm">
					   AND  BL.TRNK_VSL_NM LIKE '%' + #f_trnk_vsl_nm# + '%'
					</isNotEmpty>
					<isNotEmpty property="f_grs_wgt">
					   AND  BL.GRS_WGT LIKE '%' + #f_grs_wgt# + '%'
					</isNotEmpty>
					<isNotEmpty property="f_grs_wgt1">
					   AND  BL.GRS_WGT1 LIKE '%' + #f_grs_wgt1# + '%'
					</isNotEmpty>
					<isNotEmpty property="f_meas">
					   AND  BL.MEAS LIKE '%' + #f_meas# + '%'
					</isNotEmpty>
					<isNotEmpty property="f_it_no">
					   AND  BL.IT_NO LIKE '%' + #f_it_no# + '%'
					</isNotEmpty>
					<isNotEmpty property="fm_pck_qty">
					   AND  BL.PCK_QTY BETWEEN #fm_pck_qty# AND #to_pck_qty#
					</isNotEmpty>
					<isNotEmpty property="fm_grs_wgt">
					   AND  BL.GRS_WGT BETWEEN #fm_grs_wgt# AND #to_grs_wgt#
					</isNotEmpty>
					<isNotEmpty property="fm_meas">
					   AND  BL.MEAS BETWEEN #fm_meas# AND #to_meas#
					</isNotEmpty>
					<isNotEmpty property="f_po_no">
					   AND  BL.PO_NO LIKE '%' + #f_po_no# + '%'
					</isNotEmpty>
					<isNotEmpty property="f_lc_no">
					   AND  BL.LC_NO = #f_lc_no#
					</isNotEmpty>
					<isNotEmpty property="f_inv_no">
					   AND  BL.INV_NO = #f_inv_no#
					</isNotEmpty>
					<isNotEmpty property="f_lnr_bkg_no">
					   AND  BL.LNR_BKG_NO = #f_lnr_bkg_no#
					</isNotEmpty>
					<isNotEmpty property="f_cust_ref_no">
					   AND  BL.CUST_REF_NO LIKE '%' + #f_cust_ref_no# + '%'
					</isNotEmpty>			
					<isNotEmpty property="f_ccn_no">
					   AND  BL.CCN_NO LIKE '%' + #f_ccn_no# + '%'
					</isNotEmpty>	
					<isNotEmpty property="f_fnl_dest_loc_cd">
					   AND  BL.FNL_DEST_LOC_CD = #f_fnl_dest_loc_cd#
					</isNotEmpty>
					<isNotEmpty property="f_fnl_dest_loc_nm">
					   AND  BL.FNL_DEST_LOC_NM LIKE '%' + #f_fnl_dest_loc_nm# + '%'
					</isNotEmpty>
					<isNotEmpty property="f_entr_no">
					   AND  BND.ENTR_NO LIKE '%' + #f_entr_no# + '%'
					</isNotEmpty>	
					<isNotEmpty property="post_strdt">
					   AND  BL.POST_DT BETWEEN #post_strdt# AND #post_enddt#
					</isNotEmpty>	
					<isNotEmpty property="f_sub_bl_no">
					   AND  BL.SUB_BL_NO LIKE '%' + #f_sub_bl_no# + '%'
					</isNotEmpty>
					<isNotEmpty property="opr_usrid">
					   AND  BND.ISSUED_BY = #opr_usrid#
					</isNotEmpty>
					 ) a1
					 order by a1.no
    </select>
    
    <!--Vinh.Vo (E)  -->
    
    
	<!-- LKH TODO::작업중  -->
    <update id="updateBlArApDcStatusFromJnr" parameterClass="HashMap">
    /* BlCmmSQL.xml > updateBlArApDcStatusFromJnr */
        ;WITH BLINFO AS (
			SELECT A.INTG_BL_SEQ FROM TB_INTG_BL A WITH(nolock) WHERE EXISTS (
				SELECT INTG_BL_SEQ FROM tb_frt B WITH(nolock)
					WHERE B.INTG_BL_SEQ = A.INTG_BL_SEQ 
					  AND INV_SEQ IN (
								SELECT
									INV_SEQ 
								FROM
									TB_JNR_DTL WITH(nolock)   
								WHERE
									JNR_NO =  #jnr_no#
								AND ISNULL(INV_SEQ, '')	!=''		
							) 
					  AND ISNULL(OTH_SEQ,'') = '' AND ISNULL(WMS_SEQ,'') = ''
				)
		), INVINFO AS(
			SELECT T1.INTG_BL_SEQ,
			<![CDATA[ 
				CASE 
					 WHEN Isnull(inv_sum.ar_cnt, 0) = 0 THEN 'X' 
					 WHEN inv_sum.ar_bal_amt = 0 THEN 'Y' 
					 WHEN inv_sum.ar_inv_sum_amt = inv_sum.ar_bal_amt THEN 'N' 
					 WHEN inv_sum.ar_bal_amt < 0 THEN 'O' 
					 ELSE 'P' 
				   END AS AR_CHK, 
				   CASE 
					 WHEN Isnull(inv_sum.ap_cnt, 0) = 0 THEN 'X' 
					 WHEN inv_sum.ap_bal_amt = 0 THEN 'Y' 
					 WHEN inv_sum.ap_inv_sum_amt = inv_sum.ap_bal_amt THEN 'N' 
					 WHEN inv_sum.ap_bal_amt < 0 THEN 'O' 
					 ELSE 'P' 
				   END AS AP_CHK, 
				   CASE 
					 WHEN Isnull(inv_sum.dc_cnt, 0) = 0 THEN 'X' 
					 WHEN inv_sum.dc_bal_amt = 0 THEN 'Y' 
					 WHEN inv_sum.dc_inv_sum_amt = inv_sum.dc_bal_amt THEN 'N' 
					 WHEN inv_sum.dc_bal_amt < 0 THEN 'O' 
					 ELSE 'P' 
				   END AS DC_CHK  
			]]>    
			FROM (	BLINFO AS T1
				LEFT OUTER JOIN (			
					SELECT frt.intg_bl_seq, 
								SUM(CASE 
										WHEN frt.sell_buy_tp_cd = 'S' THEN 1 
										ELSE 0 
									END) AS ar_cnt, 
								SUM(CASE 
										WHEN frt.sell_buy_tp_cd = 'S' THEN 
										dtl.inv_sum_amt 
										ELSE 0 
									END) AS ar_inv_sum_amt, 
								SUM(CASE 
										WHEN frt.sell_buy_tp_cd = 'S' THEN 
										dtl.bal_amt 
										ELSE 0 
									END) AS ar_bal_amt, 
								SUM(CASE 
										WHEN frt.sell_buy_tp_cd = 'B' THEN 1 
										ELSE 0 
									END) AS ap_cnt, 
								SUM(CASE 
										WHEN frt.sell_buy_tp_cd = 'B' THEN 
										dtl.inv_sum_amt 
										ELSE 0 
									END) AS ap_inv_sum_amt, 
								SUM(CASE 
										WHEN frt.sell_buy_tp_cd = 'B' THEN 
										dtl.bal_amt 
										ELSE 0 
									END) AS ap_bal_amt, 
								SUM(CASE 
										WHEN frt.sell_buy_tp_cd = 'D' 
											OR frt.sell_buy_tp_cd = 'C' THEN 1 
										ELSE 0 
									END) AS dc_cnt, 
								SUM(CASE 
										WHEN frt.sell_buy_tp_cd = 'D' 
											OR frt.sell_buy_tp_cd = 'C' THEN 
										dtl.inv_sum_amt 
										ELSE 0 
									END) AS dc_inv_sum_amt, 
								SUM(CASE 
										WHEN frt.sell_buy_tp_cd = 'D' 
											OR frt.sell_buy_tp_cd = 'C' THEN 
										dtl.bal_amt 
										ELSE 0 
									END) AS dc_bal_amt 
						FROM   tb_frt frt WITH(nolock) 
								JOIN tb_inv_dtl dtl WITH(INDEX(xif1tb_inv_dtl), nolock) 
									ON dtl.delt_flg = 'N' 
									AND frt.inv_seq = dtl.inv_seq 
						WHERE  frt.delt_flg = 'N' 
							and     frt.INTG_BL_SEQ  IN (SELECT INTG_BL_SEQ FROM TB_INTG_BL T WITH(nolock) WHERE T.INTG_BL_SEQ=FRT.INTG_BL_SEQ)      
						GROUP  BY frt.intg_bl_seq
					) inv_sum
					ON T1.intg_bl_seq = inv_sum.intg_bl_seq 
			) 
		)
		UPDATE A SET AR_CHK = B.AR_CHK,AP_CHK = B.AP_CHK,DC_CHK = B.DC_CHK
		FROM TB_ADD_INFO_BND AS A, INVINFO AS B
		WHERE A.INTG_BL_SEQ = B.INTG_BL_SEQ	 		 	
    </update>
	<!-- LKH TODO::작업중  -->
    <update id="updateOthArApDcStatusFromJnr" parameterClass="HashMap">
    /* BlCmmSQL.xml > updateOthArApDcStatusFromJnr */
        ;WITH OTHINFO AS (
			SELECT A.oth_seq FROM TB_OTH_SALES A WITH(nolock) WHERE EXISTS (
				SELECT oth_seq FROM tb_frt B WITH(nolock)
					WHERE B.oth_seq = A.oth_seq 
						 AND INV_SEQ IN (
									SELECT
										INV_SEQ 
									FROM
										TB_JNR_DTL WITH(nolock)    
									WHERE
										JNR_NO =  #jnr_no#
									AND ISNULL(INV_SEQ, '')	!=''		
								) 
						  <![CDATA[ 
						  AND ISNULL(OTH_SEQ,'') <> '' 
						  ]]>    
				)
		), INVINFO AS(
			SELECT T1.oth_seq,
			<![CDATA[ 
				CASE 
					 WHEN Isnull(inv_sum.ar_cnt, 0) = 0 THEN 'X' 
					 WHEN inv_sum.ar_bal_amt = 0 THEN 'Y' 
					 WHEN inv_sum.ar_inv_sum_amt = inv_sum.ar_bal_amt THEN 'N' 
					 WHEN inv_sum.ar_bal_amt < 0 THEN 'O' 
					 ELSE 'P' 
				   END AS AR_CHK, 
				   CASE 
					 WHEN Isnull(inv_sum.ap_cnt, 0) = 0 THEN 'X' 
					 WHEN inv_sum.ap_bal_amt = 0 THEN 'Y' 
					 WHEN inv_sum.ap_inv_sum_amt = inv_sum.ap_bal_amt THEN 'N' 
					 WHEN inv_sum.ap_bal_amt < 0 THEN 'O' 
					 ELSE 'P' 
				   END AS AP_CHK, 
				   CASE 
					 WHEN Isnull(inv_sum.dc_cnt, 0) = 0 THEN 'X' 
					 WHEN inv_sum.dc_bal_amt = 0 THEN 'Y' 
					 WHEN inv_sum.dc_inv_sum_amt = inv_sum.dc_bal_amt THEN 'N' 
					 WHEN inv_sum.dc_bal_amt < 0 THEN 'O' 
					 ELSE 'P' 
				   END AS DC_CHK  
			]]>    
			FROM (	OTHINFO AS T1
				LEFT OUTER JOIN (			
					SELECT frt.oth_seq, 
								SUM(CASE 
										WHEN frt.sell_buy_tp_cd = 'S' THEN 1 
										ELSE 0 
									END) AS ar_cnt, 
								SUM(CASE 
										WHEN frt.sell_buy_tp_cd = 'S' THEN 
										dtl.inv_sum_amt 
										ELSE 0 
									END) AS ar_inv_sum_amt, 
								SUM(CASE 
										WHEN frt.sell_buy_tp_cd = 'S' THEN 
										dtl.bal_amt 
										ELSE 0 
									END) AS ar_bal_amt, 
								SUM(CASE 
										WHEN frt.sell_buy_tp_cd = 'B' THEN 1 
										ELSE 0 
									END) AS ap_cnt, 
								SUM(CASE 
										WHEN frt.sell_buy_tp_cd = 'B' THEN 
										dtl.inv_sum_amt 
										ELSE 0 
									END) AS ap_inv_sum_amt, 
								SUM(CASE 
										WHEN frt.sell_buy_tp_cd = 'B' THEN 
										dtl.bal_amt 
										ELSE 0 
									END) AS ap_bal_amt, 
								SUM(CASE 
										WHEN frt.sell_buy_tp_cd = 'D' 
											OR frt.sell_buy_tp_cd = 'C' THEN 1 
										ELSE 0 
									END) AS dc_cnt, 
								SUM(CASE 
										WHEN frt.sell_buy_tp_cd = 'D' 
											OR frt.sell_buy_tp_cd = 'C' THEN 
										dtl.inv_sum_amt 
										ELSE 0 
									END) AS dc_inv_sum_amt, 
								SUM(CASE 
										WHEN frt.sell_buy_tp_cd = 'D' 
											OR frt.sell_buy_tp_cd = 'C' THEN 
										dtl.bal_amt 
										ELSE 0 
									END) AS dc_bal_amt 
						FROM   tb_frt frt WITH(nolock) 
								JOIN tb_inv_dtl dtl WITH(INDEX(xif1tb_inv_dtl), nolock) 
									ON dtl.delt_flg = 'N' 
									AND frt.inv_seq = dtl.inv_seq 
						WHERE  frt.delt_flg = 'N' 
							and     frt.oth_seq  IN (SELECT oth_seq FROM OTHINFO T WITH(nolock) WHERE T.oth_seq=FRT.oth_seq)      
						GROUP  BY frt.oth_seq
					) inv_sum
					ON T1.oth_seq = inv_sum.oth_seq 
			) 
		)UPDATE A SET AR_CHK = B.AR_CHK,AP_CHK = B.AP_CHK,DC_CHK = B.DC_CHK
		FROM TB_OTH_SALES AS A, INVINFO AS B
		WHERE A.OTH_SEQ = B.OTH_SEQ	 	
    </update> 
	<!-- LKH TODO::작업중  --> 
    <update id="updateWmsArApDcStatusFromJnr" parameterClass="HashMap">
    /* BlCmmSQL.xml > updateWmsArApDcStatusFromJnr */
        ;WITH OTHINFO AS (
			SELECT A.WM_DOC_SEQ FROM TB_WM_DOC_MST A WITH(nolock) WHERE EXISTS (
				SELECT wms_seq FROM tb_frt B WITH(nolock)
					WHERE B.wms_seq = A.wm_doc_seq 					
						 AND INV_SEQ IN (
									SELECT
										INV_SEQ 
									FROM
										TB_JNR_DTL WITH(nolock)   
									WHERE
										JNR_NO =  #jnr_no#
									AND ISNULL(INV_SEQ, '')	!=''	
								) 
						  <![CDATA[ 
						  AND ISNULL(WMS_SEQ,'') <> '' 
						  ]]>    
				)
		), INVINFO AS(
			SELECT T1.WM_DOC_SEQ,
			<![CDATA[ 
				CASE 
					 WHEN Isnull(inv_sum.ar_cnt, 0) = 0 THEN 'X' 
					 WHEN inv_sum.ar_bal_amt = 0 THEN 'Y' 
					 WHEN inv_sum.ar_inv_sum_amt = inv_sum.ar_bal_amt THEN 'N' 
					 WHEN inv_sum.ar_bal_amt < 0 THEN 'O' 
					 ELSE 'P' 
				   END AS AR_CHK, 
				   CASE 
					 WHEN Isnull(inv_sum.ap_cnt, 0) = 0 THEN 'X' 
					 WHEN inv_sum.ap_bal_amt = 0 THEN 'Y' 
					 WHEN inv_sum.ap_inv_sum_amt = inv_sum.ap_bal_amt THEN 'N' 
					 WHEN inv_sum.ap_bal_amt < 0 THEN 'O' 
					 ELSE 'P' 
				   END AS AP_CHK, 
				   CASE 
					 WHEN Isnull(inv_sum.dc_cnt, 0) = 0 THEN 'X' 
					 WHEN inv_sum.dc_bal_amt = 0 THEN 'Y' 
					 WHEN inv_sum.dc_inv_sum_amt = inv_sum.dc_bal_amt THEN 'N' 
					 WHEN inv_sum.dc_bal_amt < 0 THEN 'O' 
					 ELSE 'P' 
				   END AS DC_CHK  
			]]>    
			FROM (	OTHINFO AS T1
				LEFT OUTER JOIN (			
					SELECT frt.wms_seq, 
								SUM(CASE 
										WHEN frt.sell_buy_tp_cd = 'S' THEN 1 
										ELSE 0 
									END) AS ar_cnt, 
								SUM(CASE 
										WHEN frt.sell_buy_tp_cd = 'S' THEN 
										dtl.inv_sum_amt 
										ELSE 0 
									END) AS ar_inv_sum_amt, 
								SUM(CASE 
										WHEN frt.sell_buy_tp_cd = 'S' THEN 
										dtl.bal_amt 
										ELSE 0 
									END) AS ar_bal_amt, 
								SUM(CASE 
										WHEN frt.sell_buy_tp_cd = 'B' THEN 1 
										ELSE 0 
									END) AS ap_cnt, 
								SUM(CASE 
										WHEN frt.sell_buy_tp_cd = 'B' THEN 
										dtl.inv_sum_amt 
										ELSE 0 
									END) AS ap_inv_sum_amt, 
								SUM(CASE 
										WHEN frt.sell_buy_tp_cd = 'B' THEN 
										dtl.bal_amt 
										ELSE 0 
									END) AS ap_bal_amt, 
								SUM(CASE 
										WHEN frt.sell_buy_tp_cd = 'D' 
											OR frt.sell_buy_tp_cd = 'C' THEN 1 
										ELSE 0 
									END) AS dc_cnt, 
								SUM(CASE 
										WHEN frt.sell_buy_tp_cd = 'D' 
											OR frt.sell_buy_tp_cd = 'C' THEN 
										dtl.inv_sum_amt 
										ELSE 0 
									END) AS dc_inv_sum_amt, 
								SUM(CASE 
										WHEN frt.sell_buy_tp_cd = 'D' 
											OR frt.sell_buy_tp_cd = 'C' THEN 
										dtl.bal_amt 
										ELSE 0 
									END) AS dc_bal_amt 
						FROM   tb_frt frt WITH(nolock) 
								JOIN tb_inv_dtl dtl WITH(INDEX(xif1tb_inv_dtl), nolock) 
									ON dtl.delt_flg = 'N' 
									AND frt.inv_seq = dtl.inv_seq 
						WHERE  frt.delt_flg = 'N' 
							and     frt.wms_seq  IN (SELECT WM_DOC_SEQ FROM OTHINFO T WITH(nolock) WHERE T.WM_DOC_SEQ=FRT.wms_seq)       
						GROUP  BY frt.wms_seq
					) inv_sum
					ON T1.WM_DOC_SEQ = inv_sum.wms_seq 
			) 
		)UPDATE A SET AR_CHK = B.AR_CHK,AP_CHK = B.AP_CHK,DC_CHK = B.DC_CHK
		FROM TB_WM_DOC_MST AS A, INVINFO AS B
		WHERE A.WM_DOC_SEQ = B.WM_DOC_SEQ	 	
    </update> 
    
    <select id="selectMBL_SHP_MOD_CD" parameterClass="java.util.HashMap" resultClass="SeeMasterBLVO">
    	SELECT shp_mod_cd, fm_svc_term_cd, to_svc_term_cd, cy_trdp_cd, cfs_trdp_cd
    	FROM   tb_intg_bl
    	WHERE  intg_bl_seq =  #intg_bl_seq#
    </select>
    
    <select id="selectBkgPoInfo" parameterClass="HashMap" resultClass="BkgPoInfoVO">
    	SELECT distinct(po.cust_po_no) AS cust_po_no 
    	  FROM tb_bkg_po po_itm, tb_po po 
    	 WHERE po_itm.po_sys_no = po.po_sys_no
    	   AND po_itm.bkg_seq = #bkg_seq#
    </select>
    
    <select id="selectBkgItemInfo" parameterClass="HashMap" resultClass="BkgPoItemInfoVO">
    	SELECT distinct(po_itm.cust_itm_id) AS cust_itm_id 
    	  FROM tb_bkg_po po_itm, tb_po po 
    	 WHERE po_itm.po_sys_no = po.po_sys_no
    	   AND po_itm.bkg_seq = #bkg_seq#
    </select>
    
    <select id="selectQTTN_INFO" parameterClass="HashMap" resultClass="QttnInfoVO">
    	/* BlCmmSQL.xml > selectQTTN_INFO */
    	SELECT TOP 1
    	       qttn_seq,		qttn_no,		air_sea_clss_cd,	bnd_clss_cd 
		      ,cust_cd,			cust_nm,		cust_pic_nm 
		      ,agn_cd,			agn_nm,			cmdt_cd,			cmdt_nm 
		      ,por_cd,			por_nm,			del_cd,				del_nm 
		      ,pol_cd,			pol_nm,			pod_cd,				pod_nm,			fnl_dest_loc_cd,	fnl_dest_loc_nm 
		      ,pck_qty,			pck_ut_cd,		grs_wgt_kg,			grs_wgt_lbs,	meas_cbm,			meas_cft 
		      ,mode,			tt,				carr_nm,			qttn_dt,		opr_usr_id,			vty_dt
		      ,state_cd,		state_nm,		state_cnt_cd,		curr_cd,		bkg_no,				cust_ref_no 
		      ,rmk,				rmk2,			free_form_chk,		free_form_txt,	rate_qttn_txt,		delt_flg 
		      ,rgst_usrid,		rgst_ofc_cd,	rgst_tms,			modi_usrid,		modi_ofc_cd,		modi_tms
		      ,inco_cd,			eq_type,		eq_type_cd,			chg_wgt_kg,		chg_wgt_lbs,		cust_addr
		      ,size_ut_cd
		  FROM tb_qttn 
		 WHERE delt_flg = 'N'
		   AND air_sea_clss_cd = #air_sea_clss_cd#
		   AND bnd_clss_cd = #bnd_clss_cd#
		 <isNotEmpty property="f_qttn_seq">
		   AND qttn_seq = #f_qttn_seq#
		</isNotEmpty>
		<isNotEmpty property="f_qttn_no">
		  AND qttn_no = #f_qttn_no#
		</isNotEmpty>
    </select>
    
    <select id="selectQTTN_CHG_LIST" parameterClass="HashMap" resultClass="QttnChgInfoVO">
    	/* BlCmmSQL.xml > selectQTTN_CHG_INFO */
    	SELECT qttn_chg_seq
		      ,qttn_seq
		      ,chg_desc
		      ,unit
		      ,qty
		      ,chg_unit_amt
		      ,chg_ttl_amt
		      ,delt_flg
		  FROM tb_qttn_chg
		 WHERE delt_flg = 'N'
		   AND qttn_seq = #f_qttn_seq#
    </select>
    
    <select id="selectQTTN_OTH_CHG_LIST" parameterClass="HashMap" resultClass="QttnOthChgInfoVO">
    	/* BlCmmSQL.xml > selectQTTN_OTH_CHG_INFO */
    	SELECT qttn_oth_chg_seq
		      ,qttn_seq
		      ,oth_chg_desc
		      ,oth_chg_amt
		      ,delt_flg
		  FROM tb_qttn_oth_chg
		 WHERE delt_flg = 'N'
		   AND qttn_seq = #f_qttn_seq#
    </select>
    
    <insert id="insertQTTN_INFO"  parameterClass="QttnInfoVO">
    	/* BlCmmSQL.xml > insertQTTN_INFO */
    	INSERT into tb_qttn(
		           	qttn_seq,		qttn_no,		air_sea_clss_cd,	bnd_clss_cd 
				   ,cust_cd,		cust_nm,		cust_pic_nm 
				   ,agn_cd,			agn_nm,			cmdt_cd,			cmdt_nm 
				   ,por_cd,			por_nm,			del_cd,				del_nm 
				   ,pol_cd,			pol_nm,			pod_cd,				pod_nm,			fnl_dest_loc_cd,	fnl_dest_loc_nm 
				   ,pck_qty,		pck_ut_cd,		grs_wgt_kg,			grs_wgt_lbs,	meas_cbm,			meas_cft 
				   ,mode,			tt,				carr_nm,			qttn_dt,		opr_usr_id,			vty_dt 
				   ,state_cd,		state_nm,		state_cnt_cd,		curr_cd,		bkg_no,				cust_ref_no 
				   ,rmk,			rmk2,			free_form_chk,		free_form_txt,	rate_qttn_txt,		delt_flg 
				   ,rgst_usrid,		rgst_ofc_cd,	rgst_tms,			modi_usrid,		modi_ofc_cd,		modi_tms
				   ,inco_cd,		eq_type,		eq_type_cd,			chg_wgt_kg,		chg_wgt_lbs,		cust_addr
				   ,size_ut_cd )
     	VALUES (
     			    #qttn_seq#,		#qttn_no#,		#air_sea_clss_cd#,	#bnd_clss_cd# 
				   ,#cust_cd#,		#cust_nm#,		#cust_pic_nm# 
				   ,#agn_cd#,		#agn_nm#,		#cmdt_cd#,			#cmdt_nm# 
				   ,#por_cd#,		#por_nm#,		#del_cd#,			#del_nm# 
				   ,#pol_cd#,		#pol_nm#,		#pod_cd#,			#pod_nm#,			#fnl_dest_loc_cd#,	#fnl_dest_loc_nm# 
				   ,#pck_qty#,		#pck_ut_cd#,	#grs_wgt_kg#,		#grs_wgt_lbs#,		#meas_cbm#,			#meas_cft# 
				   ,#mode#,			#tt#,			#carr_nm#,			#qttn_dt#,			#opr_usr_id#,		#vty_dt# 
				   ,#state_cd#,		#state_nm#,		#state_cnt_cd#,		#curr_cd#,			#bkg_no#,			#cust_ref_no# 
				   ,#rmk#,			#rmk2#,			#free_form_chk#,	#free_form_txt#,	#rate_qttn_txt#,	'N' 
				   ,#proc_usrid#,	#proc_ofccd#,	getdate(),			#proc_usrid#,		#proc_ofccd#,		GETUTCDATE()
				   ,#inco_cd#,		#eq_type#,		#eq_type_cd#,		#chg_wgt_kg#,		#chg_wgt_lbs#,		#cust_addr#
				   ,#size_ut_cd#
     	)
     </insert>
     
     <update id="updateQTTN_INFO" parameterClass="QttnInfoVO">
    	/* BlCmmSQL.xml > updateQTTN_INFO */
        UPDATE tb_qttn
		   SET qttn_seq 		= #qttn_seq#
		      ,qttn_no 			= #qttn_no#
		      ,cust_cd 			= #cust_cd#
		      ,cust_nm 			= #cust_nm#
		      ,cust_pic_nm		= #cust_pic_nm#
		      ,agn_cd 			= #agn_cd#
		      ,agn_nm 			= #agn_nm#
		      ,cmdt_cd 			= #cmdt_cd#
		      ,cmdt_nm 			= #cmdt_nm#
		      ,por_cd 			= #por_cd#
		      ,por_nm 			= #por_nm#
		      ,del_cd 			= #del_cd#
		      ,del_nm 			= #del_nm#
		      ,pol_cd 			= #pol_cd#
		      ,pol_nm 			= #pol_nm#
		      ,pod_cd 			= #pod_cd#
		      ,pod_nm 			= #pod_nm#
		      ,fnl_dest_loc_cd 	= #fnl_dest_loc_cd#
		      ,fnl_dest_loc_nm 	= #fnl_dest_loc_nm#
		      ,pck_qty 			= #pck_qty#
		      ,pck_ut_cd 		= #pck_ut_cd#
		      ,grs_wgt_kg 		= #grs_wgt_kg#
		      ,grs_wgt_lbs 		= #grs_wgt_lbs#
		      ,chg_wgt_kg 		= #chg_wgt_kg#
		      ,chg_wgt_lbs 		= #chg_wgt_lbs#
		      ,meas_cbm 		= #meas_cbm#
		      ,meas_cft 		= #meas_cft#
		      ,mode 			= #mode#
		      ,tt 				= #tt#
		      ,carr_nm 			= #carr_nm#
		      ,qttn_dt 			= #qttn_dt#
		      ,opr_usr_id 		= #opr_usr_id#
		      ,inco_cd 			= #inco_cd#
		      ,vty_dt 			= #vty_dt#
		      ,state_cd 		= #state_cd#
		      ,state_nm 		= #state_nm#
		      ,state_cnt_cd 	= #state_cnt_cd#
		      ,curr_cd 			= #curr_cd#
		      ,bkg_no 			= #bkg_no#
		      ,cust_ref_no 		= #cust_ref_no#
		      ,rmk 				= #rmk#
		      ,rmk2 			= #rmk2#
		      ,free_form_chk 	= #free_form_chk#
		      ,free_form_txt	= #free_form_txt#
		      ,rate_qttn_txt 	= #rate_qttn_txt#
		      ,eq_type			= #eq_type#
		      ,eq_type_cd		= #eq_type_cd#
		      ,cust_addr		= #cust_addr#
		      ,size_ut_cd       = #size_ut_cd#
		      ,modi_usrid 		= #proc_usrid#
		      ,modi_ofc_cd 		= #proc_ofccd#
		      ,modi_tms 		= GETUTCDATE()
		 WHERE air_sea_clss_cd 	= #air_sea_clss_cd#
		   AND bnd_clss_cd 		= #bnd_clss_cd#
		   AND qttn_seq 		= #qttn_seq#
    </update> 
    
    <update id="deleteQTTN_INFO" parameterClass="QttnInfoVO">
    	/* BlCmmSQL.xml > deleteQTTN_INFO */
        UPDATE tb_qttn
		   SET delt_flg 		= 'Y'
		      ,modi_usrid 		= #proc_usrid#
		      ,modi_ofc_cd 		= #proc_ofccd#
		      ,modi_tms 		= GETUTCDATE()
		 WHERE qttn_seq 		= #qttn_seq#
    </update> 
    
    <!-- Purchase Order Item 등록   -->
	<insert id="insertQTTN_CHG_LIST" parameterClass="QttnChgInfoVO">
		/* BlCmmSQL.xml > insertQTTN_CHG_LIST */
		INSERT INTO tb_qttn_chg (
			 qttn_seq
			,chg_desc
			,unit
			,qty
			,chg_unit_amt
			,chg_ttl_amt
			,delt_flg
			,rgst_usrid
			,rgst_ofc_cd
			,rgst_tms
			,modi_usrid
			,modi_ofc_cd
			,modi_tms
		) VALUES (
			 #qttn_seq#
			,#chg_desc#
			,#unit#
			,#qty#
			,#chg_unit_amt#
			,#chg_ttl_amt#
			,'N'
			,#proc_usrid#
			,#proc_ofccd#
			,getdate()
			,#proc_usrid#
			,#proc_ofccd#
			,GETUTCDATE()
		)
	</insert>
	
	<!-- Purchase Order Item 수정   -->
	<update id="updateQTTN_CHG_LIST" parameterClass="QttnChgInfoVO">
		/* BlCmmSQL.xml > updateQTTN_CHG_LIST */
		UPDATE   tb_qttn_chg
		   SET   chg_desc		= #chg_desc#
				,unit			= #unit#
				,qty			= #qty#
				,chg_unit_amt	= #chg_unit_amt#
				,chg_ttl_amt	= #chg_ttl_amt#
				,modi_usrid		= #proc_usrid#
				,modi_ofc_cd	= #proc_ofccd#
				,modi_tms		= GETUTCDATE()
		 WHERE   qttn_seq  		= #qttn_seq#
		   AND   qttn_chg_seq 	= #qttn_chg_seq#
	</update>
	
	<!-- Purchase Order Item 삭제   -->
	<update id="deleteQTTN_CHG_LIST" parameterClass="QttnChgInfoVO">
		/* BlCmmSQL.xml > deleteQTTN_CHG_LIST */
		UPDATE   tb_qttn_chg
		   SET   delt_flg		= 'Y'
				,modi_usrid		= #proc_usrid#
				,modi_ofc_cd	= #proc_ofccd#
				,modi_tms		= GETUTCDATE()
		 WHERE   qttn_seq  		= #qttn_seq#
		   AND   qttn_chg_seq 	= #qttn_chg_seq#
	</update>
	
	<!-- Purchase Order Item All 삭제   -->
	<update id="deleteQTTN_CHG_LIST_ALL" parameterClass="QttnInfoVO">
		/* BlCmmSQL.xml > deleteQTTN_CHG_LIST_ALL */
		UPDATE   tb_qttn_chg
		   SET   delt_flg		= 'Y'
				,modi_usrid		= #proc_usrid#
				,modi_ofc_cd	= #proc_ofccd#
				,modi_tms		= GETUTCDATE()
		 WHERE   qttn_seq  		= #qttn_seq#
	</update>
	
	<!-- Purchase Order Item 등록   -->
	<insert id="insertQTTN_OTH_CHG_LIST" parameterClass="QttnOthChgInfoVO">
		/* BlCmmSQL.xml > insertQTTN_OTH_CHG_LIST */
		INSERT INTO tb_qttn_oth_chg (
			 qttn_seq
			,oth_chg_desc
			,oth_chg_amt
			,delt_flg
			,rgst_usrid
			,rgst_ofc_cd
			,rgst_tms
			,modi_usrid
			,modi_ofc_cd
			,modi_tms
		) VALUES (
			 #qttn_seq#
			,#oth_chg_desc#
			,#oth_chg_amt#
			,'N'
			,#proc_usrid#
			,#proc_ofccd#
			,getdate()
			,#proc_usrid#
			,#proc_ofccd#
			,GETUTCDATE()
		)
	</insert>
	
	<!-- Purchase Order Item 수정   -->
	<update id="updateQTTN_OTH_CHG_LIST" parameterClass="QttnOthChgInfoVO">
		/* BlCmmSQL.xml > updateQTTN_OTH_CHG_LIST */
		UPDATE   tb_qttn_oth_chg
		   SET   oth_chg_desc		= #oth_chg_desc#
				,oth_chg_amt		= #oth_chg_amt#
				,modi_usrid			= #proc_usrid#
				,modi_ofc_cd		= #proc_ofccd#
				,modi_tms			= GETUTCDATE()
		 WHERE   qttn_seq  			= #qttn_seq#
		   AND   qttn_oth_chg_seq 	= #qttn_oth_chg_seq#
	</update>
	
	<!-- Purchase Order Item 삭제   -->
	<update id="deleteQTTN_OTH_CHG_LIST" parameterClass="QttnOthChgInfoVO">
		/* BlCmmSQL.xml > deleteQTTN_OTH_CHG_LIST */
		UPDATE   tb_qttn_oth_chg
		   SET   delt_flg			= 'Y'
				,modi_usrid			= #proc_usrid#
				,modi_ofc_cd		= #proc_ofccd#
				,modi_tms			= GETUTCDATE()
		 WHERE   qttn_seq  			= #qttn_seq#
		   AND   qttn_oth_chg_seq 	= #qttn_oth_chg_seq#
	</update>
	
	<!-- Purchase Order Item All 삭제   -->
	<update id="deleteQTTN_OTH_CHG_LIST_ALL" parameterClass="QttnInfoVO">
		/* BlCmmSQL.xml > deleteQTTN_OTH_CHG_LIST_ALL */
		UPDATE   tb_qttn_oth_chg
		   SET   delt_flg			= 'Y'
				,modi_usrid			= #proc_usrid#
				,modi_ofc_cd		= #proc_ofccd#
				,modi_tms			= GETUTCDATE()
		 WHERE   qttn_seq  			= #qttn_seq#
	</update>
	
	<!-- Quotation List select    -->
    <select id="selectQTTN_LIST" parameterClass="java.util.HashMap" resultClass="QttnInfoVO">
		/* BlCmmSQL.xml > selectQTTN_LIST */
   		SELECT a1.*
		  FROM (
		  	SELECT  ROW_NUMBER() OVER (ORDER BY  QTTN_DT DESC, MODI_TMS DESC) as ROWNUM,
         		    QTTN_SEQ,		QTTN_NO,		AIR_SEA_CLSS_CD,	BND_CLSS_CD, 
				    CUST_CD,		CUST_NM,		CUST_PIC_NM, 
				    AGN_CD,			AGN_NM,			CMDT_CD,			CMDT_NM, 
				    POR_CD,			POR_NM,			DEL_CD,				DEL_NM, 
				    POL_CD,			POL_NM,			POD_CD,				POD_NM,			FNL_DEST_LOC_CD,	FNL_DEST_LOC_NM, 
				    PCK_QTY,		PCK_UT_CD,		GRS_WGT_KG,			GRS_WGT_LBS,	MEAS_CBM,			MEAS_CFT, 
				    MODE,			TT,				CARR_NM,			QTTN_DT,		OPR_USR_ID,			VTY_DT, 
				    STATE_CD,		STATE_NM,		STATE_CNT_CD,		CURR_CD,		BKG_NO,				CUST_REF_NO, 
				    RMK,			RMK2,			FREE_FORM_CHK,		FREE_FORM_TXT,	RATE_QTTN_TXT,		DELT_FLG, 
				    RGST_USRID,		RGST_OFC_CD,	RGST_TMS,			MODI_USRID,		MODI_OFC_CD,		MODI_TMS,
				    INCO_CD,		CUST_ADDR
			  FROM  TB_QTTN
			 WHERE  DELT_FLG = 'N'
			   AND  AIR_SEA_CLSS_CD = #air_sea_clss_cd#
			   AND  BND_CLSS_CD = #bnd_clss_cd#
			<isNotEmpty property="f_qttn_no">
				AND  QTTN_NO LIKE '%' + #f_qttn_no# + '%'
			</isNotEmpty>
			<isNotEmpty property="f_qttn_strdt">
			   AND  QTTN_DT BETWEEN #f_qttn_strdt# AND #f_qttn_enddt#
			</isNotEmpty>
			<isNotEmpty property="f_opr_usr_id">
				AND  OPR_USR_ID LIKE '%' + #f_opr_usr_id# + '%'
			</isNotEmpty>
			<isNotEmpty property="f_cust_cd">
			   AND  CUST_CD = #f_cust_cd#
			</isNotEmpty>
			<isNotEmpty property="f_cust_nm">
			   AND  CUST_NM LIKE '%' + #f_cust_nm# + '%'
			</isNotEmpty>
			<isNotEmpty property="f_por_cd">
			   AND  POR_CD = #f_por_cd#
			</isNotEmpty>
			<isNotEmpty property="f_por_nm">
			   AND  POR_NM LIKE '%' + #f_por_nm# + '%'
			</isNotEmpty>
			<isNotEmpty property="f_pol_cd">
			   AND  POL_CD = #f_pol_cd#
			</isNotEmpty>
			<isNotEmpty property="f_pol_nm">
			   AND  POL_NM LIKE '%' + #f_pol_nm# + '%'
			</isNotEmpty>
			<isNotEmpty property="f_pod_cd">
			   AND  POD_CD = #f_pod_cd#
			</isNotEmpty>
			<isNotEmpty property="f_pod_nm">
			   AND  POD_NM LIKE '%' + #f_pod_nm# + '%'
			</isNotEmpty>
			 ) a1
			<![CDATA[ where a1.ROWNUM > #beginIdx# AND a1.ROWNUM <= #topCnt#	]]>
    </select>
    
    <!--  Quotation List select count    -->
    <select id="selectQTTN_LIST_CNT" parameterClass="java.util.HashMap" resultClass="Integer">
            SELECT  COUNT(QTTN_SEQ)    
          	  FROM  TB_QTTN
			 WHERE  DELT_FLG = 'N'
			   AND  AIR_SEA_CLSS_CD = #air_sea_clss_cd#
			   AND  BND_CLSS_CD = #bnd_clss_cd#
			<isNotEmpty property="f_qttn_no">
				AND  QTTN_NO LIKE '%' + #f_qttn_no# + '%'
			</isNotEmpty>
			<isNotEmpty property="f_qttn_strdt">
			   AND  QTTN_DT BETWEEN #f_qttn_strdt# AND #f_qttn_enddt#
			</isNotEmpty>
			<isNotEmpty property="f_opr_usr_id">
				AND  OPR_USR_ID LIKE '%' + #f_opr_usr_id# + '%'
			</isNotEmpty>
			<isNotEmpty property="f_cust_cd">
			   AND  CUST_CD = #f_cust_cd#
			</isNotEmpty>
			<isNotEmpty property="f_cust_nm">
			   AND  CUST_NM LIKE '%' + #f_cust_nm# + '%'
			</isNotEmpty>
			<isNotEmpty property="f_por_cd">
			   AND  POR_CD = #f_por_cd#
			</isNotEmpty>
			<isNotEmpty property="f_por_nm">
			   AND  POR_NM LIKE '%' + #f_por_nm# + '%'
			</isNotEmpty>
			<isNotEmpty property="f_pol_cd">
			   AND  POL_CD = #f_pol_cd#
			</isNotEmpty>
			<isNotEmpty property="f_pol_nm">
			   AND  POL_NM LIKE '%' + #f_pol_nm# + '%'
			</isNotEmpty>
			<isNotEmpty property="f_pod_cd">
			   AND  POD_CD = #f_pod_cd#
			</isNotEmpty>
			<isNotEmpty property="f_pod_nm">
			   AND  POD_NM LIKE '%' + #f_pod_nm# + '%'
			</isNotEmpty>
	</select>
	 
	
	<update id="updateBlFrtChkStatus" parameterClass="HashMap">
    /* BlCmmSQL.xml > updateBlFrtChkStatus */ 
    
		UPDATE TB_ADD_INFO_BND SET  FRT_CHK =  (CASE WHEN (SELECT
				                COUNT(1) 
				            FROM
				                TB_FRT FRT                            
				            WHERE
				                FRT.INTG_BL_SEQ      = #intg_bl_seq# 	                  
				                AND FRT.INV_STS_CD  = 'FI'                      
				                AND FRT.DELT_FLG = 'N'                    ) 	<![CDATA[ > ]]> 0 THEN 'O'
				                ELSE 'X' END) 
				,MODI_TMS			= GETUTCDATE() 
		WHERE INTG_BL_SEQ = #intg_bl_seq# 		 	
    </update>
    
</sqlMap>