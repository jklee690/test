<?xml version="1.0" encoding="UTF-8" ?>
<!DOCTYPE sqlMap PUBLIC "-//ibatis.apache.org//DTD SQL Map 2.0//EN" "http://ibatis.apache.org/dtd/sql-map-2.dtd">
<sqlMap namespace="edi.ams">
	
	<typeAlias alias="EdiAmsAirMAWBVO"  type="com.clt.apps.fis.edi.ams.air.dto.EdiAmsAirMAWBVO"/>
	<typeAlias alias="EdiAmsAirHAWBVO"  type="com.clt.apps.fis.edi.ams.air.dto.EdiAmsAirHAWBVO"/>
	<typeAlias alias="EdiAmsSendVO"  	type="com.clt.apps.fis.edi.ams.air.dto.EdiAmsSendVO"/>
	<typeAlias alias="SeeAmsVO"  type="com.clt.apps.fis.see.bmd.ams.dto.SeeAmsVO"/>
	<typeAlias alias="AieAmsVO"  type="com.clt.apps.fis.aie.bmd.ams.dto.AieAmsVO"/>
	<typeAlias alias="SeeAmsVO"  type="com.clt.apps.fis.see.bmd.ams.dto.SeeAmsVO"/>
	
	<select id="selectEDI_AMS_AIR_MasterList" parameterClass="HashMap" resultClass="EdiAmsAirMAWBVO">
		/* selectEDI_AMS_AIR_MasterList */
		SELECT  BL.BL_NO AS BL_NO
			  , BL.INTG_BL_SEQ AS INTG_BL_SEQ
			  , MST.STATUS AS STATUS
			  , X.CNT AS HBL_CNT
			  , MST.MSG_NO AS MSG_NO
			  , SUBSTRING(BL.ETD_DT_TM,   1, 8) AS ETD_DT_TM
			  , BL.MODI_USRID AS MODI_USRID
		  FROM  TB_INTG_BL BL
		  JOIN  TB_ADD_INFO_BND BND ON 
		  BL.INTG_BL_SEQ = BND.INTG_BL_SEQ
		  
		  <!-- 51589 [BNX, COMMON] KAMS MAWB 조회 조건 추가 -->
		  AND (   BL.TS1_PORT_CD IN (SELECT LOC_CD FROM TB_LOC WHERE CNT_CD = 'KR')
           OR BL.TS2_PORT_CD IN (SELECT LOC_CD FROM TB_LOC WHERE CNT_CD = 'KR')
           OR BL.TS3_PORT_CD IN (SELECT LOC_CD FROM TB_LOC WHERE CNT_CD = 'KR')
           OR BL.POD_CD IN (SELECT LOC_CD FROM TB_LOC WHERE CNT_CD = 'KR') 
            ) 
		  
		  JOIN  TB_BL_PRNR CNE_BL    
            ON  BL.INTG_BL_SEQ = CNE_BL.INTG_BL_SEQ 
            AND CNE_BL.BL_TRDP_TP_CD = 'C01'     
    	  JOIN  TB_TRDP CNE_BL_TRDP       
            ON  CNE_BL.TRDP_CD = CNE_BL_TRDP.TRDP_CD 
		  JOIN (
			SELECT  COUNT(*) AS CNT, RLT.RLT_INTG_BL_SEQ
			  FROM  TB_INTG_BL_RLT RLT
			  JOIN  TB_INTG_BL BL 
			    ON  RLT.INTG_BL_SEQ = BL.INTG_BL_SEQ AND BL.DELT_FLG = 'N'
		  GROUP BY  RLT.RLT_INTG_BL_SEQ
		  ) X ON X.RLT_INTG_BL_SEQ = BL.INTG_BL_SEQ
LEFT OUTER JOIN TB_EDI_KAMS_AIR_MST MST
			 ON MST.INTG_BL_SEQ = BL.INTG_BL_SEQ
		 WHERE  BL.DELT_FLG = 'N'
		   AND  BL.AIR_SEA_CLSS_CD = 'A'
		   AND  BL.BIZ_CLSS_CD = 'M'
		   AND  BND.BND_CLSS_CD = 'O'
        <isNotEmpty property="bl_no">
		   AND  BL.BL_NO LIKE #bl_no# + '%'
        </isNotEmpty>
        <isNotEmpty property="ofc_cd">
           AND  bl.ref_ofc_cd = #ofc_cd#
        </isNotEmpty>
        <isNotEmpty property="status">
           AND  mst.status = #status#
        </isNotEmpty>
        <isNotEmpty property="etd_strdt">
		   AND  BL.ETD_DT_TM BETWEEN ISNULL(#etd_strdt#, '00000101') + '0000' AND ISNULL(#etd_enddt#, '99991231') + '2329'
		</isNotEmpty>
	  ORDER BY  BL.ETD_DT_TM DESC
	</select>

	<select id="selectEDI_AMS_AIR_HouseList" parameterClass="HashMap" resultClass="EdiAmsAirHAWBVO">
		/* selectEDI_AMS_AIR_HouseList */
		SELECT  SHP.TRDP_NM 			AS SHP_NM
			  , SHP_TRDP.LGL_ADDR 			AS SHP_ADDR
			  , SHP_TRDP.CITY_NM 		AS SHP_CITY
			  , SHP_TRDP.STATE_CD 		AS SHP_STATE
			  , SHP_TRDP.CNT_CD 		AS SHP_CNTRY
			  , SHP_TRDP.REP_ZIP 		AS SHP_ZIP_CD
			  , SHP_CNTC_PSON.PIC_PHN	AS SHP_TEL_NO
			  , SHP_CNTC_PSON.PIC_FAX 	AS SHP_FAX_NO
			  , '' 						AS SHP_TLX_NO
			  , CNE.TRDP_NM 			AS CNE_NM
			  , CNE_TRDP.LGL_ADDR 			AS CNE_ADDR
			  , CNE_TRDP.CITY_NM 		AS CNE_CITY
			  , CNE_TRDP.STATE_CD 		AS CNE_STATE
			  , CNE_TRDP.CNT_CD 		AS CNE_CNTRY
			  , CNE_TRDP.REP_ZIP 		AS CNE_ZIP_CD
			  , CNE_CNTC_PSON.PIC_PHN 	AS CNE_TEL_NO
			  , CNE_CNTC_PSON.PIC_FAX 	AS CNE_FAX_NO
			  , '' 						AS CNE_TLX_NO
			  , BL.CUST_CURR_CD AS CVD_ISO_CURR_CD
			  , BL.FRT_TERM_CD AS CVD_PC_TERM
			  , REPLACE(BL.DECL_CRR_VAL,'.','') AS CVD_VAL_CARR
			  , 'NCV' AS CVD_VAL_CUST
			  , 'XXX' AS CVD_VAL_INSU
			  , 'KR' AS OCI_CNTRY_CD
			  , 'IMP' AS OCI_INFO_ID
			  , 'M' AS OCI_CUS_INFO_ID
			  , 'I' AS OCI_SUPP_CUS_INFO
			  , BL.BL_SER_NO AS HSN_NO
			  , SUBSTRING(REPLACE(MBL.BL_NO, '-', ''),1,3) AS MBI_AIR_PFX
			  , SUBSTRING(REPLACE(MBL.BL_NO, '-', ''),4,8) AS MBI_AWBL_NO
			  , MBL.POL_CD AS MBI_ORG_PORT
			  , MBL.POD_CD AS MBI_DEST_PORT
			  , 'T' AS MBI_SHIP_DESC_CD
			  , MBL.PCK_QTY AS MBI_NO_OF_PCS
			  , 'K' AS MBI_WGT_CD
			  , MBL.GRS_WGT AS MBI_WGT
			
			  , REPLACE(BL.BL_NO, '-', '') AS HBS_HAWBL_NO
			  , BL.POL_CD AS HBS_ORG_PORT
			  , BL.POD_CD AS HBS_DEST_PORT
			  , BL.PCK_QTY AS HBS_NO_OF_PCS
			  , 'K' AS HBS_WGT_CD
			  , BL.GRS_WGT AS HBS_WGT
			  , '' AS HBS_SLAC
			  , BL.REP_CMDT_NM AS HBS_GDS_DESC
			  , '' AS HBS_HANDLE_CD_1
			  , '' AS HBS_HANDLE_CD_2
			
			  , SUBSTRING(BL.ETA_DT_TM, 1, 8) AS ETA_DT_TM
			  , REPLACE(BL.FLT_NO, '-', '') AS FLT_NO
			  , CASE WHEN ISNULL(CNE_MBL_TRDP.DCNSL_CD, '') = ''
			  		 THEN 'XXXX' 
			         ELSE CNE_MBL_TRDP.DCNSL_CD 
			    END AS MBL_CNE_CD
			  , CNE_MBL.TRDP_NM AS MBL_CNE_NM
			  , (SELECT MAX(IATA_CD) FROM TB_TRDP where PREFIX =SUBSTRING(REPLACE(MBL.BL_NO, '-', ''),1,3) ) AS LNR_IATA_CD
		  FROM  TB_INTG_BL_RLT RLT
		  JOIN  TB_INTG_BL MBL 
			ON  RLT.RLT_INTG_BL_SEQ = MBL.INTG_BL_SEQ AND MBL.DELT_FLG = 'N'
LEFT OUTER JOIN  TB_BL_PRNR CNE_MBL
			ON  MBL.INTG_BL_SEQ = CNE_MBL.INTG_BL_SEQ AND CNE_MBL.BL_TRDP_TP_CD = 'C01'
LEFT OUTER JOIN  TB_TRDP CNE_MBL_TRDP
		    ON  CNE_MBL.TRDP_CD = CNE_MBL_TRDP.TRDP_CD
		  JOIN  TB_INTG_BL BL
			ON  RLT.INTG_BL_SEQ = BL.INTG_BL_SEQ AND BL.DELT_FLG = 'N'
LEFT OUTER JOIN  TB_BL_PRNR SHP
			ON  BL.INTG_BL_SEQ = SHP.INTG_BL_SEQ AND SHP.BL_TRDP_TP_CD = 'S01'
LEFT OUTER JOIN  TB_TRDP SHP_TRDP
			ON  SHP.TRDP_CD = SHP_TRDP.TRDP_CD
LEFT OUTER JOIN TB_TRDP_CNTC_PSON SHP_CNTC_PSON
			ON  SHP_TRDP.TRDP_CD = SHP_CNTC_PSON.TRDP_CD AND SHP_CNTC_PSON.REP_FLG = 'Y' AND SHP_CNTC_PSON.DELT_FLG = 'N'
LEFT OUTER JOIN  TB_BL_PRNR CNE
			ON  BL.INTG_BL_SEQ = CNE.INTG_BL_SEQ AND CNE.BL_TRDP_TP_CD = 'C01'
LEFT OUTER JOIN  TB_TRDP CNE_TRDP
			ON  CNE.TRDP_CD = CNE_TRDP.TRDP_CD
LEFT OUTER JOIN TB_TRDP_CNTC_PSON CNE_CNTC_PSON
			ON  CNE_TRDP.TRDP_CD = CNE_CNTC_PSON.TRDP_CD AND CNE_CNTC_PSON.REP_FLG = 'Y' AND CNE_CNTC_PSON.DELT_FLG = 'N'
LEFT OUTER JOIN  TB_BL_PRNR LNR
			ON  BL.INTG_BL_SEQ = LNR.INTG_BL_SEQ AND LNR.BL_TRDP_TP_CD = 'L01'
LEFT OUTER  JOIN  TB_TRDP LNR_TRDP
			ON  LNR.TRDP_CD = LNR_TRDP.TRDP_CD
		 WHERE  RLT.RLT_INTG_BL_SEQ = #rlt_intg_bl_seq#

	</select>
	
	<select id="selectEDI_AMS_AIR_HouseList2" parameterClass="HashMap" resultClass="EdiAmsAirHAWBVO">
		/* selectEDI_AMS_AIR_HouseList2 */
		SELECT  SHP_NM
			  , SHP_ADDR
			  , SHP_CITY
			  , SHP_STATE
			  , SHP_CNTRY
			  , SHP_ZIP_CD
			  , SHP_TEL_NO
			  , SHP_FAX_NO
			  , SHP_TLX_NO
			
			  , CNE_NM
			  , CNE_ADDR
			  , CNE_CITY
			  , CNE_STATE
			  , CNE_CNTRY
			  , CNE_ZIP_CD
			  , CNE_TEL_NO
			  , CNE_FAX_NO
			  , CNE_TLX_NO
			
			  , CVD_ISO_CURR_CD
			  , CVD_PC_TERM
			  , CVD_VAL_CARR
			  , CVD_VAL_CUST
			  , CVD_VAL_INSU
			
			  , OCI_CNTRY_CD
			  , OCI_INFO_ID
			  , OCI_CUS_INFO_ID
			  , OCI_SUPP_CUS_INFO
			  , HSN_NO
			
			  , MBI_AIR_PFX
			  , MBI_AWBL_NO
			  , MBI_ORG_PORT
			  , MBI_DEST_PORT
			  , MBI_SHIP_DESC_CD
			  , MBI_NO_OF_PCS
			  , MBI_WGT_CD
			  , MBI_WGT
			
			  , HBS_HAWBL_NO
			  , HBS_ORG_PORT
			  , HBS_DEST_PORT
			  , HBS_NO_OF_PCS
			  , HBS_WGT_CD
			  , HBS_WGT
			  , HBS_SLAC
			  , HBS_GDS_DESC
			  , HBS_HANDLE_CD_1
			  , HBS_HANDLE_CD_2
			
			  , ETA_DT_TM
			  , FLT_NO
			  , MBL_CNE_CD
			  , MBL_CNE_NM
			  , LNR_IATA_CD
			  
			  , MSG_NO
			  , SEQ
			  
			  , RGST_OFC_CD
			  , RGST_USRID
			
		  FROM  TB_EDI_KAMS_AIR_DTL DTL
		 WHERE  DTL.MSG_NO = #msg_no#
	  ORDER BY  DTL.SEQ

	</select>

	<insert id="insertEDI_AMS_AIR_MST" parameterClass="EdiAmsAirMAWBVO">
   INSERT INTO  TB_EDI_KAMS_AIR_MST(MSG_NO
													 	,INTG_BL_SEQ
														,RGST_TMS
														,RGST_USRID
														,RGST_OFC_CD
														,MODI_TMS
														,MODI_USRID
														,MODI_OFC_CD
														,STATUS)
		VALUES
			(#msg_no#,#intg_bl_seq#,GETDATE(),#rgst_usrid#,#rgst_ofc_cd#,GETUTCDATE(),#modi_usrid#,#modi_ofc_cd#,#status#)
	</insert>
	
	<update id="updateEDI_AMS_AIR_MST" parameterClass="EdiAmsAirMAWBVO">
		UPDATE  TB_EDI_KAMS_AIR_MST
		   SET  MODI_TMS = GETUTCDATE()
		      , MODI_USRID = #modi_usrid#
		      , MODI_OFC_CD = #modi_ofc_cd#
		      , STATUS = #status#
		 WHERE  MSG_NO = #msg_no#
	</update>
	
	<insert id="insertEDI_AMS_AIR_DTL" parameterClass="EdiAmsAirHAWBVO">
   INSERT INTO  TB_EDI_KAMS_AIR_DTL(
   														MSG_NO
														,SEQ
														,RGST_TMS
														,RGST_USRID
														,RGST_OFC_CD
														,MODI_TMS
														,MODI_USRID
														,MODI_OFC_CD
														,SHP_NM
														,SHP_ADDR
														,SHP_CITY
														,SHP_STATE
														,SHP_CNTRY
														,SHP_ZIP_CD
														,SHP_TEL_NO
														,SHP_FAX_NO
														,SHP_TLX_NO
														,CNE_NM
														,CNE_ADDR
														,CNE_CITY
														,CNE_STATE
														,CNE_CNTRY
														,CNE_ZIP_CD
														,CNE_TEL_NO
														,CNE_FAX_NO
														,CNE_TLX_NO
														,CVD_ISO_CURR_CD
														,CVD_PC_TERM
														,CVD_VAL_CARR
														,CVD_VAL_CUST
														,CVD_VAL_INSU
														,OCI_CNTRY_CD
														,OCI_INFO_ID
														,OCI_CUS_INFO_ID
														,OCI_SUPP_CUS_INFO
														,HSN_NO
														,MBI_AIR_PFX
														,MBI_AWBL_NO
														,MBI_ORG_PORT
														,MBI_DEST_PORT
														,MBI_SHIP_DESC_CD
														,MBI_NO_OF_PCS
														,MBI_WGT_CD
														,MBI_WGT
														,HBS_HAWBL_NO
														,HBS_ORG_PORT
														,HBS_DEST_PORT
														,HBS_NO_OF_PCS
														,HBS_WGT_CD
														,HBS_WGT
														,HBS_SLAC
														,HBS_GDS_DESC
														,HBS_HANDLE_CD_1
														,HBS_HANDLE_CD_2
														,ETA_DT_TM
														,FLT_NO
														,LNR_IATA_CD
														,PLACE
														,CARRY_PLACE
														,MBL_CNE_CD
														,MBL_CNE_NM
														)
   		VALUES
   			(#msg_no#,#seq#,GETDATE(),#rgst_usrid#,#rgst_ofc_cd#,
			 GETUTCDATE(),#modi_usrid#,#modi_ofc_cd#,
			 #shp_nm#,#shp_addr#,#shp_city#,#shp_state#,#shp_cntry#,
			 #shp_zip_cd#,#shp_tel_no#,#shp_fax_no#,#shp_tlx_no#,
			 #cne_nm#,#cne_addr#,#cne_city#,#cne_state#,#cne_cntry#,
			 #cne_zip_cd#,#cne_tel_no#,#cne_fax_no#,#cne_tlx_no#,
			 #cvd_iso_curr_cd#,#cvd_pc_term#,#cvd_val_carr#,
			 #cvd_val_cust#,#cvd_val_insu#,
			 #oci_cntry_cd#,#oci_info_id#,
			 #oci_cus_info_id#,#oci_supp_cus_info#,#hsn_no#,
			 #mbi_air_pfx#,#mbi_awbl_no#,
			 #mbi_org_port#,#mbi_dest_port#,
			 #mbi_ship_desc_cd#,#mbi_no_of_pcs#,#mbi_wgt_cd#,#mbi_wgt#,
			 #hbs_hawbl_no#,#hbs_org_port#,#hbs_dest_port#,
			 #hbs_no_of_pcs#,#hbs_wgt_cd#,#hbs_wgt#,
			 #hbs_slac#,#hbs_gds_desc#,#hbs_handle_cd_1#,#hbs_handle_cd_2#,
			 #eta_dt_tm#,#flt_no#,#lnr_iata_cd#,#place#,#carry_place#,#mbl_cne_cd#,#mbl_cne_nm#)
	</insert>
	
	<update id="updateEDI_AMS_AIR_DTL" parameterClass="EdiAmsAirHAWBVO">
		UPDATE  TB_EDI_KAMS_AIR_DTL
		   SET  modi_tms = GETUTCDATE()
			  , modi_usrid = #modi_usrid#
			  , modi_ofc_cd = #modi_ofc_cd#
			  , shp_nm = #shp_nm#
			  , shp_addr = #shp_addr#
			  , shp_city = #shp_city#
			  , shp_state = #shp_state#
			  , shp_cntry = #shp_cntry#
			  , shp_zip_cd = #shp_zip_cd#
			  , shp_tel_no = #shp_tel_no#
			  , shp_fax_no = #shp_fax_no#
			  , shp_tlx_no = #shp_tlx_no#
			  , cne_nm = #cne_nm#
			  , cne_addr = #cne_addr#
			  , cne_city = #cne_city#
			  , cne_state = #cne_state#
			  , cne_cntry = #cne_cntry#
			  , cne_zip_cd = #cne_zip_cd#
			  , cne_tel_no = #cne_tel_no#
			  , cne_fax_no = #cne_fax_no#
			  , cne_tlx_no = #cne_tlx_no#
			  , cvd_iso_curr_cd = #cvd_iso_curr_cd#
			  , cvd_pc_term = #cvd_pc_term#
			  , cvd_val_carr = #cvd_val_carr#
			  , cvd_val_cust = #cvd_val_cust#
			  , cvd_val_insu = #cvd_val_insu#
			  , oci_cntry_cd = #oci_cntry_cd#
			  , oci_info_id = #oci_info_id#
			  , oci_cus_info_id = #oci_cus_info_id#
			  , oci_supp_cus_info = #oci_supp_cus_info#
			  , hsn_no = #hsn_no#
			  , mbi_air_pfx = #mbi_air_pfx#
			  , mbi_awbl_no = #mbi_awbl_no#
			  , mbi_org_port = #mbi_org_port#
			  , mbi_dest_port = #mbi_dest_port#
			  , mbi_ship_desc_cd = #mbi_ship_desc_cd#
			  , mbi_no_of_pcs = #mbi_no_of_pcs#
			  , mbi_wgt_cd = #mbi_wgt_cd#
			  , mbi_wgt = #mbi_wgt#
			  , hbs_hawbl_no = #hbs_hawbl_no#
			  , hbs_org_port = #hbs_org_port#
			  , hbs_dest_port = #hbs_dest_port#
			  , hbs_no_of_pcs = #hbs_no_of_pcs#
			  , hbs_wgt_cd = #hbs_wgt_cd#
			  , hbs_wgt = #hbs_wgt#
			  , hbs_slac = #hbs_slac#
			  , hbs_gds_desc = #hbs_gds_desc#
			  , hbs_handle_cd_1 = #hbs_handle_cd_1#
			  , hbs_handle_cd_2 = #hbs_handle_cd_2#
			  , eta_dt_tm = #eta_dt_tm#
			  , flt_no = #flt_no#
			  , lnr_iata_cd = #lnr_iata_cd#
			  , place = #place#
			  , carry_place = #carry_place#
			  , mbl_cne_cd = #mbl_cne_cd#
			  , mbl_cne_nm = #mbl_cne_nm#
		 WHERE  msg_no = #msg_no#
		   AND  seq = #seq#
	</update>
	
	<delete id="deleteEDI_AMS_AIR_MST" parameterClass="EdiAmsAirMAWBVO">
		DELETE  
		  FROM  TB_EDI_KAMS_AIR_MST
		 WHERE  MSG_NO = #msg_no#
	</delete>

	<delete id="deleteEDI_AMS_AIR_DTL" parameterClass="EdiAmsAirMAWBVO">
		DELETE  
		  FROM  TB_EDI_KAMS_AIR_DTL
		 WHERE  MSG_NO = #msg_no#
	</delete>
	
	<select id="selectEDI_AMS_AIR_DTL_SEQ" parameterClass="EdiAmsAirHAWBVO" resultClass="Integer">
		SELECT  ISNULL(MAX(SEQ), 0) + 1
		  FROM  TB_EDI_KAMS_AIR_DTL
		 WHERE  SUBSTRING(CONVERT(VARCHAR(10), RGST_TMS, 112), 3, 8) = SUBSTRING(CONVERT(VARCHAR(10), GETDATE(), 112), 3, 8)
		   AND  LNR_IATA_CD = #lnr_iata_cd#
		   AND  RGST_OFC_CD = #rgst_ofc_cd#
	</select>
	
	<select id="selectEDI_AMS_SEND_SEQ" parameterClass="EdiAmsAirHAWBVO" resultClass="Integer">
		SELECT  ISNULL(COUNT(SEQ), 0) + 1
		  FROM  TB_EDI_KAMS_SEND
		 WHERE  1=1
		   AND  SUBSTRING(REF_MSG_NO, 6, 6) = SUBSTRING(CONVERT(VARCHAR(8), GETDATE(), 112), 3, 6)
		   AND  SUBSTRING(REF_MSG_NO, 1, 3) = #rgst_ofc_cd#
		   AND  SUBSTRING(REF_MSG_NO, 4, 2) = #lnr_iata_cd#
	</select>
	
	<insert id="insertEDI_AMS_SEND" parameterClass="EdiAmsSendVO">
		INSERT  INTO TB_EDI_KAMS_SEND 
		(
			MSG_NO, SEQ, REF_MSG_NO,
			FILE_NM, MSG_TXT, RCV_MSG_TXT,
			RGST_TMS, RGST_USRID, RGST_OFC_CD,
			MODI_TMS, MODI_USRID, MODI_OFC_CD, STATUS
		)
		VALUES
		(
			#msg_no#, #seq#, #ref_msg_no#,
			#file_nm#, #msg_txt#, #rcv_msg_txt#, 
			GETDATE(), #rgst_usrid#, #rgst_ofc_cd#, 
			GETUTCDATE(), #modi_usrid#, #modi_ofc_cd#, #status#
		)
	</insert>
	
	<select id="selectEDI_AMS_AIR_HistoryList" parameterClass="HashMap" resultClass="EdiAmsSendVO">
		SELECT  REF_MSG_NO
			  , FILE_NM
			  , MSG_TXT
			  , RCV_MSG_TXT
			  , STATUS
			  , MSG_NO
			  , SEQ
		  FROM  TB_EDI_KAMS_SEND
		 WHERE  MSG_NO = #msg_no#
	  ORDER BY  RGST_TMS ASC

	</select>
	
	<!-- SEE AMS SEARCH   -->
	<select id="selectSeeAmsLIST" parameterClass="HashMap" resultClass="SeeAmsVO">
		/*selectSeeAmsLIST*/
		SELECT  bl.trnk_vsl_nm
		       ,bl.trnk_voy
		       ,bl.pol_cd
		       ,bl.pod_cd
		       ,SUBSTRING(bl.etd_dt_tm ,1,8) AS etd_dt_tm
		       ,mbl.bl_no AS mbl_no
		       ,bl.bl_no  AS hbl_no
		       ,bl.ams_no AS ams_file_no
		       ,SUBSTRING(bl.eta_dt_tm ,1,8) AS eta_dt_tm
		       ,CONVERT(VARCHAR,amshdr.SND_TMS,110) + ' ' + CONVERT(VARCHAR,amshdr.SND_TMS,108) AS send_dt
		       ,CASE amshdr.msg_type WHEN 'MI' THEN 'Orginal'
		                                      WHEN 'AI' THEN 'Amendment' END AS send_msg
       		   ,(SELECT cd_nm FROM TB_COM_CD_DTL WHERE CD_VAL = bl.hbl_tp_cd AND com_cd = 'C016' AND USE_FLG = 'Y') AS hbl_tp
		       ,bl.pol_nm
		       ,bl.pod_nm
		       ,lnr.trdp_cd AS lnr_trdp_cd
		       ,lnr.trdp_nm AS lnr_trdp_nm
		       ,bl.intg_bl_seq
		  FROM TB_INTG_BL bl
		 JOIN tb_add_info_bnd bnd
		    ON bl.intg_bl_seq = bnd.intg_bl_seq AND bnd.bnd_clss_cd = 'O' AND bnd.delt_flg = 'N'   
		 LEFT OUTER JOIN tb_bl_prnr lnr
		    ON bl.intg_bl_seq = lnr.intg_bl_seq  AND lnr.bl_trdp_tp_cd = 'L01' AND lnr.delt_flg = 'N'
		 LEFT OUTER JOIN tb_intg_bl_rlt rlt
		    ON bl.intg_bl_seq = rlt.intg_bl_seq AND rlt.delt_flg = 'N'
		 LEFT OUTER JOIN tb_intg_bl mbl
		    ON rlt.rlt_intg_bl_seq = mbl.intg_bl_seq AND mbl.biz_clss_cd = 'M' AND mbl.delt_flg = 'N'    
		 LEFT OUTER JOIN TB_EDI_AMS_HDR amshdr
		    ON bl.ams_no = amshdr.msg_no     
		 WHERE bl.delt_flg = 'N'
		   AND bl.air_sea_clss_cd = 'S'
		   AND bl.bl_no != ''
		   AND mbl.bl_no != ''
		   AND bl.trnk_vsl_nm != ''
		   AND bl.trnk_voy != ''
		   AND bl.pol_cd != ''
		   AND bl.pod_cd != ''
		 <isNotEmpty property="etd_strdt">
		 	AND SUBSTRING(bl.etd_dt_tm, 1,8) BETWEEN #etd_strdt# AND #etd_enddt#
		 </isNotEmpty>
		 <isNotEmpty property="eta_strdt">
		 	AND SUBSTRING(bl.eta_dt_tm, 1,8) BETWEEN #eta_strdt# AND #eta_enddt#
		 </isNotEmpty>
		 <isNotEmpty property="f_trnk_vsl">
		 	AND bl.trnk_vsl_nm LIKE '%' + #f_trnk_vsl# + '%'
		 </isNotEmpty>
		 <isNotEmpty property="f_trnk_voy">
		 	AND bl.trnk_voy LIKE '%' + #f_trnk_voy# + '%'
		 </isNotEmpty>
		 <isNotEmpty property="f_pod_cd">
		 	AND bl.pod_cd = #f_pod_cd#
		 </isNotEmpty>
		 <isNotEmpty property="f_hbl_no">
		 	AND bl.bl_no = #f_hbl_no#
		 </isNotEmpty>
		 <isNotEmpty property="f_bl_type">
		 	AND bl.hbl_tp_cd = #f_bl_type#
		 </isNotEmpty>
		 <isNotEmpty property="f_ams_no">
		 	AND bl.ams_no = #f_ams_no#
		 </isNotEmpty>
		 <isEqual property="f_snd_type" compareValue="Y">
 		 	AND amshdr.msg_type in ('MI', 'AI')
		 </isEqual>
		 <isEqual property="f_snd_type" compareValue="N">
		 	AND amshdr.msg_type = ''
		 </isEqual>
         <isNotEmpty property="f_pod_nm">
            AND bl.pod_nm LIKE #f_pod_nm#+'%' 
         </isNotEmpty>
	</select>
	
	
	
	
	<!-- AIE AMS SEARCH   -->
	<select id="selectAieAmsLIST" parameterClass="HashMap" resultClass="AieAmsVO">
		SELECT  bl.obrd_dt_tm
			   ,bl.pol_cd
		       ,bl.pod_cd
		       ,bl.pol_nm
		       ,bl.pod_nm
		       ,mbl.bl_no AS mbl_no
		       ,bl.bl_no  AS hbl_no
		       ,bl.flt_no
		       ,'' AS send_dt
		       ,'' AS send_sts
       		   ,bl.intg_bl_seq
       		   ,mbl.intg_bl_seq AS mbl_intg_bl_seq
		  FROM TB_INTG_BL bl
		 JOIN tb_add_info_bnd bnd
		    ON bl.intg_bl_seq = bnd.intg_bl_seq AND bnd.bnd_clss_cd = 'O'  AND bnd.delt_flg = 'N'   
		 LEFT OUTER JOIN tb_intg_bl_rlt rlt
		    ON bl.intg_bl_seq = rlt.intg_bl_seq AND rlt.delt_flg = 'N'
		 LEFT OUTER JOIN tb_intg_bl mbl
		    ON rlt.rlt_intg_bl_seq = mbl.intg_bl_seq AND mbl.biz_clss_cd = 'M' AND mbl.delt_flg = 'N'    
		 WHERE bl.delt_flg = 'N'
		   AND bl.air_sea_clss_cd = 'A'
		 <isNotEmpty property="dept_strdt">
		 	AND SUBSTRING(bl.obrd_dt_tm, 1,8) BETWEEN #dept_strdt# AND #dept_enddt#
		 </isNotEmpty>
		 <isNotEmpty property="f_mbl_no">
		 	AND mbl.bl_no = #f_mbl_no#
		 </isNotEmpty>
	</select>
	
	
	<!-- AIE AMS SEARCH   -->
	<select id="selectAieAmsInfo" parameterClass="HashMap" resultClass="AieAmsVO">
		SELECT bl.intg_bl_seq
		      ,bl.bl_no 						AS mbl_no
		      ,bl.pol_cd
		      ,bl.pol_nm
		      ,bl.pod_cd
		      ,bl.pod_nm
		      ,bl.PCK_QTY 						AS qty
		      ,bl.GRS_WGT 						AS wgt
		      ,shp.TRDP_CD 						AS shp_cd
		      ,shp.TRDP_NM 						AS shp_nm
		      ,substring(shp.TRDP_ADDR,1,35) 	AS shp_addr
		      ,(SELECT REP_ZIP FROM TB_TRDP WHERE TRDP_CD = shp.TRDP_CD AND DELT_FLG = 'N')  AS shp_ziq
		      ,(SELECT CNT_CD  FROM TB_TRDP WHERE TRDP_CD = shp.TRDP_CD AND DELT_FLG = 'N')  AS shp_cnt
		      ,cne.TRDP_CD 						AS cne_cd
		      ,cne.TRDP_NM 						AS cne_nm
		      ,substring(cne.TRDP_ADDR,1,35) 	AS cne_addr
		      ,(SELECT REP_ZIP FROM TB_TRDP WHERE TRDP_CD = cne.TRDP_CD AND DELT_FLG = 'N')  AS cne_ziq
		      ,(SELECT CNT_CD  FROM TB_TRDP WHERE TRDP_CD = cne.TRDP_CD AND DELT_FLG = 'N')  AS cne_cnt
		      ,bl.curr_cd
		      ,bl.frt_term_cd
		  FROM TB_INTG_BL bl
		 LEFT OUTER JOIN tb_bl_prnr shp
		    ON bl.intg_bl_seq = shp.intg_bl_seq  AND shp.bl_trdp_tp_cd = 'S01' AND shp.delt_flg = 'N'
         LEFT OUTER JOIN tb_bl_prnr cne
		    ON bl.intg_bl_seq = cne.intg_bl_seq  AND cne.bl_trdp_tp_cd = 'C01' AND cne.delt_flg = 'N'
		 WHERE bl.delt_flg = 'N'
		 <isNotEmpty property="f_intg_bl_seq">
		 	AND bl.intg_bl_seq = #f_intg_bl_seq#
		 </isNotEmpty>
		 <isNotEmpty property="f_mbl_no">
		 	AND bl.bl_no = #f_mbl_no#
		 </isNotEmpty>
	</select>
	
	<!-- AIE AMS SEARCH   -->
	<select id="selectAieAmsHblList" parameterClass="HashMap" resultClass="AieAmsVO">
		SELECT hbl.obrd_dt_tm	AS hbl_obrd_dt_tm
		      ,hbl.bl_no 		AS hbl_no
		      ,hbl.pol_cd		AS hbl_pol_cd
		      ,hbl.pol_nm		AS hbl_pol_nm
		      ,hbl.pod_cd		AS hbl_pod_cd
		      ,hbl.pod_nm		AS hbl_pod_nm
		      ,hbl.pck_qty		AS hbl_qty
		      ,hbl.grs_wgt		AS hbl_wgt
		      ,hbl.intg_bl_seq	AS hbl_intg_bl_seq
		  FROM TB_INTG_BL mbl
		 LEFT OUTER JOIN tb_intg_bl_rlt rlt
		    ON mbl.intg_bl_seq = rlt.rlt_intg_bl_seq AND rlt.delt_flg = 'N'
		 LEFT OUTER JOIN tb_intg_bl hbl
		    ON rlt.intg_bl_seq = hbl.intg_bl_seq AND hbl.delt_flg = 'N'    
		 WHERE mbl.DELT_FLG = 'N'
		 <isNotEmpty property="f_intg_bl_seq">
		 	AND mbl.intg_bl_seq = #f_intg_bl_seq#
		 </isNotEmpty>
		 <isNotEmpty property="f_mbl_no">
		 	AND mbl.bl_no = #f_mbl_no#
		 </isNotEmpty>
	</select>
	
	
	
	
	<!-- SEE AMS SEARCH   -->
	<select id="selectSeeAmsInfo" parameterClass="HashMap" resultClass="SeeAmsVO">
		/*	selectSeeAmsInfo */
		SELECT
					bl.trnk_vsl_cd         ,
		        	bl.trnk_vsl_nm         ,
			        bl.trnk_voy         ,
			        bl.pol_cd         ,
			        pol.ams_loc_val AS ams_pol_cd,
			        bl.pol_nm         ,
			        bl.pod_cd         ,
			        pod.ams_loc_val AS ams_pod_cd,
			        bl.pod_nm         ,
			        bl.etd_dt_tm,
			        bl.eta_dt_tm,
			        vsl.cnt_cd 		,
			        vsl.vsl_cd 		,
			        bl.intg_bl_seq          
	 	  FROM TB_INTG_BL bl
	 	     LEFT OUTER JOIN TB_VSL vsl
	 	       ON  bl.trnk_vsl_cd = vsl.vsl_cd
	 	      , TB_LOC pol, TB_LOC pod 
		 WHERE 1=1
		     AND bl.pol_cd = pol.loc_cd
		     AND bl.pod_cd = pod.loc_cd
		     AND bl.delt_flg = 'N'   
		 	 AND bl.intg_bl_seq = #f_intg_bl_seq#
	</select>
	
	
	<!-- SEE AMS SEARCH   -->
	<select id="selectSeeAmsInfoList" parameterClass="HashMap" resultClass="SeeAmsVO">
		/*	selectSeeAmsInfoList	*/
		SELECT mbl.bl_no		AS mbl_no
			      ,bl.bl_no			AS hbl_no
				  ,(SELECT cd_nm FROM TB_COM_CD_DTL WHERE CD_VAL = bl.hbl_tp_cd AND com_cd = 'C016' AND USE_FLG = 'Y') AS hbl_tp
				  ,''				AS sub_tp
				  ,bl.ams_no				AS ams_file_no
				  ,bl.eta_dt_tm
				  ,bl.pol_cd
				  ,amsbl.last_pol_ams				AS ams_lst_pol_cd
				  ,amsbl.last_usa_ams				AS ams_usa_cd
				  ,amsbl.bond_id				AS bond_id
				  ,bl.pod_cd
				  ,bl.del_cd
				  ,bl.pck_qty
				  ,amsbl.it_no				AS it_no
				  ,amsbl.it_type				AS it_tp
				  ,amsbl.hub_ams				AS hub_ams
				  ,amsbl.msg_sts				AS msg_sts
				  ,CASE amsbl.msg_sts WHEN 'A' THEN 'B'
				                              WHEN 'B' THEN 'B'
				                              WHEN 'D' THEN 'A' END AS ams_snd
				  ,bl.intg_bl_seq
				  ,bl.por_nm
				  ,bl.del_cd
				  ,(SELECT ams_pck_cd_val FROM tb_pck_ut_cd WHERE PCK_UT_CD = bl.pck_ut_cd) AS pck_ut_cd
				  ,bl.grs_wgt
				  ,'KG' AS grs_wgt_ut_cd
				  ,shp.trdp_cd AS shpr_cd
			      ,shp.trdp_nm AS shpr_nm
			      ,shp.trdp_addr AS shpr_addr
			      ,cne.trdp_cd AS cnee_cd
			      ,cne.trdp_nm AS cnee_nm
			      ,cne.trdp_addr AS cnee_addr
			      ,ntf.trdp_cd AS ntfy_cd
			      ,ntf.trdp_nm AS ntfy_nm
			      ,ntf.trdp_addr AS ntfy_addr
			      ,amsbl.hub_ams
			      ,amsbl.last_usa_ams
			      ,amsbl.bond_id
        		  ,CASE amshdr.msg_type WHEN 'MI' THEN 'Orginal'
		                                      WHEN 'AI' THEN 'Amendment' END AS ams_sts
		          , (SELECT AMS_LOC_VAL FROM TB_LOC WHERE LOC_CD = bl.pol_cd) ams_pol_cd
		          , (SELECT AMS_LOC_VAL FROM TB_LOC WHERE LOC_CD = bl.pod_cd) ams_pod_cd
		          , (SELECT AMS_LOC_VAL FROM TB_LOC WHERE LOC_CD = bl.del_cd) ams_del_cd
		          , (SELECT LOC_CD FROM TB_LOC WHERE LOC_CD = amsbl.last_pol_ams) lst_pol_cd
		          , (SELECT LOC_CD FROM TB_LOC WHERE LOC_CD = amsbl.last_usa_ams) usa_cd                            
		  FROM TB_INTG_BL bl
		 JOIN  TB_ADD_INFO_BND bnd 
		    ON bl.intg_bl_seq = bnd.intg_bl_seq AND bnd.bnd_clss_cd = 'O' AND bnd.delt_flg = 'N'    
		 LEFT OUTER JOIN tb_intg_bl_rlt rlt
		    ON bl.intg_bl_seq = rlt.intg_bl_seq AND rlt.delt_flg = 'N'
		 LEFT OUTER JOIN tb_intg_bl mbl
		    ON rlt.rlt_intg_bl_seq = mbl.intg_bl_seq AND mbl.biz_clss_cd = 'M' AND mbl.delt_flg = 'N'
		 LEFT OUTER JOIN tb_bl_prnr shp            
				ON   bl.intg_bl_seq = shp.intg_bl_seq  
				AND shp.bl_trdp_tp_cd = 'S01' 
				AND shp.delt_flg = 'N'           
		 LEFT OUTER JOIN tb_bl_prnr cne            
				ON   bl.intg_bl_seq = cne.intg_bl_seq  
				AND cne.bl_trdp_tp_cd = 'C01' 
				AND cne.delt_flg = 'N'  
		 LEFT OUTER JOIN tb_bl_prnr ntf            
				ON   bl.intg_bl_seq = ntf.intg_bl_seq  
				AND ntf.bl_trdp_tp_cd = 'N01' 
				AND ntf.delt_flg = 'N'
		LEFT OUTER JOIN TB_EDI_AMS_HDR amshdr
		       ON bl.ams_no = amshdr.msg_no  
		LEFT OUTER JOIN TB_EDI_AMS_BL amsbl
		       ON bl.ams_no = amsbl.msg_no 
		       AND bl.bl_no = amsbl.blnbr         
		 WHERE bl.delt_flg = 'N'
		     AND bl.air_sea_clss_cd=  'S'
		     AND bl.biz_clss_cd=  'H'
			 AND bl.TRNK_VOY = #f_voy_cd#
			 AND bl.TRNK_VSL_NM = #f_vsl_nm#
			 AND bl.POL_CD = #f_pol_cd#
			 AND bl.POD_CD = #f_pod_cd#
			 AND bl.TRNK_VSL_NM != ''
			 AND bl.TRNK_VOY != ''
			 AND bl.POL_CD != ''
			 AND bl.POD_CD != ''
	</select>
	
	
	<!-- SEE AMS SEARCH   -->
	<select id="serachSeeAmsCntrList" parameterClass="HashMap" resultClass="SeeAmsVO">
		SELECT a.cntr_no
		      ,a.cntr_tpsz_cd
		      ,a.seal_no1
		      ,a.cgo_pck_qty
		      ,a.cgo_wgt
		      ,a.cntr_list_seq
		      ,a.intg_bl_seq
		      ,b.AMS_CNTR_CD
		  from tb_cntr_list a, TB_CNTR_TPSZ b
		 WHERE a.delt_flg = 'N' 
		   AND a.CNTR_TPSZ_CD = b.CNTR_TPSZ_CD
		   AND intg_bl_seq = #intg_bl_seq#
	</select>
	
	<!-- SEE AMS SEARCH   -->
	<select id="serachSeeAmsShpCmdtList" parameterClass="HashMap" resultClass="SeeAmsVO">
		SELECT shp_cmdt_cd, shp_cmdt_nm, pck_qty, dg_cd_tp, dg_cd, pck_ut_cd 
		  FROM tb_shp_cmdt
		 WHERE intg_bl_seq = #intg_bl_seq#
		    AND CNTR_LIST_SEQ = #cntr_list_seq#
		    AND  delt_flg = 'N'
	</select>
	
	<!-- SEE AMS SEARCH   -->
	<select id="serachSeeAmsCntrDngr" parameterClass="HashMap" resultClass="SeeAmsVO">
		SELECT dg_cd_tp, dg_cd 
		    FROM tb_shp_cmdt
		   WHERE intg_bl_seq = #intg_bl_seq#
		     AND CNTR_LIST_SEQ =#cntr_list_seq# /*'146'*/
		     AND DG_CD_TP != ''
		     AND  delt_flg = 'N'
	</select>
	
	
	
	
	
	
	
	
	
	
	
	
	
	
	
	
	
	<insert id="insertEdiAmsHdr" parameterClass="com.clt.apps.fis.see.bmd.ams.dto.EdiAmsHdrVO">
		INSERT INTO TB_EDI_AMS_HDR
           (MSG_NO
           ,MSG_TYPE
           ,SCAC
           ,VSL_FULLNAME
           ,VSL_VOYAGE
           ,VSL_FLAG
           ,BL_COUNT
           ,H_POL_AMS
           ,H_POL_ETD
           ,POD_AMS
           ,POD_ETA
           ,REF_NO
           ,CUST_ID
           ,FILE_NM
           ,TRNS_STS
           ,SND_TMS
           ,RCV_TMS
           ,RGST_USRID
           ,RGST_OFC_CD
           ,RGST_TMS)
     VALUES
           (#msg_no#
           ,#msg_type#
           ,#scac#
           ,#vsl_fullname#
           ,#vsl_voyage#
           ,#vsl_flag#
           ,#bl_count#
           ,#h_pol_ams#
           ,#h_pol_etd#
           ,#pod_ams#
           ,#pod_eta#
           ,#ref_no#
           ,#cust_id#
           ,#file_nm#
           ,#trns_sts#
           ,GETDATE()
           ,#rcv_tms#
           ,#rgst_usrid#
           ,#rgst_ofc_cd#
           ,GETUTCDATE()
           )
	</insert>
	
	<insert id="insertEdiAmsBl" parameterClass="com.clt.apps.fis.see.bmd.ams.dto.EdiAmsBlVO">
		INSERT INTO TB_EDI_AMS_BL
           (MSG_NO
           ,BLNBR
           ,REFNBR
           ,MSG_STS
           ,POR_FULLNAME
           ,LAST_POL_AMS
           ,POL_AMS
           ,DEL_AMS
           ,HUB_AMS
           ,LAST_USA_AMS
           ,BLPKG
           ,BLPKGU
           ,BLWGT
           ,BLWGTU
           ,SNP
           ,IT_NO
           ,IT_TYPE
           ,BOND_ID
           ,SHPR_NM1
           ,SHPR_NM2
           ,SHPR_ADD1
           ,SHPR_ADD2
           ,SHPR_ADD3
           ,CNEE_NM1
           ,CNEE_NM2
           ,CNEE_ADD1
           ,CNEE_ADD2
           ,CNEE_ADD3
           ,NTFY_NM1
           ,NTFY_NM2
           ,NTFY_ADD1
           ,NTFY_ADD2
           ,NTFY_ADD3
           ,ERR_FLG)
     VALUES
           (#msg_no#
           ,#blnbr#
           ,#refnbr#
           ,#msg_sts#
           ,#por_fullname#
           ,#last_pol_ams#
           ,#pol_ams#
           ,#del_ams#
           ,#hub_ams#
           ,#last_usa_ams#
           ,#blpkg#
           ,#blpkgu#
           ,#blwgt#
           ,#blwgtu#
           ,#snp#
           ,#it_no#
           ,#it_type#
           ,#bond_id#
           ,#shpr_nm1#
           ,#shpr_nm2#
           ,#shpr_add1#
           ,#shpr_add2#
           ,#shpr_add3#
           ,#cnee_nm1#
           ,#cnee_nm2#
           ,#cnee_add1#
           ,#cnee_add2#
           ,#cnee_add3#
           ,#ntfy_nm1#
           ,#ntfy_nm2#
           ,#ntfy_add1#
           ,#ntfy_add2#
           ,#ntfy_add3#
           ,#err_flg#)
	</insert>
	
	<insert id="insertEdiAmsCntr" parameterClass="com.clt.apps.fis.see.bmd.ams.dto.EdiAmsCntrVO">
		INSERT INTO TB_EDI_AMS_CNTR
           (MSG_NO
           ,BLNBR
           ,CNTRNBR
           ,CNTRTYPE
           ,SEALNBR
           ,FM_IND)
     VALUES
           (#msg_no#
           ,#blnbr#
           ,#cntrnbr#
           ,#cntrtype#
           ,#sealnbr#
           ,#fm_ind#)
	</insert>
	
	<insert id="insertEdiAmsCntrDesc" parameterClass="com.clt.apps.fis.see.bmd.ams.dto.EdiAmsCntrDescVO">
		INSERT INTO TB_EDI_AMS_CNTR_DESC
           (MSG_NO
           ,BLNBR
           ,CNTRNBR
           ,SEQ
           ,D_PKG
           ,D_PUNIT
           ,D_CMDT
           ,D_DESC)	
     VALUES
           (#msg_no#
           ,#blnbr#
           ,#cntrnbr#
           ,#seq#
           ,#d_pkg#
           ,#d_punit#
           ,#d_cmdt#
           ,#d_desc#)
	</insert>
	
	<insert id="insertEdiAmsCntrDngr" parameterClass="com.clt.apps.fis.see.bmd.ams.dto.EdiAmsCntrDngrVO">
		INSERT INTO TB_EDI_AMS_CNTR_DNGR
           (MSG_NO
           ,BLNBR
           ,CNTRNBR
           ,SEQ
           ,HAZ_CODE
           ,HAZ_QUAL)
     VALUES
           (#msg_no#
           ,#blnbr#
           ,#cntrnbr#
           ,#seq#
           ,#haz_code#
           ,#haz_qual#)
	</insert>
	
	<select id="selectEdiAmsMsgNo" resultClass="String">
		SELECT 'SEE' + SUBSTRING(CONVERT(VARCHAR(10), GETDATE(), 112), 3, 8) + ISNULL(dbo.LPAD(MAX(SUBSTRING(MSG_NO, 10, 5))+1, 5, '0'), '00001') AS MSG_NO
		  FROM TB_EDI_AMS_HDR
		 WHERE MSG_NO LIKE 'SEE' + SUBSTRING(CONVERT(VARCHAR(10), GETDATE(), 112), 3, 8) + '%'
	</select>
	
	<select id="selectEdiAmsSendChk" resultClass="String">
		 SELECT TRNS_STS
           FROM
		            TB_EDI_AMS_HDR A,
		            TB_EDI_AMS_BL B          
          WHERE A.MSG_NO = B.MSG_NO           
            AND SCAC =  #scac#  
            AND VSL_FULLNAME =  #vsl_fullname#    
            AND VSL_VOYAGE = #vsl_voyage#            
            AND H_POL_AMS =  #h_pol_amd#         
            AND POD_AMS =  #pod_ams#
            AND A.TRNS_STS = 'S'     
	</select>
	
	<select id="selectEdiAmsMsgType" resultClass="String">
		 SELECT CASE WHEN (SUM(AA.ADD_CNT) - SUM(AA.DEL_CNT)) = 0 THEN 'MI'
		             WHEN (SUM(AA.ADD_CNT) - SUM(AA.DEL_CNT)) > 0 THEN 'AI'
		             ELSE 'MI' END MSG_TYPE
		   FROM ( 
					 SELECT
					        CASE B.MSG_STS WHEN 'A' THEN 1 ELSE 0 END AS ADD_CNT,
					        CASE B.MSG_STS WHEN 'D' THEN 1 ELSE 0 END AS DEL_CNT
					        FROM
					            TB_EDI_AMS_HDR A,
					            TB_EDI_AMS_BL B          
					        WHERE
					            A.MSG_NO = B.MSG_NO           
					            AND SCAC =  #scac# 
					            AND VSL_FULLNAME =  #vsl_fullname#    
					            AND VSL_VOYAGE =  #vsl_voyage#         
					            AND H_POL_AMS = #h_pol_amd#   
					            AND POD_AMS =  #pod_ams#
					            AND A.TRNS_STS = 'R'
					            AND B.MSG_STS IN ('A', 'D')    
					            AND B.ERR_FLG = 'N'    
		            ) AA
	</select>
	
	<!-- select id="selectEdiAmsMsgType" resultClass="String">
	 /*
		 SELECT MIN(CASE WHEN(AA.TRNS_STS = 'S') THEN '' 
		             			  WHEN(AA.TRNS_STS = 'R') AND AA.BL_COUNT - err_cnt > 0 THEN 'AI'
		             			  WHEN(AA.TRNS_STS = 'R') AND AA.BL_COUNT - err_cnt = 0 THEN 'MI'  
		        		  END) AS MSG_TYPE     
		   FROM (
				 SELECT MIN(A.TRNS_STS) AS TRNS_STS
						, MIN(A.BL_COUNT) AS BL_COUNT
						, COUNT(case when(B.ERR_FLG='Y') then 1 else 0 end) as err_cnt
				   FROM TB_EDI_AMS_HDR A, TB_EDI_AMS_BL B   
				  WHERE A.MSG_NO = B.MSG_NO 
				     AND SCAC = #scac# 
		 		     AND VSL_FULLNAME = #vsl_fullname# 
		 		     AND VSL_VOYAGE = #vsl_voyage# 
		 		     AND H_POL_AMS = #h_pol_amd# 
		 		     AND POD_AMS = #pod_ams#
				  group by A.MSG_NO ) AA
		*/
	</select  -->
		
	<update id="updateAmsBlInfo" parameterClass="com.clt.apps.fis.see.bmd.ams.dto.EdiAmsBlVO">
		UPDATE  TB_INTG_BL
		   SET  AMS_NO = #msg_no#
		 WHERE  intg_bl_seq = #intg_bl_seq#
	</update>
	
	
	<select id="serachSeeAmsRcvList" parameterClass="HashMap" resultClass="com.clt.apps.fis.see.bmd.ams.dto.EdiAmsRcvVO">
		/* serachSeeAmsRcvList */
		SELECT MSG_NO, MSG_TYPE, MSG_SEQ, SND_TMS
			       , CONVERT(VARCHAR,RCV_TMS,110) + ' ' + CONVERT(VARCHAR,RCV_TMS,108) AS RCV_TMS
			       , BL_NO
			       , STS 
			       , ERR_MSG AS rslt_msg
			       , DISP_CD
			 FROM 
					(
					SELECT B.MSG_NO, B.MSG_TYPE, B.MSG_SEQ, B.SND_TMS
					       , B.RCV_TMS 
					       , A.BLNBR AS BL_NO
					       , CASE WHEN B.TRNS_STS = 'R' AND A.ERR_FLG = 'N' THEN 'OK'
				                     WHEN B.TRNS_STS = 'R' AND A.ERR_FLG = 'Y' THEN 'ERROR'
				             END AS STS
                           , A.ERR_MSG
					       , '' AS DISP_CD
					 FROM TB_EDI_AMS_BL A, TB_EDI_AMS_HDR B
					WHERE A.MSG_NO = B.MSG_NO 
					  AND A.BLNBR = #bl_no#
					UNION ALL
					SELECT '' AS MSG_NO, MSG_TYPE, MSG_SEQ, '' AS SND_TMS
					       , RCV_TMS 
					       , BL_NO
					       , 'OK' AS STS
					       , REMARK AS ERR_MSG
					       , DISP_CD
					  FROM TB_EDI_AMS_BL_STS
					 WHERE BL_NO = #bl_no#
				   UNION ALL 
				   SELECT A.MSG_NO, A.MSG_TYPE, A.MSG_SEQ, '' AS SND_TMS
					       , B.RCV_TMS 
					       , A.BLNBR
					       , 'ERROR' AS STS
					       , A.ERR_MSG
					       , '' AS DISP_CD
					  FROM TB_EDI_AMS_RCV_ERR A, TB_EDI_AMS_HDR B
					 WHERE A.MSG_NO = B.MSG_NO
					    AND BLNBR = #bl_no#
					) AA
			ORDER BY RCV_TMS DESC, SND_TMS DESC
	</select>
	
	<select id="serachSeeAmsSndHis" parameterClass="HashMap" resultClass="com.clt.apps.fis.see.bmd.ams.dto.EdiAmsSndHisVO">
		/* serachSeeAmsSndHis */
		SELECT A.BLNBR, A.MSG_NO, B.MSG_TYPE, A.SNP, A.LAST_POL_AMS
			       , CASE WHEN A.IT_TYPE='F' THEN 'Y' ELSE 'N' END FROB 
			       , CONVERT(VARCHAR,B.SND_TMS,110) + ' ' + CONVERT(VARCHAR,B.SND_TMS,108) AS SND_TMS, A.MSG_NO  
			       ,CASE B.msg_type WHEN 'MI' THEN 'Orginal'
		                                      WHEN 'AI' THEN 'Amendment' END AS ams_snd
		           ,B.file_nm AS snd_file_nm                           
		  FROM TB_EDI_AMS_BL A, TB_EDI_AMS_HDR B
		 WHERE A.MSG_NO = B.MSG_NO
			 AND A.BLNBR = #blnbr#
		  ORDER BY SND_TMS DESC
	</select>
	
	<select id="serachEdiSmtAmsHdr" parameterClass="HashMap" resultClass="com.clt.apps.fis.see.bmd.ams.dto.EdiAmsHdrVO">
		/* serachEdiSmtAmsHdr */
		SELECT REF_NO, MSG_NO, MSG_DATE
		  FROM TB_EDI_SMTAMS_HDR
		 WHERE 1=1
		 	<isNotEmpty property="ref_no">
		 	AND REF_NO = #ref_no#
		 	</isNotEmpty>
		 	<isNotEmpty property="msg_no">
		 	AND MSG_NO = #msg_no#
		 	</isNotEmpty>
			 
	</select>
	
	<insert id="insertEdiSmtAmsHdr" parameterClass="com.clt.apps.fis.see.bmd.ams.dto.EdiAmsHdrVO">
		INSERT INTO TB_EDI_SMTAMS_HDR
											           (MSG_NO
											           ,MSG_TYPE
											           ,SCAC
											           ,VSL_FULLNAME
											           ,VSL_VOYAGE
											           ,VSL_FLAG
											           ,BL_COUNT
											           ,H_POL_AMS
											           ,H_POL_ETD
											           ,POD_AMS
											           ,POD_ETA
											           ,REF_NO
											           ,CUST_ID
											           ,FILE_NM
											           ,RGST_USRID
											           ,RGST_OFC_CD
											           ,RGST_TMS
											           ,MSG_DATE
											           ,DNLD_DATE)
											     VALUES
											           (#msg_no#
											           ,#msg_type#
											           ,#scac#
											           ,#vsl_fullname#
											           ,#vsl_voyage#
											           ,#vsl_flag#
											           ,#bl_count#
											           ,#h_pol_ams#
											           ,#h_pol_etd#
											           ,#pod_ams#
											           ,#pod_eta#
											           ,#ref_no#
											           ,#cust_id#
											           ,#file_nm#
											           ,#rgst_usrid#
											           ,#rgst_ofc_cd#
											           ,GETDATE()
											           ,#msg_date#
											           ,#dnld_date#)
	</insert>
	
	<insert id="insertEdiSmtAmsBl" parameterClass="com.clt.apps.fis.see.bmd.ams.dto.EdiAmsBlVO">
		INSERT INTO TB_EDI_SMTAMS_BL
										           (MSG_NO
										           ,BLNBR
										           ,REFNBR
										           ,MSG_STS
										           ,POR_FULLNAME
										           ,LAST_POL_AMS
										           ,POL_AMS
										           ,DEL_AMS
										           ,HUB_AMS
										           ,LAST_USA_AMS
										           ,BLPKG
										           ,BLPKGU
										           ,BLWGT
										           ,BLWGTU
										           ,SNP
										           ,IT_NO
										           ,IT_TYPE
										           ,BOND_ID
										           ,SHPR_NM1
										           ,SHPR_NM2
										           ,SHPR_ADD1
										           ,SHPR_ADD2
										           ,SHPR_ADD3
										           ,CNEE_NM1
										           ,CNEE_NM2
										           ,CNEE_ADD1
										           ,CNEE_ADD2
										           ,CNEE_ADD3
										           ,NTFY_NM1
										           ,NTFY_NM2
										           ,NTFY_ADD1
										           ,NTFY_ADD2
										           ,NTFY_ADD3
										           ,DL_STS)
										     VALUES
										           (#msg_no#
										           ,#blnbr#
										           ,#refnbr#
										           ,#msg_sts#
										           ,#por_fullname#
										           ,#last_pol_ams#
										           ,#pol_ams#
										           ,#del_ams#
										           ,#hub_ams#
										           ,#last_usa_ams#
										           ,#blpkg#
										           ,#blpkgu#
										           ,#blwgt#
										           ,#blwgtu#
										           ,#snp#
										           ,#it_no#
										           ,#it_type#
										           ,#bond_id#
										           ,#shpr_nm1#
										           ,#shpr_nm2#
										           ,#shpr_add1#
										           ,#shpr_add2#
										           ,#shpr_add3#
										           ,#cnee_nm1#
										           ,#cnee_nm2#
										           ,#cnee_add1#
										           ,#cnee_add2#
										           ,#cnee_add3#
										           ,#ntfy_nm1#
										           ,#ntfy_nm2#
										           ,#ntfy_add1#
										           ,#ntfy_add2#
										           ,#ntfy_add3#
										           ,#dl_sts#)
	</insert>
           
	<insert id="insertEdiSmtAmsCntr" parameterClass="com.clt.apps.fis.see.bmd.ams.dto.EdiAmsCntrVO">
		INSERT INTO TB_EDI_SMTAMS_CNTR
           (MSG_NO
           ,BLNBR
           ,CNTRNBR
           ,CNTRTYPE
           ,SEALNBR
           ,FM_IND)
     VALUES
           (#msg_no#
           ,#blnbr#
           ,#cntrnbr#
           ,#cntrtype#
           ,#sealnbr#
           ,#fm_ind#)
	</insert>
	
	<insert id="insertEdiSmtAmsCntrDesc" parameterClass="com.clt.apps.fis.see.bmd.ams.dto.EdiAmsCntrDescVO">
		INSERT INTO TB_EDI_SMTAMS_CNTR_DESC
           (MSG_NO
           ,BLNBR
           ,CNTRNBR
           ,SEQ
           ,D_PKG
           ,D_PUNIT
           ,D_CMDT
           ,D_DESC
           ,D_MARK)	
     VALUES
           (#msg_no#
           ,#blnbr#
           ,#cntrnbr#
           ,#seq#
           ,#d_pkg#
           ,#d_punit#
           ,#d_cmdt#
           ,#d_desc#
           ,#d_mark#)
	</insert>
	
	<insert id="insertEdiSmtAmsCntrDngr" parameterClass="com.clt.apps.fis.see.bmd.ams.dto.EdiAmsCntrDngrVO">
		INSERT INTO TB_EDI_SMTAMS_CNTR_DNGR
           (MSG_NO
           ,BLNBR
           ,CNTRNBR
           ,SEQ
           ,HAZ_CODE
           ,HAZ_QUAL)
     VALUES
           (#msg_no#
           ,#blnbr#
           ,#cntrnbr#
           ,#seq#
           ,#haz_code#
           ,#haz_qual#)
	</insert>
	           
	<select id="selectEdiSmtAmsMsgNo" resultClass="String">
		SELECT 'OIB' + SUBSTRING(CONVERT(VARCHAR(10), GETDATE(), 112), 3, 8) + ISNULL(dbo.LPAD(MAX(SUBSTRING(MSG_NO, 10, 5))+1, 5, '0'), '00001') AS MSG_NO
		  FROM TB_EDI_SMTAMS_HDR
		 WHERE MSG_NO LIKE 'OIB' + SUBSTRING(CONVERT(VARCHAR(10), GETDATE(), 112), 3, 8) + '%'
	</select>	      
	
	<delete id="deleteEdiSmtAmsHdr" parameterClass="String">
		DELETE  
		  FROM  TB_EDI_SMTAMS_HDR
		 WHERE  MSG_NO = #mgs_no#
	</delete>
	
	<delete id="deleteEdiSmtAmsBl" parameterClass="String">
		DELETE  
		  FROM  TB_EDI_SMTAMS_BL
		 WHERE  MSG_NO = #mgs_no#
	</delete>
	     
	<delete id="deleteEdiSmtAmsCntr" parameterClass="String">
		DELETE  
		  FROM  TB_EDI_SMTAMS_CNTR
		 WHERE  MSG_NO = #mgs_no#
	</delete>
	
	<delete id="deleteEdiSmtAmsCntrDngr" parameterClass="String">
		DELETE  
		  FROM  TB_EDI_SMTAMS_CNTR_DNGR
		 WHERE  MSG_NO = #mgs_no#
	</delete>
	
	<delete id="deleteEdiSmtAmsCntrDesc" parameterClass="String">
		DELETE  
		  FROM  TB_EDI_SMTAMS_CNTR_DESC
		 WHERE  MSG_NO = #mgs_no#
	</delete>
	
	<!-- select id="serachEdiSmtAmsData" parameterClass="HashMap" resultClass="com.clt.apps.fis.see.bmd.ams.dto.EdiSmtAmsDataVO">
		/* serachEdiSmtAmsData */
		SELECT AA.* 
		  FROM  (
					SELECT A.MSG_NO, A.MSG_STS, A.MSG_DATE, A.VSL_FULLNAME, A.VSL_VOYAGE
					           , A.SCAC
							   , B.REFNBR, B.BLNBR, B.POL_AMS
							   , CONVERT(VARCHAR(8), A.H_POL_ETD) AS H_POL_ETD
							   , A.REF_NO, A.POD_AMS
							   , CONVERT(VARCHAR(8), A.POD_ETA) AS POD_ETA
							   , B.POR_FULLNAME, B.DEL_AMS, '' AS CARRIER, A.CUST_ID
							   , B.SHPR_NM1 + B.SHPR_NM2 AS SHPR_NM
							   , B.CNEE_NM1 + B.CNEE_NM2 AS CNEE_NM
							   , B.NTFY_NM1 + B.NTFY_NM2 AS NTFY_NM
							   , (SELECT COUNT(*) FROM TB_EDI_SMTAMS_CNTR WHERE MSG_NO = B.MSG_NO AND BLNBR = B.BLNBR) AS CNTR_QTY
							   , B.BLPKG, B.BLPKGU, B.BLWGT, B.BLWGTU
							   , B.DL_STS
							   , A.DNLD_DATE
						       , (SELECT CD_NM FROM TB_COM_CD_DTL WHERE COM_CD = 'AMSD' AND CD_VAL = B.DL_STS) AS DL_STS_NM
						       , (SELECT MIN(TRDP_CD) FROM TB_TRDP WHERE SMT_ID = A.CUST_ID AND DELT_FLG = 'N') AS AGT_CD
						       , (SELECT MIN(ENG_NM) FROM TB_TRDP WHERE SMT_ID = A.CUST_ID AND DELT_FLG = 'N') AS AGT_NM
						       , (SELECT MIN(PCK_UT_CD) FROM TB_PCK_UT_CD WHERE AMS_PCK_CD_VAL = B.BLPKGU) AS PCK_UT_CD
						       , CASE B.MSG_STS WHEN 'A' THEN 'New' 
						                        WHEN 'B' THEN 'Amd' 
						                        ELSE 'Del' END AS TYPE
						       , RANK() OVER (PARTITION BY B.BLNBR ORDER BY B.MSG_NO, B.DL_STS) RNK              
				     FROM TB_EDI_SMTAMS_HDR A, TB_EDI_SMTAMS_BL B
				   WHERE A.MSG_NO = B.MSG_NO
				       AND A.RGST_TMS BETWEEN  GETDATE()-31 AND GETDATE()
					) AA
	 	WHERE AA.RNK = 1		
 		<isNotEmpty property="dl_sts">
		 	AND AA.DL_STS = #dl_sts#  
		</isNotEmpty>
		<isNotEmpty property="dnld_strdt">
		 	AND AA.DNLD_DATE BETWEEN #dnld_strdt#  AND #dnld_enddt#
		</isNotEmpty>
		ORDER BY MSG_NO DESC
	</select-->
	
	<!-- #25561 AMS List 에 Tracking 기능 추가 : AA.CNTR_NO ADD -->
	<select id="serachEdiSmtAmsData" parameterClass="HashMap" resultClass="com.clt.apps.fis.see.bmd.ams.dto.EdiSmtAmsDataVO">
		/* serachEdiSmtAmsData */
		SELECT                         
                     AA.VSL_FULLNAME, AA.VSL_VOYAGE
				   , AA.REFNBR
				   , AA.BLNBR
				   , AA.POL_AMS
				   , MAX(AA.SCAC) AS SCAC
				   , MAX(AA.CUST_REF_NO) AS CUST_REF_NO
				   , MAX(AA.MSG_NO) AS MSG_NO
				   , MAX(AA.MSG_STS) AS MSG_STS
				   , MAX(AA.MSG_DATE) AS MSG_DATE
				   , MAX(AA.H_POL_ETD) AS H_POL_ETD
				   , MAX(AA.REF_NO) AS REF_NO
				   , MAX(AA.POD_AMS) AS POD_AMS
				   , MAX(AA.POD_ETA) AS POD_ETA
				   , MAX(AA.POR_FULLNAME) AS POR_FULLNAME
				   , MAX(AA.DEL_AMS) AS DEL_AMS
				   , MAX(AA.CARRIER) AS CARRIER
				   , MAX(AA.CUST_ID) AS CUST_ID
				   , MAX(AA.SHPR_NM) AS SHPR_NM
				   , MAX(AA.CNEE_NM) AS CNEE_NM
				   , MAX(AA.NTFY_NM) AS NTFY_NM
				   , MAX(AA.CNTR_QTY) AS CNTR_QTY
				   , MAX(AA.BLPKG) AS BLPKG
				   , MAX(AA.BLPKGU) AS BLPKGU
				   , MAX(AA.BLWGT) AS BLWGT
				   , MAX(AA.BLWGTU) AS BLWGTU
				   , MAX(AA.DL_STS) AS DL_STS
				   , MAX(AA.DNLD_DATE) AS DNLD_DATE
			       , MAX(AA.DL_STS_NM) AS DL_STS_NM
			       , MAX(AA.AGT_CD) AS AGT_CD
			       , MAX(AA.AGT_NM) AS AGT_NM
			       , MAX(AA.PCK_UT_CD) AS PCK_UT_CD 
			       , MAX(AA.TYPE) AS TYPE
			       , MAX(RNK) AS RNK
				   , MAX(FILLING_NO) AS FILLING_NO
				   , MAX(BLCK_FLG) AS BLCK_FLG
				   , CASE WHEN MAX(ERR_FLG) = 'N' THEN 'Accepted' 
				             WHEN MAX(ERR_FLG) = 'Y' THEN 'Error' 
				             WHEN MAX(MSG_STS) = 'S' THEN 'Sent' 
				             WHEN MAX(MSG_STS) = 'C' THEN 'Created' 
				             ELSE '' END AS ERR_FLG
				   , MAX(AA.DISP_CD) AS DISP_CD     
				   , CASE WHEN MAX(AA.DISP_CD) = '1Y' THEN 'Load to OK(1Y)'
				          WHEN MAX(AA.DISP_CD) = '54' THEN 'Deleted'
				          WHEN MAX(AA.DISP_CD) = '55' THEN 'Amended'
						  WHEN MAX(AA.DISP_CD) = '6H' THEN 'Do Not Load'
						  WHEN MAX(AA.DISP_CD) IN ('1H','2H','3H','4H','5H','6H', '7H') THEN 'Hold'
						  WHEN MAX(AA.DISP_CD) IS NULL AND MAX(ERR_FLG) = 'Y' THEN 'Rejected'
						  WHEN MAX(AA.DISP_CD) IS NULL AND MAX(ERR_FLG) = 'N' THEN 'OK to Load'
						  END AS BL_STS
			      ,(SELECT SUM(CONVERT(FLOAT, ISNULL(D_VOL, 0))) FROM TB_EDI_SMTAMS_CNTR_DESC WHERE MSG_NO = MAX(AA.MSG_NO)  AND BLNBR = AA.BLNBR ) AS BLVOL
			      ,AA.CNTR_NO
			      ,AA.CNTR_CNT 
		  FROM  (
					SELECT A.MSG_NO, A.MSG_STS
					           , SUBSTRING(A.MSG_DATE, 0, 9) AS MSG_DATE
					           , A.VSL_FULLNAME, A.VSL_VOYAGE
					           , A.SCAC
					           , A.CUST_REF_NO
							   , B.REFNBR, B.BLNBR, B.POL_AMS
							   , CONVERT(VARCHAR(8), A.H_POL_ETD) AS H_POL_ETD
							   , A.REF_NO, A.POD_AMS
							   , CONVERT(VARCHAR(8), A.POD_ETA) AS POD_ETA
							   , B.POR_FULLNAME, B.DEL_AMS, '' AS CARRIER, A.CUST_ID
							   , B.SHPR_NM1 AS SHPR_NM
							   , B.CNEE_NM1 AS CNEE_NM
							   , B.NTFY_NM1 AS NTFY_NM
							   , (SELECT COUNT(*) FROM TB_EDI_SMTAMS_CNTR WHERE MSG_NO = B.MSG_NO AND BLNBR = B.BLNBR) AS CNTR_QTY
							   , B.BLPKG, B.BLPKGU, B.BLWGT, B.BLWGTU
							   , B.DL_STS
							   , A.DNLD_DATE
						       , (SELECT CD_NM FROM TB_COM_CD_DTL WHERE COM_CD = 'AMSD' AND CD_VAL = B.DL_STS) AS DL_STS_NM
						       , (SELECT MIN(TRDP_CD) FROM TB_TRDP WHERE SMT_ID = A.CUST_ID AND DELT_FLG = 'N') AS AGT_CD
						       , (SELECT MIN(ENG_NM) FROM TB_TRDP WHERE SMT_ID = A.CUST_ID AND DELT_FLG = 'N') AS AGT_NM
						       , (SELECT MIN(PCK_UT_CD) FROM TB_PCK_UT_CD WHERE AMS_PCK_CD_VAL = B.BLPKGU) AS PCK_UT_CD
						       , CASE B.MSG_STS WHEN 'A' THEN 'New' 
						                        WHEN 'B' THEN 'Amd' 
						                        ELSE 'Del' END AS TYPE
						       , RANK() OVER (PARTITION BY B.BLNBR ORDER BY B.INTG_BL_SEQ DESC, B.MSG_NO DESC, B.DL_STS) RNK       
							   , (SELECT MIN(REF_NO) FROM TB_INTG_BL BL WHERE BL.INTG_BL_SEQ = B.INTG_BL_SEQ AND BL.DELT_FLG = 'N') AS FILLING_NO      
							   , B.BLCK_FLG 
							   , B.ERR_FLG   
							   ,  (SELECT SUBSTRING(MAX(MSG_DATE + MSG_SEQ + DISP_CD), LEN(MAX(MSG_DATE + MSG_SEQ + DISP_CD))-1, 2) AS DISP_CD
							        FROM TB_EDI_AMS_BL_STS 
							       WHERE BL_NO = B.BLNBR
								       AND DISP_CD IN ('54','55', '1H', '2H', '3H', '4H', '5H', '6H', '7H','1Y')
								  ) AS DISP_CD
							   ,(SELECT MAX(X.CNTRNBR) FROM TB_EDI_SMTAMS_CNTR X WHERE X.MSG_NO = B.MSG_NO AND X.BLNBR = B.BLNBR) AS CNTR_NO
							   ,(SELECT COUNT(X.CNTRNBR)-1 FROM TB_EDI_SMTAMS_CNTR X WHERE X.MSG_NO = B.MSG_NO AND X.BLNBR = B.BLNBR) AS CNTR_CNT
				     FROM TB_EDI_SMTAMS_HDR A, TB_EDI_SMTAMS_BL B
				   WHERE A.MSG_NO = B.MSG_NO
					) AA
	 	WHERE AA.RNK = 1		
 		<isNotEmpty property="dl_sts">
		 	AND AA.DL_STS = #dl_sts#  
		</isNotEmpty>
		<isNotEmpty property="dnld_strdt">
		 	AND AA.DNLD_DATE BETWEEN #dnld_strdt#  AND #dnld_enddt#
		</isNotEmpty>
		<isNotEmpty property="etd_strdt">
		 	AND AA.H_POL_ETD BETWEEN #etd_strdt#  AND #etd_enddt#
		</isNotEmpty>
		<isNotEmpty property="eta_strdt">
		 	AND AA.POD_ETA BETWEEN #eta_strdt#  AND #eta_enddt#
		</isNotEmpty>
		
		<isNotEmpty property="blnbr">
		 	AND AA.BLNBR = #blnbr#
		</isNotEmpty>
		
		<isNotEmpty property="refnbr">
		 	AND AA.REFNBR = #refnbr#
		</isNotEmpty>
		
		<isNotEmpty property="filling_no">
		 	AND AA.FILLING_NO = #filling_no#
		</isNotEmpty>
		
		<isNotEmpty property="pol_cd">
		 	AND AA.POL_AMS = (SELECT MIN(AMS_LOC_VAL) FROM TB_LOC WHERE LOC_CD =  #pol_cd# )
		</isNotEmpty>
		
		<isNotEmpty property="pod_cd">
		 	AND AA.POD_AMS = (SELECT MIN(AMS_LOC_VAL) FROM TB_LOC WHERE LOC_CD =  #pod_cd#)
		</isNotEmpty>
		
		<isNotEmpty property="shpr_nm">
		 	AND AA.SHPR_NM LIKE #shpr_nm# + '%'
		</isNotEmpty>
		
		<isNotEmpty property="cnee_nm">
		 	AND AA.CNEE_NM LIKE #cnee_nm# + '%'
		</isNotEmpty>
		
		<isNotEmpty property="vsl_fullname">
		 	AND AA.VSL_FULLNAME LIKE #vsl_fullname# + '%'
		</isNotEmpty>
		
		<isNotEmpty property="vsl_voyage">
		 	AND AA.VSL_VOYAGE LIKE #vsl_voyage# + '%'
		</isNotEmpty>
		
		<isNotEmpty property="cust_ref_no">
		 	AND AA.CUST_REF_NO LIKE #cust_ref_no# + '%'
		</isNotEmpty>
		
		<isNotEmpty property="cntrnbr">
		 	AND AA.MSG_NO IN ( SELECT MSG_NO FROM TB_EDI_SMTAMS_CNTR WHERE CNTRNBR =  #cntrnbr# )
		</isNotEmpty>
		
		GROUP BY AA.VSL_FULLNAME, AA.VSL_VOYAGE, AA.REFNBR, AA.BLNBR, AA.POL_AMS, AA.CNTR_NO, AA.CNTR_CNT
		ORDER BY MAX(AA.MSG_NO) DESC
	</select>
	
	<select id="serachAmsData" parameterClass="HashMap" resultClass="com.clt.apps.fis.see.bmd.ams.dto.EdiSmtAmsDataVO">
		/* serachAmsData */
		SELECT * 
		  FROM
		          ( 
					SELECT A.MSG_NO, A.MSG_STS
					           , SUBSTRING(A.MSG_DATE, 0, 9) AS MSG_DATE
					           , A.VSL_FULLNAME, A.VSL_VOYAGE
					           , A.SCAC
					           , A.CUST_REF_NO
							   , B.REFNBR, B.BLNBR, B.POL_AMS
							   , CONVERT(VARCHAR(8), A.H_POL_ETD) AS H_POL_ETD
							   , A.REF_NO, A.POD_AMS
							   , CONVERT(VARCHAR(8), A.POD_ETA) AS POD_ETA
							   , B.POR_FULLNAME, B.DEL_AMS, '' AS CARRIER, A.CUST_ID
							   , B.SHPR_NM1  AS SHPR_NM
							   , B.SHPR_NM2 +  char(13)+char(10) + B.SHPR_ADD1 + char(13)+char(10) + B.SHPR_ADD2 + char(13)+char(10) + B.SHPR_ADD3 AS SHPR_ADD
							   , B.CNEE_NM1 AS CNEE_NM
							   , B.CNEE_NM2 + char(13)+char(10)  + B.CNEE_ADD1 + char(13)+char(10)+ B.CNEE_ADD2 + char(13)+char(10) + B.CNEE_ADD3 AS CNEE_ADD
							   , B.NTFY_NM1 AS NTFY_NM
							   , B.NTFY_NM2 + char(13)+char(10) + B.NTFY_ADD1 + char(13)+char(10) + B.NTFY_ADD2 + char(13)+char(10) + B.NTFY_ADD3 AS NTFY_ADD
							   , (SELECT COUNT(*) FROM TB_EDI_SMTAMS_CNTR WHERE MSG_NO = B.MSG_NO AND BLNBR = B.BLNBR) AS CNTR_QTY
							   , B.BLPKG, B.BLPKGU, B.BLWGT, B.BLWGTU
							   , B.DL_STS
						       , (SELECT CD_NM FROM TB_COM_CD_DTL WHERE COM_CD = 'AMSD' AND CD_VAL = B.DL_STS) AS DL_STS_NM
						       , (SELECT MIN(TRDP_CD) FROM TB_TRDP WHERE SMT_ID = A.CUST_ID AND DELT_FLG = 'N') AS AGT_CD
						       , (SELECT MIN(ENG_NM) FROM TB_TRDP WHERE SMT_ID = A.CUST_ID AND DELT_FLG = 'N') AS AGT_NM
						       , (SELECT MIN(PCK_UT_CD) FROM TB_PCK_UT_CD WHERE AMS_PCK_CD_VAL = B.BLPKGU) AS PCK_UT_CD
						       , CASE B.MSG_STS WHEN 'A' THEN 'New' 
						                        WHEN 'B' THEN 'Amd' 
						                        ELSE 'Del' END AS TYPE
						       , RANK() OVER (PARTITION BY B.BLNBR ORDER BY A.MSG_NO DESC) RNK
						       ,(SELECT SUM(CONVERT(FLOAT, ISNULL(D_VOL, 0))) FROM TB_EDI_SMTAMS_CNTR_DESC WHERE MSG_NO = A.MSG_NO  AND BLNBR = B.BLNBR ) AS BLVOL
				     FROM TB_EDI_SMTAMS_HDR A, TB_EDI_SMTAMS_BL B
				   WHERE A.MSG_NO = B.MSG_NO
				    <isNotEmpty property="dnld_strdt">
					 	AND A.DNLD_DATE BETWEEN #dnld_strdt#  AND #dnld_enddt#
					</isNotEmpty>
					<isNotEmpty property="dl_sts">
					 	AND B.DL_STS = #dl_sts#  
					</isNotEmpty>
					<isNotEmpty property="ref_no">
					 	AND A.REF_NO = #ref_no#  
					</isNotEmpty>
					<isNotEmpty property="blnbr">
					 	AND B.BLNBR = #blnbr#  
					</isNotEmpty>
					) AA
			WHERE 1=1
			    AND RNK = 1
	</select>
		     
	<select id="selectMpCdByVSL" parameterClass="HashMap" resultClass="com.clt.apps.fis.see.bmd.ams.dto.EdiDataMpVO">
		/* selectMpCdByVSL */
		SELECT TOP 1 AA.MP_CD 
		  FROM (
					SELECT VSL_CD AS MP_CD FROM TB_VSL WHERE VSL_NM = #mp_val# AND DELT_FLG = 'N' AND USE_FLG = 'Y'
					UNION ALL
					SELECT MP_CD FROM TB_EDI_DATA_MP WHERE MP_VAL = #mp_val# AND MP_TP = #mp_tp#
					) AA
	</select>
	
	<select id="selectMpCdByTRDP" parameterClass="HashMap" resultClass="com.clt.apps.fis.see.bmd.ams.dto.EdiDataMpVO">
		/* selectMpCdByTRDP */
		SELECT TOP 1 MP_CD 
		  FROM (
					SELECT TRDP_CD AS MP_CD FROM TB_TRDP WHERE ENG_NM = #mp_val# OR LOCL_NM = #mp_val# AND DELT_FLG = 'N'
					UNION ALL
					SELECT MP_CD FROM TB_EDI_DATA_MP WHERE MP_VAL = #mp_val# AND MP_TP = #mp_tp#
					) AA
	</select>
	
	<select id="selectMpCdByPOR" parameterClass="HashMap" resultClass="com.clt.apps.fis.see.bmd.ams.dto.EdiDataMpVO">
		/* selectMpCdByPOR */
		SELECT TOP 1 MP_CD, MP_VAL 
		  FROM (
					SELECT LOC_CD AS MP_CD, LOC_NM AS MP_VAL FROM TB_LOC WHERE LOC_NM = #mp_val# AND USE_FLG = 'Y' AND DELT_FLG = 'N'
					UNION ALL
					SELECT MP_CD, MP_VAL FROM TB_EDI_DATA_MP WHERE MP_VAL = #mp_val# AND MP_TP = #mp_tp#
					) AA
	</select>
	
	<select id="selectMpCdByLOC" parameterClass="HashMap" resultClass="com.clt.apps.fis.see.bmd.ams.dto.EdiDataMpVO">
		/* selectMpCdByPOR */
		SELECT TOP 1 MP_CD, MP_VAL 
		  FROM (
					SELECT LOC_CD AS MP_CD, LOC_NM AS MP_VAL  FROM TB_LOC WHERE AMS_LOC_VAL = #mp_val# AND USE_FLG = 'Y' AND DELT_FLG = 'N'
					UNION ALL
					SELECT MP_CD, MP_VAL  FROM TB_EDI_DATA_MP WHERE MP_VAL = #mp_val# AND MP_TP = #mp_tp#
					) AA
	</select>
	
	<select id="selectLnrInfo" parameterClass="HashMap" resultClass="com.clt.apps.fis.see.bmd.ams.dto.SeeAmsVO">
		/* selectLnrInfo */
		SELECT A.LNR_TRDP_CD AS LNR_TRDP_CD, B.ENG_NM AS LNR_TRDP_NM  
		  FROM TB_VSL A, TB_TRDP B 
		 WHERE A.LNR_TRDP_CD = B.TRDP_CD 
		     AND VSL_CD = #vsl_cd#
		     AND A.DELT_FLG = 'N' 
		     AND A.USE_FLG = 'Y' 
		     AND B.DELT_FLG = 'N' 
	</select>
	
	<insert id="insertBlPrnr" parameterClass="HashMap">
        INSERT INTO tb_bl_prnr(                                                      
              intg_bl_seq,          bl_trdp_tp_cd,    
              trdp_cd,              trdp_addr,          trdp_nm,
              
              trdp_pic_usr_id,      trdp_pic,           trdp_phn,      trdp_fax,     trdp_eml,
              
              rgst_usrid,           rgst_ofc_cd,        rgst_tms,        
              modi_usrid,           modi_ofc_cd,        modi_tms,      delt_flg                                                       
        ) SELECT  #intg_bl_seq#,    #bl_trdp_tp_cd#, 
                  a.trdp_cd,        eng_addr,  eng_nm,
                  b.cntc_pson_seq,  b.pic_nm,            b.pic_phn,    b.pic_fax,    b.pic_eml,
                  #rgst_usrid#,     #rgst_ofc_cd#,        getdate(),
                  #modi_usrid#,     #modi_ofc_cd#,        GETUTCDATE(),    'N'
            FROM  tb_trdp a 
 LEFT OUTER JOIN  tb_trdp_cntc_pson b
              ON  a.trdp_cd=b.trdp_cd 
             AND  b.cntc_pson_seq = ( SELECT MIN(cntc_pson_seq)  
                                        FROM tb_trdp_cntc_pson 
                                       WHERE delt_flg = 'N' AND trdp_cd = a.trdp_cd )
             AND  a.delt_flg = 'N'
           WHERE  a.trdp_cd = #trdp_cd# AND a.delt_flg = 'N'
    </insert>
    
    <insert id="insertEdiDataMp" parameterClass="com.clt.apps.fis.see.bmd.ams.dto.EdiDataMpVO">
        INSERT INTO TB_EDI_DATA_MP
									           (MP_VAL
									           ,MP_TP
									           ,MP_CD
									           ,RGST_USRID
									           ,RGST_TMS)
									     VALUES
									           (#mp_val#
									           ,#mp_tp#
									           ,#mp_cd#
									           ,#rgst_usrid#
									           ,getdate())
    </insert>			
    
    <delete id="deleteEdiDataMp" parameterClass="com.clt.apps.fis.see.bmd.ams.dto.EdiDataMpVO">
		DELETE  
		  FROM  TB_EDI_DATA_MP
		 WHERE  mp_val = #mp_val#
	</delete>
    
    
    <select id="selectEdiDataMp" parameterClass="HashMap" resultClass="com.clt.apps.fis.see.bmd.ams.dto.EdiDataMpVO">
		/* selectEdiDataMp */
		SELECT *  
		  FROM TB_EDI_DATA_MP
		 WHERE mp_val = #mp_val#
		     AND mp_tp = #mp_tp# 
	</select>   
	
	 <select id="selectAmsLocVal" parameterClass="String" resultClass="String">
		/* selectAmsLocVal */
		SELECT AMS_LOC_VAL 
		  FROM TB_LOC
		 WHERE loc_cd = #loc_cd#
	</select>
	
	<select id="selectEdiSmtAmsCntr" parameterClass="HashMap" resultClass="com.clt.apps.fis.see.bmd.housebl.dto.CntrListVO">
		/* selectEdiSmtAmsCntr */
		SELECT  CNTRNBR AS cntr_no
        			, SEALNBR AS seal_no1
        			, (SELECT MIN(CNTR_TPSZ_CD) FROM TB_CNTR_TPSZ WHERE AMS_CNTR_CD = A.CNTRTYPE) as cntr_tpsz_cd
        			, (SELECT CASE WHEN COUNT(*) > 0 THEN 'Y' ELSE 'N' END FROM TB_EDI_SMTAMS_CNTR_DNGR WHERE MSG_NO = A.MSG_NO AND CNTRNBR = A.CNTRNBR ) AS dg_gds_flg  
        			, ISNULL((SELECT SUM(CONVERT(INT, ISNULL(D_PKG, 0))) FROM TB_EDI_SMTAMS_CNTR_DESC WHERE MSG_NO = A.MSG_NO AND BLNBR = A.BLNBR AND CNTRNBR = A.CNTRNBR), 0) AS cgo_pck_qty
        			, ISNULL((SELECT SUM(CONVERT(FLOAT, ISNULL(D_WGT, 0))) FROM TB_EDI_SMTAMS_CNTR_DESC WHERE MSG_NO = A.MSG_NO AND BLNBR = A.BLNBR AND CNTRNBR = A.CNTRNBR), 0) AS cgo_wgt
   		            , ISNULL((SELECT SUM(CONVERT(FLOAT, ISNULL(D_VOL, 0))) FROM TB_EDI_SMTAMS_CNTR_DESC WHERE MSG_NO = A.MSG_NO AND BLNBR = A.BLNBR AND CNTRNBR = A.CNTRNBR), 0) AS cgo_meas
   		  FROM TB_EDI_SMTAMS_CNTR A
		 WHERE MSG_NO = #msg_no#
		     AND BLNBR = #blnbr#
	</select>
	
	<select id="selectEdiSmtAmsCntrDesc" parameterClass="HashMap" resultClass="com.clt.apps.fis.see.bmd.housebl.dto.HblItemVO">
		/* selectEdiSmtAmsCntrDesc */
		SELECT CNTRNBR AS  item_cntr_no
				   , D_CMDT AS item_shp_cmdt_cd
		           , SUBSTRING(D_DESC, 0, 300) AS item_shp_cmdt_nm
		           , D_PUNIT AS item_pck_ut_cd
		           , ISNULL(D_PKG,0) AS item_pck_qty
		           , D_MARK AS d_mark  
		           , CASE D_WGT WHEN '' THEN '0' 
		                                 WHEN NULL THEN '0' 
		                                    ELSE D_WGT END AS item_wgt 
		           , CASE D_VOL WHEN '' THEN '0' 
		                                WHEN NULL THEN '0' 
		                                  ELSE D_VOL END AS item_meas
		  FROM TB_EDI_SMTAMS_CNTR_DESC
		 WHERE MSG_NO = #msg_no#
		     AND BLNBR = #blnbr#
	</select>
	
	<select id="selectBllInfo" parameterClass="HashMap" resultClass="com.clt.apps.fis.see.bmd.ams.dto.BlInfoVO">
		/* selectBlInfo */
		SELECT  bl.INTG_BL_SEQ, bl.BL_NO, bl.REF_NO, ISNULL(BLCK.BL_STS_CD1, BL.BL_STS_CD) AS BL_STS_CD, bl.POST_DT
		  FROM  tb_intg_bl bl 
		   JOIN  tb_add_info_bnd bnd 
		     ON  bl.INTG_BL_SEQ = bnd.INTG_BL_SEQ AND bnd.delt_flg = 'N'
		   LEFT OUTER JOIN(SELECT INTG_BL_SEQ AS INTG_BL_SEQ1, BL_STS_CD AS BL_STS_CD1 FROM TB_INTG_BL_BLCK) BLCK 
		   	 ON BL.INTG_BL_SEQ = BLCK.INTG_BL_SEQ1
		 WHERE  bl.bl_no = #bl_no# 
		     AND  bl.biz_clss_cd = #biz_clss_cd# 
		     AND  bl.air_sea_clss_cd = #air_sea_clss_cd#
		     AND  bnd.bnd_clss_cd = #bnd_clss_cd#
		     AND  bl.delt_flg = 'N'       
	</select>
	
	<select id="selectMbllInfo" parameterClass="HashMap" resultClass="com.clt.apps.fis.see.bmd.ams.dto.BlInfoVO">
		/* selectMblInfo */
		SELECT  bl.INTG_BL_SEQ, bl.BL_NO, bl.REF_NO, ISNULL(BLCK.BL_STS_CD1, BL.BL_STS_CD) AS BL_STS_CD, bl.POST_DT
		  FROM  tb_intg_bl bl 
		   JOIN  tb_add_info_bnd bnd 
		     ON  bl.INTG_BL_SEQ = bnd.INTG_BL_SEQ AND bnd.delt_flg = 'N'
		   LEFT OUTER JOIN(SELECT INTG_BL_SEQ AS INTG_BL_SEQ1, BL_STS_CD AS BL_STS_CD1 FROM TB_INTG_BL_BLCK) BLCK 
		     ON BL.INTG_BL_SEQ = BLCK.INTG_BL_SEQ1
		 WHERE  bl.bl_no = #bl_no# 
		     AND  bl.biz_clss_cd = 'M'
		     AND  bl.air_sea_clss_cd = #air_sea_clss_cd#
		     AND  bnd.bnd_clss_cd = #bnd_clss_cd#
		     AND  ISNULL(bl.AMS_ID, '') != ''  
		     AND  bl.delt_flg = 'N'       
	</select>
	
	<select id="selectMblNoFlg" parameterClass="HashMap" resultClass="String">
		/* selectMblNoFlg */
 		SELECT  CASE WHEN COUNT(bl.INTG_BL_SEQ) > 0 THEN 'Y' ELSE 'N' END AS MBL_NO_FLG
		  FROM  tb_intg_bl bl 
		   JOIN  tb_add_info_bnd bnd 
		     ON  bl.INTG_BL_SEQ = bnd.INTG_BL_SEQ AND bnd.delt_flg = 'N'
		 WHERE  bl.bl_no = #bl_no# 
		     AND  bl.biz_clss_cd = 'M'
		     AND  bl.air_sea_clss_cd = 'S'
		     AND  bnd.bnd_clss_cd = 'I'
		     AND  bl.delt_flg = 'N'       
		     AND  ISNULL(bl.AMS_ID, '') = ''
	</select>
	
	<select id="selectAddMblCntrList" parameterClass="HashMap" resultClass="com.clt.apps.fis.see.bmd.housebl.dto.CntrListVO">
		/* selectAddMblCntrList */
		SELECT * 
		  FROM TB_CNTR_LIST 
		 WHERE INTG_BL_SEQ = #intg_bl_seq# AND DELT_FLG = 'N'
		     AND CNTR_NO NOT IN (SELECT CNTR_NO FROM TB_CNTR_LIST WHERE INTG_BL_SEQ = #intg_bl_seq_mbl# AND DELT_FLG = 'N')
	</select>
	
	<update id="updateEdiSmtAmsBlSts" parameterClass="com.clt.apps.fis.see.bmd.ams.dto.EdiSmtAmsDataVO">
		UPDATE  TB_EDI_SMTAMS_BL        
		     SET  DL_STS = #dl_sts#, INTG_BL_SEQ = #intg_bl_seq#
		 WHERE  MSG_NO = #msg_no#
		     AND  BLNBR = #blnbr# 
	</update>   
	
	<select id="selectEdiKamsPreFix" resultClass="String">	
		SELECT PRE_FIX from TB_SEQ WHERE SEQ_TYPE = 'KAMS_NO'
	</select>
	
	<select id="selectEdiKamsNo" resultClass="String">	
		SELECT PRE_FIX + SUBSTRING(CONVERT(VARCHAR(10), GETDATE(), 112), 3, 8) + #iata_cd# + dbo.LPAD(SEQ, 3, '0') from TB_SEQ WHERE SEQ_TYPE = 'KAMS_NO'
	</select>
	
	<update id="updateEdiKamsNo" parameterClass="String"  >
		UPDATE TB_SEQ
		     SET SEQ = SEQ + 1
		 WHERE SEQ_TYPE = 'KAMS_NO'
    </update> 
    
    <!-- REF_MSG_NO SEQ RULE CHANGE-->
    <!-- select id="selectEdiKamsRefMsgNo" parameterClass="HashMap" resultClass="String">
		SELECT ISNULL( MAX(SUBSTRING(REF_MSG_NO, 1, 5)) + SUBSTRING(CONVERT(VARCHAR(10), GETDATE(), 112), 3, 8) + ISNULL(dbo.LPAD(MAX(SUBSTRING(REF_MSG_NO, 13, 3))+1, 3, '0'), '001') 
								, #kams_pre_fix# + #iata_cd# + SUBSTRING(CONVERT(VARCHAR(10), GETDATE(), 112), 3, 8)+ '001') AS REF_MSG_NO 
		  FROM TB_EDI_KAMS_SEND
		 WHERE REF_MSG_NO LIKE #kams_pre_fix# + #iata_cd# + SUBSTRING(CONVERT(VARCHAR(10), GETDATE(), 112), 3, 8) + '%'
	</select-->
	
	<select id="selectEdiKamsRefMsgNo" parameterClass="HashMap" resultClass="String">
		SELECT ISNULL( MAX(SUBSTRING(REF_MSG_NO, 1, 7)) + ISNULL(dbo.LPAD(MAX(SUBSTRING(REF_MSG_NO, 8, 7)) + 1, 7, '0'), '0000001') 
								, #smt_cust_id# + #sys_ofc_cd# + '0000001') AS REF_MSG_NO 
		  FROM TB_EDI_KAMS_SEND
		 WHERE REF_MSG_NO LIKE #smt_cust_id# + #sys_ofc_cd# + '%'
	</select>
    
    <update id="updateSmtAmsBlBlckFlg" parameterClass="HashMap"  >
		UPDATE TB_EDI_SMTAMS_BL
		     SET BLCK_FLG = #blck_flg#, BLCK_DT = CONVERT(VARCHAR(8), GETDATE(), 112), BLCK_USRID = #blck_usrid#
		 WHERE MSG_NO = #msg_no#
		     AND BLNBR = #blnbr#
    </update> 
    
    <select id="selectCfsEdiInfo" parameterClass="HashMap" resultClass="com.clt.apps.fis.see.bmd.ams.dto.EdiDataMpVO">
		/* selectCfsEdiInfo */
		SELECT MP_VAL, MP_TP, MP_CD 
		 FROM TB_EDI_DATA_MP 
		WHERE MP_CD = #mp_cd#
		  AND MP_TP LIKE 'CFS%'
	</select>
	
	<select id="serachSmtAmsMbl" parameterClass="HashMap" resultClass="com.clt.apps.fis.see.bmd.ams.dto.EdiSmtAmsDataVO">
		/* serachSmtAmsMbl */
		SELECT TOP 1 A.VSL_FULLNAME, A.VSL_VOYAGE, A.VSL_FLAG, H_POL_AMS
		            , CONVERT(VARCHAR(8), A.H_POL_ETD) AS H_POL_ETD
	          		, A.POD_AMS, A.CUST_ID
	          		, CONVERT(VARCHAR(8), A.POD_ETA) AS POD_ETA
	          		, POL.LOC_NM AS POL_NM,POD.LOC_NM AS POD_NM
	          		, B.REFNBR , SUBSTRING(B.REFNBR, 1, 4) AS SCAC
	          		, (SELECT TOP 1 ENG_NM FROM TB_TRDP WHERE SCAC_CD = SUBSTRING(B.REFNBR, 1, 4)) AS CARR_NM
	     FROM TB_EDI_SMTAMS_HDR A
	     		  LEFT OUTER JOIN TB_LOC POL ON A.H_POL_AMS = POL.AMS_LOC_VAL AND POL.LOC_CLSS_CD = 'U'
	     		  LEFT OUTER JOIN TB_LOC POD ON A.POD_AMS = POD.AMS_LOC_VAL AND POD.LOC_CLSS_CD = 'U'
	     		  , TB_EDI_SMTAMS_BL B
	    WHERE A.MSG_NO = B.MSG_NO
	       AND A.MSG_NO = #msg_no#
	</select>
	
	<select id="serachSmtAmsMblCntr" parameterClass="HashMap" resultClass="com.clt.apps.fis.see.bmd.ams.dto.EdiAmsCntrVO">
		SELECT CNTRNBR, MAX(CNTRTYPE) AS CNTRTYPE, MAX(SEALNBR) AS SEALNBR
			  FROM TB_EDI_SMTAMS_CNTR CNTR,
					(		
						SELECT * 
						  FROM
								  ( 
									SELECT A.MSG_NO,B.BLNBR
											   , RANK() OVER (PARTITION BY B.BLNBR ORDER BY A.MSG_NO DESC) RNK
									 FROM TB_EDI_SMTAMS_HDR A, TB_EDI_SMTAMS_BL B
								   WHERE A.MSG_NO = B.MSG_NO
						 				AND B.REFNBR = #refnbr#
									) AA
							WHERE 1=1
								AND RNK = 1
				    ) HBL
			WHERE CNTR.MSG_NO = HBL.MSG_NO
			  AND CNTR.BLNBR = HBL.BLNBR
			 GROUP BY CNTRNBR
	</select>	
	
	<select id="serachSmtAmsHbl" parameterClass="HashMap" resultClass="com.clt.apps.fis.see.bmd.ams.dto.EdiSmtAmsDataVO">
		/* serachSmtAmsHbl */
		SELECT TOP 1 A.MSG_NO, A.REFNBR, A.BLNBR, A.POR_FULLNAME
	          		, A.SHPR_NM1  AS SHPR_NM
					, A.SHPR_NM2 +  char(13)+char(10) + A.SHPR_ADD1 + char(13)+char(10) + A.SHPR_ADD2 + char(13)+char(10) + A.SHPR_ADD3 AS SHPR_ADD
					, A.CNEE_NM1 AS CNEE_NM
					, A.CNEE_NM2 + char(13)+char(10)  + A.CNEE_ADD1 + char(13)+char(10)+ A.CNEE_ADD2 + char(13)+char(10) + A.CNEE_ADD3 AS CNEE_ADD
					, A.NTFY_NM1 AS NTFY_NM
					, A.NTFY_NM2 + char(13)+char(10) + A.NTFY_ADD1 + char(13)+char(10) + A.NTFY_ADD2 + char(13)+char(10) + A.NTFY_ADD3 AS NTFY_ADD
	     FROM TB_EDI_SMTAMS_BL A
	     		  LEFT OUTER JOIN TB_LOC POL ON A.POL_AMS = POL.AMS_LOC_VAL AND POL.LOC_CLSS_CD = 'U'
	    WHERE A.MSG_NO = #msg_no#
	       AND A.BLNBR = #blnbr#
	</select>
	
	<select id="serachSmtAmsHblCntrDesc" parameterClass="HashMap" resultClass="com.clt.apps.fis.see.bmd.ams.dto.EdiAmsCntrDescVO">
		/* serachSmtAmsHblCntrDesc */
		SELECT *
	     FROM TB_EDI_SMTAMS_CNTR_DESC A
	    WHERE A.MSG_NO = #msg_no#
	       AND A.BLNBR = #blnbr#
	</select>
	
	<select id="serachSmtAmsHblCntrDngr" parameterClass="HashMap" resultClass="com.clt.apps.fis.see.bmd.ams.dto.EdiAmsCntrDngrVO">
		/* serachSmtAmsHblCntrDngr */
		SELECT *
	     FROM TB_EDI_SMTAMS_CNTR_DNGR A
	    WHERE A.MSG_NO = #msg_no#
	       AND A.BLNBR = #blnbr#
	</select>
	
</sqlMap>