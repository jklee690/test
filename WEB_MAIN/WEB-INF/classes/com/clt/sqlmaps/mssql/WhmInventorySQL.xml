<?xml version="1.0" encoding="UTF-8" ?>

<!DOCTYPE sqlMap PUBLIC "-//ibatis.apache.org//DTD SQL Map 2.0//EN"
    "http://ibatis.apache.org/dtd/sql-map-2.dtd">

<sqlMap namespace="oth.item.all">
<typeAlias alias="InventoryVO" 	type="com.clt.apps.fis.whm.inventory.dto.InventoryVO"/>

	<select id="selectWhCdList"  parameterClass="java.util.HashMap"  resultClass="InventoryVO">
	/*WhmInventorySQL.xml >  selectWhCdList */
		SELECT WH_CD, WH_NM FROM WHM_WH WHERE ISNULL(USE_FLG, 'N') = 'Y'
	</select>
	
	<!-- <select id="searchItemInventoryRSQL"  parameterClass="java.util.HashMap"  resultClass="InventoryVO">
	/* WhmInventorySQL.xml > searchItemInventoryRSQL.Query */
		SELECT 
		 IVN.CUST_ITM_ID,
		 CI.ITM_NM,
		 (CASE LOC.LOC_CD
				WHEN 'DUMMY' THEN NULL
				ELSE LOC.LOC_CD
				END) AS LOC_CD,
		 ISNULL(IVN.ITM_TTL_CTN_QTY, 0) TTL_CTN_QTY,
		 ISNULL(IVN.ITM_TTL_EA_QTY, 0) TTL_EA_QTY,
		 ISNULL(IVN.ITM_TTL_QTY, 0) TTL_QTY,
		 ISNULL(IVN.ITM_TTL_WGT, 0) TTL_WGT_KGS,
		 ISNULL(IVN.ITM_TTL_WGT_LBS, 0) TTL_WGT_LBS,
		 ISNULL(IVN.ITM_TTL_VOL, 0) TTL_VOL_CBM,
		 ISNULL(IVN.ITM_TTL_VOL_CFT, 0) TTL_VOL_CFT,
		 ISNULL(CI.ITM_CD, 0) ITM_CD,
		 ISNULL(CI.ITM_UT_CD, 0) ITM_UT_CD,
		 ISNULL(CI.ITM_INR_QTY, 0) ITM_INR_QTY,		 
		 ISNULL(CI.ITM_WGT, 0) ITM_WGT,
		 ISNULL(CI.ITM_WGT_LBS, 0) ITM_WGT_LBS,
		 ISNULL(CI.ITM_VOL, 0) ITM_VOL,
		 ISNULL(CI.ITM_VOL_CFT, 0) ITM_VOL_CFT,		 
		 ISNULL(IVN.ITM_TTL_WGT, CI.ITM_WGT) ITM_WGT,
		 ISNULL(IVN.ITM_TTL_WGT_LBS, CI.ITM_WGT_LBS) ITM_WGT_LBS,
		 ISNULL(IVN.ITM_TTL_VOL, CI.ITM_VOL) ITM_VOL,
		 ISNULL(IVN.ITM_TTL_VOL_CFT, CI.ITM_VOL_CFT) ITM_VOL_CFT,		 
		 ISNULL(CI.ITM_LEN, 0) ITM_LEN,
		 ISNULL(CI.ITM_WDT, 0) ITM_WDT,
		 ISNULL(CI.ITM_HGT, 0) ITM_HGT 
		FROM 
		 WHM_ITM_INVT IVN,
		 WHM_CUST_ITM CI,
		 WHM_LOC LOC
		WHERE 1 = 1
		 AND LOC.WH_CD        =  #whCd# 
		 AND IVN.LOC_ID    = LOC.LOC_ID
		 AND IVN.CUST_ITM_ID  = CI.CUST_ITM_ID
		 <isNotEmpty property="itmCd">
		  AND IVN.CUST_ITM_ID = #itmCd#
		 </isNotEmpty>
		 <isNotEmpty property="custCd">
		  AND CI.CUST_CD =     #custCd#
		 </isNotEmpty>
		 <isNotEmpty property="rgstOfcCd">
		  AND CI.RGST_OFC_CD = #rgstOfcCd#
		 </isNotEmpty>
		 ORDER BY IVN.CUST_ITM_ID , LOC_CD
	</select> -->
	
	<select id="searchItemInventoryRSQL"  parameterClass="java.util.HashMap"  resultClass="InventoryVO">
	/* WhmInventorySQL.xml > searchItemInventoryRSQL.Query */
		SELECT 
		DISTINCT IVN.CUST_ITM_ID,
		 CI.ITEM_NM ITM_NM, IVN.ITM_UT_CD,
		 (CASE LOC.LOC_CD
				WHEN 'DUMMY' THEN NULL
				ELSE LOC.LOC_CD
				END) AS LOC_CD,
		 ISNULL(IVN.ITM_TTL_CTN_QTY, 0) TTL_CTN_QTY,
		 ISNULL(IVN.ITM_TTL_EA_QTY, 0) TTL_EA_QTY,
		 ISNULL(IVN.ITM_TTL_QTY, 0) TTL_QTY,
		 ISNULL(IVN.ITM_TTL_WGT, 0) TTL_WGT_KGS,
		 ISNULL(IVN.ITM_TTL_WGT_LBS, 0) TTL_WGT_LBS,
		 ISNULL(IVN.ITM_TTL_VOL, 0) TTL_VOL_CBM,
		 ISNULL(IVN.ITM_TTL_VOL_CFT, 0) TTL_VOL_CFT,
		 IVN.CTRT_NO,
		 (SELECT TL_CTRT.CTRT_NM CTRT_NM FROM TL_CTRT WHERE 1=1 AND TL_CTRT.CTRT_NO = IVN.CTRT_NO) AS CTRT_NM
		FROM 
		 WHM_ITM_INVT IVN,
		 TL_CTRT_CUST_ITEM CI,
		 WHM_LOC LOC,
		  (
				SELECT DISTINCT CITM.ITEM_CD, WITM.ITM_UT_CD,IVN.CUST_ITM_ID,IVN.LOC_ID,CITM.ITEM_SYS_NO, RSP.CUST_CD, WITM.RGST_OFC_CD, IVN.CTRT_NO
							FROM WHM_RCV_SHP_ITM WITM, WHM_RCV_SHP RSP, TL_CTRT_CUST_ITEM CITM, WHM_ITM_INVT IVN
							WHERE 1=1 
							AND WITM.FILE_NO     = RSP.FILE_NO
							AND WITM.RGST_OFC_CD = RSP.RGST_OFC_CD
							AND WITM.CUST_ITM_ID = CITM.ITEM_CD 
							AND IVN.CUST_ITM_ID  = CITM.ITEM_CD
							AND CITM.CTRT_NO     = RSP.CTRT_NO
							AND RSP.CTRT_NO = IVN.CTRT_NO
						
			) TEMP
		WHERE 1 = 1
		 AND LOC.WH_CD          =  #whCd# 
		 AND IVN.LOC_ID    		= LOC.LOC_ID
		 AND IVN.CUST_ITM_ID    = CI.ITEM_CD
		 AND IVN.CTRT_NO		= CI.CTRT_NO
		 AND IVN.CUST_ITM_ID    = TEMP.ITEM_CD
		 AND IVN.LOC_ID  		= TEMP.LOC_ID	
		 AND IVN.ITM_UT_CD = TEMP.ITM_UT_CD
		 AND IVN.CTRT_NO = TEMP.CTRT_NO
		 AND IVN.ITM_TTL_CTN_QTY != 0
		 <isNotEmpty property="itmCd">
		  AND IVN.CUST_ITM_ID = #itmCd#
		 </isNotEmpty>
		 <isNotEmpty property="custCd">
		  AND TEMP.CUST_CD =     #custCd#
		 </isNotEmpty>
		 <isNotEmpty property="rgstOfcCd">
		  AND TEMP.RGST_OFC_CD = #rgstOfcCd#
		 </isNotEmpty>
		 <isNotEmpty property="ctrt_no">
		  AND CI.CTRT_NO = #ctrt_no#
		 </isNotEmpty>
		 ORDER BY IVN.CTRT_NO, IVN.CUST_ITM_ID , LOC_CD
	</select>
	
	<select id="searchItemWHLoad"  parameterClass="java.util.HashMap"  resultClass="InventoryVO">
	/* WhmInventorySQL.xml > searchItemInventoryRSQL.Query */
		SELECT DISTINCT TEMP.CUST_CD,
		 IVN.CUST_ITM_ID,
		 CI.ITEM_NM ITM_NM,
		 CI.ITEM_SYS_NO,
		 IVN.ITM_UT_CD AS ITM_UT_CD,
		 (CASE LOC.LOC_CD WHEN 'DUMMY' THEN NULL ELSE LOC.LOC_CD END) AS LOC_CD,
		 ISNULL(IVN.ITM_TTL_CTN_QTY, 0) TTL_CTN_QTY,
		 ISNULL(IVN.ITM_TTL_EA_QTY, 0) TTL_EA_QTY,
		 ISNULL(IVN.ITM_TTL_QTY, 0) TTL_QTY,
		 ISNULL(IVN.ITM_TTL_WGT, 0) TTL_WGT_KGS,
		 ISNULL(IVN.ITM_TTL_WGT_LBS, 0) TTL_WGT_LBS,
		 ISNULL(IVN.ITM_TTL_VOL, 0) TTL_VOL_CBM,
		 ISNULL(IVN.ITM_TTL_VOL_CFT, 0) TTL_VOL_CFT,
		 ( CASE WHEN TEMP.ITM_UT_CD = CI.PKG_LV1_UNIT_CD THEN LTRIM( RTRIM( CONVERT ( DECIMAL (10, 3), CI.LV1_GRS_KGS ) ) ) 				 
				WHEN TEMP.ITM_UT_CD = CI.ITEM_PKGUNIT  THEN LTRIM( RTRIM( CONVERT ( DECIMAL (10, 3), CI.ITEM_KGS ) ) ) 
				WHEN TEMP.ITM_UT_CD = CI.PKG_LV3_UNIT_CD THEN LTRIM( RTRIM( CONVERT ( DECIMAL (10, 3), CI.LV3_GRS_KGS ) ) )
				ELSE '0'
		   END )AS ITM_WGT,
		  ( CASE WHEN TEMP.ITM_UT_CD = CI.PKG_LV1_UNIT_CD THEN LTRIM( RTRIM( CONVERT ( DECIMAL (10, 3), CI.LV1_GRS_LBS ) ) ) 				 
				WHEN TEMP.ITM_UT_CD = CI.ITEM_PKGUNIT  THEN LTRIM( RTRIM( CONVERT ( DECIMAL (10, 3), CI.ITEM_GRS_LBS ) ) ) 
				WHEN TEMP.ITM_UT_CD = CI.PKG_LV3_UNIT_CD THEN LTRIM( RTRIM( CONVERT ( DECIMAL (10, 3), CI.LV3_GRS_LBS ) ) )
				ELSE '0'
		   END )AS itm_wgt_lbs,
		( CASE WHEN TEMP.ITM_UT_CD = CI.PKG_LV1_UNIT_CD THEN LTRIM(RTRIM(CONVERT(DECIMAL(10, 3),  CI.LV1_NET_KGS))) 				 
				WHEN TEMP.ITM_UT_CD = CI.ITEM_PKGUNIT  THEN LTRIM(RTRIM(CONVERT(DECIMAL(10,  3), CI.ITEM_NET_WGT))) 
				WHEN TEMP.ITM_UT_CD = CI.PKG_LV3_UNIT_CD  THEN LTRIM(RTRIM(CONVERT(DECIMAL(10, 3),  CI.LV3_NET_KGS))) 
				ELSE '0'
		   END )AS ACT_ITM_WGT,
		( CASE WHEN TEMP.ITM_UT_CD = CI.PKG_LV1_UNIT_CD THEN LTRIM(RTRIM(CONVERT(DECIMAL(10, 5),  CI.LV1_CBM))) 				 
				WHEN TEMP.ITM_UT_CD = CI.ITEM_PKGUNIT  THEN LTRIM(RTRIM(CONVERT(DECIMAL(10,  5), CI.ITEM_CBM))) 
				WHEN TEMP.ITM_UT_CD = CI.PKG_LV3_UNIT_CD  THEN LTRIM(RTRIM(CONVERT(DECIMAL(10, 5),  CI.LV3_CBM))) 
				ELSE '0'
		   END )AS ITM_VOL,
		( CASE WHEN TEMP.ITM_UT_CD = CI.PKG_LV1_UNIT_CD THEN LTRIM(RTRIM(CONVERT(DECIMAL(10, 5),  CI.LV1_CBF))) 				 
				WHEN TEMP.ITM_UT_CD = CI.ITEM_PKGUNIT  THEN LTRIM(RTRIM(CONVERT(DECIMAL(10,  5), CI.ITEM_CBF))) 
				WHEN TEMP.ITM_UT_CD = CI.PKG_LV3_UNIT_CD  THEN LTRIM(RTRIM(CONVERT(DECIMAL(10, 5),  CI.LV3_CBF))) 
				ELSE '0'
		   END )AS ITM_VOL_CFT,
		   
		( CASE WHEN TEMP.ITM_UT_CD = CI.PKG_LV1_UNIT_CD THEN LTRIM(RTRIM(CONVERT(DECIMAL(10, 3),  CI.PKG_LV1_QTY))) 				 
				WHEN TEMP.ITM_UT_CD = CI.ITEM_PKGUNIT  THEN LTRIM(RTRIM(CONVERT(DECIMAL(10,  3), CI.ITEM_PKGBASEQTY))) 
				WHEN TEMP.ITM_UT_CD = CI.PKG_LV3_UNIT_CD  THEN LTRIM(RTRIM(CONVERT(DECIMAL(10, 3),  CI.PKG_LV3_QTY))) 
				ELSE LTRIM(RTRIM(CONVERT(DECIMAL(10, 0),  CI.PKG_LV4_QTY))) 
		   END )AS ITM_INR_QTY,
		   
	/* 0 AS ITM_INR_QTY,*/
	( CASE WHEN TEMP.ITM_UT_CD = CI.PKG_LV1_UNIT_CD THEN LTRIM(RTRIM(CONVERT(DECIMAL(10, 2),  CI.LV1_LENGTH))) 				 
				WHEN TEMP.ITM_UT_CD = CI.ITEM_PKGUNIT  THEN LTRIM(RTRIM(CONVERT(DECIMAL(10,  2), CI.ITEM_LENGTH))) 
				WHEN TEMP.ITM_UT_CD = CI.PKG_LV3_UNIT_CD  THEN LTRIM(RTRIM(CONVERT(DECIMAL(10, 2),  CI.LV3_LENGTH))) 
				ELSE '0'
		   END )AS ITM_LEN, 		 		 
	( CASE WHEN TEMP.ITM_UT_CD = CI.PKG_LV1_UNIT_CD THEN LTRIM(RTRIM(CONVERT(DECIMAL(10, 2),  CI.LV1_WIDTH))) 				 
				WHEN TEMP.ITM_UT_CD = CI.ITEM_PKGUNIT  THEN LTRIM(RTRIM(CONVERT(DECIMAL(10,  2), CI.ITEM_WIDTH))) 
				WHEN TEMP.ITM_UT_CD = CI.PKG_LV3_UNIT_CD  THEN LTRIM(RTRIM(CONVERT(DECIMAL(10, 2),  CI.LV3_WIDTH))) 
				ELSE '0'
		   END )AS ITM_WDT, 	
		( CASE WHEN TEMP.ITM_UT_CD = CI.PKG_LV1_UNIT_CD THEN LTRIM(RTRIM(CONVERT(DECIMAL(10, 2),  CI.LV1_HEIGHT))) 				 
				WHEN TEMP.ITM_UT_CD = CI.ITEM_PKGUNIT  THEN LTRIM(RTRIM(CONVERT(DECIMAL(10,  2), CI.ITEM_HEIGHT))) 
				WHEN TEMP.ITM_UT_CD = CI.PKG_LV3_UNIT_CD  THEN LTRIM(RTRIM(CONVERT(DECIMAL(10, 2),  CI.LV3_HEIGHT))) 
				ELSE '0'
		   END )AS  ITM_HGT 
		FROM 
		 WHM_ITM_INVT IVN,
		 TL_CTRT_CUST_ITEM CI,
		 WHM_LOC LOC,
		 (
				SELECT DISTINCT CITM.ITEM_CD, WITM.ITM_UT_CD,IVN.CUST_ITM_ID,IVN.LOC_ID,CITM.ITEM_SYS_NO, RSP.CUST_CD, RSP.RGST_OFC_CD
							FROM WHM_RCV_SHP_ITM WITM, WHM_RCV_SHP RSP, TL_CTRT_CUST_ITEM CITM, WHM_ITM_INVT IVN
							WHERE 1=1 
							AND WITM.FILE_NO     = RSP.FILE_NO
							AND WITM.RGST_OFC_CD = RSP.RGST_OFC_CD
							AND WITM.CUST_ITM_ID = CITM.ITEM_CD 
							AND IVN.CUST_ITM_ID  = CITM.ITEM_CD
							AND IVN.CTRT_NO		 = RSP.CTRT_NO
							AND CITM.CTRT_NO     = RSP.CTRT_NO
						
			) TEMP
		WHERE 1 = 1
		 AND LOC.WH_CD        =   #whCd# 
		 AND IVN.LOC_ID    = LOC.LOC_ID
		 AND IVN.CUST_ITM_ID  = CI.ITEM_CD
		 AND TEMP.ITEM_CD  = CI.ITEM_CD
		 AND IVN.CTRT_NO = CI.CTRT_NO
		 AND TEMP.ITEM_SYS_NO =  CI. ITEM_SYS_NO
		 AND ISNULL(IVN.ITM_TTL_QTY, 0) > 0	
		 AND IVN.ITM_UT_CD = TEMP.ITM_UT_CD 
		 <isNotEmpty property="itmCd">
		  AND IVN.CUST_ITM_ID = #itmCd#
		 </isNotEmpty>
		 <isNotEmpty property="custCd">
		  AND TEMP.CUST_CD =     #custCd#
		 </isNotEmpty>
		 <!-- isNotEmpty property="rgstOfcCd">
		  AND TEMP.RGST_OFC_CD = #rgstOfcCd#
		 </isNotEmpty-->
		 <isNotEmpty property="s_ctrt_no">
		  AND CI.CTRT_NO = #s_ctrt_no#
		 </isNotEmpty>
		 ORDER BY IVN.CUST_ITM_ID , LOC_CD
	</select>
	
	<select id="searchInOutHistoryRSQL"  parameterClass="java.util.HashMap"  resultClass="InventoryVO">
	/* WhmInventorySQL.xml > searchInOutHistoryRSQL.Query*/
		SELECT 
			WRS.CUST_CD,
			(SELECT TOP 1 TP.LOCL_NM 
				FROM TB_TRDP TP 
				WHERE 1 = 1
				AND TP.TRDP_CD = WRS.CUST_CD 
			<!-- 	AND ISNULL(TP.DELT_FLG, 'N') = 'N' -->
				) AS CUST_NM,
			WRSI.CUST_ITM_ID,
			ITM.ITEM_NM ITM_NM,
			WRSI.ITM_UT_CD,
			WRS.RCV_SHP_DT,
			CASE WRS.RCV_SHP_TP_CD 
				WHEN 'RCV' THEN 'Inbound'  
				ELSE 'Outbound' END RCV_SHP_TP_CD,
			(SELECT TOP 1 TP.LOCL_NM 
				FROM TB_TRDP TP 
				WHERE 1 = 1
				AND TP.TRDP_CD = WRS.SPLR_RCVR_CD 
<!-- 				AND ISNULL(TP.DELT_FLG, 'N') = 'N' -->
				) AS SPLR_RCVR_CD,
			WRS.FILE_NO,
			ISNULL(WRSI.ITM_BGN_BAL_QTY, 0) BGN_BAL,
		
			CASE WRS.RCV_SHP_TP_CD WHEN 'RCV' THEN ISNULL(WRSI.ITM_CTN_QTY, 0) END IN_CTN,
			CASE WRS.RCV_SHP_TP_CD WHEN 'RCV' THEN ISNULL(WRSI.ITM_EA_QTY, 0)  END IN_EA,
			CASE WRS.RCV_SHP_TP_CD WHEN 'RCV' THEN (ISNULL(WRSI.ITM_CTN_QTY, 0) * ISNULL(WRSI.ITM_INR_QTY, 0) + ISNULL(WRSI.ITM_EA_QTY, 0)) END IN_ITM_TTL_QTY,
			CASE WRS.RCV_SHP_TP_CD WHEN 'RCV' THEN ISNULL(WRSI.ITM_ACT_WGT, 0) END IN_KGS,
			CASE WRS.RCV_SHP_TP_CD WHEN 'RCV' THEN ISNULL(WRSI.ITM_ACT_WGT_LBS, 0) END IN_LBS,
			CASE WRS.RCV_SHP_TP_CD WHEN 'RCV' THEN ISNULL(WRSI.ITM_VOL, 0) END IN_CBM,
			CASE WRS.RCV_SHP_TP_CD WHEN 'RCV' THEN ISNULL(WRSI.ITM_VOL_CFT, 0) END IN_CFT,
		
			CASE WRS.RCV_SHP_TP_CD WHEN 'SHP' THEN ISNULL(WRSI.ITM_CTN_QTY, 0) END OUT_CTN,
			CASE WRS.RCV_SHP_TP_CD WHEN 'SHP' THEN ISNULL(WRSI.ITM_EA_QTY, 0)  END OUT_EA,
			CASE WRS.RCV_SHP_TP_CD WHEN 'SHP' THEN (ISNULL(WRSI.ITM_CTN_QTY, 0) * ISNULL(WRSI.ITM_INR_QTY, 0) + ISNULL(WRSI.ITM_EA_QTY, 0)) END OUT_ITM_TTL_QTY,
			CASE WRS.RCV_SHP_TP_CD WHEN 'SHP' THEN ISNULL(WRSI.ITM_ACT_WGT, 0) END OUT_KGS,
			CASE WRS.RCV_SHP_TP_CD WHEN 'SHP' THEN ISNULL(WRSI.ITM_ACT_WGT_LBS, 0) END OUT_LBS,
			CASE WRS.RCV_SHP_TP_CD WHEN 'SHP' THEN ISNULL(WRSI.ITM_VOL, 0) END OUT_CBM,
			CASE WRS.RCV_SHP_TP_CD WHEN 'SHP' THEN ISNULL(WRSI.ITM_VOL_CFT, 0) END OUT_CFT,
		

			ISNULL(WRSI.ITM_ENDG_BAL_QTY, 0) END_BAL,
			WRS.CTRT_NO,
			(SELECT TL_CTRT.CTRT_NM CTRT_NM FROM TL_CTRT WHERE 1=1 AND TL_CTRT.CTRT_NO = WRS.CTRT_NO) AS CTRT_NM
		FROM  
			  WHM_RCV_SHP WRS,
			  WHM_RCV_SHP_ITM WRSI,
			  TL_CTRT_CUST_ITEM ITM  
<!-- 			  WHM_CUST_ITM ITM  -->
		WHERE 1 = 1
			AND WRS.WH_CD        = #whCd# 
			AND WRS.FILE_NO      = WRSI.FILE_NO	
			AND WRS.RGST_OFC_CD  = WRSI.RGST_OFC_CD
			AND WRS.CTRT_NO  	 = ITM.CTRT_NO
			AND WRSI.CUST_ITM_ID = ITM.ITEM_CD
<!-- 			AND WRSI.CUST_ITM_ID = ITM.CUST_ITM_ID -->
			AND ISNULL(WRS.RCV_SHP_FLG, 'N') = 'Y'
			<isNotEmpty property="custCd">
				AND WRS.CUST_CD =     #custCd#
			</isNotEmpty>
			<isNotEmpty property="rgstOfcCd">
				AND WRS.RGST_OFC_CD = #rgstOfcCd#
			</isNotEmpty>
			<isNotEmpty property="itmCd">
				AND WRSI.CUST_ITM_ID = #itmCd#
			</isNotEmpty>
			<isNotEmpty property="sdate">
				<isNotEmpty property="edate">
					AND WRS.RCV_SHP_DT BETWEEN #sdate# AND #edate#
				</isNotEmpty>
			</isNotEmpty>
			<isNotEmpty property="ctrt_no">
			  AND WRS.CTRT_NO = #ctrt_no#
			</isNotEmpty>
		ORDER BY 
			WRS.CUST_CD,
			WRSI.CUST_ITM_ID,
			WRS.CTRT_NO,
			ITM.ITEM_NM,
			WRS.RCV_SHP_DT,
			WRSI.ITM_UT_CD ASC,
			WRS.RCV_SHP_TP_CD,
			WRS.SPLR_RCVR_CD,
			WRS.CRE_DT
	</select>
</sqlMap>